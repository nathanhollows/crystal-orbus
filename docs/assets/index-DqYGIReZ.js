(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))b(E);new MutationObserver(E=>{for(const P of E)if(P.type==="childList")for(const z of P.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&b(z)}).observe(document,{childList:!0,subtree:!0});function g(E){const P={};return E.integrity&&(P.integrity=E.integrity),E.referrerPolicy&&(P.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?P.credentials="include":E.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function b(E){if(E.ep)return;E.ep=!0;const P=g(E);fetch(E.href,P)}})();/**
* @vue/shared v3.4.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function i0(l,f){const g=new Set(l.split(","));return b=>g.has(b)}const Dn={},Vh=[],aa=()=>{},DC=()=>!1,u_=l=>l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&(l.charCodeAt(2)>122||l.charCodeAt(2)<97),n0=l=>l.startsWith("onUpdate:"),Lo=Object.assign,o0=(l,f)=>{const g=l.indexOf(f);g>-1&&l.splice(g,1)},zC=Object.prototype.hasOwnProperty,Wi=(l,f)=>zC.call(l,f),di=Array.isArray,Gh=l=>h_(l)==="[object Map]",oT=l=>h_(l)==="[object Set]",vi=l=>typeof l=="function",Eo=l=>typeof l=="string",qu=l=>typeof l=="symbol",zn=l=>l!==null&&typeof l=="object",sT=l=>(zn(l)||vi(l))&&vi(l.then)&&vi(l.catch),aT=Object.prototype.toString,h_=l=>aT.call(l),kC=l=>h_(l).slice(8,-1),lT=l=>h_(l)==="[object Object]",s0=l=>Eo(l)&&l!=="NaN"&&l[0]!=="-"&&""+parseInt(l,10)===l,Ff=i0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),d_=l=>{const f=Object.create(null);return g=>f[g]||(f[g]=l(g))},FC=/-(\w)/g,ll=d_(l=>l.replace(FC,(f,g)=>g?g.toUpperCase():"")),BC=/\B([A-Z])/g,Qh=d_(l=>l.replace(BC,"-$1").toLowerCase()),f_=d_(l=>l.charAt(0).toUpperCase()+l.slice(1)),gy=d_(l=>l?`on${f_(l)}`:""),Fc=(l,f)=>!Object.is(l,f),yy=(l,f)=>{for(let g=0;g<l.length;g++)l[g](f)},cT=(l,f,g,b=!1)=>{Object.defineProperty(l,f,{configurable:!0,enumerable:!1,writable:b,value:g})},NC=l=>{const f=parseFloat(l);return isNaN(f)?l:f};let j1;const uT=()=>j1||(j1=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function $h(l){if(di(l)){const f={};for(let g=0;g<l.length;g++){const b=l[g],E=Eo(b)?GC(b):$h(b);if(E)for(const P in E)f[P]=E[P]}return f}else if(Eo(l)||zn(l))return l}const UC=/;(?![^(]*\))/g,jC=/:([^]+)/,VC=/\/\*[^]*?\*\//g;function GC(l){const f={};return l.replace(VC,"").split(UC).forEach(g=>{if(g){const b=g.split(jC);b.length>1&&(f[b[0].trim()]=b[1].trim())}}),f}function p_(l){let f="";if(Eo(l))f=l;else if(di(l))for(let g=0;g<l.length;g++){const b=p_(l[g]);b&&(f+=b+" ")}else if(zn(l))for(const g in l)l[g]&&(f+=g+" ");return f.trim()}const $C="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",qC=i0($C);function hT(l){return!!l||l===""}const Nu=l=>Eo(l)?l:l==null?"":di(l)||zn(l)&&(l.toString===aT||!vi(l.toString))?JSON.stringify(l,dT,2):String(l),dT=(l,f)=>f&&f.__v_isRef?dT(l,f.value):Gh(f)?{[`Map(${f.size})`]:[...f.entries()].reduce((g,[b,E],P)=>(g[vy(b,P)+" =>"]=E,g),{})}:oT(f)?{[`Set(${f.size})`]:[...f.values()].map(g=>vy(g))}:qu(f)?vy(f):zn(f)&&!di(f)&&!lT(f)?String(f):f,vy=(l,f="")=>{var g;return qu(l)?`Symbol(${(g=l.description)!=null?g:f})`:l};/**
* @vue/reactivity v3.4.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Pa;class fT{constructor(f=!1){this.detached=f,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Pa,!f&&Pa&&(this.index=(Pa.scopes||(Pa.scopes=[])).push(this)-1)}get active(){return this._active}run(f){if(this._active){const g=Pa;try{return Pa=this,f()}finally{Pa=g}}}on(){Pa=this}off(){Pa=this.parent}stop(f){if(this._active){let g,b;for(g=0,b=this.effects.length;g<b;g++)this.effects[g].stop();for(g=0,b=this.cleanups.length;g<b;g++)this.cleanups[g]();if(this.scopes)for(g=0,b=this.scopes.length;g<b;g++)this.scopes[g].stop(!0);if(!this.detached&&this.parent&&!f){const E=this.parent.scopes.pop();E&&E!==this&&(this.parent.scopes[this.index]=E,E.index=this.index)}this.parent=void 0,this._active=!1}}}function ZC(l){return new fT(l)}function HC(l,f=Pa){f&&f.active&&f.effects.push(l)}function WC(){return Pa}let Vu;class a0{constructor(f,g,b,E){this.fn=f,this.trigger=g,this.scheduler=b,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,HC(this,E)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,jc();for(let f=0;f<this._depsLength;f++){const g=this.deps[f];if(g.computed&&(XC(g.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Vc()}return this._dirtyLevel>=4}set dirty(f){this._dirtyLevel=f?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let f=zc,g=Vu;try{return zc=!0,Vu=this,this._runnings++,V1(this),this.fn()}finally{G1(this),this._runnings--,Vu=g,zc=f}}stop(){this.active&&(V1(this),G1(this),this.onStop&&this.onStop(),this.active=!1)}}function XC(l){return l.value}function V1(l){l._trackId++,l._depsLength=0}function G1(l){if(l.deps.length>l._depsLength){for(let f=l._depsLength;f<l.deps.length;f++)pT(l.deps[f],l);l.deps.length=l._depsLength}}function pT(l,f){const g=l.get(f);g!==void 0&&f._trackId!==g&&(l.delete(f),l.size===0&&l.cleanup())}let zc=!0,By=0;const mT=[];function jc(){mT.push(zc),zc=!1}function Vc(){const l=mT.pop();zc=l===void 0?!0:l}function l0(){By++}function c0(){for(By--;!By&&Ny.length;)Ny.shift()()}function _T(l,f,g){if(f.get(l)!==l._trackId){f.set(l,l._trackId);const b=l.deps[l._depsLength];b!==f?(b&&pT(b,l),l.deps[l._depsLength++]=f):l._depsLength++}}const Ny=[];function gT(l,f,g){l0();for(const b of l.keys()){let E;b._dirtyLevel<f&&(E??(E=l.get(b)===b._trackId))&&(b._shouldSchedule||(b._shouldSchedule=b._dirtyLevel===0),b._dirtyLevel=f),b._shouldSchedule&&(E??(E=l.get(b)===b._trackId))&&(b.trigger(),(!b._runnings||b.allowRecurse)&&b._dirtyLevel!==2&&(b._shouldSchedule=!1,b.scheduler&&Ny.push(b.scheduler)))}c0()}const yT=(l,f)=>{const g=new Map;return g.cleanup=l,g.computed=f,g},e_=new WeakMap,Gu=Symbol(""),Uy=Symbol("");function ws(l,f,g){if(zc&&Vu){let b=e_.get(l);b||e_.set(l,b=new Map);let E=b.get(g);E||b.set(g,E=yT(()=>b.delete(g))),_T(Vu,E)}}function Ul(l,f,g,b,E,P){const z=e_.get(l);if(!z)return;let j=[];if(f==="clear")j=[...z.values()];else if(g==="length"&&di(l)){const s=Number(b);z.forEach((K,Q)=>{(Q==="length"||!qu(Q)&&Q>=s)&&j.push(K)})}else switch(g!==void 0&&j.push(z.get(g)),f){case"add":di(l)?s0(g)&&j.push(z.get("length")):(j.push(z.get(Gu)),Gh(l)&&j.push(z.get(Uy)));break;case"delete":di(l)||(j.push(z.get(Gu)),Gh(l)&&j.push(z.get(Uy)));break;case"set":Gh(l)&&j.push(z.get(Gu));break}l0();for(const s of j)s&&gT(s,4);c0()}function YC(l,f){const g=e_.get(l);return g&&g.get(f)}const KC=i0("__proto__,__v_isRef,__isVue"),vT=new Set(Object.getOwnPropertyNames(Symbol).filter(l=>l!=="arguments"&&l!=="caller").map(l=>Symbol[l]).filter(qu)),$1=JC();function JC(){const l={};return["includes","indexOf","lastIndexOf"].forEach(f=>{l[f]=function(...g){const b=rn(this);for(let P=0,z=this.length;P<z;P++)ws(b,"get",P+"");const E=b[f](...g);return E===-1||E===!1?b[f](...g.map(rn)):E}}),["push","pop","shift","unshift","splice"].forEach(f=>{l[f]=function(...g){jc(),l0();const b=rn(this)[f].apply(this,g);return c0(),Vc(),b}}),l}function QC(l){qu(l)||(l=String(l));const f=rn(this);return ws(f,"has",l),f.hasOwnProperty(l)}class xT{constructor(f=!1,g=!1){this._isReadonly=f,this._isShallow=g}get(f,g,b){const E=this._isReadonly,P=this._isShallow;if(g==="__v_isReactive")return!E;if(g==="__v_isReadonly")return E;if(g==="__v_isShallow")return P;if(g==="__v_raw")return b===(E?P?dP:ET:P?TT:wT).get(f)||Object.getPrototypeOf(f)===Object.getPrototypeOf(b)?f:void 0;const z=di(f);if(!E){if(z&&Wi($1,g))return Reflect.get($1,g,b);if(g==="hasOwnProperty")return QC}const j=Reflect.get(f,g,b);return(qu(g)?vT.has(g):KC(g))||(E||ws(f,"get",g),P)?j:Ko(j)?z&&s0(g)?j:j.value:zn(j)?E?MT(j):tp(j):j}}class bT extends xT{constructor(f=!1){super(!1,f)}set(f,g,b,E){let P=f[g];if(!this._isShallow){const s=qf(P);if(!t_(b)&&!qf(b)&&(P=rn(P),b=rn(b)),!di(f)&&Ko(P)&&!Ko(b))return s?!1:(P.value=b,!0)}const z=di(f)&&s0(g)?Number(g)<f.length:Wi(f,g),j=Reflect.set(f,g,b,E);return f===rn(E)&&(z?Fc(b,P)&&Ul(f,"set",g,b):Ul(f,"add",g,b)),j}deleteProperty(f,g){const b=Wi(f,g);f[g];const E=Reflect.deleteProperty(f,g);return E&&b&&Ul(f,"delete",g,void 0),E}has(f,g){const b=Reflect.has(f,g);return(!qu(g)||!vT.has(g))&&ws(f,"has",g),b}ownKeys(f){return ws(f,"iterate",di(f)?"length":Gu),Reflect.ownKeys(f)}}class eP extends xT{constructor(f=!1){super(!0,f)}set(f,g){return!0}deleteProperty(f,g){return!0}}const tP=new bT,rP=new eP,iP=new bT(!0);const u0=l=>l,m_=l=>Reflect.getPrototypeOf(l);function Nm(l,f,g=!1,b=!1){l=l.__v_raw;const E=rn(l),P=rn(f);g||(Fc(f,P)&&ws(E,"get",f),ws(E,"get",P));const{has:z}=m_(E),j=b?u0:g?f0:Zf;if(z.call(E,f))return j(l.get(f));if(z.call(E,P))return j(l.get(P));l!==E&&l.get(f)}function Um(l,f=!1){const g=this.__v_raw,b=rn(g),E=rn(l);return f||(Fc(l,E)&&ws(b,"has",l),ws(b,"has",E)),l===E?g.has(l):g.has(l)||g.has(E)}function jm(l,f=!1){return l=l.__v_raw,!f&&ws(rn(l),"iterate",Gu),Reflect.get(l,"size",l)}function q1(l){l=rn(l);const f=rn(this);return m_(f).has.call(f,l)||(f.add(l),Ul(f,"add",l,l)),this}function Z1(l,f){f=rn(f);const g=rn(this),{has:b,get:E}=m_(g);let P=b.call(g,l);P||(l=rn(l),P=b.call(g,l));const z=E.call(g,l);return g.set(l,f),P?Fc(f,z)&&Ul(g,"set",l,f):Ul(g,"add",l,f),this}function H1(l){const f=rn(this),{has:g,get:b}=m_(f);let E=g.call(f,l);E||(l=rn(l),E=g.call(f,l)),b&&b.call(f,l);const P=f.delete(l);return E&&Ul(f,"delete",l,void 0),P}function W1(){const l=rn(this),f=l.size!==0,g=l.clear();return f&&Ul(l,"clear",void 0,void 0),g}function Vm(l,f){return function(b,E){const P=this,z=P.__v_raw,j=rn(z),s=f?u0:l?f0:Zf;return!l&&ws(j,"iterate",Gu),z.forEach((K,Q)=>b.call(E,s(K),s(Q),P))}}function Gm(l,f,g){return function(...b){const E=this.__v_raw,P=rn(E),z=Gh(P),j=l==="entries"||l===Symbol.iterator&&z,s=l==="keys"&&z,K=E[l](...b),Q=g?u0:f?f0:Zf;return!f&&ws(P,"iterate",s?Uy:Gu),{next(){const{value:re,done:we}=K.next();return we?{value:re,done:we}:{value:j?[Q(re[0]),Q(re[1])]:Q(re),done:we}},[Symbol.iterator](){return this}}}}function Ac(l){return function(...f){return l==="delete"?!1:l==="clear"?void 0:this}}function nP(){const l={get(P){return Nm(this,P)},get size(){return jm(this)},has:Um,add:q1,set:Z1,delete:H1,clear:W1,forEach:Vm(!1,!1)},f={get(P){return Nm(this,P,!1,!0)},get size(){return jm(this)},has:Um,add:q1,set:Z1,delete:H1,clear:W1,forEach:Vm(!1,!0)},g={get(P){return Nm(this,P,!0)},get size(){return jm(this,!0)},has(P){return Um.call(this,P,!0)},add:Ac("add"),set:Ac("set"),delete:Ac("delete"),clear:Ac("clear"),forEach:Vm(!0,!1)},b={get(P){return Nm(this,P,!0,!0)},get size(){return jm(this,!0)},has(P){return Um.call(this,P,!0)},add:Ac("add"),set:Ac("set"),delete:Ac("delete"),clear:Ac("clear"),forEach:Vm(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(P=>{l[P]=Gm(P,!1,!1),g[P]=Gm(P,!0,!1),f[P]=Gm(P,!1,!0),b[P]=Gm(P,!0,!0)}),[l,g,f,b]}const[oP,sP,aP,lP]=nP();function h0(l,f){const g=f?l?lP:aP:l?sP:oP;return(b,E,P)=>E==="__v_isReactive"?!l:E==="__v_isReadonly"?l:E==="__v_raw"?b:Reflect.get(Wi(g,E)&&E in b?g:b,E,P)}const cP={get:h0(!1,!1)},uP={get:h0(!1,!0)},hP={get:h0(!0,!1)};const wT=new WeakMap,TT=new WeakMap,ET=new WeakMap,dP=new WeakMap;function fP(l){switch(l){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function pP(l){return l.__v_skip||!Object.isExtensible(l)?0:fP(kC(l))}function tp(l){return qf(l)?l:d0(l,!1,tP,cP,wT)}function ST(l){return d0(l,!1,iP,uP,TT)}function MT(l){return d0(l,!0,rP,hP,ET)}function d0(l,f,g,b,E){if(!zn(l)||l.__v_raw&&!(f&&l.__v_isReactive))return l;const P=E.get(l);if(P)return P;const z=pP(l);if(z===0)return l;const j=new Proxy(l,z===2?b:g);return E.set(l,j),j}function Bf(l){return qf(l)?Bf(l.__v_raw):!!(l&&l.__v_isReactive)}function qf(l){return!!(l&&l.__v_isReadonly)}function t_(l){return!!(l&&l.__v_isShallow)}function AT(l){return l?!!l.__v_raw:!1}function rn(l){const f=l&&l.__v_raw;return f?rn(f):l}function IT(l){return Object.isExtensible(l)&&cT(l,"__v_skip",!0),l}const Zf=l=>zn(l)?tp(l):l,f0=l=>zn(l)?MT(l):l;class CT{constructor(f,g,b,E){this.getter=f,this._setter=g,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new a0(()=>f(this._value),()=>Hm(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!E,this.__v_isReadonly=b}get value(){const f=rn(this);return(!f._cacheable||f.effect.dirty)&&Fc(f._value,f._value=f.effect.run())&&Hm(f,4),PT(f),f.effect._dirtyLevel>=2&&Hm(f,2),f._value}set value(f){this._setter(f)}get _dirty(){return this.effect.dirty}set _dirty(f){this.effect.dirty=f}}function mP(l,f,g=!1){let b,E;const P=vi(l);return P?(b=l,E=aa):(b=l.get,E=l.set),new CT(b,E,P||!E,g)}function PT(l){var f;zc&&Vu&&(l=rn(l),_T(Vu,(f=l.dep)!=null?f:l.dep=yT(()=>l.dep=void 0,l instanceof CT?l:void 0)))}function Hm(l,f=4,g){l=rn(l);const b=l.dep;b&&gT(b,f)}function Ko(l){return!!(l&&l.__v_isRef===!0)}function Po(l){return LT(l,!1)}function _P(l){return LT(l,!0)}function LT(l,f){return Ko(l)?l:new gP(l,f)}class gP{constructor(f,g){this.__v_isShallow=g,this.dep=void 0,this.__v_isRef=!0,this._rawValue=g?f:rn(f),this._value=g?f:Zf(f)}get value(){return PT(this),this._value}set value(f){const g=this.__v_isShallow||t_(f)||qf(f);f=g?f:rn(f),Fc(f,this._rawValue)&&(this._rawValue=f,this._value=g?f:Zf(f),Hm(this,4))}}function al(l){return Ko(l)?l.value:l}const yP={get:(l,f,g)=>al(Reflect.get(l,f,g)),set:(l,f,g,b)=>{const E=l[f];return Ko(E)&&!Ko(g)?(E.value=g,!0):Reflect.set(l,f,g,b)}};function RT(l){return Bf(l)?l:new Proxy(l,yP)}function vP(l){const f=di(l)?new Array(l.length):{};for(const g in l)f[g]=OT(l,g);return f}class xP{constructor(f,g,b){this._object=f,this._key=g,this._defaultValue=b,this.__v_isRef=!0}get value(){const f=this._object[this._key];return f===void 0?this._defaultValue:f}set value(f){this._object[this._key]=f}get dep(){return YC(rn(this._object),this._key)}}class bP{constructor(f){this._getter=f,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function wP(l,f,g){return Ko(l)?l:vi(l)?new bP(l):zn(l)&&arguments.length>1?OT(l,f,g):Po(l)}function OT(l,f,g){const b=l[f];return Ko(b)?b:new xP(l,f,g)}/**
* @vue/runtime-core v3.4.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function kc(l,f,g,b){try{return b?l(...b):l()}catch(E){__(E,f,g)}}function Ra(l,f,g,b){if(vi(l)){const E=kc(l,f,g,b);return E&&sT(E)&&E.catch(P=>{__(P,f,g)}),E}if(di(l)){const E=[];for(let P=0;P<l.length;P++)E.push(Ra(l[P],f,g,b));return E}}function __(l,f,g,b=!0){const E=f?f.vnode:null;if(f){let P=f.parent;const z=f.proxy,j=`https://vuejs.org/error-reference/#runtime-${g}`;for(;P;){const K=P.ec;if(K){for(let Q=0;Q<K.length;Q++)if(K[Q](l,z,j)===!1)return}P=P.parent}const s=f.appContext.config.errorHandler;if(s){jc(),kc(s,null,10,[l,z,j]),Vc();return}}TP(l,g,E,b)}function TP(l,f,g,b=!0){console.error(l)}let Hf=!1,jy=!1;const Yo=[];let ol=0;const qh=[];let Lc=null,Uu=0;const DT=Promise.resolve();let p0=null;function zT(l){const f=p0||DT;return l?f.then(this?l.bind(this):l):f}function EP(l){let f=ol+1,g=Yo.length;for(;f<g;){const b=f+g>>>1,E=Yo[b],P=Wf(E);P<l||P===l&&E.pre?f=b+1:g=b}return f}function m0(l){(!Yo.length||!Yo.includes(l,Hf&&l.allowRecurse?ol+1:ol))&&(l.id==null?Yo.push(l):Yo.splice(EP(l.id),0,l),kT())}function kT(){!Hf&&!jy&&(jy=!0,p0=DT.then(BT))}function SP(l){const f=Yo.indexOf(l);f>ol&&Yo.splice(f,1)}function MP(l){di(l)?qh.push(...l):(!Lc||!Lc.includes(l,l.allowRecurse?Uu+1:Uu))&&qh.push(l),kT()}function X1(l,f,g=Hf?ol+1:0){for(;g<Yo.length;g++){const b=Yo[g];if(b&&b.pre){if(l&&b.id!==l.uid)continue;Yo.splice(g,1),g--,b()}}}function FT(l){if(qh.length){const f=[...new Set(qh)].sort((g,b)=>Wf(g)-Wf(b));if(qh.length=0,Lc){Lc.push(...f);return}for(Lc=f,Uu=0;Uu<Lc.length;Uu++)Lc[Uu]();Lc=null,Uu=0}}const Wf=l=>l.id==null?1/0:l.id,AP=(l,f)=>{const g=Wf(l)-Wf(f);if(g===0){if(l.pre&&!f.pre)return-1;if(f.pre&&!l.pre)return 1}return g};function BT(l){jy=!1,Hf=!0,Yo.sort(AP);try{for(ol=0;ol<Yo.length;ol++){const f=Yo[ol];f&&f.active!==!1&&kc(f,null,14)}}finally{ol=0,Yo.length=0,FT(),Hf=!1,p0=null,(Yo.length||qh.length)&&BT()}}function IP(l,f,...g){if(l.isUnmounted)return;const b=l.vnode.props||Dn;let E=g;const P=f.startsWith("update:"),z=P&&f.slice(7);if(z&&z in b){const Q=`${z==="modelValue"?"model":z}Modifiers`,{number:re,trim:we}=b[Q]||Dn;we&&(E=g.map(Ee=>Eo(Ee)?Ee.trim():Ee)),re&&(E=g.map(NC))}let j,s=b[j=gy(f)]||b[j=gy(ll(f))];!s&&P&&(s=b[j=gy(Qh(f))]),s&&Ra(s,l,6,E);const K=b[j+"Once"];if(K){if(!l.emitted)l.emitted={};else if(l.emitted[j])return;l.emitted[j]=!0,Ra(K,l,6,E)}}function NT(l,f,g=!1){const b=f.emitsCache,E=b.get(l);if(E!==void 0)return E;const P=l.emits;let z={},j=!1;if(!vi(l)){const s=K=>{const Q=NT(K,f,!0);Q&&(j=!0,Lo(z,Q))};!g&&f.mixins.length&&f.mixins.forEach(s),l.extends&&s(l.extends),l.mixins&&l.mixins.forEach(s)}return!P&&!j?(zn(l)&&b.set(l,null),null):(di(P)?P.forEach(s=>z[s]=null):Lo(z,P),zn(l)&&b.set(l,z),z)}function g_(l,f){return!l||!u_(f)?!1:(f=f.slice(2).replace(/Once$/,""),Wi(l,f[0].toLowerCase()+f.slice(1))||Wi(l,Qh(f))||Wi(l,f))}let To=null,y_=null;function r_(l){const f=To;return To=l,y_=l&&l.type.__scopeId||null,f}function CP(l){y_=l}function PP(){y_=null}function jl(l,f=To,g){if(!f||l._n)return l;const b=(...E)=>{b._d&&sw(-1);const P=r_(f);let z;try{z=l(...E)}finally{r_(P),b._d&&sw(1)}return z};return b._n=!0,b._c=!0,b._d=!0,b}function xy(l){const{type:f,vnode:g,proxy:b,withProxy:E,propsOptions:[P],slots:z,attrs:j,emit:s,render:K,renderCache:Q,props:re,data:we,setupState:Ee,ctx:Me,inheritAttrs:Ce}=l,Ue=r_(l);let lt,$t;try{if(g.shapeFlag&4){const yr=E||b,zr=yr;lt=nl(K.call(zr,yr,Q,re,Ee,we,Me)),$t=j}else{const yr=f;lt=nl(yr.length>1?yr(re,{attrs:j,slots:z,emit:s}):yr(re,null)),$t=f.props?j:LP(j)}}catch(yr){Vf.length=0,__(yr,l,1),lt=bn(Bc)}let It=lt;if($t&&Ce!==!1){const yr=Object.keys($t),{shapeFlag:zr}=It;yr.length&&zr&7&&(P&&yr.some(n0)&&($t=RP($t,P)),It=Wh(It,$t,!1,!0))}return g.dirs&&(It=Wh(It,null,!1,!0),It.dirs=It.dirs?It.dirs.concat(g.dirs):g.dirs),g.transition&&(It.transition=g.transition),lt=It,r_(Ue),lt}const LP=l=>{let f;for(const g in l)(g==="class"||g==="style"||u_(g))&&((f||(f={}))[g]=l[g]);return f},RP=(l,f)=>{const g={};for(const b in l)(!n0(b)||!(b.slice(9)in f))&&(g[b]=l[b]);return g};function OP(l,f,g){const{props:b,children:E,component:P}=l,{props:z,children:j,patchFlag:s}=f,K=P.emitsOptions;if(f.dirs||f.transition)return!0;if(g&&s>=0){if(s&1024)return!0;if(s&16)return b?Y1(b,z,K):!!z;if(s&8){const Q=f.dynamicProps;for(let re=0;re<Q.length;re++){const we=Q[re];if(z[we]!==b[we]&&!g_(K,we))return!0}}}else return(E||j)&&(!j||!j.$stable)?!0:b===z?!1:b?z?Y1(b,z,K):!0:!!z;return!1}function Y1(l,f,g){const b=Object.keys(f);if(b.length!==Object.keys(l).length)return!0;for(let E=0;E<b.length;E++){const P=b[E];if(f[P]!==l[P]&&!g_(g,P))return!0}return!1}function DP({vnode:l,parent:f},g){for(;f;){const b=f.subTree;if(b.suspense&&b.suspense.activeBranch===l&&(b.el=l.el),b===l)(l=f.vnode).el=g,f=f.parent;else break}}const zP="components";function Vl(l,f){return FP(zP,l,!0,f)||l}const kP=Symbol.for("v-ndc");function FP(l,f,g=!0,b=!1){const E=To||Fo;if(E){const P=E.type;{const j=LL(P,!1);if(j&&(j===f||j===ll(f)||j===f_(ll(f))))return P}const z=K1(E[l]||P[l],f)||K1(E.appContext[l],f);return!z&&b?P:z}}function K1(l,f){return l&&(l[f]||l[ll(f)]||l[f_(ll(f))])}const BP=l=>l.__isSuspense;function NP(l,f){f&&f.pendingBranch?di(l)?f.effects.push(...l):f.effects.push(l):MP(l)}const UP=Symbol.for("v-scx"),jP=()=>_n(UP),$m={};function Yn(l,f,g){return UT(l,f,g)}function UT(l,f,{immediate:g,deep:b,flush:E,once:P,onTrack:z,onTrigger:j}=Dn){if(f&&P){const hr=f;f=(...Ai)=>{hr(...Ai),zr()}}const s=Fo,K=hr=>b===!0?hr:ju(hr,b===!1?1:void 0);let Q,re=!1,we=!1;if(Ko(l)?(Q=()=>l.value,re=t_(l)):Bf(l)?(Q=()=>K(l),re=!0):di(l)?(we=!0,re=l.some(hr=>Bf(hr)||t_(hr)),Q=()=>l.map(hr=>{if(Ko(hr))return hr.value;if(Bf(hr))return K(hr);if(vi(hr))return kc(hr,s,2)})):vi(l)?f?Q=()=>kc(l,s,2):Q=()=>(Ee&&Ee(),Ra(l,s,3,[Me])):Q=aa,f&&b){const hr=Q;Q=()=>ju(hr())}let Ee,Me=hr=>{Ee=It.onStop=()=>{kc(hr,s,4),Ee=It.onStop=void 0}},Ce;if(w_)if(Me=aa,f?g&&Ra(f,s,3,[Q(),we?[]:void 0,Me]):Q(),E==="sync"){const hr=jP();Ce=hr.__watcherHandles||(hr.__watcherHandles=[])}else return aa;let Ue=we?new Array(l.length).fill($m):$m;const lt=()=>{if(!(!It.active||!It.dirty))if(f){const hr=It.run();(b||re||(we?hr.some((Ai,Ii)=>Fc(Ai,Ue[Ii])):Fc(hr,Ue)))&&(Ee&&Ee(),Ra(f,s,3,[hr,Ue===$m?void 0:we&&Ue[0]===$m?[]:Ue,Me]),Ue=hr)}else It.run()};lt.allowRecurse=!!f;let $t;E==="sync"?$t=lt:E==="post"?$t=()=>xs(lt,s&&s.suspense):(lt.pre=!0,s&&(lt.id=s.uid),$t=()=>m0(lt));const It=new a0(Q,aa,$t),yr=WC(),zr=()=>{It.stop(),yr&&o0(yr.effects,It)};return f?g?lt():Ue=It.run():E==="post"?xs(It.run.bind(It),s&&s.suspense):It.run(),Ce&&Ce.push(zr),zr}function VP(l,f,g){const b=this.proxy,E=Eo(l)?l.includes(".")?jT(b,l):()=>b[l]:l.bind(b,b);let P;vi(f)?P=f:(P=f.handler,g=f);const z=ip(this),j=UT(E,P.bind(b),g);return z(),j}function jT(l,f){const g=f.split(".");return()=>{let b=l;for(let E=0;E<g.length&&b;E++)b=b[g[E]];return b}}function ju(l,f=1/0,g){if(f<=0||!zn(l)||l.__v_skip||(g=g||new Set,g.has(l)))return l;if(g.add(l),f--,Ko(l))ju(l.value,f,g);else if(di(l))for(let b=0;b<l.length;b++)ju(l[b],f,g);else if(oT(l)||Gh(l))l.forEach(b=>{ju(b,f,g)});else if(lT(l))for(const b in l)ju(l[b],f,g);return l}function GP(l,f){if(To===null)return l;const g=T_(To)||To.proxy,b=l.dirs||(l.dirs=[]);for(let E=0;E<f.length;E++){let[P,z,j,s=Dn]=f[E];P&&(vi(P)&&(P={mounted:P,updated:P}),P.deep&&ju(z),b.push({dir:P,instance:g,value:z,oldValue:void 0,arg:j,modifiers:s}))}return l}function zu(l,f,g,b){const E=l.dirs,P=f&&f.dirs;for(let z=0;z<E.length;z++){const j=E[z];P&&(j.oldValue=P[z].value);let s=j.dir[b];s&&(jc(),Ra(s,g,8,[l.el,j,l,f]),Vc())}}/*! #__NO_SIDE_EFFECTS__ */function $n(l,f){return vi(l)?Lo({name:l.name},f,{setup:l}):l}const Nf=l=>!!l.type.__asyncLoader,VT=l=>l.type.__isKeepAlive;function $P(l,f){GT(l,"a",f)}function qP(l,f){GT(l,"da",f)}function GT(l,f,g=Fo){const b=l.__wdc||(l.__wdc=()=>{let E=g;for(;E;){if(E.isDeactivated)return;E=E.parent}return l()});if(v_(f,b,g),g){let E=g.parent;for(;E&&E.parent;)VT(E.parent.vnode)&&ZP(b,f,g,E),E=E.parent}}function ZP(l,f,g,b){const E=v_(f,l,b,!0);lo(()=>{o0(b[f],E)},g)}function v_(l,f,g=Fo,b=!1){if(g){const E=g[l]||(g[l]=[]),P=f.__weh||(f.__weh=(...z)=>{if(g.isUnmounted)return;jc();const j=ip(g),s=Ra(f,g,l,z);return j(),Vc(),s});return b?E.unshift(P):E.push(P),P}}const Gl=l=>(f,g=Fo)=>(!w_||l==="sp")&&v_(l,(...b)=>f(...b),g),HP=Gl("bm"),mo=Gl("m"),WP=Gl("bu"),XP=Gl("u"),YP=Gl("bum"),lo=Gl("um"),KP=Gl("sp"),JP=Gl("rtg"),QP=Gl("rtc");function eL(l,f=Fo){v_("ec",l,f)}function x_(l,f,g,b){let E;const P=g;if(di(l)||Eo(l)){E=new Array(l.length);for(let z=0,j=l.length;z<j;z++)E[z]=f(l[z],z,void 0,P)}else if(typeof l=="number"){E=new Array(l);for(let z=0;z<l;z++)E[z]=f(z+1,z,void 0,P)}else if(zn(l))if(l[Symbol.iterator])E=Array.from(l,(z,j)=>f(z,j,void 0,P));else{const z=Object.keys(l);E=new Array(z.length);for(let j=0,s=z.length;j<s;j++){const K=z[j];E[j]=f(l[K],K,j,P)}}else E=[];return E}function ss(l,f,g={},b,E){if(To.isCE||To.parent&&Nf(To.parent)&&To.parent.isCE)return f!=="default"&&(g.name=f),bn("slot",g,b&&b());let P=l[f];P&&P._c&&(P._d=!1),Di();const z=P&&$T(P(g)),j=rp(Xo,{key:g.key||z&&z.key||`_${f}`},z||(b?b():[]),z&&l._===1?64:-2);return j.scopeId&&(j.slotScopeIds=[j.scopeId+"-s"]),P&&P._c&&(P._d=!0),j}function $T(l){return l.some(f=>n_(f)?!(f.type===Bc||f.type===Xo&&!$T(f.children)):!0)?l:null}const Vy=l=>l?sE(l)?T_(l)||l.proxy:Vy(l.parent):null,Uf=Lo(Object.create(null),{$:l=>l,$el:l=>l.vnode.el,$data:l=>l.data,$props:l=>l.props,$attrs:l=>l.attrs,$slots:l=>l.slots,$refs:l=>l.refs,$parent:l=>Vy(l.parent),$root:l=>Vy(l.root),$emit:l=>l.emit,$options:l=>_0(l),$forceUpdate:l=>l.f||(l.f=()=>{l.effect.dirty=!0,m0(l.update)}),$nextTick:l=>l.n||(l.n=zT.bind(l.proxy)),$watch:l=>VP.bind(l)}),by=(l,f)=>l!==Dn&&!l.__isScriptSetup&&Wi(l,f),tL={get({_:l},f){if(f==="__v_skip")return!0;const{ctx:g,setupState:b,data:E,props:P,accessCache:z,type:j,appContext:s}=l;let K;if(f[0]!=="$"){const Ee=z[f];if(Ee!==void 0)switch(Ee){case 1:return b[f];case 2:return E[f];case 4:return g[f];case 3:return P[f]}else{if(by(b,f))return z[f]=1,b[f];if(E!==Dn&&Wi(E,f))return z[f]=2,E[f];if((K=l.propsOptions[0])&&Wi(K,f))return z[f]=3,P[f];if(g!==Dn&&Wi(g,f))return z[f]=4,g[f];Gy&&(z[f]=0)}}const Q=Uf[f];let re,we;if(Q)return f==="$attrs"&&ws(l.attrs,"get",""),Q(l);if((re=j.__cssModules)&&(re=re[f]))return re;if(g!==Dn&&Wi(g,f))return z[f]=4,g[f];if(we=s.config.globalProperties,Wi(we,f))return we[f]},set({_:l},f,g){const{data:b,setupState:E,ctx:P}=l;return by(E,f)?(E[f]=g,!0):b!==Dn&&Wi(b,f)?(b[f]=g,!0):Wi(l.props,f)||f[0]==="$"&&f.slice(1)in l?!1:(P[f]=g,!0)},has({_:{data:l,setupState:f,accessCache:g,ctx:b,appContext:E,propsOptions:P}},z){let j;return!!g[z]||l!==Dn&&Wi(l,z)||by(f,z)||(j=P[0])&&Wi(j,z)||Wi(b,z)||Wi(Uf,z)||Wi(E.config.globalProperties,z)},defineProperty(l,f,g){return g.get!=null?l._.accessCache[f]=0:Wi(g,"value")&&this.set(l,f,g.value,null),Reflect.defineProperty(l,f,g)}};function J1(l){return di(l)?l.reduce((f,g)=>(f[g]=null,f),{}):l}let Gy=!0;function rL(l){const f=_0(l),g=l.proxy,b=l.ctx;Gy=!1,f.beforeCreate&&Q1(f.beforeCreate,l,"bc");const{data:E,computed:P,methods:z,watch:j,provide:s,inject:K,created:Q,beforeMount:re,mounted:we,beforeUpdate:Ee,updated:Me,activated:Ce,deactivated:Ue,beforeDestroy:lt,beforeUnmount:$t,destroyed:It,unmounted:yr,render:zr,renderTracked:hr,renderTriggered:Ai,errorCaptured:Ii,serverPrefetch:dt,expose:Cn,inheritAttrs:Kn,components:br,directives:zi,filters:Jn}=f;if(K&&iL(K,b,null),z)for(const Jr in z){const Zt=z[Jr];vi(Zt)&&(b[Jr]=Zt.bind(g))}if(E){const Jr=E.call(g,g);zn(Jr)&&(l.data=tp(Jr))}if(Gy=!0,P)for(const Jr in P){const Zt=P[Jr],Pn=vi(Zt)?Zt.bind(g,g):vi(Zt.get)?Zt.get.bind(g,g):aa,kn=!vi(Zt)&&vi(Zt.set)?Zt.set.bind(g):aa,nn=sa({get:Pn,set:kn});Object.defineProperty(b,Jr,{enumerable:!0,configurable:!0,get:()=>nn.value,set:_r=>nn.value=_r})}if(j)for(const Jr in j)qT(j[Jr],b,g,Jr);if(s){const Jr=vi(s)?s.call(g):s;Reflect.ownKeys(Jr).forEach(Zt=>{bs(Zt,Jr[Zt])})}Q&&Q1(Q,l,"c");function Ci(Jr,Zt){di(Zt)?Zt.forEach(Pn=>Jr(Pn.bind(g))):Zt&&Jr(Zt.bind(g))}if(Ci(HP,re),Ci(mo,we),Ci(WP,Ee),Ci(XP,Me),Ci($P,Ce),Ci(qP,Ue),Ci(eL,Ii),Ci(QP,hr),Ci(JP,Ai),Ci(YP,$t),Ci(lo,yr),Ci(KP,dt),di(Cn))if(Cn.length){const Jr=l.exposed||(l.exposed={});Cn.forEach(Zt=>{Object.defineProperty(Jr,Zt,{get:()=>g[Zt],set:Pn=>g[Zt]=Pn})})}else l.exposed||(l.exposed={});zr&&l.render===aa&&(l.render=zr),Kn!=null&&(l.inheritAttrs=Kn),br&&(l.components=br),zi&&(l.directives=zi)}function iL(l,f,g=aa){di(l)&&(l=$y(l));for(const b in l){const E=l[b];let P;zn(E)?"default"in E?P=_n(E.from||b,E.default,!0):P=_n(E.from||b):P=_n(E),Ko(P)?Object.defineProperty(f,b,{enumerable:!0,configurable:!0,get:()=>P.value,set:z=>P.value=z}):f[b]=P}}function Q1(l,f,g){Ra(di(l)?l.map(b=>b.bind(f.proxy)):l.bind(f.proxy),f,g)}function qT(l,f,g,b){const E=b.includes(".")?jT(g,b):()=>g[b];if(Eo(l)){const P=f[l];vi(P)&&Yn(E,P)}else if(vi(l))Yn(E,l.bind(g));else if(zn(l))if(di(l))l.forEach(P=>qT(P,f,g,b));else{const P=vi(l.handler)?l.handler.bind(g):f[l.handler];vi(P)&&Yn(E,P,l)}}function _0(l){const f=l.type,{mixins:g,extends:b}=f,{mixins:E,optionsCache:P,config:{optionMergeStrategies:z}}=l.appContext,j=P.get(f);let s;return j?s=j:!E.length&&!g&&!b?s=f:(s={},E.length&&E.forEach(K=>i_(s,K,z,!0)),i_(s,f,z)),zn(f)&&P.set(f,s),s}function i_(l,f,g,b=!1){const{mixins:E,extends:P}=f;P&&i_(l,P,g,!0),E&&E.forEach(z=>i_(l,z,g,!0));for(const z in f)if(!(b&&z==="expose")){const j=nL[z]||g&&g[z];l[z]=j?j(l[z],f[z]):f[z]}return l}const nL={data:ew,props:tw,emits:tw,methods:Df,computed:Df,beforeCreate:os,created:os,beforeMount:os,mounted:os,beforeUpdate:os,updated:os,beforeDestroy:os,beforeUnmount:os,destroyed:os,unmounted:os,activated:os,deactivated:os,errorCaptured:os,serverPrefetch:os,components:Df,directives:Df,watch:sL,provide:ew,inject:oL};function ew(l,f){return f?l?function(){return Lo(vi(l)?l.call(this,this):l,vi(f)?f.call(this,this):f)}:f:l}function oL(l,f){return Df($y(l),$y(f))}function $y(l){if(di(l)){const f={};for(let g=0;g<l.length;g++)f[l[g]]=l[g];return f}return l}function os(l,f){return l?[...new Set([].concat(l,f))]:f}function Df(l,f){return l?Lo(Object.create(null),l,f):f}function tw(l,f){return l?di(l)&&di(f)?[...new Set([...l,...f])]:Lo(Object.create(null),J1(l),J1(f??{})):f}function sL(l,f){if(!l)return f;if(!f)return l;const g=Lo(Object.create(null),l);for(const b in f)g[b]=os(l[b],f[b]);return g}function ZT(){return{app:null,config:{isNativeTag:DC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let aL=0;function lL(l,f){return function(b,E=null){vi(b)||(b=Lo({},b)),E!=null&&!zn(E)&&(E=null);const P=ZT(),z=new WeakSet;let j=!1;const s=P.app={_uid:aL++,_component:b,_props:E,_container:null,_context:P,_instance:null,version:OL,get config(){return P.config},set config(K){},use(K,...Q){return z.has(K)||(K&&vi(K.install)?(z.add(K),K.install(s,...Q)):vi(K)&&(z.add(K),K(s,...Q))),s},mixin(K){return P.mixins.includes(K)||P.mixins.push(K),s},component(K,Q){return Q?(P.components[K]=Q,s):P.components[K]},directive(K,Q){return Q?(P.directives[K]=Q,s):P.directives[K]},mount(K,Q,re){if(!j){const we=bn(b,E);return we.appContext=P,re===!0?re="svg":re===!1&&(re=void 0),Q&&f?f(we,K):l(we,K,re),j=!0,s._container=K,K.__vue_app__=s,T_(we.component)||we.component.proxy}},unmount(){j&&(l(null,s._container),delete s._container.__vue_app__)},provide(K,Q){return P.provides[K]=Q,s},runWithContext(K){const Q=jf;jf=s;try{return K()}finally{jf=Q}}};return s}}let jf=null;function bs(l,f){if(Fo){let g=Fo.provides;const b=Fo.parent&&Fo.parent.provides;b===g&&(g=Fo.provides=Object.create(b)),g[l]=f}}function _n(l,f,g=!1){const b=Fo||To;if(b||jf){const E=b?b.parent==null?b.vnode.appContext&&b.vnode.appContext.provides:b.parent.provides:jf._context.provides;if(E&&l in E)return E[l];if(arguments.length>1)return g&&vi(f)?f.call(b&&b.proxy):f}}const HT={},WT=()=>Object.create(HT),XT=l=>Object.getPrototypeOf(l)===HT;function cL(l,f,g,b=!1){const E={},P=WT();l.propsDefaults=Object.create(null),YT(l,f,E,P);for(const z in l.propsOptions[0])z in E||(E[z]=void 0);g?l.props=b?E:ST(E):l.type.props?l.props=E:l.props=P,l.attrs=P}function uL(l,f,g,b){const{props:E,attrs:P,vnode:{patchFlag:z}}=l,j=rn(E),[s]=l.propsOptions;let K=!1;if((b||z>0)&&!(z&16)){if(z&8){const Q=l.vnode.dynamicProps;for(let re=0;re<Q.length;re++){let we=Q[re];if(g_(l.emitsOptions,we))continue;const Ee=f[we];if(s)if(Wi(P,we))Ee!==P[we]&&(P[we]=Ee,K=!0);else{const Me=ll(we);E[Me]=qy(s,j,Me,Ee,l,!1)}else Ee!==P[we]&&(P[we]=Ee,K=!0)}}}else{YT(l,f,E,P)&&(K=!0);let Q;for(const re in j)(!f||!Wi(f,re)&&((Q=Qh(re))===re||!Wi(f,Q)))&&(s?g&&(g[re]!==void 0||g[Q]!==void 0)&&(E[re]=qy(s,j,re,void 0,l,!0)):delete E[re]);if(P!==j)for(const re in P)(!f||!Wi(f,re))&&(delete P[re],K=!0)}K&&Ul(l.attrs,"set","")}function YT(l,f,g,b){const[E,P]=l.propsOptions;let z=!1,j;if(f)for(let s in f){if(Ff(s))continue;const K=f[s];let Q;E&&Wi(E,Q=ll(s))?!P||!P.includes(Q)?g[Q]=K:(j||(j={}))[Q]=K:g_(l.emitsOptions,s)||(!(s in b)||K!==b[s])&&(b[s]=K,z=!0)}if(P){const s=rn(g),K=j||Dn;for(let Q=0;Q<P.length;Q++){const re=P[Q];g[re]=qy(E,s,re,K[re],l,!Wi(K,re))}}return z}function qy(l,f,g,b,E,P){const z=l[g];if(z!=null){const j=Wi(z,"default");if(j&&b===void 0){const s=z.default;if(z.type!==Function&&!z.skipFactory&&vi(s)){const{propsDefaults:K}=E;if(g in K)b=K[g];else{const Q=ip(E);b=K[g]=s.call(null,f),Q()}}else b=s}z[0]&&(P&&!j?b=!1:z[1]&&(b===""||b===Qh(g))&&(b=!0))}return b}function KT(l,f,g=!1){const b=f.propsCache,E=b.get(l);if(E)return E;const P=l.props,z={},j=[];let s=!1;if(!vi(l)){const Q=re=>{s=!0;const[we,Ee]=KT(re,f,!0);Lo(z,we),Ee&&j.push(...Ee)};!g&&f.mixins.length&&f.mixins.forEach(Q),l.extends&&Q(l.extends),l.mixins&&l.mixins.forEach(Q)}if(!P&&!s)return zn(l)&&b.set(l,Vh),Vh;if(di(P))for(let Q=0;Q<P.length;Q++){const re=ll(P[Q]);rw(re)&&(z[re]=Dn)}else if(P)for(const Q in P){const re=ll(Q);if(rw(re)){const we=P[Q],Ee=z[re]=di(we)||vi(we)?{type:we}:Lo({},we);if(Ee){const Me=ow(Boolean,Ee.type),Ce=ow(String,Ee.type);Ee[0]=Me>-1,Ee[1]=Ce<0||Me<Ce,(Me>-1||Wi(Ee,"default"))&&j.push(re)}}}const K=[z,j];return zn(l)&&b.set(l,K),K}function rw(l){return l[0]!=="$"&&!Ff(l)}function iw(l){return l===null?"null":typeof l=="function"?l.name||"":typeof l=="object"&&l.constructor&&l.constructor.name||""}function nw(l,f){return iw(l)===iw(f)}function ow(l,f){return di(f)?f.findIndex(g=>nw(g,l)):vi(f)&&nw(f,l)?0:-1}const JT=l=>l[0]==="_"||l==="$stable",g0=l=>di(l)?l.map(nl):[nl(l)],hL=(l,f,g)=>{if(f._n)return f;const b=jl((...E)=>g0(f(...E)),g);return b._c=!1,b},QT=(l,f,g)=>{const b=l._ctx;for(const E in l){if(JT(E))continue;const P=l[E];if(vi(P))f[E]=hL(E,P,b);else if(P!=null){const z=g0(P);f[E]=()=>z}}},eE=(l,f)=>{const g=g0(f);l.slots.default=()=>g},dL=(l,f)=>{const g=l.slots=WT();if(l.vnode.shapeFlag&32){const b=f._;b?(Lo(g,f),cT(g,"_",b,!0)):QT(f,g)}else f&&eE(l,f)},fL=(l,f,g)=>{const{vnode:b,slots:E}=l;let P=!0,z=Dn;if(b.shapeFlag&32){const j=f._;j?g&&j===1?P=!1:(Lo(E,f),!g&&j===1&&delete E._):(P=!f.$stable,QT(f,E)),z=f}else f&&(eE(l,f),z={default:1});if(P)for(const j in E)!JT(j)&&z[j]==null&&delete E[j]};function Zy(l,f,g,b,E=!1){if(di(l)){l.forEach((we,Ee)=>Zy(we,f&&(di(f)?f[Ee]:f),g,b,E));return}if(Nf(b)&&!E)return;const P=b.shapeFlag&4?T_(b.component)||b.component.proxy:b.el,z=E?null:P,{i:j,r:s}=l,K=f&&f.r,Q=j.refs===Dn?j.refs={}:j.refs,re=j.setupState;if(K!=null&&K!==s&&(Eo(K)?(Q[K]=null,Wi(re,K)&&(re[K]=null)):Ko(K)&&(K.value=null)),vi(s))kc(s,j,12,[z,Q]);else{const we=Eo(s),Ee=Ko(s);if(we||Ee){const Me=()=>{if(l.f){const Ce=we?Wi(re,s)?re[s]:Q[s]:s.value;E?di(Ce)&&o0(Ce,P):di(Ce)?Ce.includes(P)||Ce.push(P):we?(Q[s]=[P],Wi(re,s)&&(re[s]=Q[s])):(s.value=[P],l.k&&(Q[l.k]=s.value))}else we?(Q[s]=z,Wi(re,s)&&(re[s]=z)):Ee&&(s.value=z,l.k&&(Q[l.k]=z))};z?(Me.id=-1,xs(Me,g)):Me()}}}const xs=NP;function pL(l){return mL(l)}function mL(l,f){const g=uT();g.__VUE__=!0;const{insert:b,remove:E,patchProp:P,createElement:z,createText:j,createComment:s,setText:K,setElementText:Q,parentNode:re,nextSibling:we,setScopeId:Ee=aa,insertStaticContent:Me}=l,Ce=(ge,ve,We,rt=null,ut=null,Vt=null,lr=void 0,bt=null,Qt=!!ve.dynamicChildren)=>{if(ge===ve)return;ge&&!Cf(ge,ve)&&(rt=Ye(ge),_r(ge,ut,Vt,!0),ge=null),ve.patchFlag===-2&&(Qt=!1,ve.dynamicChildren=null);const{type:Dt,ref:cr,shapeFlag:Er}=ve;switch(Dt){case b_:Ue(ge,ve,We,rt);break;case Bc:lt(ge,ve,We,rt);break;case Wm:ge==null&&$t(ve,We,rt,lr);break;case Xo:br(ge,ve,We,rt,ut,Vt,lr,bt,Qt);break;default:Er&1?zr(ge,ve,We,rt,ut,Vt,lr,bt,Qt):Er&6?zi(ge,ve,We,rt,ut,Vt,lr,bt,Qt):(Er&64||Er&128)&&Dt.process(ge,ve,We,rt,ut,Vt,lr,bt,Qt,St)}cr!=null&&ut&&Zy(cr,ge&&ge.ref,Vt,ve||ge,!ve)},Ue=(ge,ve,We,rt)=>{if(ge==null)b(ve.el=j(ve.children),We,rt);else{const ut=ve.el=ge.el;ve.children!==ge.children&&K(ut,ve.children)}},lt=(ge,ve,We,rt)=>{ge==null?b(ve.el=s(ve.children||""),We,rt):ve.el=ge.el},$t=(ge,ve,We,rt)=>{[ge.el,ge.anchor]=Me(ge.children,ve,We,rt,ge.el,ge.anchor)},It=({el:ge,anchor:ve},We,rt)=>{let ut;for(;ge&&ge!==ve;)ut=we(ge),b(ge,We,rt),ge=ut;b(ve,We,rt)},yr=({el:ge,anchor:ve})=>{let We;for(;ge&&ge!==ve;)We=we(ge),E(ge),ge=We;E(ve)},zr=(ge,ve,We,rt,ut,Vt,lr,bt,Qt)=>{ve.type==="svg"?lr="svg":ve.type==="math"&&(lr="mathml"),ge==null?hr(ve,We,rt,ut,Vt,lr,bt,Qt):dt(ge,ve,ut,Vt,lr,bt,Qt)},hr=(ge,ve,We,rt,ut,Vt,lr,bt)=>{let Qt,Dt;const{props:cr,shapeFlag:Er,transition:Sr,dirs:Oe}=ge;if(Qt=ge.el=z(ge.type,Vt,cr&&cr.is,cr),Er&8?Q(Qt,ge.children):Er&16&&Ii(ge.children,Qt,null,rt,ut,wy(ge,Vt),lr,bt),Oe&&zu(ge,null,rt,"created"),Ai(Qt,ge,ge.scopeId,lr,rt),cr){for(const se in cr)se!=="value"&&!Ff(se)&&P(Qt,se,null,cr[se],Vt,ge.children,rt,ut,gr);"value"in cr&&P(Qt,"value",null,cr.value,Vt),(Dt=cr.onVnodeBeforeMount)&&il(Dt,rt,ge)}Oe&&zu(ge,null,rt,"beforeMount");const W=_L(ut,Sr);W&&Sr.beforeEnter(Qt),b(Qt,ve,We),((Dt=cr&&cr.onVnodeMounted)||W||Oe)&&xs(()=>{Dt&&il(Dt,rt,ge),W&&Sr.enter(Qt),Oe&&zu(ge,null,rt,"mounted")},ut)},Ai=(ge,ve,We,rt,ut)=>{if(We&&Ee(ge,We),rt)for(let Vt=0;Vt<rt.length;Vt++)Ee(ge,rt[Vt]);if(ut){let Vt=ut.subTree;if(ve===Vt){const lr=ut.vnode;Ai(ge,lr,lr.scopeId,lr.slotScopeIds,ut.parent)}}},Ii=(ge,ve,We,rt,ut,Vt,lr,bt,Qt=0)=>{for(let Dt=Qt;Dt<ge.length;Dt++){const cr=ge[Dt]=bt?Rc(ge[Dt]):nl(ge[Dt]);Ce(null,cr,ve,We,rt,ut,Vt,lr,bt)}},dt=(ge,ve,We,rt,ut,Vt,lr)=>{const bt=ve.el=ge.el;let{patchFlag:Qt,dynamicChildren:Dt,dirs:cr}=ve;Qt|=ge.patchFlag&16;const Er=ge.props||Dn,Sr=ve.props||Dn;let Oe;if(We&&ku(We,!1),(Oe=Sr.onVnodeBeforeUpdate)&&il(Oe,We,ve,ge),cr&&zu(ve,ge,We,"beforeUpdate"),We&&ku(We,!0),Dt?Cn(ge.dynamicChildren,Dt,bt,We,rt,wy(ve,ut),Vt):lr||Zt(ge,ve,bt,null,We,rt,wy(ve,ut),Vt,!1),Qt>0){if(Qt&16)Kn(bt,ve,Er,Sr,We,rt,ut);else if(Qt&2&&Er.class!==Sr.class&&P(bt,"class",null,Sr.class,ut),Qt&4&&P(bt,"style",Er.style,Sr.style,ut),Qt&8){const W=ve.dynamicProps;for(let se=0;se<W.length;se++){const de=W[se],Fe=Er[de],Ze=Sr[de];(Ze!==Fe||de==="value")&&P(bt,de,Fe,Ze,ut,ge.children,We,rt,gr)}}Qt&1&&ge.children!==ve.children&&Q(bt,ve.children)}else!lr&&Dt==null&&Kn(bt,ve,Er,Sr,We,rt,ut);((Oe=Sr.onVnodeUpdated)||cr)&&xs(()=>{Oe&&il(Oe,We,ve,ge),cr&&zu(ve,ge,We,"updated")},rt)},Cn=(ge,ve,We,rt,ut,Vt,lr)=>{for(let bt=0;bt<ve.length;bt++){const Qt=ge[bt],Dt=ve[bt],cr=Qt.el&&(Qt.type===Xo||!Cf(Qt,Dt)||Qt.shapeFlag&70)?re(Qt.el):We;Ce(Qt,Dt,cr,null,rt,ut,Vt,lr,!0)}},Kn=(ge,ve,We,rt,ut,Vt,lr)=>{if(We!==rt){if(We!==Dn)for(const bt in We)!Ff(bt)&&!(bt in rt)&&P(ge,bt,We[bt],null,lr,ve.children,ut,Vt,gr);for(const bt in rt){if(Ff(bt))continue;const Qt=rt[bt],Dt=We[bt];Qt!==Dt&&bt!=="value"&&P(ge,bt,Dt,Qt,lr,ve.children,ut,Vt,gr)}"value"in rt&&P(ge,"value",We.value,rt.value,lr)}},br=(ge,ve,We,rt,ut,Vt,lr,bt,Qt)=>{const Dt=ve.el=ge?ge.el:j(""),cr=ve.anchor=ge?ge.anchor:j("");let{patchFlag:Er,dynamicChildren:Sr,slotScopeIds:Oe}=ve;Oe&&(bt=bt?bt.concat(Oe):Oe),ge==null?(b(Dt,We,rt),b(cr,We,rt),Ii(ve.children||[],We,cr,ut,Vt,lr,bt,Qt)):Er>0&&Er&64&&Sr&&ge.dynamicChildren?(Cn(ge.dynamicChildren,Sr,We,ut,Vt,lr,bt),(ve.key!=null||ut&&ve===ut.subTree)&&tE(ge,ve,!0)):Zt(ge,ve,We,cr,ut,Vt,lr,bt,Qt)},zi=(ge,ve,We,rt,ut,Vt,lr,bt,Qt)=>{ve.slotScopeIds=bt,ge==null?ve.shapeFlag&512?ut.ctx.activate(ve,We,rt,lr,Qt):Jn(ve,We,rt,ut,Vt,lr,Qt):Ct(ge,ve,Qt)},Jn=(ge,ve,We,rt,ut,Vt,lr)=>{const bt=ge.component=ML(ge,rt,ut);if(VT(ge)&&(bt.ctx.renderer=St),AL(bt),bt.asyncDep){if(ut&&ut.registerDep(bt,Ci),!ge.el){const Qt=bt.subTree=bn(Bc);lt(null,Qt,ve,We)}}else Ci(bt,ge,ve,We,ut,Vt,lr)},Ct=(ge,ve,We)=>{const rt=ve.component=ge.component;if(OP(ge,ve,We))if(rt.asyncDep&&!rt.asyncResolved){Jr(rt,ve,We);return}else rt.next=ve,SP(rt.update),rt.effect.dirty=!0,rt.update();else ve.el=ge.el,rt.vnode=ve},Ci=(ge,ve,We,rt,ut,Vt,lr)=>{const bt=()=>{if(ge.isMounted){let{next:cr,bu:Er,u:Sr,parent:Oe,vnode:W}=ge;{const nt=rE(ge);if(nt){cr&&(cr.el=W.el,Jr(ge,cr,lr)),nt.asyncDep.then(()=>{ge.isUnmounted||bt()});return}}let se=cr,de;ku(ge,!1),cr?(cr.el=W.el,Jr(ge,cr,lr)):cr=W,Er&&yy(Er),(de=cr.props&&cr.props.onVnodeBeforeUpdate)&&il(de,Oe,cr,W),ku(ge,!0);const Fe=xy(ge),Ze=ge.subTree;ge.subTree=Fe,Ce(Ze,Fe,re(Ze.el),Ye(Ze),ge,ut,Vt),cr.el=Fe.el,se===null&&DP(ge,Fe.el),Sr&&xs(Sr,ut),(de=cr.props&&cr.props.onVnodeUpdated)&&xs(()=>il(de,Oe,cr,W),ut)}else{let cr;const{el:Er,props:Sr}=ve,{bm:Oe,m:W,parent:se}=ge,de=Nf(ve);if(ku(ge,!1),Oe&&yy(Oe),!de&&(cr=Sr&&Sr.onVnodeBeforeMount)&&il(cr,se,ve),ku(ge,!0),Er&&bi){const Fe=()=>{ge.subTree=xy(ge),bi(Er,ge.subTree,ge,ut,null)};de?ve.type.__asyncLoader().then(()=>!ge.isUnmounted&&Fe()):Fe()}else{const Fe=ge.subTree=xy(ge);Ce(null,Fe,We,rt,ge,ut,Vt),ve.el=Fe.el}if(W&&xs(W,ut),!de&&(cr=Sr&&Sr.onVnodeMounted)){const Fe=ve;xs(()=>il(cr,se,Fe),ut)}(ve.shapeFlag&256||se&&Nf(se.vnode)&&se.vnode.shapeFlag&256)&&ge.a&&xs(ge.a,ut),ge.isMounted=!0,ve=We=rt=null}},Qt=ge.effect=new a0(bt,aa,()=>m0(Dt),ge.scope),Dt=ge.update=()=>{Qt.dirty&&Qt.run()};Dt.id=ge.uid,ku(ge,!0),Dt()},Jr=(ge,ve,We)=>{ve.component=ge;const rt=ge.vnode.props;ge.vnode=ve,ge.next=null,uL(ge,ve.props,rt,We),fL(ge,ve.children,We),jc(),X1(ge),Vc()},Zt=(ge,ve,We,rt,ut,Vt,lr,bt,Qt=!1)=>{const Dt=ge&&ge.children,cr=ge?ge.shapeFlag:0,Er=ve.children,{patchFlag:Sr,shapeFlag:Oe}=ve;if(Sr>0){if(Sr&128){kn(Dt,Er,We,rt,ut,Vt,lr,bt,Qt);return}else if(Sr&256){Pn(Dt,Er,We,rt,ut,Vt,lr,bt,Qt);return}}Oe&8?(cr&16&&gr(Dt,ut,Vt),Er!==Dt&&Q(We,Er)):cr&16?Oe&16?kn(Dt,Er,We,rt,ut,Vt,lr,bt,Qt):gr(Dt,ut,Vt,!0):(cr&8&&Q(We,""),Oe&16&&Ii(Er,We,rt,ut,Vt,lr,bt,Qt))},Pn=(ge,ve,We,rt,ut,Vt,lr,bt,Qt)=>{ge=ge||Vh,ve=ve||Vh;const Dt=ge.length,cr=ve.length,Er=Math.min(Dt,cr);let Sr;for(Sr=0;Sr<Er;Sr++){const Oe=ve[Sr]=Qt?Rc(ve[Sr]):nl(ve[Sr]);Ce(ge[Sr],Oe,We,null,ut,Vt,lr,bt,Qt)}Dt>cr?gr(ge,ut,Vt,!0,!1,Er):Ii(ve,We,rt,ut,Vt,lr,bt,Qt,Er)},kn=(ge,ve,We,rt,ut,Vt,lr,bt,Qt)=>{let Dt=0;const cr=ve.length;let Er=ge.length-1,Sr=cr-1;for(;Dt<=Er&&Dt<=Sr;){const Oe=ge[Dt],W=ve[Dt]=Qt?Rc(ve[Dt]):nl(ve[Dt]);if(Cf(Oe,W))Ce(Oe,W,We,null,ut,Vt,lr,bt,Qt);else break;Dt++}for(;Dt<=Er&&Dt<=Sr;){const Oe=ge[Er],W=ve[Sr]=Qt?Rc(ve[Sr]):nl(ve[Sr]);if(Cf(Oe,W))Ce(Oe,W,We,null,ut,Vt,lr,bt,Qt);else break;Er--,Sr--}if(Dt>Er){if(Dt<=Sr){const Oe=Sr+1,W=Oe<cr?ve[Oe].el:rt;for(;Dt<=Sr;)Ce(null,ve[Dt]=Qt?Rc(ve[Dt]):nl(ve[Dt]),We,W,ut,Vt,lr,bt,Qt),Dt++}}else if(Dt>Sr)for(;Dt<=Er;)_r(ge[Dt],ut,Vt,!0),Dt++;else{const Oe=Dt,W=Dt,se=new Map;for(Dt=W;Dt<=Sr;Dt++){const Tt=ve[Dt]=Qt?Rc(ve[Dt]):nl(ve[Dt]);Tt.key!=null&&se.set(Tt.key,Dt)}let de,Fe=0;const Ze=Sr-W+1;let nt=!1,Nt=0;const He=new Array(Ze);for(Dt=0;Dt<Ze;Dt++)He[Dt]=0;for(Dt=Oe;Dt<=Er;Dt++){const Tt=ge[Dt];if(Fe>=Ze){_r(Tt,ut,Vt,!0);continue}let Ut;if(Tt.key!=null)Ut=se.get(Tt.key);else for(de=W;de<=Sr;de++)if(He[de-W]===0&&Cf(Tt,ve[de])){Ut=de;break}Ut===void 0?_r(Tt,ut,Vt,!0):(He[Ut-W]=Dt+1,Ut>=Nt?Nt=Ut:nt=!0,Ce(Tt,ve[Ut],We,null,ut,Vt,lr,bt,Qt),Fe++)}const Ht=nt?gL(He):Vh;for(de=Ht.length-1,Dt=Ze-1;Dt>=0;Dt--){const Tt=W+Dt,Ut=ve[Tt],Rr=Tt+1<cr?ve[Tt+1].el:rt;He[Dt]===0?Ce(null,Ut,We,Rr,ut,Vt,lr,bt,Qt):nt&&(de<0||Dt!==Ht[de]?nn(Ut,We,Rr,2):de--)}}},nn=(ge,ve,We,rt,ut=null)=>{const{el:Vt,type:lr,transition:bt,children:Qt,shapeFlag:Dt}=ge;if(Dt&6){nn(ge.component.subTree,ve,We,rt);return}if(Dt&128){ge.suspense.move(ve,We,rt);return}if(Dt&64){lr.move(ge,ve,We,St);return}if(lr===Xo){b(Vt,ve,We);for(let Er=0;Er<Qt.length;Er++)nn(Qt[Er],ve,We,rt);b(ge.anchor,ve,We);return}if(lr===Wm){It(ge,ve,We);return}if(rt!==2&&Dt&1&&bt)if(rt===0)bt.beforeEnter(Vt),b(Vt,ve,We),xs(()=>bt.enter(Vt),ut);else{const{leave:Er,delayLeave:Sr,afterLeave:Oe}=bt,W=()=>b(Vt,ve,We),se=()=>{Er(Vt,()=>{W(),Oe&&Oe()})};Sr?Sr(Vt,W,se):se()}else b(Vt,ve,We)},_r=(ge,ve,We,rt=!1,ut=!1)=>{const{type:Vt,props:lr,ref:bt,children:Qt,dynamicChildren:Dt,shapeFlag:cr,patchFlag:Er,dirs:Sr}=ge;if(bt!=null&&Zy(bt,null,We,ge,!0),cr&256){ve.ctx.deactivate(ge);return}const Oe=cr&1&&Sr,W=!Nf(ge);let se;if(W&&(se=lr&&lr.onVnodeBeforeUnmount)&&il(se,ve,ge),cr&6)Ir(ge.component,We,rt);else{if(cr&128){ge.suspense.unmount(We,rt);return}Oe&&zu(ge,null,ve,"beforeUnmount"),cr&64?ge.type.remove(ge,ve,We,ut,St,rt):Dt&&(Vt!==Xo||Er>0&&Er&64)?gr(Dt,ve,We,!1,!0):(Vt===Xo&&Er&384||!ut&&cr&16)&&gr(Qt,ve,We),rt&&rr(ge)}(W&&(se=lr&&lr.onVnodeUnmounted)||Oe)&&xs(()=>{se&&il(se,ve,ge),Oe&&zu(ge,null,ve,"unmounted")},We)},rr=ge=>{const{type:ve,el:We,anchor:rt,transition:ut}=ge;if(ve===Xo){pr(We,rt);return}if(ve===Wm){yr(ge);return}const Vt=()=>{E(We),ut&&!ut.persisted&&ut.afterLeave&&ut.afterLeave()};if(ge.shapeFlag&1&&ut&&!ut.persisted){const{leave:lr,delayLeave:bt}=ut,Qt=()=>lr(We,Vt);bt?bt(ge.el,Vt,Qt):Qt()}else Vt()},pr=(ge,ve)=>{let We;for(;ge!==ve;)We=we(ge),E(ge),ge=We;E(ve)},Ir=(ge,ve,We)=>{const{bum:rt,scope:ut,update:Vt,subTree:lr,um:bt}=ge;rt&&yy(rt),ut.stop(),Vt&&(Vt.active=!1,_r(lr,ge,ve,We)),bt&&xs(bt,ve),xs(()=>{ge.isUnmounted=!0},ve),ve&&ve.pendingBranch&&!ve.isUnmounted&&ge.asyncDep&&!ge.asyncResolved&&ge.suspenseId===ve.pendingId&&(ve.deps--,ve.deps===0&&ve.resolve())},gr=(ge,ve,We,rt=!1,ut=!1,Vt=0)=>{for(let lr=Vt;lr<ge.length;lr++)_r(ge[lr],ve,We,rt,ut)},Ye=ge=>ge.shapeFlag&6?Ye(ge.component.subTree):ge.shapeFlag&128?ge.suspense.next():we(ge.anchor||ge.el);let Yt=!1;const kt=(ge,ve,We)=>{ge==null?ve._vnode&&_r(ve._vnode,null,null,!0):Ce(ve._vnode||null,ge,ve,null,null,null,We),Yt||(Yt=!0,X1(),FT(),Yt=!1),ve._vnode=ge},St={p:Ce,um:_r,m:nn,r:rr,mt:Jn,mc:Ii,pc:Zt,pbc:Cn,n:Ye,o:l};let ai,bi;return{render:kt,hydrate:ai,createApp:lL(kt,ai)}}function wy({type:l,props:f},g){return g==="svg"&&l==="foreignObject"||g==="mathml"&&l==="annotation-xml"&&f&&f.encoding&&f.encoding.includes("html")?void 0:g}function ku({effect:l,update:f},g){l.allowRecurse=f.allowRecurse=g}function _L(l,f){return(!l||l&&!l.pendingBranch)&&f&&!f.persisted}function tE(l,f,g=!1){const b=l.children,E=f.children;if(di(b)&&di(E))for(let P=0;P<b.length;P++){const z=b[P];let j=E[P];j.shapeFlag&1&&!j.dynamicChildren&&((j.patchFlag<=0||j.patchFlag===32)&&(j=E[P]=Rc(E[P]),j.el=z.el),g||tE(z,j)),j.type===b_&&(j.el=z.el)}}function gL(l){const f=l.slice(),g=[0];let b,E,P,z,j;const s=l.length;for(b=0;b<s;b++){const K=l[b];if(K!==0){if(E=g[g.length-1],l[E]<K){f[b]=E,g.push(b);continue}for(P=0,z=g.length-1;P<z;)j=P+z>>1,l[g[j]]<K?P=j+1:z=j;K<l[g[P]]&&(P>0&&(f[b]=g[P-1]),g[P]=b)}}for(P=g.length,z=g[P-1];P-- >0;)g[P]=z,z=f[z];return g}function rE(l){const f=l.subTree.component;if(f)return f.asyncDep&&!f.asyncResolved?f:rE(f)}const yL=l=>l.__isTeleport,Xo=Symbol.for("v-fgt"),b_=Symbol.for("v-txt"),Bc=Symbol.for("v-cmt"),Wm=Symbol.for("v-stc"),Vf=[];let La=null;function Di(l=!1){Vf.push(La=l?null:[])}function vL(){Vf.pop(),La=Vf[Vf.length-1]||null}let Xf=1;function sw(l){Xf+=l}function iE(l){return l.dynamicChildren=Xf>0?La||Vh:null,vL(),Xf>0&&La&&La.push(l),l}function Ki(l,f,g,b,E,P){return iE(Ni(l,f,g,b,E,P,!0))}function rp(l,f,g,b,E){return iE(bn(l,f,g,b,E,!0))}function n_(l){return l?l.__v_isVNode===!0:!1}function Cf(l,f){return l.type===f.type&&l.key===f.key}const nE=({key:l})=>l??null,Xm=({ref:l,ref_key:f,ref_for:g})=>(typeof l=="number"&&(l=""+l),l!=null?Eo(l)||Ko(l)||vi(l)?{i:To,r:l,k:f,f:!!g}:l:null);function Ni(l,f=null,g=null,b=0,E=null,P=l===Xo?0:1,z=!1,j=!1){const s={__v_isVNode:!0,__v_skip:!0,type:l,props:f,key:f&&nE(f),ref:f&&Xm(f),scopeId:y_,slotScopeIds:null,children:g,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:P,patchFlag:b,dynamicProps:E,dynamicChildren:null,appContext:null,ctx:To};return j?(y0(s,g),P&128&&l.normalize(s)):g&&(s.shapeFlag|=Eo(g)?8:16),Xf>0&&!z&&La&&(s.patchFlag>0||P&6)&&s.patchFlag!==32&&La.push(s),s}const bn=xL;function xL(l,f=null,g=null,b=0,E=null,P=!1){if((!l||l===kP)&&(l=Bc),n_(l)){const j=Wh(l,f,!0);return g&&y0(j,g),Xf>0&&!P&&La&&(j.shapeFlag&6?La[La.indexOf(l)]=j:La.push(j)),j.patchFlag|=-2,j}if(RL(l)&&(l=l.__vccOpts),f){f=bL(f);let{class:j,style:s}=f;j&&!Eo(j)&&(f.class=p_(j)),zn(s)&&(AT(s)&&!di(s)&&(s=Lo({},s)),f.style=$h(s))}const z=Eo(l)?1:BP(l)?128:yL(l)?64:zn(l)?4:vi(l)?2:0;return Ni(l,f,g,b,E,z,P,!0)}function bL(l){return l?AT(l)||XT(l)?Lo({},l):l:null}function Wh(l,f,g=!1,b=!1){const{props:E,ref:P,patchFlag:z,children:j,transition:s}=l,K=f?TL(E||{},f):E,Q={__v_isVNode:!0,__v_skip:!0,type:l.type,props:K,key:K&&nE(K),ref:f&&f.ref?g&&P?di(P)?P.concat(Xm(f)):[P,Xm(f)]:Xm(f):P,scopeId:l.scopeId,slotScopeIds:l.slotScopeIds,children:j,target:l.target,targetAnchor:l.targetAnchor,staticCount:l.staticCount,shapeFlag:l.shapeFlag,patchFlag:f&&l.type!==Xo?z===-1?16:z|16:z,dynamicProps:l.dynamicProps,dynamicChildren:l.dynamicChildren,appContext:l.appContext,dirs:l.dirs,transition:s,component:l.component,suspense:l.suspense,ssContent:l.ssContent&&Wh(l.ssContent),ssFallback:l.ssFallback&&Wh(l.ssFallback),el:l.el,anchor:l.anchor,ctx:l.ctx,ce:l.ce};return s&&b&&(Q.transition=s.clone(Q)),Q}function Yf(l=" ",f=0){return bn(b_,null,l,f)}function oE(l,f){const g=bn(Wm,null,l);return g.staticCount=f,g}function wL(l="",f=!1){return f?(Di(),rp(Bc,null,l)):bn(Bc,null,l)}function nl(l){return l==null||typeof l=="boolean"?bn(Bc):di(l)?bn(Xo,null,l.slice()):typeof l=="object"?Rc(l):bn(b_,null,String(l))}function Rc(l){return l.el===null&&l.patchFlag!==-1||l.memo?l:Wh(l)}function y0(l,f){let g=0;const{shapeFlag:b}=l;if(f==null)f=null;else if(di(f))g=16;else if(typeof f=="object")if(b&65){const E=f.default;E&&(E._c&&(E._d=!1),y0(l,E()),E._c&&(E._d=!0));return}else{g=32;const E=f._;!E&&!XT(f)?f._ctx=To:E===3&&To&&(To.slots._===1?f._=1:(f._=2,l.patchFlag|=1024))}else vi(f)?(f={default:f,_ctx:To},g=32):(f=String(f),b&64?(g=16,f=[Yf(f)]):g=8);l.children=f,l.shapeFlag|=g}function TL(...l){const f={};for(let g=0;g<l.length;g++){const b=l[g];for(const E in b)if(E==="class")f.class!==b.class&&(f.class=p_([f.class,b.class]));else if(E==="style")f.style=$h([f.style,b.style]);else if(u_(E)){const P=f[E],z=b[E];z&&P!==z&&!(di(P)&&P.includes(z))&&(f[E]=P?[].concat(P,z):z)}else E!==""&&(f[E]=b[E])}return f}function il(l,f,g,b=null){Ra(l,f,7,[g,b])}const EL=ZT();let SL=0;function ML(l,f,g){const b=l.type,E=(f?f.appContext:l.appContext)||EL,P={uid:SL++,vnode:l,type:b,parent:f,appContext:E,root:null,next:null,subTree:null,effect:null,update:null,scope:new fT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:f?f.provides:Object.create(E.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:KT(b,E),emitsOptions:NT(b,E),emit:null,emitted:null,propsDefaults:Dn,inheritAttrs:b.inheritAttrs,ctx:Dn,data:Dn,props:Dn,attrs:Dn,slots:Dn,refs:Dn,setupState:Dn,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:g,suspenseId:g?g.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return P.ctx={_:P},P.root=f?f.root:P,P.emit=IP.bind(null,P),l.ce&&l.ce(P),P}let Fo=null;const Zu=()=>Fo||To;let o_,Hy;{const l=uT(),f=(g,b)=>{let E;return(E=l[g])||(E=l[g]=[]),E.push(b),P=>{E.length>1?E.forEach(z=>z(P)):E[0](P)}};o_=f("__VUE_INSTANCE_SETTERS__",g=>Fo=g),Hy=f("__VUE_SSR_SETTERS__",g=>w_=g)}const ip=l=>{const f=Fo;return o_(l),l.scope.on(),()=>{l.scope.off(),o_(f)}},aw=()=>{Fo&&Fo.scope.off(),o_(null)};function sE(l){return l.vnode.shapeFlag&4}let w_=!1;function AL(l,f=!1){f&&Hy(f);const{props:g,children:b}=l.vnode,E=sE(l);cL(l,g,E,f),dL(l,b);const P=E?IL(l,f):void 0;return f&&Hy(!1),P}function IL(l,f){const g=l.type;l.accessCache=Object.create(null),l.proxy=new Proxy(l.ctx,tL);const{setup:b}=g;if(b){const E=l.setupContext=b.length>1?PL(l):null,P=ip(l);jc();const z=kc(b,l,0,[l.props,E]);if(Vc(),P(),sT(z)){if(z.then(aw,aw),f)return z.then(j=>{lw(l,j,f)}).catch(j=>{__(j,l,0)});l.asyncDep=z}else lw(l,z,f)}else aE(l,f)}function lw(l,f,g){vi(f)?l.type.__ssrInlineRender?l.ssrRender=f:l.render=f:zn(f)&&(l.setupState=RT(f)),aE(l,g)}let cw;function aE(l,f,g){const b=l.type;if(!l.render){if(!f&&cw&&!b.render){const E=b.template||_0(l).template;if(E){const{isCustomElement:P,compilerOptions:z}=l.appContext.config,{delimiters:j,compilerOptions:s}=b,K=Lo(Lo({isCustomElement:P,delimiters:j},z),s);b.render=cw(E,K)}}l.render=b.render||aa}{const E=ip(l);jc();try{rL(l)}finally{Vc(),E()}}}const CL={get(l,f){return ws(l,"get",""),l[f]}};function PL(l){const f=g=>{l.exposed=g||{}};return{attrs:new Proxy(l.attrs,CL),slots:l.slots,emit:l.emit,expose:f}}function T_(l){if(l.exposed)return l.exposeProxy||(l.exposeProxy=new Proxy(RT(IT(l.exposed)),{get(f,g){if(g in f)return f[g];if(g in Uf)return Uf[g](l)},has(f,g){return g in f||g in Uf}}))}function LL(l,f=!0){return vi(l)?l.displayName||l.name:l.name||f&&l.__name}function RL(l){return vi(l)&&"__vccOpts"in l}const sa=(l,f)=>mP(l,f,w_);function Kf(l,f,g){const b=arguments.length;return b===2?zn(f)&&!di(f)?n_(f)?bn(l,null,[f]):bn(l,f):bn(l,null,f):(b>3?g=Array.prototype.slice.call(arguments,2):b===3&&n_(g)&&(g=[g]),bn(l,f,g))}const OL="3.4.26";/**
* @vue/runtime-dom v3.4.26
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const DL="http://www.w3.org/2000/svg",zL="http://www.w3.org/1998/Math/MathML",Oc=typeof document<"u"?document:null,uw=Oc&&Oc.createElement("template"),kL={insert:(l,f,g)=>{f.insertBefore(l,g||null)},remove:l=>{const f=l.parentNode;f&&f.removeChild(l)},createElement:(l,f,g,b)=>{const E=f==="svg"?Oc.createElementNS(DL,l):f==="mathml"?Oc.createElementNS(zL,l):Oc.createElement(l,g?{is:g}:void 0);return l==="select"&&b&&b.multiple!=null&&E.setAttribute("multiple",b.multiple),E},createText:l=>Oc.createTextNode(l),createComment:l=>Oc.createComment(l),setText:(l,f)=>{l.nodeValue=f},setElementText:(l,f)=>{l.textContent=f},parentNode:l=>l.parentNode,nextSibling:l=>l.nextSibling,querySelector:l=>Oc.querySelector(l),setScopeId(l,f){l.setAttribute(f,"")},insertStaticContent(l,f,g,b,E,P){const z=g?g.previousSibling:f.lastChild;if(E&&(E===P||E.nextSibling))for(;f.insertBefore(E.cloneNode(!0),g),!(E===P||!(E=E.nextSibling)););else{uw.innerHTML=b==="svg"?`<svg>${l}</svg>`:b==="mathml"?`<math>${l}</math>`:l;const j=uw.content;if(b==="svg"||b==="mathml"){const s=j.firstChild;for(;s.firstChild;)j.appendChild(s.firstChild);j.removeChild(s)}f.insertBefore(j,g)}return[z?z.nextSibling:f.firstChild,g?g.previousSibling:f.lastChild]}},FL=Symbol("_vtc");function BL(l,f,g){const b=l[FL];b&&(f=(f?[f,...b]:[...b]).join(" ")),f==null?l.removeAttribute("class"):g?l.setAttribute("class",f):l.className=f}const s_=Symbol("_vod"),lE=Symbol("_vsh"),NL={beforeMount(l,{value:f},{transition:g}){l[s_]=l.style.display==="none"?"":l.style.display,g&&f?g.beforeEnter(l):Pf(l,f)},mounted(l,{value:f},{transition:g}){g&&f&&g.enter(l)},updated(l,{value:f,oldValue:g},{transition:b}){!f!=!g&&(b?f?(b.beforeEnter(l),Pf(l,!0),b.enter(l)):b.leave(l,()=>{Pf(l,!1)}):Pf(l,f))},beforeUnmount(l,{value:f}){Pf(l,f)}};function Pf(l,f){l.style.display=f?l[s_]:"none",l[lE]=!f}const UL=Symbol(""),jL=/(^|;)\s*display\s*:/;function VL(l,f,g){const b=l.style,E=Eo(g);let P=!1;if(g&&!E){if(f)if(Eo(f))for(const z of f.split(";")){const j=z.slice(0,z.indexOf(":")).trim();g[j]==null&&Ym(b,j,"")}else for(const z in f)g[z]==null&&Ym(b,z,"");for(const z in g)z==="display"&&(P=!0),Ym(b,z,g[z])}else if(E){if(f!==g){const z=b[UL];z&&(g+=";"+z),b.cssText=g,P=jL.test(g)}}else f&&l.removeAttribute("style");s_ in l&&(l[s_]=P?b.display:"",l[lE]&&(b.display="none"))}const hw=/\s*!important$/;function Ym(l,f,g){if(di(g))g.forEach(b=>Ym(l,f,b));else if(g==null&&(g=""),f.startsWith("--"))l.setProperty(f,g);else{const b=GL(l,f);hw.test(g)?l.setProperty(Qh(b),g.replace(hw,""),"important"):l[b]=g}}const dw=["Webkit","Moz","ms"],Ty={};function GL(l,f){const g=Ty[f];if(g)return g;let b=ll(f);if(b!=="filter"&&b in l)return Ty[f]=b;b=f_(b);for(let E=0;E<dw.length;E++){const P=dw[E]+b;if(P in l)return Ty[f]=P}return f}const fw="http://www.w3.org/1999/xlink";function $L(l,f,g,b,E){if(b&&f.startsWith("xlink:"))g==null?l.removeAttributeNS(fw,f.slice(6,f.length)):l.setAttributeNS(fw,f,g);else{const P=qC(f);g==null||P&&!hT(g)?l.removeAttribute(f):l.setAttribute(f,P?"":g)}}function qL(l,f,g,b,E,P,z){if(f==="innerHTML"||f==="textContent"){b&&z(b,E,P),l[f]=g??"";return}const j=l.tagName;if(f==="value"&&j!=="PROGRESS"&&!j.includes("-")){const K=j==="OPTION"?l.getAttribute("value")||"":l.value,Q=g??"";(K!==Q||!("_value"in l))&&(l.value=Q),g==null&&l.removeAttribute(f),l._value=g;return}let s=!1;if(g===""||g==null){const K=typeof l[f];K==="boolean"?g=hT(g):g==null&&K==="string"?(g="",s=!0):K==="number"&&(g=0,s=!0)}try{l[f]=g}catch{}s&&l.removeAttribute(f)}function ZL(l,f,g,b){l.addEventListener(f,g,b)}function HL(l,f,g,b){l.removeEventListener(f,g,b)}const pw=Symbol("_vei");function WL(l,f,g,b,E=null){const P=l[pw]||(l[pw]={}),z=P[f];if(b&&z)z.value=b;else{const[j,s]=XL(f);if(b){const K=P[f]=JL(b,E);ZL(l,j,K,s)}else z&&(HL(l,j,z,s),P[f]=void 0)}}const mw=/(?:Once|Passive|Capture)$/;function XL(l){let f;if(mw.test(l)){f={};let b;for(;b=l.match(mw);)l=l.slice(0,l.length-b[0].length),f[b[0].toLowerCase()]=!0}return[l[2]===":"?l.slice(3):Qh(l.slice(2)),f]}let Ey=0;const YL=Promise.resolve(),KL=()=>Ey||(YL.then(()=>Ey=0),Ey=Date.now());function JL(l,f){const g=b=>{if(!b._vts)b._vts=Date.now();else if(b._vts<=g.attached)return;Ra(QL(b,g.value),f,5,[b])};return g.value=l,g.attached=KL(),g}function QL(l,f){if(di(f)){const g=l.stopImmediatePropagation;return l.stopImmediatePropagation=()=>{g.call(l),l._stopped=!0},f.map(b=>E=>!E._stopped&&b&&b(E))}else return f}const _w=l=>l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&l.charCodeAt(2)>96&&l.charCodeAt(2)<123,eR=(l,f,g,b,E,P,z,j,s)=>{const K=E==="svg";f==="class"?BL(l,b,K):f==="style"?VL(l,g,b):u_(f)?n0(f)||WL(l,f,g,b,z):(f[0]==="."?(f=f.slice(1),!0):f[0]==="^"?(f=f.slice(1),!1):tR(l,f,b,K))?qL(l,f,b,P,z,j,s):(f==="true-value"?l._trueValue=b:f==="false-value"&&(l._falseValue=b),$L(l,f,b,K))};function tR(l,f,g,b){if(b)return!!(f==="innerHTML"||f==="textContent"||f in l&&_w(f)&&vi(g));if(f==="spellcheck"||f==="draggable"||f==="translate"||f==="form"||f==="list"&&l.tagName==="INPUT"||f==="type"&&l.tagName==="TEXTAREA")return!1;if(f==="width"||f==="height"){const E=l.tagName;if(E==="IMG"||E==="VIDEO"||E==="CANVAS"||E==="SOURCE")return!1}return _w(f)&&Eo(g)?!1:f in l}const rR=Lo({patchProp:eR},kL);let gw;function iR(){return gw||(gw=pL(rR))}const nR=(...l)=>{const f=iR().createApp(...l),{mount:g}=f;return f.mount=b=>{const E=sR(b);if(!E)return;const P=f._component;!vi(P)&&!P.render&&!P.template&&(P.template=E.innerHTML),E.innerHTML="";const z=g(E,!1,oR(E));return E instanceof Element&&(E.removeAttribute("v-cloak"),E.setAttribute("data-v-app","")),z},f};function oR(l){if(l instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&l instanceof MathMLElement)return"mathml"}function sR(l){return Eo(l)?document.querySelector(l):l}var aR=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */const lR=Symbol();var yw;(function(l){l.direct="direct",l.patchObject="patch object",l.patchFunction="patch function"})(yw||(yw={}));function cR(){const l=ZC(!0),f=l.run(()=>Po({}));let g=[],b=[];const E=IT({install(P){E._a=P,P.provide(lR,E),P.config.globalProperties.$pinia=E,b.forEach(z=>g.push(z)),b=[]},use(P){return!this._a&&!aR?b.push(P):g.push(P),this},_p:g,_a:null,_e:l,_s:new Map,state:f});return E}/*!
  * vue-router v4.3.2
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const jh=typeof document<"u";function uR(l){return l.__esModule||l[Symbol.toStringTag]==="Module"}const mn=Object.assign;function Sy(l,f){const g={};for(const b in f){const E=f[b];g[b]=Oa(E)?E.map(l):l(E)}return g}const Gf=()=>{},Oa=Array.isArray,cE=/#/g,hR=/&/g,dR=/\//g,fR=/=/g,pR=/\?/g,uE=/\+/g,mR=/%5B/g,_R=/%5D/g,hE=/%5E/g,gR=/%60/g,dE=/%7B/g,yR=/%7C/g,fE=/%7D/g,vR=/%20/g;function v0(l){return encodeURI(""+l).replace(yR,"|").replace(mR,"[").replace(_R,"]")}function xR(l){return v0(l).replace(dE,"{").replace(fE,"}").replace(hE,"^")}function Wy(l){return v0(l).replace(uE,"%2B").replace(vR,"+").replace(cE,"%23").replace(hR,"%26").replace(gR,"`").replace(dE,"{").replace(fE,"}").replace(hE,"^")}function bR(l){return Wy(l).replace(fR,"%3D")}function wR(l){return v0(l).replace(cE,"%23").replace(pR,"%3F")}function TR(l){return l==null?"":wR(l).replace(dR,"%2F")}function Jf(l){try{return decodeURIComponent(""+l)}catch{}return""+l}const ER=/\/$/,SR=l=>l.replace(ER,"");function My(l,f,g="/"){let b,E={},P="",z="";const j=f.indexOf("#");let s=f.indexOf("?");return j<s&&j>=0&&(s=-1),s>-1&&(b=f.slice(0,s),P=f.slice(s+1,j>-1?j:f.length),E=l(P)),j>-1&&(b=b||f.slice(0,j),z=f.slice(j,f.length)),b=CR(b??f,g),{fullPath:b+(P&&"?")+P+z,path:b,query:E,hash:Jf(z)}}function MR(l,f){const g=f.query?l(f.query):"";return f.path+(g&&"?")+g+(f.hash||"")}function vw(l,f){return!f||!l.toLowerCase().startsWith(f.toLowerCase())?l:l.slice(f.length)||"/"}function AR(l,f,g){const b=f.matched.length-1,E=g.matched.length-1;return b>-1&&b===E&&Xh(f.matched[b],g.matched[E])&&pE(f.params,g.params)&&l(f.query)===l(g.query)&&f.hash===g.hash}function Xh(l,f){return(l.aliasOf||l)===(f.aliasOf||f)}function pE(l,f){if(Object.keys(l).length!==Object.keys(f).length)return!1;for(const g in l)if(!IR(l[g],f[g]))return!1;return!0}function IR(l,f){return Oa(l)?xw(l,f):Oa(f)?xw(f,l):l===f}function xw(l,f){return Oa(f)?l.length===f.length&&l.every((g,b)=>g===f[b]):l.length===1&&l[0]===f}function CR(l,f){if(l.startsWith("/"))return l;if(!l)return f;const g=f.split("/"),b=l.split("/"),E=b[b.length-1];(E===".."||E===".")&&b.push("");let P=g.length-1,z,j;for(z=0;z<b.length;z++)if(j=b[z],j!==".")if(j==="..")P>1&&P--;else break;return g.slice(0,P).join("/")+"/"+b.slice(z).join("/")}var Qf;(function(l){l.pop="pop",l.push="push"})(Qf||(Qf={}));var $f;(function(l){l.back="back",l.forward="forward",l.unknown=""})($f||($f={}));function PR(l){if(!l)if(jh){const f=document.querySelector("base");l=f&&f.getAttribute("href")||"/",l=l.replace(/^\w+:\/\/[^\/]+/,"")}else l="/";return l[0]!=="/"&&l[0]!=="#"&&(l="/"+l),SR(l)}const LR=/^[^#]+#/;function RR(l,f){return l.replace(LR,"#")+f}function OR(l,f){const g=document.documentElement.getBoundingClientRect(),b=l.getBoundingClientRect();return{behavior:f.behavior,left:b.left-g.left-(f.left||0),top:b.top-g.top-(f.top||0)}}const E_=()=>({left:window.scrollX,top:window.scrollY});function DR(l){let f;if("el"in l){const g=l.el,b=typeof g=="string"&&g.startsWith("#"),E=typeof g=="string"?b?document.getElementById(g.slice(1)):document.querySelector(g):g;if(!E)return;f=OR(E,l)}else f=l;"scrollBehavior"in document.documentElement.style?window.scrollTo(f):window.scrollTo(f.left!=null?f.left:window.scrollX,f.top!=null?f.top:window.scrollY)}function bw(l,f){return(history.state?history.state.position-f:-1)+l}const Xy=new Map;function zR(l,f){Xy.set(l,f)}function kR(l){const f=Xy.get(l);return Xy.delete(l),f}let FR=()=>location.protocol+"//"+location.host;function mE(l,f){const{pathname:g,search:b,hash:E}=f,P=l.indexOf("#");if(P>-1){let j=E.includes(l.slice(P))?l.slice(P).length:1,s=E.slice(j);return s[0]!=="/"&&(s="/"+s),vw(s,"")}return vw(g,l)+b+E}function BR(l,f,g,b){let E=[],P=[],z=null;const j=({state:we})=>{const Ee=mE(l,location),Me=g.value,Ce=f.value;let Ue=0;if(we){if(g.value=Ee,f.value=we,z&&z===Me){z=null;return}Ue=Ce?we.position-Ce.position:0}else b(Ee);E.forEach(lt=>{lt(g.value,Me,{delta:Ue,type:Qf.pop,direction:Ue?Ue>0?$f.forward:$f.back:$f.unknown})})};function s(){z=g.value}function K(we){E.push(we);const Ee=()=>{const Me=E.indexOf(we);Me>-1&&E.splice(Me,1)};return P.push(Ee),Ee}function Q(){const{history:we}=window;we.state&&we.replaceState(mn({},we.state,{scroll:E_()}),"")}function re(){for(const we of P)we();P=[],window.removeEventListener("popstate",j),window.removeEventListener("beforeunload",Q)}return window.addEventListener("popstate",j),window.addEventListener("beforeunload",Q,{passive:!0}),{pauseListeners:s,listen:K,destroy:re}}function ww(l,f,g,b=!1,E=!1){return{back:l,current:f,forward:g,replaced:b,position:window.history.length,scroll:E?E_():null}}function NR(l){const{history:f,location:g}=window,b={value:mE(l,g)},E={value:f.state};E.value||P(b.value,{back:null,current:b.value,forward:null,position:f.length-1,replaced:!0,scroll:null},!0);function P(s,K,Q){const re=l.indexOf("#"),we=re>-1?(g.host&&document.querySelector("base")?l:l.slice(re))+s:FR()+l+s;try{f[Q?"replaceState":"pushState"](K,"",we),E.value=K}catch(Ee){console.error(Ee),g[Q?"replace":"assign"](we)}}function z(s,K){const Q=mn({},f.state,ww(E.value.back,s,E.value.forward,!0),K,{position:E.value.position});P(s,Q,!0),b.value=s}function j(s,K){const Q=mn({},E.value,f.state,{forward:s,scroll:E_()});P(Q.current,Q,!0);const re=mn({},ww(b.value,s,null),{position:Q.position+1},K);P(s,re,!1),b.value=s}return{location:b,state:E,push:j,replace:z}}function UR(l){l=PR(l);const f=NR(l),g=BR(l,f.state,f.location,f.replace);function b(P,z=!0){z||g.pauseListeners(),history.go(P)}const E=mn({location:"",base:l,go:b,createHref:RR.bind(null,l)},f,g);return Object.defineProperty(E,"location",{enumerable:!0,get:()=>f.location.value}),Object.defineProperty(E,"state",{enumerable:!0,get:()=>f.state.value}),E}function jR(l){return typeof l=="string"||l&&typeof l=="object"}function _E(l){return typeof l=="string"||typeof l=="symbol"}const Ic={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},gE=Symbol("");var Tw;(function(l){l[l.aborted=4]="aborted",l[l.cancelled=8]="cancelled",l[l.duplicated=16]="duplicated"})(Tw||(Tw={}));function Yh(l,f){return mn(new Error,{type:l,[gE]:!0},f)}function Nl(l,f){return l instanceof Error&&gE in l&&(f==null||!!(l.type&f))}const Ew="[^/]+?",VR={sensitive:!1,strict:!1,start:!0,end:!0},GR=/[.+*?^${}()[\]/\\]/g;function $R(l,f){const g=mn({},VR,f),b=[];let E=g.start?"^":"";const P=[];for(const K of l){const Q=K.length?[]:[90];g.strict&&!K.length&&(E+="/");for(let re=0;re<K.length;re++){const we=K[re];let Ee=40+(g.sensitive?.25:0);if(we.type===0)re||(E+="/"),E+=we.value.replace(GR,"\\$&"),Ee+=40;else if(we.type===1){const{value:Me,repeatable:Ce,optional:Ue,regexp:lt}=we;P.push({name:Me,repeatable:Ce,optional:Ue});const $t=lt||Ew;if($t!==Ew){Ee+=10;try{new RegExp(`(${$t})`)}catch(yr){throw new Error(`Invalid custom RegExp for param "${Me}" (${$t}): `+yr.message)}}let It=Ce?`((?:${$t})(?:/(?:${$t}))*)`:`(${$t})`;re||(It=Ue&&K.length<2?`(?:/${It})`:"/"+It),Ue&&(It+="?"),E+=It,Ee+=20,Ue&&(Ee+=-8),Ce&&(Ee+=-20),$t===".*"&&(Ee+=-50)}Q.push(Ee)}b.push(Q)}if(g.strict&&g.end){const K=b.length-1;b[K][b[K].length-1]+=.7000000000000001}g.strict||(E+="/?"),g.end?E+="$":g.strict&&(E+="(?:/|$)");const z=new RegExp(E,g.sensitive?"":"i");function j(K){const Q=K.match(z),re={};if(!Q)return null;for(let we=1;we<Q.length;we++){const Ee=Q[we]||"",Me=P[we-1];re[Me.name]=Ee&&Me.repeatable?Ee.split("/"):Ee}return re}function s(K){let Q="",re=!1;for(const we of l){(!re||!Q.endsWith("/"))&&(Q+="/"),re=!1;for(const Ee of we)if(Ee.type===0)Q+=Ee.value;else if(Ee.type===1){const{value:Me,repeatable:Ce,optional:Ue}=Ee,lt=Me in K?K[Me]:"";if(Oa(lt)&&!Ce)throw new Error(`Provided param "${Me}" is an array but it is not repeatable (* or + modifiers)`);const $t=Oa(lt)?lt.join("/"):lt;if(!$t)if(Ue)we.length<2&&(Q.endsWith("/")?Q=Q.slice(0,-1):re=!0);else throw new Error(`Missing required param "${Me}"`);Q+=$t}}return Q||"/"}return{re:z,score:b,keys:P,parse:j,stringify:s}}function qR(l,f){let g=0;for(;g<l.length&&g<f.length;){const b=f[g]-l[g];if(b)return b;g++}return l.length<f.length?l.length===1&&l[0]===80?-1:1:l.length>f.length?f.length===1&&f[0]===80?1:-1:0}function ZR(l,f){let g=0;const b=l.score,E=f.score;for(;g<b.length&&g<E.length;){const P=qR(b[g],E[g]);if(P)return P;g++}if(Math.abs(E.length-b.length)===1){if(Sw(b))return 1;if(Sw(E))return-1}return E.length-b.length}function Sw(l){const f=l[l.length-1];return l.length>0&&f[f.length-1]<0}const HR={type:0,value:""},WR=/[a-zA-Z0-9_]/;function XR(l){if(!l)return[[]];if(l==="/")return[[HR]];if(!l.startsWith("/"))throw new Error(`Invalid path "${l}"`);function f(Ee){throw new Error(`ERR (${g})/"${K}": ${Ee}`)}let g=0,b=g;const E=[];let P;function z(){P&&E.push(P),P=[]}let j=0,s,K="",Q="";function re(){K&&(g===0?P.push({type:0,value:K}):g===1||g===2||g===3?(P.length>1&&(s==="*"||s==="+")&&f(`A repeatable param (${K}) must be alone in its segment. eg: '/:ids+.`),P.push({type:1,value:K,regexp:Q,repeatable:s==="*"||s==="+",optional:s==="*"||s==="?"})):f("Invalid state to consume buffer"),K="")}function we(){K+=s}for(;j<l.length;){if(s=l[j++],s==="\\"&&g!==2){b=g,g=4;continue}switch(g){case 0:s==="/"?(K&&re(),z()):s===":"?(re(),g=1):we();break;case 4:we(),g=b;break;case 1:s==="("?g=2:WR.test(s)?we():(re(),g=0,s!=="*"&&s!=="?"&&s!=="+"&&j--);break;case 2:s===")"?Q[Q.length-1]=="\\"?Q=Q.slice(0,-1)+s:g=3:Q+=s;break;case 3:re(),g=0,s!=="*"&&s!=="?"&&s!=="+"&&j--,Q="";break;default:f("Unknown state");break}}return g===2&&f(`Unfinished custom RegExp for param "${K}"`),re(),z(),E}function YR(l,f,g){const b=$R(XR(l.path),g),E=mn(b,{record:l,parent:f,children:[],alias:[]});return f&&!E.record.aliasOf==!f.record.aliasOf&&f.children.push(E),E}function KR(l,f){const g=[],b=new Map;f=Iw({strict:!1,end:!0,sensitive:!1},f);function E(Q){return b.get(Q)}function P(Q,re,we){const Ee=!we,Me=JR(Q);Me.aliasOf=we&&we.record;const Ce=Iw(f,Q),Ue=[Me];if("alias"in Q){const It=typeof Q.alias=="string"?[Q.alias]:Q.alias;for(const yr of It)Ue.push(mn({},Me,{components:we?we.record.components:Me.components,path:yr,aliasOf:we?we.record:Me}))}let lt,$t;for(const It of Ue){const{path:yr}=It;if(re&&yr[0]!=="/"){const zr=re.record.path,hr=zr[zr.length-1]==="/"?"":"/";It.path=re.record.path+(yr&&hr+yr)}if(lt=YR(It,re,Ce),we?we.alias.push(lt):($t=$t||lt,$t!==lt&&$t.alias.push(lt),Ee&&Q.name&&!Aw(lt)&&z(Q.name)),Me.children){const zr=Me.children;for(let hr=0;hr<zr.length;hr++)P(zr[hr],lt,we&&we.children[hr])}we=we||lt,(lt.record.components&&Object.keys(lt.record.components).length||lt.record.name||lt.record.redirect)&&s(lt)}return $t?()=>{z($t)}:Gf}function z(Q){if(_E(Q)){const re=b.get(Q);re&&(b.delete(Q),g.splice(g.indexOf(re),1),re.children.forEach(z),re.alias.forEach(z))}else{const re=g.indexOf(Q);re>-1&&(g.splice(re,1),Q.record.name&&b.delete(Q.record.name),Q.children.forEach(z),Q.alias.forEach(z))}}function j(){return g}function s(Q){let re=0;for(;re<g.length&&ZR(Q,g[re])>=0&&(Q.record.path!==g[re].record.path||!yE(Q,g[re]));)re++;g.splice(re,0,Q),Q.record.name&&!Aw(Q)&&b.set(Q.record.name,Q)}function K(Q,re){let we,Ee={},Me,Ce;if("name"in Q&&Q.name){if(we=b.get(Q.name),!we)throw Yh(1,{location:Q});Ce=we.record.name,Ee=mn(Mw(re.params,we.keys.filter($t=>!$t.optional).concat(we.parent?we.parent.keys.filter($t=>$t.optional):[]).map($t=>$t.name)),Q.params&&Mw(Q.params,we.keys.map($t=>$t.name))),Me=we.stringify(Ee)}else if(Q.path!=null)Me=Q.path,we=g.find($t=>$t.re.test(Me)),we&&(Ee=we.parse(Me),Ce=we.record.name);else{if(we=re.name?b.get(re.name):g.find($t=>$t.re.test(re.path)),!we)throw Yh(1,{location:Q,currentLocation:re});Ce=we.record.name,Ee=mn({},re.params,Q.params),Me=we.stringify(Ee)}const Ue=[];let lt=we;for(;lt;)Ue.unshift(lt.record),lt=lt.parent;return{name:Ce,path:Me,params:Ee,matched:Ue,meta:eO(Ue)}}return l.forEach(Q=>P(Q)),{addRoute:P,resolve:K,removeRoute:z,getRoutes:j,getRecordMatcher:E}}function Mw(l,f){const g={};for(const b of f)b in l&&(g[b]=l[b]);return g}function JR(l){return{path:l.path,redirect:l.redirect,name:l.name,meta:l.meta||{},aliasOf:void 0,beforeEnter:l.beforeEnter,props:QR(l),children:l.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in l?l.components||null:l.component&&{default:l.component}}}function QR(l){const f={},g=l.props||!1;if("component"in l)f.default=g;else for(const b in l.components)f[b]=typeof g=="object"?g[b]:g;return f}function Aw(l){for(;l;){if(l.record.aliasOf)return!0;l=l.parent}return!1}function eO(l){return l.reduce((f,g)=>mn(f,g.meta),{})}function Iw(l,f){const g={};for(const b in l)g[b]=b in f?f[b]:l[b];return g}function yE(l,f){return f.children.some(g=>g===l||yE(l,g))}function tO(l){const f={};if(l===""||l==="?")return f;const b=(l[0]==="?"?l.slice(1):l).split("&");for(let E=0;E<b.length;++E){const P=b[E].replace(uE," "),z=P.indexOf("="),j=Jf(z<0?P:P.slice(0,z)),s=z<0?null:Jf(P.slice(z+1));if(j in f){let K=f[j];Oa(K)||(K=f[j]=[K]),K.push(s)}else f[j]=s}return f}function Cw(l){let f="";for(let g in l){const b=l[g];if(g=bR(g),b==null){b!==void 0&&(f+=(f.length?"&":"")+g);continue}(Oa(b)?b.map(P=>P&&Wy(P)):[b&&Wy(b)]).forEach(P=>{P!==void 0&&(f+=(f.length?"&":"")+g,P!=null&&(f+="="+P))})}return f}function rO(l){const f={};for(const g in l){const b=l[g];b!==void 0&&(f[g]=Oa(b)?b.map(E=>E==null?null:""+E):b==null?b:""+b)}return f}const iO=Symbol(""),Pw=Symbol(""),x0=Symbol(""),vE=Symbol(""),Yy=Symbol("");function Lf(){let l=[];function f(b){return l.push(b),()=>{const E=l.indexOf(b);E>-1&&l.splice(E,1)}}function g(){l=[]}return{add:f,list:()=>l.slice(),reset:g}}function Dc(l,f,g,b,E,P=z=>z()){const z=b&&(b.enterCallbacks[E]=b.enterCallbacks[E]||[]);return()=>new Promise((j,s)=>{const K=we=>{we===!1?s(Yh(4,{from:g,to:f})):we instanceof Error?s(we):jR(we)?s(Yh(2,{from:f,to:we})):(z&&b.enterCallbacks[E]===z&&typeof we=="function"&&z.push(we),j())},Q=P(()=>l.call(b&&b.instances[E],f,g,K));let re=Promise.resolve(Q);l.length<3&&(re=re.then(K)),re.catch(we=>s(we))})}function Ay(l,f,g,b,E=P=>P()){const P=[];for(const z of l)for(const j in z.components){let s=z.components[j];if(!(f!=="beforeRouteEnter"&&!z.instances[j]))if(nO(s)){const Q=(s.__vccOpts||s)[f];Q&&P.push(Dc(Q,g,b,z,j,E))}else{let K=s();P.push(()=>K.then(Q=>{if(!Q)return Promise.reject(new Error(`Couldn't resolve component "${j}" at "${z.path}"`));const re=uR(Q)?Q.default:Q;z.components[j]=re;const Ee=(re.__vccOpts||re)[f];return Ee&&Dc(Ee,g,b,z,j,E)()}))}}return P}function nO(l){return typeof l=="object"||"displayName"in l||"props"in l||"__vccOpts"in l}function Lw(l){const f=_n(x0),g=_n(vE),b=sa(()=>{const s=al(l.to);return f.resolve(s)}),E=sa(()=>{const{matched:s}=b.value,{length:K}=s,Q=s[K-1],re=g.matched;if(!Q||!re.length)return-1;const we=re.findIndex(Xh.bind(null,Q));if(we>-1)return we;const Ee=Rw(s[K-2]);return K>1&&Rw(Q)===Ee&&re[re.length-1].path!==Ee?re.findIndex(Xh.bind(null,s[K-2])):we}),P=sa(()=>E.value>-1&&lO(g.params,b.value.params)),z=sa(()=>E.value>-1&&E.value===g.matched.length-1&&pE(g.params,b.value.params));function j(s={}){return aO(s)?f[al(l.replace)?"replace":"push"](al(l.to)).catch(Gf):Promise.resolve()}return{route:b,href:sa(()=>b.value.href),isActive:P,isExactActive:z,navigate:j}}const oO=$n({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Lw,setup(l,{slots:f}){const g=tp(Lw(l)),{options:b}=_n(x0),E=sa(()=>({[Ow(l.activeClass,b.linkActiveClass,"router-link-active")]:g.isActive,[Ow(l.exactActiveClass,b.linkExactActiveClass,"router-link-exact-active")]:g.isExactActive}));return()=>{const P=f.default&&f.default(g);return l.custom?P:Kf("a",{"aria-current":g.isExactActive?l.ariaCurrentValue:null,href:g.href,onClick:g.navigate,class:E.value},P)}}}),sO=oO;function aO(l){if(!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)&&!l.defaultPrevented&&!(l.button!==void 0&&l.button!==0)){if(l.currentTarget&&l.currentTarget.getAttribute){const f=l.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(f))return}return l.preventDefault&&l.preventDefault(),!0}}function lO(l,f){for(const g in f){const b=f[g],E=l[g];if(typeof b=="string"){if(b!==E)return!1}else if(!Oa(E)||E.length!==b.length||b.some((P,z)=>P!==E[z]))return!1}return!0}function Rw(l){return l?l.aliasOf?l.aliasOf.path:l.path:""}const Ow=(l,f,g)=>l??f??g,cO=$n({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(l,{attrs:f,slots:g}){const b=_n(Yy),E=sa(()=>l.route||b.value),P=_n(Pw,0),z=sa(()=>{let K=al(P);const{matched:Q}=E.value;let re;for(;(re=Q[K])&&!re.components;)K++;return K}),j=sa(()=>E.value.matched[z.value]);bs(Pw,sa(()=>z.value+1)),bs(iO,j),bs(Yy,E);const s=Po();return Yn(()=>[s.value,j.value,l.name],([K,Q,re],[we,Ee,Me])=>{Q&&(Q.instances[re]=K,Ee&&Ee!==Q&&K&&K===we&&(Q.leaveGuards.size||(Q.leaveGuards=Ee.leaveGuards),Q.updateGuards.size||(Q.updateGuards=Ee.updateGuards))),K&&Q&&(!Ee||!Xh(Q,Ee)||!we)&&(Q.enterCallbacks[re]||[]).forEach(Ce=>Ce(K))},{flush:"post"}),()=>{const K=E.value,Q=l.name,re=j.value,we=re&&re.components[Q];if(!we)return Dw(g.default,{Component:we,route:K});const Ee=re.props[Q],Me=Ee?Ee===!0?K.params:typeof Ee=="function"?Ee(K):Ee:null,Ue=Kf(we,mn({},Me,f,{onVnodeUnmounted:lt=>{lt.component.isUnmounted&&(re.instances[Q]=null)},ref:s}));return Dw(g.default,{Component:Ue,route:K})||Ue}}});function Dw(l,f){if(!l)return null;const g=l(f);return g.length===1?g[0]:g}const xE=cO;function uO(l){const f=KR(l.routes,l),g=l.parseQuery||tO,b=l.stringifyQuery||Cw,E=l.history,P=Lf(),z=Lf(),j=Lf(),s=_P(Ic);let K=Ic;jh&&l.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const Q=Sy.bind(null,Ye=>""+Ye),re=Sy.bind(null,TR),we=Sy.bind(null,Jf);function Ee(Ye,Yt){let kt,St;return _E(Ye)?(kt=f.getRecordMatcher(Ye),St=Yt):St=Ye,f.addRoute(St,kt)}function Me(Ye){const Yt=f.getRecordMatcher(Ye);Yt&&f.removeRoute(Yt)}function Ce(){return f.getRoutes().map(Ye=>Ye.record)}function Ue(Ye){return!!f.getRecordMatcher(Ye)}function lt(Ye,Yt){if(Yt=mn({},Yt||s.value),typeof Ye=="string"){const ve=My(g,Ye,Yt.path),We=f.resolve({path:ve.path},Yt),rt=E.createHref(ve.fullPath);return mn(ve,We,{params:we(We.params),hash:Jf(ve.hash),redirectedFrom:void 0,href:rt})}let kt;if(Ye.path!=null)kt=mn({},Ye,{path:My(g,Ye.path,Yt.path).path});else{const ve=mn({},Ye.params);for(const We in ve)ve[We]==null&&delete ve[We];kt=mn({},Ye,{params:re(ve)}),Yt.params=re(Yt.params)}const St=f.resolve(kt,Yt),ai=Ye.hash||"";St.params=Q(we(St.params));const bi=MR(b,mn({},Ye,{hash:xR(ai),path:St.path})),ge=E.createHref(bi);return mn({fullPath:bi,hash:ai,query:b===Cw?rO(Ye.query):Ye.query||{}},St,{redirectedFrom:void 0,href:ge})}function $t(Ye){return typeof Ye=="string"?My(g,Ye,s.value.path):mn({},Ye)}function It(Ye,Yt){if(K!==Ye)return Yh(8,{from:Yt,to:Ye})}function yr(Ye){return Ai(Ye)}function zr(Ye){return yr(mn($t(Ye),{replace:!0}))}function hr(Ye){const Yt=Ye.matched[Ye.matched.length-1];if(Yt&&Yt.redirect){const{redirect:kt}=Yt;let St=typeof kt=="function"?kt(Ye):kt;return typeof St=="string"&&(St=St.includes("?")||St.includes("#")?St=$t(St):{path:St},St.params={}),mn({query:Ye.query,hash:Ye.hash,params:St.path!=null?{}:Ye.params},St)}}function Ai(Ye,Yt){const kt=K=lt(Ye),St=s.value,ai=Ye.state,bi=Ye.force,ge=Ye.replace===!0,ve=hr(kt);if(ve)return Ai(mn($t(ve),{state:typeof ve=="object"?mn({},ai,ve.state):ai,force:bi,replace:ge}),Yt||kt);const We=kt;We.redirectedFrom=Yt;let rt;return!bi&&AR(b,St,kt)&&(rt=Yh(16,{to:We,from:St}),nn(St,St,!0,!1)),(rt?Promise.resolve(rt):Cn(We,St)).catch(ut=>Nl(ut)?Nl(ut,2)?ut:kn(ut):Zt(ut,We,St)).then(ut=>{if(ut){if(Nl(ut,2))return Ai(mn({replace:ge},$t(ut.to),{state:typeof ut.to=="object"?mn({},ai,ut.to.state):ai,force:bi}),Yt||We)}else ut=br(We,St,!0,ge,ai);return Kn(We,St,ut),ut})}function Ii(Ye,Yt){const kt=It(Ye,Yt);return kt?Promise.reject(kt):Promise.resolve()}function dt(Ye){const Yt=pr.values().next().value;return Yt&&typeof Yt.runWithContext=="function"?Yt.runWithContext(Ye):Ye()}function Cn(Ye,Yt){let kt;const[St,ai,bi]=hO(Ye,Yt);kt=Ay(St.reverse(),"beforeRouteLeave",Ye,Yt);for(const ve of St)ve.leaveGuards.forEach(We=>{kt.push(Dc(We,Ye,Yt))});const ge=Ii.bind(null,Ye,Yt);return kt.push(ge),gr(kt).then(()=>{kt=[];for(const ve of P.list())kt.push(Dc(ve,Ye,Yt));return kt.push(ge),gr(kt)}).then(()=>{kt=Ay(ai,"beforeRouteUpdate",Ye,Yt);for(const ve of ai)ve.updateGuards.forEach(We=>{kt.push(Dc(We,Ye,Yt))});return kt.push(ge),gr(kt)}).then(()=>{kt=[];for(const ve of bi)if(ve.beforeEnter)if(Oa(ve.beforeEnter))for(const We of ve.beforeEnter)kt.push(Dc(We,Ye,Yt));else kt.push(Dc(ve.beforeEnter,Ye,Yt));return kt.push(ge),gr(kt)}).then(()=>(Ye.matched.forEach(ve=>ve.enterCallbacks={}),kt=Ay(bi,"beforeRouteEnter",Ye,Yt,dt),kt.push(ge),gr(kt))).then(()=>{kt=[];for(const ve of z.list())kt.push(Dc(ve,Ye,Yt));return kt.push(ge),gr(kt)}).catch(ve=>Nl(ve,8)?ve:Promise.reject(ve))}function Kn(Ye,Yt,kt){j.list().forEach(St=>dt(()=>St(Ye,Yt,kt)))}function br(Ye,Yt,kt,St,ai){const bi=It(Ye,Yt);if(bi)return bi;const ge=Yt===Ic,ve=jh?history.state:{};kt&&(St||ge?E.replace(Ye.fullPath,mn({scroll:ge&&ve&&ve.scroll},ai)):E.push(Ye.fullPath,ai)),s.value=Ye,nn(Ye,Yt,kt,ge),kn()}let zi;function Jn(){zi||(zi=E.listen((Ye,Yt,kt)=>{if(!Ir.listening)return;const St=lt(Ye),ai=hr(St);if(ai){Ai(mn(ai,{replace:!0}),St).catch(Gf);return}K=St;const bi=s.value;jh&&zR(bw(bi.fullPath,kt.delta),E_()),Cn(St,bi).catch(ge=>Nl(ge,12)?ge:Nl(ge,2)?(Ai(ge.to,St).then(ve=>{Nl(ve,20)&&!kt.delta&&kt.type===Qf.pop&&E.go(-1,!1)}).catch(Gf),Promise.reject()):(kt.delta&&E.go(-kt.delta,!1),Zt(ge,St,bi))).then(ge=>{ge=ge||br(St,bi,!1),ge&&(kt.delta&&!Nl(ge,8)?E.go(-kt.delta,!1):kt.type===Qf.pop&&Nl(ge,20)&&E.go(-1,!1)),Kn(St,bi,ge)}).catch(Gf)}))}let Ct=Lf(),Ci=Lf(),Jr;function Zt(Ye,Yt,kt){kn(Ye);const St=Ci.list();return St.length?St.forEach(ai=>ai(Ye,Yt,kt)):console.error(Ye),Promise.reject(Ye)}function Pn(){return Jr&&s.value!==Ic?Promise.resolve():new Promise((Ye,Yt)=>{Ct.add([Ye,Yt])})}function kn(Ye){return Jr||(Jr=!Ye,Jn(),Ct.list().forEach(([Yt,kt])=>Ye?kt(Ye):Yt()),Ct.reset()),Ye}function nn(Ye,Yt,kt,St){const{scrollBehavior:ai}=l;if(!jh||!ai)return Promise.resolve();const bi=!kt&&kR(bw(Ye.fullPath,0))||(St||!kt)&&history.state&&history.state.scroll||null;return zT().then(()=>ai(Ye,Yt,bi)).then(ge=>ge&&DR(ge)).catch(ge=>Zt(ge,Ye,Yt))}const _r=Ye=>E.go(Ye);let rr;const pr=new Set,Ir={currentRoute:s,listening:!0,addRoute:Ee,removeRoute:Me,hasRoute:Ue,getRoutes:Ce,resolve:lt,options:l,push:yr,replace:zr,go:_r,back:()=>_r(-1),forward:()=>_r(1),beforeEach:P.add,beforeResolve:z.add,afterEach:j.add,onError:Ci.add,isReady:Pn,install(Ye){const Yt=this;Ye.component("RouterLink",sO),Ye.component("RouterView",xE),Ye.config.globalProperties.$router=Yt,Object.defineProperty(Ye.config.globalProperties,"$route",{enumerable:!0,get:()=>al(s)}),jh&&!rr&&s.value===Ic&&(rr=!0,yr(E.location).catch(ai=>{}));const kt={};for(const ai in Ic)Object.defineProperty(kt,ai,{get:()=>s.value[ai],enumerable:!0});Ye.provide(x0,Yt),Ye.provide(vE,ST(kt)),Ye.provide(Yy,s);const St=Ye.unmount;pr.add(Ye),Ye.unmount=function(){pr.delete(Ye),pr.size<1&&(K=Ic,zi&&zi(),zi=null,s.value=Ic,rr=!1,Jr=!1),St()}}};function gr(Ye){return Ye.reduce((Yt,kt)=>Yt.then(()=>dt(kt)),Promise.resolve())}return Ir}function hO(l,f){const g=[],b=[],E=[],P=Math.max(f.matched.length,l.matched.length);for(let z=0;z<P;z++){const j=f.matched[z];j&&(l.matched.find(K=>Xh(K,j))?b.push(j):g.push(j));const s=l.matched[z];s&&(f.matched.find(K=>Xh(K,s))||E.push(s))}return[g,b,E]}const S_=(l,f)=>{const g=l.__vccOpts||l;for(const[b,E]of f)g[b]=E;return g},dO={},fO={class:"bg-orbus-500 p-4 text-white"},pO={class:"container mx-auto align-middle flex justify-between md:max-w-xl"},mO=Ni("h1",{class:"text-lg"},"Crystal Orbus",-1),_O={class:"flex gap-3"};function gO(l,f){const g=Vl("RouterLink");return Di(),Ki("nav",fO,[Ni("div",pO,[mO,Ni("div",_O,[bn(g,{to:"/",class:"text-white p-2 hover:bg-orbus-700 rounded font-bold"},{default:jl(()=>[Yf("My Stops")]),_:1}),bn(g,{to:"/map",class:"text-white p-2 hover:bg-orbus-700 rounded font-bold"},{default:jl(()=>[Yf("Map")]),_:1})])])])}const yO=S_(dO,[["render",gO]]),vO={class:"m-auto md:max-w-xl"},xO=$n({__name:"App",setup(l){return(f,g)=>(Di(),Ki(Xo,null,[bn(yO),Ni("main",vO,[bn(al(xE))])],64))}});function bO(l){const f=[];return l.forEach(g=>{g.nextStopVisits.forEach(b=>{b.stopVisits.forEach(E=>{const P=E.estimatedMinutesUntilDeparture??E.scheduledMinutesUntilDeparture;f.push({lineNumber:b.directionOfLine.lineNumber,destinationName:b.directionOfLine.destinationName,stopName:E.stopName,departureTime:P})})})}),f.sort((g,b)=>g.departureTime-b.departureTime)}const bE=l=>(CP("data-v-74d4dc5b"),l=l(),PP(),l),wO={class:"min-w-full leading-normal border-t"},TO=bE(()=>Ni("thead",null,[Ni("tr",null,[Ni("th",{class:"px-5 py-3 border-b-2 border-gray-300 text-xs font-semibold text-gray-600 uppercase tracking-wider w-16 text-center"}," Bus "),Ni("th",{class:"px-5 py-3 border-b-2 border-gray-300 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"}," Route & Destination "),Ni("th",{class:"px-5 py-3 border-b-2 border-gray-300 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-24"}," Est. Departure ")])],-1)),EO={class:"px-5 py-5 border-b border-gray-200 text-sm"},SO={class:"flex justify-center items-center"},MO={class:"block rounded-full bg-black text-white text-center px-3 py-1 text-sm font-semibold"},AO={class:"px-5 py-5 border-b border-gray-200 text-sm"},IO={class:"text-gray-900 whitespace-no-wrap"},CO=bE(()=>Ni("br",null,null,-1)),PO={class:"text-xs text-gray-500"},LO={class:"px-5 py-5 border-b border-gray-200"},RO={class:"text-gray-900 whitespace-no-wrap"},OO=$n({__name:"GroupTimetable",props:{data:{}},setup(l){const f=l,g=sa(()=>bO(f.data));return(b,E)=>(Di(),Ki("table",wO,[TO,Ni("tbody",null,[(Di(!0),Ki(Xo,null,x_(g.value,(P,z)=>(Di(),Ki("tr",{class:"",key:z},[Ni("td",EO,[Ni("div",SO,[Ni("span",MO,Nu(P.lineNumber),1)])]),Ni("td",AO,[Ni("p",IO,[Yf(Nu(P.destinationName)+" ",1),CO,Ni("span",PO,Nu(P.stopName),1)])]),Ni("td",LO,[Ni("p",RO,Nu(P.departureTime)+" "+Nu(P.departureTime===1?"min":"mins"),1)])]))),128))])]))}}),DO=S_(OO,[["__scopeId","data-v-74d4dc5b"]]);/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zO=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var qm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kO=({size:l,strokeWidth:f=2,absoluteStrokeWidth:g,color:b,iconNode:E,name:P,class:z,...j},{slots:s})=>Kf("svg",{...qm,width:l||qm.width,height:l||qm.height,stroke:b||qm.stroke,"stroke-width":g?Number(f)*24/Number(l):f,class:["lucide",`lucide-${zO(P??"icon")}`],...j},[...E.map(K=>Kf(...K)),...s.default?[s.default()]:[]]);/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wE=(l,f)=>(g,{slots:b})=>Kf(kO,{...g,iconNode:f,name:l},b);/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FO=wE("CheckIcon",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-vue-next v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BO=wE("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var so=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function np(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function NO(l){if(l.__esModule)return l;var f=l.default;if(typeof f=="function"){var g=function b(){return this instanceof b?Reflect.construct(f,arguments,this.constructor):f.apply(this,arguments)};g.prototype=f.prototype}else g={};return Object.defineProperty(g,"__esModule",{value:!0}),Object.keys(l).forEach(function(b){var E=Object.getOwnPropertyDescriptor(l,b);Object.defineProperty(g,b,E.get?E:{enumerable:!0,get:function(){return l[b]}})}),g}var TE={exports:{}};/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT © Zeno Rocha
 */(function(l,f){(function(b,E){l.exports=E()})(so,function(){return function(){var g={686:function(P,z,j){j.d(z,{default:function(){return nn}});var s=j(279),K=j.n(s),Q=j(370),re=j.n(Q),we=j(817),Ee=j.n(we);function Me(_r){try{return document.execCommand(_r)}catch{return!1}}var Ce=function(rr){var pr=Ee()(rr);return Me("cut"),pr},Ue=Ce;function lt(_r){var rr=document.documentElement.getAttribute("dir")==="rtl",pr=document.createElement("textarea");pr.style.fontSize="12pt",pr.style.border="0",pr.style.padding="0",pr.style.margin="0",pr.style.position="absolute",pr.style[rr?"right":"left"]="-9999px";var Ir=window.pageYOffset||document.documentElement.scrollTop;return pr.style.top="".concat(Ir,"px"),pr.setAttribute("readonly",""),pr.value=_r,pr}var $t=function(rr,pr){var Ir=lt(rr);pr.container.appendChild(Ir);var gr=Ee()(Ir);return Me("copy"),Ir.remove(),gr},It=function(rr){var pr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},Ir="";return typeof rr=="string"?Ir=$t(rr,pr):rr instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(rr==null?void 0:rr.type)?Ir=$t(rr.value,pr):(Ir=Ee()(rr),Me("copy")),Ir},yr=It;function zr(_r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?zr=function(pr){return typeof pr}:zr=function(pr){return pr&&typeof Symbol=="function"&&pr.constructor===Symbol&&pr!==Symbol.prototype?"symbol":typeof pr},zr(_r)}var hr=function(){var rr=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},pr=rr.action,Ir=pr===void 0?"copy":pr,gr=rr.container,Ye=rr.target,Yt=rr.text;if(Ir!=="copy"&&Ir!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(Ye!==void 0)if(Ye&&zr(Ye)==="object"&&Ye.nodeType===1){if(Ir==="copy"&&Ye.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(Ir==="cut"&&(Ye.hasAttribute("readonly")||Ye.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(Yt)return yr(Yt,{container:gr});if(Ye)return Ir==="cut"?Ue(Ye):yr(Ye,{container:gr})},Ai=hr;function Ii(_r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ii=function(pr){return typeof pr}:Ii=function(pr){return pr&&typeof Symbol=="function"&&pr.constructor===Symbol&&pr!==Symbol.prototype?"symbol":typeof pr},Ii(_r)}function dt(_r,rr){if(!(_r instanceof rr))throw new TypeError("Cannot call a class as a function")}function Cn(_r,rr){for(var pr=0;pr<rr.length;pr++){var Ir=rr[pr];Ir.enumerable=Ir.enumerable||!1,Ir.configurable=!0,"value"in Ir&&(Ir.writable=!0),Object.defineProperty(_r,Ir.key,Ir)}}function Kn(_r,rr,pr){return rr&&Cn(_r.prototype,rr),pr&&Cn(_r,pr),_r}function br(_r,rr){if(typeof rr!="function"&&rr!==null)throw new TypeError("Super expression must either be null or a function");_r.prototype=Object.create(rr&&rr.prototype,{constructor:{value:_r,writable:!0,configurable:!0}}),rr&&zi(_r,rr)}function zi(_r,rr){return zi=Object.setPrototypeOf||function(Ir,gr){return Ir.__proto__=gr,Ir},zi(_r,rr)}function Jn(_r){var rr=Jr();return function(){var Ir=Zt(_r),gr;if(rr){var Ye=Zt(this).constructor;gr=Reflect.construct(Ir,arguments,Ye)}else gr=Ir.apply(this,arguments);return Ct(this,gr)}}function Ct(_r,rr){return rr&&(Ii(rr)==="object"||typeof rr=="function")?rr:Ci(_r)}function Ci(_r){if(_r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _r}function Jr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function Zt(_r){return Zt=Object.setPrototypeOf?Object.getPrototypeOf:function(pr){return pr.__proto__||Object.getPrototypeOf(pr)},Zt(_r)}function Pn(_r,rr){var pr="data-clipboard-".concat(_r);if(rr.hasAttribute(pr))return rr.getAttribute(pr)}var kn=function(_r){br(pr,_r);var rr=Jn(pr);function pr(Ir,gr){var Ye;return dt(this,pr),Ye=rr.call(this),Ye.resolveOptions(gr),Ye.listenClick(Ir),Ye}return Kn(pr,[{key:"resolveOptions",value:function(){var gr=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof gr.action=="function"?gr.action:this.defaultAction,this.target=typeof gr.target=="function"?gr.target:this.defaultTarget,this.text=typeof gr.text=="function"?gr.text:this.defaultText,this.container=Ii(gr.container)==="object"?gr.container:document.body}},{key:"listenClick",value:function(gr){var Ye=this;this.listener=re()(gr,"click",function(Yt){return Ye.onClick(Yt)})}},{key:"onClick",value:function(gr){var Ye=gr.delegateTarget||gr.currentTarget,Yt=this.action(Ye)||"copy",kt=Ai({action:Yt,container:this.container,target:this.target(Ye),text:this.text(Ye)});this.emit(kt?"success":"error",{action:Yt,text:kt,trigger:Ye,clearSelection:function(){Ye&&Ye.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(gr){return Pn("action",gr)}},{key:"defaultTarget",value:function(gr){var Ye=Pn("target",gr);if(Ye)return document.querySelector(Ye)}},{key:"defaultText",value:function(gr){return Pn("text",gr)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(gr){var Ye=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return yr(gr,Ye)}},{key:"cut",value:function(gr){return Ue(gr)}},{key:"isSupported",value:function(){var gr=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],Ye=typeof gr=="string"?[gr]:gr,Yt=!!document.queryCommandSupported;return Ye.forEach(function(kt){Yt=Yt&&!!document.queryCommandSupported(kt)}),Yt}}]),pr}(K()),nn=kn},828:function(P){var z=9;if(typeof Element<"u"&&!Element.prototype.matches){var j=Element.prototype;j.matches=j.matchesSelector||j.mozMatchesSelector||j.msMatchesSelector||j.oMatchesSelector||j.webkitMatchesSelector}function s(K,Q){for(;K&&K.nodeType!==z;){if(typeof K.matches=="function"&&K.matches(Q))return K;K=K.parentNode}}P.exports=s},438:function(P,z,j){var s=j(828);function K(we,Ee,Me,Ce,Ue){var lt=re.apply(this,arguments);return we.addEventListener(Me,lt,Ue),{destroy:function(){we.removeEventListener(Me,lt,Ue)}}}function Q(we,Ee,Me,Ce,Ue){return typeof we.addEventListener=="function"?K.apply(null,arguments):typeof Me=="function"?K.bind(null,document).apply(null,arguments):(typeof we=="string"&&(we=document.querySelectorAll(we)),Array.prototype.map.call(we,function(lt){return K(lt,Ee,Me,Ce,Ue)}))}function re(we,Ee,Me,Ce){return function(Ue){Ue.delegateTarget=s(Ue.target,Ee),Ue.delegateTarget&&Ce.call(we,Ue)}}P.exports=Q},879:function(P,z){z.node=function(j){return j!==void 0&&j instanceof HTMLElement&&j.nodeType===1},z.nodeList=function(j){var s=Object.prototype.toString.call(j);return j!==void 0&&(s==="[object NodeList]"||s==="[object HTMLCollection]")&&"length"in j&&(j.length===0||z.node(j[0]))},z.string=function(j){return typeof j=="string"||j instanceof String},z.fn=function(j){var s=Object.prototype.toString.call(j);return s==="[object Function]"}},370:function(P,z,j){var s=j(879),K=j(438);function Q(Me,Ce,Ue){if(!Me&&!Ce&&!Ue)throw new Error("Missing required arguments");if(!s.string(Ce))throw new TypeError("Second argument must be a String");if(!s.fn(Ue))throw new TypeError("Third argument must be a Function");if(s.node(Me))return re(Me,Ce,Ue);if(s.nodeList(Me))return we(Me,Ce,Ue);if(s.string(Me))return Ee(Me,Ce,Ue);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function re(Me,Ce,Ue){return Me.addEventListener(Ce,Ue),{destroy:function(){Me.removeEventListener(Ce,Ue)}}}function we(Me,Ce,Ue){return Array.prototype.forEach.call(Me,function(lt){lt.addEventListener(Ce,Ue)}),{destroy:function(){Array.prototype.forEach.call(Me,function(lt){lt.removeEventListener(Ce,Ue)})}}}function Ee(Me,Ce,Ue){return K(document.body,Me,Ce,Ue)}P.exports=Q},817:function(P){function z(j){var s;if(j.nodeName==="SELECT")j.focus(),s=j.value;else if(j.nodeName==="INPUT"||j.nodeName==="TEXTAREA"){var K=j.hasAttribute("readonly");K||j.setAttribute("readonly",""),j.select(),j.setSelectionRange(0,j.value.length),K||j.removeAttribute("readonly"),s=j.value}else{j.hasAttribute("contenteditable")&&j.focus();var Q=window.getSelection(),re=document.createRange();re.selectNodeContents(j),Q.removeAllRanges(),Q.addRange(re),s=Q.toString()}return s}P.exports=z},279:function(P){function z(){}z.prototype={on:function(j,s,K){var Q=this.e||(this.e={});return(Q[j]||(Q[j]=[])).push({fn:s,ctx:K}),this},once:function(j,s,K){var Q=this;function re(){Q.off(j,re),s.apply(K,arguments)}return re._=s,this.on(j,re,K)},emit:function(j){var s=[].slice.call(arguments,1),K=((this.e||(this.e={}))[j]||[]).slice(),Q=0,re=K.length;for(Q;Q<re;Q++)K[Q].fn.apply(K[Q].ctx,s);return this},off:function(j,s){var K=this.e||(this.e={}),Q=K[j],re=[];if(Q&&s)for(var we=0,Ee=Q.length;we<Ee;we++)Q[we].fn!==s&&Q[we].fn._!==s&&re.push(Q[we]);return re.length?K[j]=re:delete K[j],this}},P.exports=z,P.exports.TinyEmitter=z}},b={};function E(P){if(b[P])return b[P].exports;var z=b[P]={exports:{}};return g[P](z,z.exports,E),z.exports}return function(){E.n=function(P){var z=P&&P.__esModule?function(){return P.default}:function(){return P};return E.d(z,{a:z}),z}}(),function(){E.d=function(P,z){for(var j in z)E.o(z,j)&&!E.o(P,j)&&Object.defineProperty(P,j,{enumerable:!0,get:z[j]})}}(),function(){E.o=function(P,z){return Object.prototype.hasOwnProperty.call(P,z)}}(),E(686)}().default})})(TE);var UO=TE.exports;const jO=np(UO),VO={class:"flex flex-col gap-6 my-12 md:rounded-xl bg-white py-3 md:shadow-lg"},GO={class:"px-3"},$O={class:"mb-3 flex gap-1 justify-between"},qO={class:"text-xl font-bold"},ZO=["id"],HO={class:"flex gap-1"},WO=["href"],XO={class:"inline-block bg-blue-200 `text-blue-800 text-xs px-2 rounded-full font-semibold tracking-wide"},YO=$n({__name:"BusStopGroup",props:{group:{}},setup(l){const f=l,g=Po(`copy-${Math.random().toString(36).substring(2,11)}`),b=Po(!1);function E(){const z=window.location.href.split("/").slice(0,3).join("/")+"/routes",j=f.group.name.replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-*|-*$/g,""),s=f.group.stops.join("-");return`${z}/${j}/stops/${s}`}const P=new jO(`#${g.value}`,{text:()=>E()});return P.on("success",()=>{b.value=!0,setTimeout(()=>{b.value=!1},3e3)}),lo(()=>{P.destroy()}),(z,j)=>(Di(),Ki("div",VO,[Ni("div",GO,[Ni("div",$O,[Ni("h2",qO,Nu(f.group.name),1),Ni("button",{id:g.value,class:p_(["copy","bg-slate-100","transition-all","hover:bg-slate-200","text-sm","rounded-full","py-2","px-4","flex","items-center","gap-2",b.value?"copied":""])},[Yf(" Copy link "),bn(al(BO),{class:"w-4 h-4"}),bn(al(FO),{class:"w-4 h-4"})],10,ZO)]),Ni("div",HO,[(Di(!0),Ki(Xo,null,x_(f.group.data,s=>(Di(),Ki("a",{key:s.stop.id,href:"https://orc.mattersoft.fi/timetable/#?stop="+s.stop.id,target:"_blank"},[Ni("span",XO,Nu(s.stop.name),1)],8,WO))),128))])]),bn(DO,{data:f.group.data},null,8,["data"])]))}}),EE=S_(YO,[["__scopeId","data-v-78a82162"]]);function SE(l,f){return function(){return l.apply(f,arguments)}}const{toString:KO}=Object.prototype,{getPrototypeOf:b0}=Object,M_=(l=>f=>{const g=KO.call(f);return l[g]||(l[g]=g.slice(8,-1).toLowerCase())})(Object.create(null)),ul=l=>(l=l.toLowerCase(),f=>M_(f)===l),A_=l=>f=>typeof f===l,{isArray:ed}=Array,ep=A_("undefined");function JO(l){return l!==null&&!ep(l)&&l.constructor!==null&&!ep(l.constructor)&&la(l.constructor.isBuffer)&&l.constructor.isBuffer(l)}const ME=ul("ArrayBuffer");function QO(l){let f;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?f=ArrayBuffer.isView(l):f=l&&l.buffer&&ME(l.buffer),f}const eD=A_("string"),la=A_("function"),AE=A_("number"),I_=l=>l!==null&&typeof l=="object",tD=l=>l===!0||l===!1,Km=l=>{if(M_(l)!=="object")return!1;const f=b0(l);return(f===null||f===Object.prototype||Object.getPrototypeOf(f)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)},rD=ul("Date"),iD=ul("File"),nD=ul("Blob"),oD=ul("FileList"),sD=l=>I_(l)&&la(l.pipe),aD=l=>{let f;return l&&(typeof FormData=="function"&&l instanceof FormData||la(l.append)&&((f=M_(l))==="formdata"||f==="object"&&la(l.toString)&&l.toString()==="[object FormData]"))},lD=ul("URLSearchParams"),cD=l=>l.trim?l.trim():l.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function op(l,f,{allOwnKeys:g=!1}={}){if(l===null||typeof l>"u")return;let b,E;if(typeof l!="object"&&(l=[l]),ed(l))for(b=0,E=l.length;b<E;b++)f.call(null,l[b],b,l);else{const P=g?Object.getOwnPropertyNames(l):Object.keys(l),z=P.length;let j;for(b=0;b<z;b++)j=P[b],f.call(null,l[j],j,l)}}function IE(l,f){f=f.toLowerCase();const g=Object.keys(l);let b=g.length,E;for(;b-- >0;)if(E=g[b],f===E.toLowerCase())return E;return null}const CE=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,PE=l=>!ep(l)&&l!==CE;function Ky(){const{caseless:l}=PE(this)&&this||{},f={},g=(b,E)=>{const P=l&&IE(f,E)||E;Km(f[P])&&Km(b)?f[P]=Ky(f[P],b):Km(b)?f[P]=Ky({},b):ed(b)?f[P]=b.slice():f[P]=b};for(let b=0,E=arguments.length;b<E;b++)arguments[b]&&op(arguments[b],g);return f}const uD=(l,f,g,{allOwnKeys:b}={})=>(op(f,(E,P)=>{g&&la(E)?l[P]=SE(E,g):l[P]=E},{allOwnKeys:b}),l),hD=l=>(l.charCodeAt(0)===65279&&(l=l.slice(1)),l),dD=(l,f,g,b)=>{l.prototype=Object.create(f.prototype,b),l.prototype.constructor=l,Object.defineProperty(l,"super",{value:f.prototype}),g&&Object.assign(l.prototype,g)},fD=(l,f,g,b)=>{let E,P,z;const j={};if(f=f||{},l==null)return f;do{for(E=Object.getOwnPropertyNames(l),P=E.length;P-- >0;)z=E[P],(!b||b(z,l,f))&&!j[z]&&(f[z]=l[z],j[z]=!0);l=g!==!1&&b0(l)}while(l&&(!g||g(l,f))&&l!==Object.prototype);return f},pD=(l,f,g)=>{l=String(l),(g===void 0||g>l.length)&&(g=l.length),g-=f.length;const b=l.indexOf(f,g);return b!==-1&&b===g},mD=l=>{if(!l)return null;if(ed(l))return l;let f=l.length;if(!AE(f))return null;const g=new Array(f);for(;f-- >0;)g[f]=l[f];return g},_D=(l=>f=>l&&f instanceof l)(typeof Uint8Array<"u"&&b0(Uint8Array)),gD=(l,f)=>{const b=(l&&l[Symbol.iterator]).call(l);let E;for(;(E=b.next())&&!E.done;){const P=E.value;f.call(l,P[0],P[1])}},yD=(l,f)=>{let g;const b=[];for(;(g=l.exec(f))!==null;)b.push(g);return b},vD=ul("HTMLFormElement"),xD=l=>l.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(g,b,E){return b.toUpperCase()+E}),zw=(({hasOwnProperty:l})=>(f,g)=>l.call(f,g))(Object.prototype),bD=ul("RegExp"),LE=(l,f)=>{const g=Object.getOwnPropertyDescriptors(l),b={};op(g,(E,P)=>{let z;(z=f(E,P,l))!==!1&&(b[P]=z||E)}),Object.defineProperties(l,b)},wD=l=>{LE(l,(f,g)=>{if(la(l)&&["arguments","caller","callee"].indexOf(g)!==-1)return!1;const b=l[g];if(la(b)){if(f.enumerable=!1,"writable"in f){f.writable=!1;return}f.set||(f.set=()=>{throw Error("Can not rewrite read-only method '"+g+"'")})}})},TD=(l,f)=>{const g={},b=E=>{E.forEach(P=>{g[P]=!0})};return ed(l)?b(l):b(String(l).split(f)),g},ED=()=>{},SD=(l,f)=>(l=+l,Number.isFinite(l)?l:f),Iy="abcdefghijklmnopqrstuvwxyz",kw="0123456789",RE={DIGIT:kw,ALPHA:Iy,ALPHA_DIGIT:Iy+Iy.toUpperCase()+kw},MD=(l=16,f=RE.ALPHA_DIGIT)=>{let g="";const{length:b}=f;for(;l--;)g+=f[Math.random()*b|0];return g};function AD(l){return!!(l&&la(l.append)&&l[Symbol.toStringTag]==="FormData"&&l[Symbol.iterator])}const ID=l=>{const f=new Array(10),g=(b,E)=>{if(I_(b)){if(f.indexOf(b)>=0)return;if(!("toJSON"in b)){f[E]=b;const P=ed(b)?[]:{};return op(b,(z,j)=>{const s=g(z,E+1);!ep(s)&&(P[j]=s)}),f[E]=void 0,P}}return b};return g(l,0)},CD=ul("AsyncFunction"),PD=l=>l&&(I_(l)||la(l))&&la(l.then)&&la(l.catch),Rt={isArray:ed,isArrayBuffer:ME,isBuffer:JO,isFormData:aD,isArrayBufferView:QO,isString:eD,isNumber:AE,isBoolean:tD,isObject:I_,isPlainObject:Km,isUndefined:ep,isDate:rD,isFile:iD,isBlob:nD,isRegExp:bD,isFunction:la,isStream:sD,isURLSearchParams:lD,isTypedArray:_D,isFileList:oD,forEach:op,merge:Ky,extend:uD,trim:cD,stripBOM:hD,inherits:dD,toFlatObject:fD,kindOf:M_,kindOfTest:ul,endsWith:pD,toArray:mD,forEachEntry:gD,matchAll:yD,isHTMLForm:vD,hasOwnProperty:zw,hasOwnProp:zw,reduceDescriptors:LE,freezeMethods:wD,toObjectSet:TD,toCamelCase:xD,noop:ED,toFiniteNumber:SD,findKey:IE,global:CE,isContextDefined:PE,ALPHABET:RE,generateString:MD,isSpecCompliantForm:AD,toJSONObject:ID,isAsyncFn:CD,isThenable:PD};function Hi(l,f,g,b,E){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=l,this.name="AxiosError",f&&(this.code=f),g&&(this.config=g),b&&(this.request=b),E&&(this.response=E)}Rt.inherits(Hi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Rt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const OE=Hi.prototype,DE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(l=>{DE[l]={value:l}});Object.defineProperties(Hi,DE);Object.defineProperty(OE,"isAxiosError",{value:!0});Hi.from=(l,f,g,b,E,P)=>{const z=Object.create(OE);return Rt.toFlatObject(l,z,function(s){return s!==Error.prototype},j=>j!=="isAxiosError"),Hi.call(z,l.message,f,g,b,E),z.cause=l,z.name=l.name,P&&Object.assign(z,P),z};const LD=null;function Jy(l){return Rt.isPlainObject(l)||Rt.isArray(l)}function zE(l){return Rt.endsWith(l,"[]")?l.slice(0,-2):l}function Fw(l,f,g){return l?l.concat(f).map(function(E,P){return E=zE(E),!g&&P?"["+E+"]":E}).join(g?".":""):f}function RD(l){return Rt.isArray(l)&&!l.some(Jy)}const OD=Rt.toFlatObject(Rt,{},null,function(f){return/^is[A-Z]/.test(f)});function C_(l,f,g){if(!Rt.isObject(l))throw new TypeError("target must be an object");f=f||new FormData,g=Rt.toFlatObject(g,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Ce,Ue){return!Rt.isUndefined(Ue[Ce])});const b=g.metaTokens,E=g.visitor||Q,P=g.dots,z=g.indexes,s=(g.Blob||typeof Blob<"u"&&Blob)&&Rt.isSpecCompliantForm(f);if(!Rt.isFunction(E))throw new TypeError("visitor must be a function");function K(Me){if(Me===null)return"";if(Rt.isDate(Me))return Me.toISOString();if(!s&&Rt.isBlob(Me))throw new Hi("Blob is not supported. Use a Buffer instead.");return Rt.isArrayBuffer(Me)||Rt.isTypedArray(Me)?s&&typeof Blob=="function"?new Blob([Me]):Buffer.from(Me):Me}function Q(Me,Ce,Ue){let lt=Me;if(Me&&!Ue&&typeof Me=="object"){if(Rt.endsWith(Ce,"{}"))Ce=b?Ce:Ce.slice(0,-2),Me=JSON.stringify(Me);else if(Rt.isArray(Me)&&RD(Me)||(Rt.isFileList(Me)||Rt.endsWith(Ce,"[]"))&&(lt=Rt.toArray(Me)))return Ce=zE(Ce),lt.forEach(function(It,yr){!(Rt.isUndefined(It)||It===null)&&f.append(z===!0?Fw([Ce],yr,P):z===null?Ce:Ce+"[]",K(It))}),!1}return Jy(Me)?!0:(f.append(Fw(Ue,Ce,P),K(Me)),!1)}const re=[],we=Object.assign(OD,{defaultVisitor:Q,convertValue:K,isVisitable:Jy});function Ee(Me,Ce){if(!Rt.isUndefined(Me)){if(re.indexOf(Me)!==-1)throw Error("Circular reference detected in "+Ce.join("."));re.push(Me),Rt.forEach(Me,function(lt,$t){(!(Rt.isUndefined(lt)||lt===null)&&E.call(f,lt,Rt.isString($t)?$t.trim():$t,Ce,we))===!0&&Ee(lt,Ce?Ce.concat($t):[$t])}),re.pop()}}if(!Rt.isObject(l))throw new TypeError("data must be an object");return Ee(l),f}function Bw(l){const f={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(l).replace(/[!'()~]|%20|%00/g,function(b){return f[b]})}function w0(l,f){this._pairs=[],l&&C_(l,this,f)}const kE=w0.prototype;kE.append=function(f,g){this._pairs.push([f,g])};kE.toString=function(f){const g=f?function(b){return f.call(this,b,Bw)}:Bw;return this._pairs.map(function(E){return g(E[0])+"="+g(E[1])},"").join("&")};function DD(l){return encodeURIComponent(l).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function FE(l,f,g){if(!f)return l;const b=g&&g.encode||DD,E=g&&g.serialize;let P;if(E?P=E(f,g):P=Rt.isURLSearchParams(f)?f.toString():new w0(f,g).toString(b),P){const z=l.indexOf("#");z!==-1&&(l=l.slice(0,z)),l+=(l.indexOf("?")===-1?"?":"&")+P}return l}class Nw{constructor(){this.handlers=[]}use(f,g,b){return this.handlers.push({fulfilled:f,rejected:g,synchronous:b?b.synchronous:!1,runWhen:b?b.runWhen:null}),this.handlers.length-1}eject(f){this.handlers[f]&&(this.handlers[f]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(f){Rt.forEach(this.handlers,function(b){b!==null&&f(b)})}}const BE={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},zD=typeof URLSearchParams<"u"?URLSearchParams:w0,kD=typeof FormData<"u"?FormData:null,FD=typeof Blob<"u"?Blob:null,BD={isBrowser:!0,classes:{URLSearchParams:zD,FormData:kD,Blob:FD},protocols:["http","https","file","blob","url","data"]},NE=typeof window<"u"&&typeof document<"u",ND=(l=>NE&&["ReactNative","NativeScript","NS"].indexOf(l)<0)(typeof navigator<"u"&&navigator.product),UD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jD=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:NE,hasStandardBrowserEnv:ND,hasStandardBrowserWebWorkerEnv:UD},Symbol.toStringTag,{value:"Module"})),sl={...jD,...BD};function VD(l,f){return C_(l,new sl.classes.URLSearchParams,Object.assign({visitor:function(g,b,E,P){return sl.isNode&&Rt.isBuffer(g)?(this.append(b,g.toString("base64")),!1):P.defaultVisitor.apply(this,arguments)}},f))}function GD(l){return Rt.matchAll(/\w+|\[(\w*)]/g,l).map(f=>f[0]==="[]"?"":f[1]||f[0])}function $D(l){const f={},g=Object.keys(l);let b;const E=g.length;let P;for(b=0;b<E;b++)P=g[b],f[P]=l[P];return f}function UE(l){function f(g,b,E,P){let z=g[P++];if(z==="__proto__")return!0;const j=Number.isFinite(+z),s=P>=g.length;return z=!z&&Rt.isArray(E)?E.length:z,s?(Rt.hasOwnProp(E,z)?E[z]=[E[z],b]:E[z]=b,!j):((!E[z]||!Rt.isObject(E[z]))&&(E[z]=[]),f(g,b,E[z],P)&&Rt.isArray(E[z])&&(E[z]=$D(E[z])),!j)}if(Rt.isFormData(l)&&Rt.isFunction(l.entries)){const g={};return Rt.forEachEntry(l,(b,E)=>{f(GD(b),E,g,0)}),g}return null}function qD(l,f,g){if(Rt.isString(l))try{return(f||JSON.parse)(l),Rt.trim(l)}catch(b){if(b.name!=="SyntaxError")throw b}return(g||JSON.stringify)(l)}const sp={transitional:BE,adapter:["xhr","http"],transformRequest:[function(f,g){const b=g.getContentType()||"",E=b.indexOf("application/json")>-1,P=Rt.isObject(f);if(P&&Rt.isHTMLForm(f)&&(f=new FormData(f)),Rt.isFormData(f))return E?JSON.stringify(UE(f)):f;if(Rt.isArrayBuffer(f)||Rt.isBuffer(f)||Rt.isStream(f)||Rt.isFile(f)||Rt.isBlob(f))return f;if(Rt.isArrayBufferView(f))return f.buffer;if(Rt.isURLSearchParams(f))return g.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),f.toString();let j;if(P){if(b.indexOf("application/x-www-form-urlencoded")>-1)return VD(f,this.formSerializer).toString();if((j=Rt.isFileList(f))||b.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return C_(j?{"files[]":f}:f,s&&new s,this.formSerializer)}}return P||E?(g.setContentType("application/json",!1),qD(f)):f}],transformResponse:[function(f){const g=this.transitional||sp.transitional,b=g&&g.forcedJSONParsing,E=this.responseType==="json";if(f&&Rt.isString(f)&&(b&&!this.responseType||E)){const z=!(g&&g.silentJSONParsing)&&E;try{return JSON.parse(f)}catch(j){if(z)throw j.name==="SyntaxError"?Hi.from(j,Hi.ERR_BAD_RESPONSE,this,null,this.response):j}}return f}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:sl.classes.FormData,Blob:sl.classes.Blob},validateStatus:function(f){return f>=200&&f<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Rt.forEach(["delete","get","head","post","put","patch"],l=>{sp.headers[l]={}});const ZD=Rt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),HD=l=>{const f={};let g,b,E;return l&&l.split(`
`).forEach(function(z){E=z.indexOf(":"),g=z.substring(0,E).trim().toLowerCase(),b=z.substring(E+1).trim(),!(!g||f[g]&&ZD[g])&&(g==="set-cookie"?f[g]?f[g].push(b):f[g]=[b]:f[g]=f[g]?f[g]+", "+b:b)}),f},Uw=Symbol("internals");function Rf(l){return l&&String(l).trim().toLowerCase()}function Jm(l){return l===!1||l==null?l:Rt.isArray(l)?l.map(Jm):String(l)}function WD(l){const f=Object.create(null),g=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let b;for(;b=g.exec(l);)f[b[1]]=b[2];return f}const XD=l=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(l.trim());function Cy(l,f,g,b,E){if(Rt.isFunction(b))return b.call(this,f,g);if(E&&(f=g),!!Rt.isString(f)){if(Rt.isString(b))return f.indexOf(b)!==-1;if(Rt.isRegExp(b))return b.test(f)}}function YD(l){return l.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(f,g,b)=>g.toUpperCase()+b)}function KD(l,f){const g=Rt.toCamelCase(" "+f);["get","set","has"].forEach(b=>{Object.defineProperty(l,b+g,{value:function(E,P,z){return this[b].call(this,f,E,P,z)},configurable:!0})})}class ca{constructor(f){f&&this.set(f)}set(f,g,b){const E=this;function P(j,s,K){const Q=Rf(s);if(!Q)throw new Error("header name must be a non-empty string");const re=Rt.findKey(E,Q);(!re||E[re]===void 0||K===!0||K===void 0&&E[re]!==!1)&&(E[re||s]=Jm(j))}const z=(j,s)=>Rt.forEach(j,(K,Q)=>P(K,Q,s));return Rt.isPlainObject(f)||f instanceof this.constructor?z(f,g):Rt.isString(f)&&(f=f.trim())&&!XD(f)?z(HD(f),g):f!=null&&P(g,f,b),this}get(f,g){if(f=Rf(f),f){const b=Rt.findKey(this,f);if(b){const E=this[b];if(!g)return E;if(g===!0)return WD(E);if(Rt.isFunction(g))return g.call(this,E,b);if(Rt.isRegExp(g))return g.exec(E);throw new TypeError("parser must be boolean|regexp|function")}}}has(f,g){if(f=Rf(f),f){const b=Rt.findKey(this,f);return!!(b&&this[b]!==void 0&&(!g||Cy(this,this[b],b,g)))}return!1}delete(f,g){const b=this;let E=!1;function P(z){if(z=Rf(z),z){const j=Rt.findKey(b,z);j&&(!g||Cy(b,b[j],j,g))&&(delete b[j],E=!0)}}return Rt.isArray(f)?f.forEach(P):P(f),E}clear(f){const g=Object.keys(this);let b=g.length,E=!1;for(;b--;){const P=g[b];(!f||Cy(this,this[P],P,f,!0))&&(delete this[P],E=!0)}return E}normalize(f){const g=this,b={};return Rt.forEach(this,(E,P)=>{const z=Rt.findKey(b,P);if(z){g[z]=Jm(E),delete g[P];return}const j=f?YD(P):String(P).trim();j!==P&&delete g[P],g[j]=Jm(E),b[j]=!0}),this}concat(...f){return this.constructor.concat(this,...f)}toJSON(f){const g=Object.create(null);return Rt.forEach(this,(b,E)=>{b!=null&&b!==!1&&(g[E]=f&&Rt.isArray(b)?b.join(", "):b)}),g}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([f,g])=>f+": "+g).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(f){return f instanceof this?f:new this(f)}static concat(f,...g){const b=new this(f);return g.forEach(E=>b.set(E)),b}static accessor(f){const b=(this[Uw]=this[Uw]={accessors:{}}).accessors,E=this.prototype;function P(z){const j=Rf(z);b[j]||(KD(E,z),b[j]=!0)}return Rt.isArray(f)?f.forEach(P):P(f),this}}ca.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Rt.reduceDescriptors(ca.prototype,({value:l},f)=>{let g=f[0].toUpperCase()+f.slice(1);return{get:()=>l,set(b){this[g]=b}}});Rt.freezeMethods(ca);function Py(l,f){const g=this||sp,b=f||g,E=ca.from(b.headers);let P=b.data;return Rt.forEach(l,function(j){P=j.call(g,P,E.normalize(),f?f.status:void 0)}),E.normalize(),P}function jE(l){return!!(l&&l.__CANCEL__)}function ap(l,f,g){Hi.call(this,l??"canceled",Hi.ERR_CANCELED,f,g),this.name="CanceledError"}Rt.inherits(ap,Hi,{__CANCEL__:!0});function JD(l,f,g){const b=g.config.validateStatus;!g.status||!b||b(g.status)?l(g):f(new Hi("Request failed with status code "+g.status,[Hi.ERR_BAD_REQUEST,Hi.ERR_BAD_RESPONSE][Math.floor(g.status/100)-4],g.config,g.request,g))}const QD=sl.hasStandardBrowserEnv?{write(l,f,g,b,E,P){const z=[l+"="+encodeURIComponent(f)];Rt.isNumber(g)&&z.push("expires="+new Date(g).toGMTString()),Rt.isString(b)&&z.push("path="+b),Rt.isString(E)&&z.push("domain="+E),P===!0&&z.push("secure"),document.cookie=z.join("; ")},read(l){const f=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove(l){this.write(l,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function e3(l){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(l)}function t3(l,f){return f?l.replace(/\/?\/$/,"")+"/"+f.replace(/^\/+/,""):l}function VE(l,f){return l&&!e3(f)?t3(l,f):f}const r3=sl.hasStandardBrowserEnv?function(){const f=/(msie|trident)/i.test(navigator.userAgent),g=document.createElement("a");let b;function E(P){let z=P;return f&&(g.setAttribute("href",z),z=g.href),g.setAttribute("href",z),{href:g.href,protocol:g.protocol?g.protocol.replace(/:$/,""):"",host:g.host,search:g.search?g.search.replace(/^\?/,""):"",hash:g.hash?g.hash.replace(/^#/,""):"",hostname:g.hostname,port:g.port,pathname:g.pathname.charAt(0)==="/"?g.pathname:"/"+g.pathname}}return b=E(window.location.href),function(z){const j=Rt.isString(z)?E(z):z;return j.protocol===b.protocol&&j.host===b.host}}():function(){return function(){return!0}}();function i3(l){const f=/^([-+\w]{1,25})(:?\/\/|:)/.exec(l);return f&&f[1]||""}function n3(l,f){l=l||10;const g=new Array(l),b=new Array(l);let E=0,P=0,z;return f=f!==void 0?f:1e3,function(s){const K=Date.now(),Q=b[P];z||(z=K),g[E]=s,b[E]=K;let re=P,we=0;for(;re!==E;)we+=g[re++],re=re%l;if(E=(E+1)%l,E===P&&(P=(P+1)%l),K-z<f)return;const Ee=Q&&K-Q;return Ee?Math.round(we*1e3/Ee):void 0}}function jw(l,f){let g=0;const b=n3(50,250);return E=>{const P=E.loaded,z=E.lengthComputable?E.total:void 0,j=P-g,s=b(j),K=P<=z;g=P;const Q={loaded:P,total:z,progress:z?P/z:void 0,bytes:j,rate:s||void 0,estimated:s&&z&&K?(z-P)/s:void 0,event:E};Q[f?"download":"upload"]=!0,l(Q)}}const o3=typeof XMLHttpRequest<"u",s3=o3&&function(l){return new Promise(function(g,b){let E=l.data;const P=ca.from(l.headers).normalize();let{responseType:z,withXSRFToken:j}=l,s;function K(){l.cancelToken&&l.cancelToken.unsubscribe(s),l.signal&&l.signal.removeEventListener("abort",s)}let Q;if(Rt.isFormData(E)){if(sl.hasStandardBrowserEnv||sl.hasStandardBrowserWebWorkerEnv)P.setContentType(!1);else if((Q=P.getContentType())!==!1){const[Ce,...Ue]=Q?Q.split(";").map(lt=>lt.trim()).filter(Boolean):[];P.setContentType([Ce||"multipart/form-data",...Ue].join("; "))}}let re=new XMLHttpRequest;if(l.auth){const Ce=l.auth.username||"",Ue=l.auth.password?unescape(encodeURIComponent(l.auth.password)):"";P.set("Authorization","Basic "+btoa(Ce+":"+Ue))}const we=VE(l.baseURL,l.url);re.open(l.method.toUpperCase(),FE(we,l.params,l.paramsSerializer),!0),re.timeout=l.timeout;function Ee(){if(!re)return;const Ce=ca.from("getAllResponseHeaders"in re&&re.getAllResponseHeaders()),lt={data:!z||z==="text"||z==="json"?re.responseText:re.response,status:re.status,statusText:re.statusText,headers:Ce,config:l,request:re};JD(function(It){g(It),K()},function(It){b(It),K()},lt),re=null}if("onloadend"in re?re.onloadend=Ee:re.onreadystatechange=function(){!re||re.readyState!==4||re.status===0&&!(re.responseURL&&re.responseURL.indexOf("file:")===0)||setTimeout(Ee)},re.onabort=function(){re&&(b(new Hi("Request aborted",Hi.ECONNABORTED,l,re)),re=null)},re.onerror=function(){b(new Hi("Network Error",Hi.ERR_NETWORK,l,re)),re=null},re.ontimeout=function(){let Ue=l.timeout?"timeout of "+l.timeout+"ms exceeded":"timeout exceeded";const lt=l.transitional||BE;l.timeoutErrorMessage&&(Ue=l.timeoutErrorMessage),b(new Hi(Ue,lt.clarifyTimeoutError?Hi.ETIMEDOUT:Hi.ECONNABORTED,l,re)),re=null},sl.hasStandardBrowserEnv&&(j&&Rt.isFunction(j)&&(j=j(l)),j||j!==!1&&r3(we))){const Ce=l.xsrfHeaderName&&l.xsrfCookieName&&QD.read(l.xsrfCookieName);Ce&&P.set(l.xsrfHeaderName,Ce)}E===void 0&&P.setContentType(null),"setRequestHeader"in re&&Rt.forEach(P.toJSON(),function(Ue,lt){re.setRequestHeader(lt,Ue)}),Rt.isUndefined(l.withCredentials)||(re.withCredentials=!!l.withCredentials),z&&z!=="json"&&(re.responseType=l.responseType),typeof l.onDownloadProgress=="function"&&re.addEventListener("progress",jw(l.onDownloadProgress,!0)),typeof l.onUploadProgress=="function"&&re.upload&&re.upload.addEventListener("progress",jw(l.onUploadProgress)),(l.cancelToken||l.signal)&&(s=Ce=>{re&&(b(!Ce||Ce.type?new ap(null,l,re):Ce),re.abort(),re=null)},l.cancelToken&&l.cancelToken.subscribe(s),l.signal&&(l.signal.aborted?s():l.signal.addEventListener("abort",s)));const Me=i3(we);if(Me&&sl.protocols.indexOf(Me)===-1){b(new Hi("Unsupported protocol "+Me+":",Hi.ERR_BAD_REQUEST,l));return}re.send(E||null)})},Qy={http:LD,xhr:s3};Rt.forEach(Qy,(l,f)=>{if(l){try{Object.defineProperty(l,"name",{value:f})}catch{}Object.defineProperty(l,"adapterName",{value:f})}});const Vw=l=>`- ${l}`,a3=l=>Rt.isFunction(l)||l===null||l===!1,GE={getAdapter:l=>{l=Rt.isArray(l)?l:[l];const{length:f}=l;let g,b;const E={};for(let P=0;P<f;P++){g=l[P];let z;if(b=g,!a3(g)&&(b=Qy[(z=String(g)).toLowerCase()],b===void 0))throw new Hi(`Unknown adapter '${z}'`);if(b)break;E[z||"#"+P]=b}if(!b){const P=Object.entries(E).map(([j,s])=>`adapter ${j} `+(s===!1?"is not supported by the environment":"is not available in the build"));let z=f?P.length>1?`since :
`+P.map(Vw).join(`
`):" "+Vw(P[0]):"as no adapter specified";throw new Hi("There is no suitable adapter to dispatch the request "+z,"ERR_NOT_SUPPORT")}return b},adapters:Qy};function Ly(l){if(l.cancelToken&&l.cancelToken.throwIfRequested(),l.signal&&l.signal.aborted)throw new ap(null,l)}function Gw(l){return Ly(l),l.headers=ca.from(l.headers),l.data=Py.call(l,l.transformRequest),["post","put","patch"].indexOf(l.method)!==-1&&l.headers.setContentType("application/x-www-form-urlencoded",!1),GE.getAdapter(l.adapter||sp.adapter)(l).then(function(b){return Ly(l),b.data=Py.call(l,l.transformResponse,b),b.headers=ca.from(b.headers),b},function(b){return jE(b)||(Ly(l),b&&b.response&&(b.response.data=Py.call(l,l.transformResponse,b.response),b.response.headers=ca.from(b.response.headers))),Promise.reject(b)})}const $w=l=>l instanceof ca?{...l}:l;function Kh(l,f){f=f||{};const g={};function b(K,Q,re){return Rt.isPlainObject(K)&&Rt.isPlainObject(Q)?Rt.merge.call({caseless:re},K,Q):Rt.isPlainObject(Q)?Rt.merge({},Q):Rt.isArray(Q)?Q.slice():Q}function E(K,Q,re){if(Rt.isUndefined(Q)){if(!Rt.isUndefined(K))return b(void 0,K,re)}else return b(K,Q,re)}function P(K,Q){if(!Rt.isUndefined(Q))return b(void 0,Q)}function z(K,Q){if(Rt.isUndefined(Q)){if(!Rt.isUndefined(K))return b(void 0,K)}else return b(void 0,Q)}function j(K,Q,re){if(re in f)return b(K,Q);if(re in l)return b(void 0,K)}const s={url:P,method:P,data:P,baseURL:z,transformRequest:z,transformResponse:z,paramsSerializer:z,timeout:z,timeoutMessage:z,withCredentials:z,withXSRFToken:z,adapter:z,responseType:z,xsrfCookieName:z,xsrfHeaderName:z,onUploadProgress:z,onDownloadProgress:z,decompress:z,maxContentLength:z,maxBodyLength:z,beforeRedirect:z,transport:z,httpAgent:z,httpsAgent:z,cancelToken:z,socketPath:z,responseEncoding:z,validateStatus:j,headers:(K,Q)=>E($w(K),$w(Q),!0)};return Rt.forEach(Object.keys(Object.assign({},l,f)),function(Q){const re=s[Q]||E,we=re(l[Q],f[Q],Q);Rt.isUndefined(we)&&re!==j||(g[Q]=we)}),g}const $E="1.6.8",T0={};["object","boolean","number","function","string","symbol"].forEach((l,f)=>{T0[l]=function(b){return typeof b===l||"a"+(f<1?"n ":" ")+l}});const qw={};T0.transitional=function(f,g,b){function E(P,z){return"[Axios v"+$E+"] Transitional option '"+P+"'"+z+(b?". "+b:"")}return(P,z,j)=>{if(f===!1)throw new Hi(E(z," has been removed"+(g?" in "+g:"")),Hi.ERR_DEPRECATED);return g&&!qw[z]&&(qw[z]=!0,console.warn(E(z," has been deprecated since v"+g+" and will be removed in the near future"))),f?f(P,z,j):!0}};function l3(l,f,g){if(typeof l!="object")throw new Hi("options must be an object",Hi.ERR_BAD_OPTION_VALUE);const b=Object.keys(l);let E=b.length;for(;E-- >0;){const P=b[E],z=f[P];if(z){const j=l[P],s=j===void 0||z(j,P,l);if(s!==!0)throw new Hi("option "+P+" must be "+s,Hi.ERR_BAD_OPTION_VALUE);continue}if(g!==!0)throw new Hi("Unknown option "+P,Hi.ERR_BAD_OPTION)}}const e0={assertOptions:l3,validators:T0},Cc=e0.validators;class $u{constructor(f){this.defaults=f,this.interceptors={request:new Nw,response:new Nw}}async request(f,g){try{return await this._request(f,g)}catch(b){if(b instanceof Error){let E;Error.captureStackTrace?Error.captureStackTrace(E={}):E=new Error;const P=E.stack?E.stack.replace(/^.+\n/,""):"";b.stack?P&&!String(b.stack).endsWith(P.replace(/^.+\n.+\n/,""))&&(b.stack+=`
`+P):b.stack=P}throw b}}_request(f,g){typeof f=="string"?(g=g||{},g.url=f):g=f||{},g=Kh(this.defaults,g);const{transitional:b,paramsSerializer:E,headers:P}=g;b!==void 0&&e0.assertOptions(b,{silentJSONParsing:Cc.transitional(Cc.boolean),forcedJSONParsing:Cc.transitional(Cc.boolean),clarifyTimeoutError:Cc.transitional(Cc.boolean)},!1),E!=null&&(Rt.isFunction(E)?g.paramsSerializer={serialize:E}:e0.assertOptions(E,{encode:Cc.function,serialize:Cc.function},!0)),g.method=(g.method||this.defaults.method||"get").toLowerCase();let z=P&&Rt.merge(P.common,P[g.method]);P&&Rt.forEach(["delete","get","head","post","put","patch","common"],Me=>{delete P[Me]}),g.headers=ca.concat(z,P);const j=[];let s=!0;this.interceptors.request.forEach(function(Ce){typeof Ce.runWhen=="function"&&Ce.runWhen(g)===!1||(s=s&&Ce.synchronous,j.unshift(Ce.fulfilled,Ce.rejected))});const K=[];this.interceptors.response.forEach(function(Ce){K.push(Ce.fulfilled,Ce.rejected)});let Q,re=0,we;if(!s){const Me=[Gw.bind(this),void 0];for(Me.unshift.apply(Me,j),Me.push.apply(Me,K),we=Me.length,Q=Promise.resolve(g);re<we;)Q=Q.then(Me[re++],Me[re++]);return Q}we=j.length;let Ee=g;for(re=0;re<we;){const Me=j[re++],Ce=j[re++];try{Ee=Me(Ee)}catch(Ue){Ce.call(this,Ue);break}}try{Q=Gw.call(this,Ee)}catch(Me){return Promise.reject(Me)}for(re=0,we=K.length;re<we;)Q=Q.then(K[re++],K[re++]);return Q}getUri(f){f=Kh(this.defaults,f);const g=VE(f.baseURL,f.url);return FE(g,f.params,f.paramsSerializer)}}Rt.forEach(["delete","get","head","options"],function(f){$u.prototype[f]=function(g,b){return this.request(Kh(b||{},{method:f,url:g,data:(b||{}).data}))}});Rt.forEach(["post","put","patch"],function(f){function g(b){return function(P,z,j){return this.request(Kh(j||{},{method:f,headers:b?{"Content-Type":"multipart/form-data"}:{},url:P,data:z}))}}$u.prototype[f]=g(),$u.prototype[f+"Form"]=g(!0)});class E0{constructor(f){if(typeof f!="function")throw new TypeError("executor must be a function.");let g;this.promise=new Promise(function(P){g=P});const b=this;this.promise.then(E=>{if(!b._listeners)return;let P=b._listeners.length;for(;P-- >0;)b._listeners[P](E);b._listeners=null}),this.promise.then=E=>{let P;const z=new Promise(j=>{b.subscribe(j),P=j}).then(E);return z.cancel=function(){b.unsubscribe(P)},z},f(function(P,z,j){b.reason||(b.reason=new ap(P,z,j),g(b.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(f){if(this.reason){f(this.reason);return}this._listeners?this._listeners.push(f):this._listeners=[f]}unsubscribe(f){if(!this._listeners)return;const g=this._listeners.indexOf(f);g!==-1&&this._listeners.splice(g,1)}static source(){let f;return{token:new E0(function(E){f=E}),cancel:f}}}function c3(l){return function(g){return l.apply(null,g)}}function u3(l){return Rt.isObject(l)&&l.isAxiosError===!0}const t0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(t0).forEach(([l,f])=>{t0[f]=l});function qE(l){const f=new $u(l),g=SE($u.prototype.request,f);return Rt.extend(g,$u.prototype,f,{allOwnKeys:!0}),Rt.extend(g,f,null,{allOwnKeys:!0}),g.create=function(E){return qE(Kh(l,E))},g}const po=qE(sp);po.Axios=$u;po.CanceledError=ap;po.CancelToken=E0;po.isCancel=jE;po.VERSION=$E;po.toFormData=C_;po.AxiosError=Hi;po.Cancel=po.CanceledError;po.all=function(f){return Promise.all(f)};po.spread=c3;po.isAxiosError=u3;po.mergeConfig=Kh;po.AxiosHeaders=ca;po.formToJSON=l=>UE(Rt.isHTMLForm(l)?new FormData(l):l);po.getAdapter=GE.getAdapter;po.HttpStatusCode=t0;po.default=po;const h3="https://orc.mattersoft.fi/timetable/rest/stopdisplays/5900",ZE=async l=>{try{return(await po.get(`${h3}${l}`)).data}catch(f){throw console.error("Error fetching bus stop data:",f),f}},d3={components:{BusStopGroup:EE},setup(){const l=Po([]),f=Po([{name:"From University",stops:["0364","0011"],data:[]},{name:"From Roslyn",stops:["0424","0952"],data:[]},{name:"Bus Hub to Rosyln",stops:["5003","5002"],data:[]}]),g=async()=>{await Promise.all(f.value.map(async E=>{const P=await Promise.all(E.stops.map(async z=>await ZE(z)));E.data=P}))},b=Po(null);return mo(()=>{g(),b.value=setInterval(g,15e3)}),lo(()=>{b.value&&clearInterval(b.value)}),{busStops:l,groups:f}}};function f3(l,f,g,b,E,P){const z=Vl("BusStopGroup");return Di(),Ki("main",null,[(Di(!0),Ki(Xo,null,x_(b.groups,j=>(Di(),rp(z,{key:j.name,group:j},null,8,["group"]))),128))])}const p3=S_(d3,[["render",f3]]),m3=$n({__name:"RoutesView",props:{routeName:{},stops:{}},setup(l){var s;const f=l;let g=f.routeName;g=g.replace(/-/g," ");const E=(((s=f.stops.match(/([0-9-]+)/))==null?void 0:s[1])??"").replace(/-/g," ").split(" "),P=Po([{name:g,stops:E,data:[]}]),z=async()=>{await Promise.all(P.value.map(async K=>{const Q=await Promise.all(K.stops.map(async re=>await ZE(re)));K.data=Q}))},j=Po(void 0);return mo(async()=>{await z(),j.value=setInterval(z,15e3)}),lo(()=>{j.value&&clearInterval(j.value)}),(K,Q)=>(Di(),Ki("main",null,[(Di(!0),Ki(Xo,null,x_(P.value,re=>(Di(),rp(EE,{key:re.name,group:re},null,8,["group"]))),128))]))}});var S0={},M0={};Object.defineProperty(M0,"__esModule",{value:!0});class _3{constructor(f=null){this.state="pending",this.fate="unresolved",this._val=f||null,this.promise=new Promise((g,b)=>{this._resolve=g,this._reject=b}),this.promise.then(g=>{this.state="fulfilled",this._val=g},()=>{this.state="rejected",this._val=null})}resolve(f){if(this.fate==="resolved")throw"Deferred cannot be resolved twice";this.fate="resolved",this._resolve(f)}reject(f){if(this.fate==="resolved")throw"Deferred cannot be resolved twice";this.fate="resolved",this._reject(f)}isResolved(){return this.fate==="resolved"}isPending(){return this.state==="pending"}isFulfilled(){return this.state==="fulfilled"}isRejected(){return this.state==="rejected"}get val(){return this._val}}M0.default=_3;var g3=so&&so.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(S0,"__esModule",{value:!0});const y3=g3(M0);var Hu=S0.default=y3.default,HE={exports:{}};(function(l,f){var g={};(function(b,E){l.exports=E()})(so,function(){var b,E,P;function z(s,K){if(!b)b=K;else if(!E)E=K;else{var Q="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+b+")(sharedChunk); ("+E+")(sharedChunk); self.onerror = null;",re={};b(re),P=K(re),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(P.workerUrl=window.URL.createObjectURL(new Blob([Q],{type:"text/javascript"})))}}z(["exports"],function(s){var K="3.3.0";let Q;const re={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Q==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Q=g.API_URL_REGEX!=null?new RegExp(g.API_URL_REGEX):t}catch{Q=t}}return Q},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!re.API_URL)return null;try{const t=new URL(re.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function we(t){return re.API_URL_REGEX.test(t)}function Ee(t){return t.indexOf("mapbox:")===0}function Me(t){return re.API_CDN_URL_REGEX.test(t)}function Ce(t){return re.API_SPRITE_REGEX.test(t)}function Ue(t){return re.API_STYLE_REGEX.test(t)&&!Ce(t)}const lt={create:"create",load:"load",fullLoad:"fullLoad"};function $t(t){const e=t.name.split("?")[0];return Me(e)&&e.includes("mapbox-gl.js")?"javascript":Me(e)&&e.includes("mapbox-gl.css")?"css":function(r){return re.API_FONTS_REGEX.test(r)}(e)?"fontRange":Ce(e)?"sprite":Ue(e)?"style":function(r){return re.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}function It(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yr=zr;function zr(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=n}zr.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,n=0;n<8;n++){var a=this.sampleCurveX(r)-t;if(Math.abs(a)<e)return r;var c=this.sampleCurveDerivativeX(r);if(Math.abs(c)<1e-6)break;r-=a/c}var d=0,m=1;for(r=t,n=0;n<20&&(a=this.sampleCurveX(r),!(Math.abs(a-t)<e));n++)t>a?d=r:m=r,r=.5*(m-d)+d;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var hr=It(yr),Ai=Ii;function Ii(t,e){this.x=t,this.y=e}Ii.prototype={clone:function(){return new Ii(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ii.convert=function(t){return t instanceof Ii?t:Array.isArray(t)?new Ii(t[0],t[1]):t};var dt=It(Ai);const Cn=Math.PI/180,Kn=180/Math.PI;function br(t){return t*Cn}function zi(t){return t*Kn}const Jn=[[0,0],[1,0],[1,1],[0,1]];function Ct(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Ci(t,e,r,n){const a=new hr(t,e,r,n);return function(c){return a.solve(c)}}const Jr=Ci(.25,.1,.25,1);function Zt(t,e,r){return Math.min(r,Math.max(e,t))}function Pn(t,e,r){return(r=Zt((r-t)/(e-t),0,1))*r*(3-2*r)}function kn(t,e,r){const n=r-e,a=((t-e)%n+n)%n+e;return a===e?r:a}function nn(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const a=new Array(t.length);let c=null;t.forEach((d,m)=>{e(d,(y,v)=>{y&&(c=y),a[m]=v,--n==0&&r(c,a)})})}function _r(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}let rr=1;function pr(){return rr++}function Ir(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function gr(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ye(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Yt(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function kt(t,e){return t.indexOf(e,t.length-e.length)!==-1}function St(t,e,r){const n={};for(const a in t)n[a]=e.call(r||this,t[a],a,t);return n}function ai(t,e,r){const n={};for(const a in t)e.call(r||this,t[a],a,t)&&(n[a]=t[a]);return n}function bi(t){return Array.isArray(t)?t.map(bi):typeof t=="object"&&t?St(t,bi):t}const ge={};function ve(t){ge[t]||(typeof console<"u"&&console.warn(t),ge[t]=!0)}function We(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function rt(t){let e=0;for(let r,n,a=0,c=t.length,d=c-1;a<c;d=a++)r=t[a],n=t[d],e+=(n.x-r.x)*(r.y+n.y);return e}function ut([t,e,r]){const n=br(e+90),a=br(r);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:r}}function Vt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function lr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,a,c)=>{const d=a||c;return e[n]=!d||d.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let bt,Qt,Dt,cr,Er,Sr,Oe=null;function W(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function se(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function de(t,e,r,n){for(;e<r;){const a=e+r>>1;t[a]<n?e=a+1:r=a}return e}function Fe(t,e,r,n){for(;e<r;){const a=e+r>>1;t[a]<=n?e=a+1:r=a}return e}function Ze(){return bt==null&&(bt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),bt}const nt={now:()=>cr!==void 0?cr:performance.now(),setNow(t){cr=t},restoreNow(){cr=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:n}=t;Er||(Er=document.createElement("canvas"));const a=Er.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(r>Er.width||n>Er.height)&&(Er.width=r,Er.height=n),a.clearRect(-e,-e,r+2*e,n+2*e),a.drawImage(t,0,0,r,n),a.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:t=>(Qt||(Qt=document.createElement("a")),Qt.href=t,Qt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Dt==null&&(Dt=window.matchMedia("(prefers-reduced-motion: reduce)")),Dt.matches)},hasCanvasFingerprintNoise(){if(Sr!==void 0)return Sr;if(!Ze())return Sr=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let a=0;a<t.width;++a)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(a,0,1,1);const n=e.getImageData(0,0,t.width,t.height);r=0;for(let a=0;a<n.data.length;++a)if(a%4!=3&&r++!==n.data[a])return Sr=!0,!0;return Sr=!1,!1}},Nt="mapbox-tiles";let He=500,Ht=50,Tt,Ut;function Rr(){try{return caches}catch{}}function fi(){const t=Rr();t&&!Tt&&(Tt=t.open(Nt))}function Ui(t){const e=t.indexOf("?");if(e<0)return t;const r=["language","worldview"],n=new URLSearchParams,a=new URLSearchParams(t.slice(e));for(const c of r){const d=a.get(c);d&&n.set(c,d)}return`${t.slice(0,e)}?${n.toString()}`}function gi(t,e){const r=t.indexOf("?");if(r<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(r));for(const a in e)n.set(a,e[a]);return`${t.slice(0,r)}?${n.toString()}`}let $r=1/0;const ii={supported:!1,testSupport:function(t){!Fn&&ki&&(ji?jn(t):yi=t)}};let yi,ki,Fn=!1,ji=!1;const _o=typeof self<"u"?self:{};function jn(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ki),t.isContextLost())return;ii.supported=!0}catch{}t.deleteTexture(e),Fn=!0}_o.document&&(ki=_o.document.createElement("img"),ki.onload=function(){yi&&jn(yi),yi=null,ji=!0},ki.onerror=function(){Fn=!0,yi=null},ki.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const So={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(So);class Tn extends Error{constructor(e,r,n){r===401&&we(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const En=Vt()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ge=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(En())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(n,a){const c=new AbortController,d=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:En(),referrerPolicy:n.referrerPolicy,signal:c.signal});let m=!1,y=!1;const v=(w=d.url).indexOf("sku=")>0&&we(w);var w;n.type==="json"&&d.headers.set("Accept","application/json");const S=(R,D,k)=>{if(y)return;if(R&&R.message!=="SecurityError"&&ve(R.toString()),D&&k)return A(D);const U=Date.now();fetch(d).then(G=>{if(G.ok){const Y=v?G.clone():null;return A(G,Y,U)}return a(new Tn(G.statusText,G.status,n.url))}).catch(G=>{G.name!=="AbortError"&&a(new Error(`${G.message} ${n.url}`))})},A=(R,D,k)=>{(n.type==="arrayBuffer"?R.arrayBuffer():n.type==="json"?R.json():R.text()).then(U=>{y||(D&&k&&function(G,Y,te){if(fi(),!Tt)return;const ee=lr(Y.headers.get("Cache-Control")||"");if(ee["no-store"])return;const ue={status:Y.status,statusText:Y.statusText,headers:new Headers};Y.headers.forEach((be,Ie)=>ue.headers.set(Ie,be)),ee["max-age"]&&ue.headers.set("Expires",new Date(te+1e3*ee["max-age"]).toUTCString());const le=ue.headers.get("Expires");if(!le||new Date(le).getTime()-te<42e4)return;let pe=Ui(G.url);if(Y.status===206){const be=G.headers.get("Range");if(!be)return;ue.status=200,pe=gi(pe,{range:be})}(function(be,Ie){if(Ut===void 0)try{new Response(new ReadableStream),Ut=!0}catch{Ut=!1}Ut?Ie(be.body):be.blob().then(Ie)})(Y,be=>{const Ie=new Response(be,ue);fi(),Tt&&Tt.then(ze=>ze.put(pe,Ie)).catch(ze=>ve(ze.message))})}(d,D,k),m=!0,a(null,U,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(U=>{y||a(new Error(U.message))})};return v?function(R,D){if(fi(),!Tt)return D(null);Tt.then(k=>{let U=Ui(R.url);const G=R.headers.get("Range");G&&(U=gi(U,{range:G})),k.match(U).then(Y=>{const te=function(ee){if(!ee)return!1;const ue=new Date(ee.headers.get("Expires")||0),le=lr(ee.headers.get("Cache-Control")||"");return ue>Date.now()&&!le["no-cache"]}(Y);k.delete(U),te&&k.put(U,Y.clone()),D(null,Y,te)}).catch(D)}).catch(D)}(d,S):S(null,null),{cancel:()=>{y=!0,m||c.abort()}}}(t,e);if(Vt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(n,a){const c=new XMLHttpRequest;c.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const d in n.headers)c.setRequestHeader(d,n.headers[d]);return n.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=n.credentials==="include",c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let d=c.response;if(n.type==="json")try{d=JSON.parse(c.response)}catch(m){return a(m)}a(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new Tn(c.statusText,c.status,n.url))},c.send(n.body),{cancel:()=>c.abort()}}(t,e)},Xe=function(t,e){return Ge(_r(t,{type:"arrayBuffer"}),e)};function ct(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let pt,Lt;pt=[],Lt=0;const Pt=function(t,e){if(ii.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Lt>=re.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return pt.push(c),c}Lt++;let r=!1;const n=()=>{if(!r)for(r=!0,Lt--;pt.length&&Lt<re.MAX_PARALLEL_IMAGE_REQUESTS;){const c=pt.shift(),{requestParameters:d,callback:m,cancelled:y}=c;y||(c.cancel=Pt(d,m).cancel)}},a=Xe(t,(c,d,m,y)=>{n(),c?e(c):d&&(self.createImageBitmap?function(v,w){const S=new Blob([new Uint8Array(v)],{type:"image/png"});createImageBitmap(S).then(A=>{w(null,A)}).catch(A=>{w(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(v,w)=>e(v,w,m,y)):function(v,w){const S=new Image;S.onload=()=>{w(null,S),URL.revokeObjectURL(S.src),S.onload=null,requestAnimationFrame(()=>{S.src=yt})},S.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(v)],{type:"image/png"});S.src=v.byteLength?URL.createObjectURL(A):yt}(d,(v,w)=>e(v,w,m,y)))});return{cancel:()=>{a.cancel(),n()}}},gt="01",zt="NO_ACCESS_TOKEN",At=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function sr(t){const e=t.match(At);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Yr(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const ir="mapbox.eventData";function Pi(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class $i{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Pi(re.ACCESS_TOKEN);let n="";return n=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c)))):re.ACCESS_TOKEN||"",e?`${ir}.${e}:${n}`:`${ir}:${n}`}fetchEventData(){const e=W("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));const c=localStorage.getItem(n);c&&(this.anonId=c)}catch{ve("Unable to read from LocalStorage")}}saveEventData(){const e=W("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),a=this.anonId;if(e&&a)try{localStorage.setItem(n,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{ve("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,a){if(!re.EVENTS_URL)return;const c=sr(re.EVENTS_URL);c.params.push(`access_token=${a||re.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},m=r?_r(d,r):d,y={url:Yr(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=function(v,w){return Ge(_r(v,{method:"POST"}),w)}(y,v=>{this.pendingRequest=null,n(v),this.saveEventData(),this.processRequests(a)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Li=new class extends $i{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){re.EVENTS_URL&&re.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>Ee(r)||we(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Pi(re.ACCESS_TOKEN),r=e?e.u:re.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;Ye(this.anonId)||(this.anonId=Ir(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),d=new Date(a),m=(a-this.eventData.lastSuccess)/864e5;n=n||m>=1||m<-1||c.getDate()!==d.getDate()}else n=!0;n?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:K,skuId:gt,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},t):this.processRequests()}},gn=Li.postTurnstileEvent.bind(Li),qn=new class extends $i{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,re.EVENTS_URL&&(r||re.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(zt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ye(this.anonId)||(this.anonId=Ir()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:K,skuId:gt,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},ti=qn.postMapLoadEvent.bind(qn),go=new class extends $i{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){re.EVENTS_URL&&(t||re.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),n=function(a){const c=performance.getEntriesByType("resource"),d=performance.getEntriesByType("mark"),m=function(R){const D={};if(R){for(const k in R)if(k!=="other")for(const U of R[k]){const G=`${k}ResolveRangeMin`,Y=`${k}ResolveRangeMax`,te=`${k}RequestCount`,ee=`${k}RequestCachedCount`;D[G]=Math.min(D[G]||1/0,U.startTime),D[Y]=Math.max(D[Y]||-1/0,U.responseEnd);const ue=le=>{D[le]===void 0&&(D[le]=0),++D[le]};U.transferSize!==void 0&&U.transferSize===0&&ue(ee),ue(te)}}return D}(function(R,D){const k={};if(R)for(const U of R){const G=D(U);k[G]===void 0&&(k[G]=[]),k[G].push(U)}return k}(c,$t)),y=window.devicePixelRatio,v=navigator.connection||navigator.mozConnection||navigator.webkitConnection,w=v?v.effectiveType:void 0,S={counters:[],metadata:[],attributes:[]},A=(R,D,k)=>{k!=null&&R.push({name:D,value:k.toString()})};for(const R in m)A(S.counters,R,m[R]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(A(S.counters,"interactionRangeMin",a.interactionRange[0]),A(S.counters,"interactionRangeMax",a.interactionRange[1])),d)for(const R of Object.keys(lt)){const D=lt[R],k=d.find(U=>U.name===D);k&&A(S.counters,D,k.startTime)}return A(S.counters,"visibilityHidden",a.visibilityHidden),A(S.attributes,"style",function(R){if(R)for(const D of R){const k=D.name.split("?")[0];if(Ue(k)){const U=k.split("/").slice(-2);if(U.length===2)return`mapbox://styles/${U[0]}/${U[1]}`}}}(c)),A(S.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),A(S.attributes,"fogEnabled",a.fogEnabled?"true":"false"),A(S.attributes,"projection",a.projection),A(S.attributes,"zoom",a.zoom),A(S.metadata,"devicePixelRatio",y),A(S.metadata,"connectionEffectiveType",w),A(S.metadata,"navigatorUserAgent",navigator.userAgent),A(S.metadata,"screenWidth",window.screen.width),A(S.metadata,"screenHeight",window.screen.height),A(S.metadata,"windowWidth",window.innerWidth),A(S.metadata,"windowHeight",window.innerHeight),A(S.metadata,"mapWidth",a.width/y),A(S.metadata,"mapHeight",a.height/y),A(S.metadata,"webglRenderer",a.renderer),A(S.metadata,"webglVendor",a.vendor),A(S.metadata,"sdkVersion",K),A(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(r);for(const a of n.metadata);for(const a of n.counters);for(const a of n.attributes);this.postEvent(e,n,()=>{},t)}},Ro=go.postPerformanceEvent.bind(go),wi=new class extends $i{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!re.API_URL||!re.SESSION_PATH)return;const a=sr(re.API_URL+re.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||re.ACCESS_TOKEN||""}`);const c={url:Yr(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(d,m){return Ge(_r(d,{method:"GET"}),m)}(c,d=>{this.pendingRequest=null,r(d),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,re.SESSION_PATH&&re.API_URL&&(r||re.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(zt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Da=wi.getSessionAPI.bind(wi),Es=new Set;function Oo(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function Bo(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}class as{constructor(e,r={}){_r(this,r),this.type=e}}class Ss extends as{constructor(e,r={}){super("error",_r({error:e},r))}}class No{on(e,r){return this._listeners=this._listeners||{},Oo(e,r,this._listeners),this}off(e,r){return Bo(e,r,this._listeners),Bo(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Oo(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new as(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const m of a)m.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const m of c)Bo(n,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(_r(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof Ss&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}s.y=void 0;var Gc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function $l(t){return(t=Math.round(t))<0?0:t>255?255:t}function $c(t){return $l(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function ql(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Zl(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{s.y={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in Gc)return Gc[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=r.indexOf("("),a=r.indexOf(")");if(n!==-1&&a+1===r.length){var c=r.substr(0,n),d=r.substr(n+1,a-(n+1)).split(","),m=1;switch(c){case"rgba":if(d.length!==4)return null;m=ql(d.pop());case"rgb":return d.length!==3?null:[$c(d[0]),$c(d[1]),$c(d[2]),m];case"hsla":if(d.length!==4)return null;m=ql(d.pop());case"hsl":if(d.length!==3)return null;var y=(parseFloat(d[0])%360+360)%360/360,v=ql(d[1]),w=ql(d[2]),S=w<=.5?w*(v+1):w+v-w*v,A=2*w-S;return[$l(255*Zl(A,S,y+1/3)),$l(255*Zl(A,S,y)),$l(255*Zl(A,S,y-1/3)),m];default:return null}}return null}}catch{}class co{constructor(e,r,n,a=1){this.r=e,this.g=r,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof co)return e;if(typeof e!="string")return;const r=s.y(e);return r?new co(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${a})`}toArray(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*r/a,255*n/a,a]}toArray01(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,r/a,n/a,a]}toArray01Scaled(e){const{r,g:n,b:a,a:c}=this;return c===0?[0,0,0]:[r/c*e,n/c*e,a/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:n,a}=this;return[e,r,n,a]}toArray01Linear(){const{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(r/a,2.2),Math.pow(n/a,2.2),a]}}co.black=new co(0,0,0,1),co.white=new co(1,1,1,1),co.transparent=new co(0,0,0,0),co.red=new co(1,0,0,1),co.blue=new co(0,0,1,1);var yn=co;function Zr(t,e,r){return t*(1-r)+e*r}function Wu(t,e,r){return t.map((n,a)=>Zr(n,e[a],r))}var Hl=Object.freeze({__proto__:null,array:Wu,color:function(t,e,r){return new yn(Zr(t.r,e.r,r),Zr(t.g,e.g,r),Zr(t.b,e.b,r),Zr(t.a,e.a,r))},number:Zr});function qc(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}class Wl extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var C=Wl;class B{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,a]of r)this.bindings[n]=a}concat(e){return new B(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var ie=B;const me={kind:"null"},ce={kind:"number"},xe={kind:"string"},Se={kind:"boolean"},wt={kind:"color"},Ft={kind:"object"},ft={kind:"value"},nr={kind:"collator"},qt={kind:"formatted"},Gr={kind:"resolvedImage"};function Ti(t,e){return{kind:"array",itemType:t,N:e}}function Tr(t){if(t.kind==="array"){const e=Tr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const jt=[me,ce,xe,Se,wt,qt,Ft,Ti(ft),Gr];function mt(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!mt(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of jt)if(!mt(r,e))return null}}return`Expected ${Tr(t)} but found ${Tr(e)} instead.`}function ht(t,e){return e.some(r=>r.kind===t.kind)}function Ei(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}class vr{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hn{constructor(e,r,n,a,c){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=a,this.textColor=c}}class Bn{constructor(e){this.sections=e}static fromString(e){return new Bn([new hn(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Bn?e:Bn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class dr{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new dr({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function on(t,e,r,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof yn||t instanceof vr||t instanceof Bn||t instanceof dr)return!0;if(Array.isArray(t)){for(const e of t)if(!Zs(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Zs(t[e]))return!1;return!0}return!1}function Ln(t){if(t===null)return me;if(typeof t=="string")return xe;if(typeof t=="boolean")return Se;if(typeof t=="number")return ce;if(t instanceof yn)return wt;if(t instanceof vr)return nr;if(t instanceof Bn)return qt;if(t instanceof dr)return Gr;if(Array.isArray(t)){const e=t.length;let r;for(const n of t){const a=Ln(n);if(r){if(r===a)continue;r=ft;break}r=a}return Ti(r||ft,e)}return Ft}function Nn(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof yn||t instanceof Bn||t instanceof dr?t.toString():JSON.stringify(t)}class Ms{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Zs(e[1]))return r.error("invalid value");const n=e[1];let a=Ln(n);const c=r.expectedType;return a.kind!=="array"||a.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(a=c),new Ms(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof yn?["rgba"].concat(this.value.toArray()):this.value instanceof Bn?this.value.serialize():this.value}}var ls=Ms,Sn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const hl={string:xe,number:ce,boolean:Se,object:Ft};class Xl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,a=1;const c=e[0];if(c==="array"){let m,y;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in hl)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=hl[v],a++}else m=ft;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}n=Ti(m,y)}else n=hl[c];const d=[];for(;a<e.length;a++){const m=r.parse(e[a],a,ft);if(!m)return null;d.push(m)}return new Xl(n,d)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!mt(this.type,Ln(n)))return n;if(r===this.args.length-1)throw new Sn(`Expected value to be of type ${Tr(this.type)}, but found ${Tr(Ln(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(n=>n.serialize()))}}var cs=Xl;class za{constructor(e){this.type=qt,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const a=[];let c=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(c&&typeof m=="object"&&!Array.isArray(m)){c=!1;let y=null;if(m["font-scale"]&&(y=r.parse(m["font-scale"],1,ce),!y))return null;let v=null;if(m["text-font"]&&(v=r.parse(m["text-font"],1,Ti(xe)),!v))return null;let w=null;if(m["text-color"]&&(w=r.parse(m["text-color"],1,wt),!w))return null;const S=a[a.length-1];S.scale=y,S.font=v,S.textColor=w}else{const y=r.parse(e[d],1,ft);if(!y)return null;const v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new za(a)}evaluate(e){return new Bn(this.sections.map(r=>{const n=r.content.evaluate(e);return Ln(n)===Gr?new hn("",n,null,null,null):new hn(Nn(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class ua{constructor(e,r){this.type=Gr,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");const n=r.parse(e[1],1,xe);if(!n)return r.error("No image name provided.");if(e.length===2)return new ua(n);const a=r.parse(e[2],1,xe);return a?new ua(n,a):r.error("Secondary image variant is not a string.")}evaluate(e){const r=dr.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ka(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const Uo={"to-boolean":Se,"to-color":wt,"to-number":ce,"to-string":xe};class dl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0],a=[];let c=me;if(n==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);c=Ti(r.expectedType.itemType,d)}else{if(!(d>0&&Zs(e[1][0])))return null;c=Ti(Ln(e[1][0]),d)}for(let m=0;m<d;m++){const y=e[1][m];let v;if(ka(y)==="array")v=r.parse(y,void 0,c.itemType);else{const w=ka(y);if(w!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${w}.`);v=r.registry.literal.parse(["literal",y===void 0?null:y],r)}if(!v)return null;a.push(v)}}else{if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");c=Uo[n];for(let d=1;d<e.length;d++){const m=r.parse(e[d],d,ft);if(!m)return null;a.push(m)}}return new dl(c,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,n;for(const a of this.args){if(r=a.evaluate(e),n=null,r instanceof yn)return r;if(typeof r=="string"){const c=e.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:on(r[0],r[1],r[2],r[3]),!n))return new yn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Sn(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new Sn(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Bn.fromString(Nn(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?dr.fromString(Nn(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Nn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new za([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ua(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var us=dl;const fl=["Unknown","Point","LineString","Polygon"];var Xu=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=yn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class hs{constructor(e,r,n,a,c){this.name=e,this.type=r,this._evaluate=n,this.args=a,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const r=hs.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],a=hs.definitions[n];if(!a)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,m=[];let y=null,v=-1;for(const[w,S]of d){if(Array.isArray(w)&&w.length!==e.length-1)continue;m.push(w),v++,y=new fs(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const A=[];let R=!1;for(let D=1;D<e.length;D++){const k=e[D],U=Array.isArray(w)?w[D-1]:w.type,G=y.parse(k,1+A.length,U);if(!G){R=!0;break}A.push(G)}if(!R)if(Array.isArray(w)&&w.length!==A.length)y.error(`Expected ${w.length} arguments, but found ${A.length} instead.`);else{for(let D=0;D<A.length;D++){const k=Array.isArray(w)?w[D]:w.type,U=A[D];y.concat(D+1).checkSubtype(k,U.type)}if(y.errors.length===0)return new hs(n,c,S,A,v)}}if(m.length===1)r.errors.push(...y.errors);else{const w=(m.length?m:d.map(([A])=>A)).map(Yl).join(" | "),S=[];for(let A=1;A<e.length;A++){const R=r.parse(e[A],1+S.length);if(!R)return null;S.push(Tr(R.type))}r.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,r){hs.definitions=r;for(const n in r)e[n]=hs}}function Yl(t){return Array.isArray(t)?`(${t.map(Tr).join(", ")})`:`(${Tr(t.type)}...)`}var Kr=hs;class Mo{constructor(e,r,n){this.type=nr,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const a=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Se);if(!a)return null;const c=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Se);if(!c)return null;let d=null;return n.locale&&(d=r.parse(n.locale,1,xe),!d)?null:new Mo(a,c,d)}evaluate(e){return new vr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Kl={exports:{}};Kl.exports=function(){function t(n,a,c,d,m){for(;d>c;){if(d-c>600){var y=d-c+1,v=a-c+1,w=Math.log(y),S=.5*Math.exp(2*w/3),A=.5*Math.sqrt(w*S*(y-S)/y)*(v-y/2<0?-1:1);t(n,a,Math.max(c,Math.floor(a-v*S/y+A)),Math.min(d,Math.floor(a+(y-v)*S/y+A)),m)}var R=n[a],D=c,k=d;for(e(n,c,a),m(n[d],R)>0&&e(n,c,d);D<k;){for(e(n,D,k),D++,k--;m(n[D],R)<0;)D++;for(;m(n[k],R)>0;)k--}m(n[c],R)===0?e(n,c,k):e(n,++k,d),k<=a&&(c=k+1),a<=k&&(d=k-1)}}function e(n,a,c){var d=n[a];n[a]=n[c],n[c]=d}function r(n,a){return n<a?-1:n>a?1:0}return function(n,a,c,d,m){t(n,a,c||0,d||n.length-1,m||r)}}();var Yu=It(Kl.exports);function id(t){let e=0;for(let r,n,a=0,c=t.length,d=c-1;a<c;d=a++)r=t[a],n=t[d],e+=(n.x-r.x)*(r.y+n.y);return e}function As(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Qo(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function pl(t,e,r){const n=t[0]-e[0],a=t[1]-e[1],c=t[0]-r[0],d=t[1]-r[1];return n*d-c*a==0&&n*c<=0&&a*d<=0}function ha(t,e,r=!1){let n=!1;for(let m=0,y=e.length;m<y;m++){const v=e[m];for(let w=0,S=v.length,A=S-1;w<S;A=w++){const R=v[A],D=v[w];if(pl(t,R,D))return r;(c=R)[1]>(a=t)[1]!=(d=D)[1]>a[1]&&a[0]<(d[0]-c[0])*(a[1]-c[1])/(d[1]-c[1])+c[0]&&(n=!n)}}var a,c,d;return n}function Zc(t,e,r,n){const a=n[0]-r[0],c=n[1]-r[1],d=(t[0]-r[0])*c-a*(t[1]-r[1]),m=(e[0]-r[0])*c-a*(e[1]-r[1]);return d>0&&m<0||d<0&&m>0}function yo(t,e,r,n){return(a=[n[0]-r[0],n[1]-r[1]])[0]*(c=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*c[0]!=0&&!(!Zc(t,e,r,n)||!Zc(r,n,t,e));var a,c}const Is=8192;function ml(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*Is),Math.round(n*a*Is)]}function Hc(t,e){for(let r=0;r<e.length;r++)if(ha(t,e[r]))return!0;return!1}function _l(t,e,r){for(const n of r)for(let a=0,c=n.length,d=c-1;a<c;d=a++)if(yo(t,e,n[d],n[a]))return!0;return!1}function uo(t,e){for(let r=0;r<t.length;++r)if(!ha(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(_l(t[r],t[r+1],e))return!1;return!0}function Jl(t,e){for(let r=0;r<e.length;r++)if(uo(t,e[r]))return!0;return!1}function gl(t,e,r){const n=[];for(let a=0;a<t.length;a++){const c=[];for(let d=0;d<t[a].length;d++){const m=ml(t[a][d],r);As(e,m),c.push(m)}n.push(c)}return n}function yl(t,e,r){const n=[];for(let a=0;a<t.length;a++){const c=gl(t[a],e,r);n.push(c)}return n}function da(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const a=.5*n;let c=t[0]-r[0]>a?-n:r[0]-t[0]>a?n:0;c===0&&(c=t[0]-r[2]>a?-n:r[2]-t[0]>a?n:0),t[0]+=c}As(e,t)}function Wc(t,e,r,n){const a=Math.pow(2,n.z)*Is,c=[n.x*Is,n.y*Is],d=[];if(!t)return d;for(const m of t)for(const y of m){const v=[y.x+c[0],y.y+c[1]];da(v,e,r,a),d.push(v)}return d}function Xc(t,e,r,n){const a=Math.pow(2,n.z)*Is,c=[n.x*Is,n.y*Is],d=[];if(!t)return d;for(const y of t){const v=[];for(const w of y){const S=[w.x+c[0],w.y+c[1]];As(e,S),v.push(S)}d.push(v)}if(e[2]-e[0]<=a/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const y of d)for(const v of y)da(v,e,r,a)}var m;return d}class Fa{constructor(e,r){this.type=Se,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Zs(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const c=n.features[a].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Fa(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Fa(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Fa(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(n.type==="Polygon"){const m=gl(n.coordinates,c,d),y=Wc(r.geometry(),a,c,d);if(!Qo(a,c))return!1;for(const v of y)if(!ha(v,m))return!1}if(n.type==="MultiPolygon"){const m=yl(n.coordinates,c,d),y=Wc(r.geometry(),a,c,d);if(!Qo(a,c))return!1;for(const v of y)if(!Hc(v,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(n.type==="Polygon"){const m=gl(n.coordinates,c,d),y=Xc(r.geometry(),a,c,d);if(!Qo(a,c))return!1;for(const v of y)if(!uo(v,m))return!1}if(n.type==="MultiPolygon"){const m=yl(n.coordinates,c,d),y=Xc(r.geometry(),a,c,d);if(!Qo(a,c))return!1;for(const v of y)if(!Jl(v,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ql=Fa,vl={exports:{}};vl.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,r=e*(2-e),n=Math.PI/180,a=function(v,w){if(v===void 0)throw new Error("No latitude given.");if(w&&!t[w])throw new Error("Unknown unit "+w+". Use one of: "+Object.keys(t).join(", "));var S=6378.137*n*(w?t[w]:1),A=Math.cos(v*n),R=1/(1-r*(1-A*A)),D=Math.sqrt(R);this.kx=S*D*A,this.ky=S*D*R*(1-r)},c={units:{configurable:!0}};function d(v,w){return v[0]===w[0]&&v[1]===w[1]}function m(v,w,S){var A=y(w[0]-v[0]);return[v[0]+A*S,v[1]+(w[1]-v[1])*S]}function y(v){for(;v<-180;)v+=360;for(;v>180;)v-=360;return v}return a.fromTile=function(v,w,S){var A=Math.PI*(1-2*(v+.5)/Math.pow(2,w)),R=Math.atan(.5*(Math.exp(A)-Math.exp(-A)))/n;return new a(R,S)},c.units.get=function(){return t},a.prototype.distance=function(v,w){var S=y(v[0]-w[0])*this.kx,A=(v[1]-w[1])*this.ky;return Math.sqrt(S*S+A*A)},a.prototype.bearing=function(v,w){var S=y(w[0]-v[0])*this.kx;return Math.atan2(S,(w[1]-v[1])*this.ky)/n},a.prototype.destination=function(v,w,S){var A=S*n;return this.offset(v,Math.sin(A)*w,Math.cos(A)*w)},a.prototype.offset=function(v,w,S){return[v[0]+w/this.kx,v[1]+S/this.ky]},a.prototype.lineDistance=function(v){for(var w=0,S=0;S<v.length-1;S++)w+=this.distance(v[S],v[S+1]);return w},a.prototype.area=function(v){for(var w=0,S=0;S<v.length;S++)for(var A=v[S],R=0,D=A.length,k=D-1;R<D;k=R++)w+=y(A[R][0]-A[k][0])*(A[R][1]+A[k][1])*(S?-1:1);return Math.abs(w)/2*this.kx*this.ky},a.prototype.along=function(v,w){var S=0;if(w<=0)return v[0];for(var A=0;A<v.length-1;A++){var R=v[A],D=v[A+1],k=this.distance(R,D);if((S+=k)>w)return m(R,D,(w-(S-k))/k)}return v[v.length-1]},a.prototype.pointToSegmentDistance=function(v,w,S){var A=w[0],R=w[1],D=y(S[0]-A)*this.kx,k=(S[1]-R)*this.ky,U=0;return D===0&&k===0||((U=(y(v[0]-A)*this.kx*D+(v[1]-R)*this.ky*k)/(D*D+k*k))>1?(A=S[0],R=S[1]):U>0&&(A+=D/this.kx*U,R+=k/this.ky*U)),D=y(v[0]-A)*this.kx,k=(v[1]-R)*this.ky,Math.sqrt(D*D+k*k)},a.prototype.pointOnLine=function(v,w){for(var S,A,R,D,k=1/0,U=0;U<v.length-1;U++){var G=v[U][0],Y=v[U][1],te=y(v[U+1][0]-G)*this.kx,ee=(v[U+1][1]-Y)*this.ky,ue=0;te===0&&ee===0||((ue=(y(w[0]-G)*this.kx*te+(w[1]-Y)*this.ky*ee)/(te*te+ee*ee))>1?(G=v[U+1][0],Y=v[U+1][1]):ue>0&&(G+=te/this.kx*ue,Y+=ee/this.ky*ue));var le=(te=y(w[0]-G)*this.kx)*te+(ee=(w[1]-Y)*this.ky)*ee;le<k&&(k=le,S=G,A=Y,R=U,D=ue)}return{point:[S,A],index:R,t:Math.max(0,Math.min(1,D))}},a.prototype.lineSlice=function(v,w,S){var A=this.pointOnLine(S,v),R=this.pointOnLine(S,w);if(A.index>R.index||A.index===R.index&&A.t>R.t){var D=A;A=R,R=D}var k=[A.point],U=A.index+1,G=R.index;!d(S[U],k[0])&&U<=G&&k.push(S[U]);for(var Y=U+1;Y<=G;Y++)k.push(S[Y]);return d(S[G],R.point)||k.push(R.point),k},a.prototype.lineSliceAlong=function(v,w,S){for(var A=0,R=[],D=0;D<S.length-1;D++){var k=S[D],U=S[D+1],G=this.distance(k,U);if((A+=G)>v&&R.length===0&&R.push(m(k,U,(v-(A-G))/G)),A>=w)return R.push(m(k,U,(w-(A-G))/G)),R;A>v&&R.push(U)}return R},a.prototype.bufferPoint=function(v,w){var S=w/this.ky,A=w/this.kx;return[v[0]-A,v[1]-S,v[0]+A,v[1]+S]},a.prototype.bufferBBox=function(v,w){var S=w/this.ky,A=w/this.kx;return[v[0]-A,v[1]-S,v[2]+A,v[3]+S]},a.prototype.insideBBox=function(v,w){return y(v[0]-w[0])>=0&&y(v[0]-w[2])<=0&&v[1]>=w[1]&&v[1]<=w[3]},Object.defineProperties(a,c),a}();var Cs=It(vl.exports),xl={exports:{}};xl.exports=function(){var t=function(r,n){if(r===void 0&&(r=[]),n===void 0&&(n=e),this.data=r,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function e(r,n){return r<n?-1:r>n?1:0}return t.prototype.push=function(r){this.data.push(r),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var r=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),r}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(r){for(var n=this.data,a=this.compare,c=n[r];r>0;){var d=r-1>>1,m=n[d];if(a(c,m)>=0)break;n[r]=m,r=d}n[r]=c},t.prototype._down=function(r){for(var n=this.data,a=this.compare,c=this.length>>1,d=n[r];r<c;){var m=1+(r<<1),y=n[m],v=m+1;if(v<this.length&&a(n[v],y)<0&&(m=v,y=n[v]),a(y,d)>=0)break;n[r]=y,r=m}n[r]=d},t}();var Zn=It(xl.exports),Mt=8192;function ds(t,e){return e.dist-t.dist}const Ba=100,jo=50;function Yc(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function es(t){return t[1]-t[0]+1}function vo(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function ec(t,e){if(t[0]>t[1])return[null,null];const r=es(t);if(e){if(r===2)return[t,null];const n=Math.floor(r/2);return[[t[0],t[0]+n],[t[0]+n,t[1]]]}{if(r===1)return[t,null];const n=Math.floor(r/2)-1;return[[t[0],t[0]+n],[t[0]+n+1,t[1]]]}}function Hs(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!vo(e,t.length))return r;for(let n=e[0];n<=e[1];++n)As(r,t[n]);return r}function tc(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let n=0;n<t[r].length;++n)As(e,t[r][n]);return e}function fa(t,e,r){if(Yc(t)||Yc(e))return NaN;let n=0,a=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),r.distance([0,0],[n,a])}function rc(t){return 360*t-180}function Ku(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Ps(t,e){const r=Math.pow(2,e.z),n=(t.y/Mt+e.y)/r;return[rc((t.x/Mt+e.x)/r),Ku(n)]}function Na(t,e){const r=[];for(let n=0;n<t.length;++n)r.push(Ps(t[n],e));return r}function Ju(t,e,r){const n=r.pointOnLine(e,t).point;return r.distance(t,n)}function Ls(t,e,r,n,a){const c=r.slice(n[0],n[1]+1);let d=1/0;for(let m=e[0];m<=e[1];++m)if((d=Math.min(d,Ju(t[m],c,a)))===0)return 0;return d}function Kc(t,e,r,n,a){const c=Math.min(a.pointToSegmentDistance(t,r,n),a.pointToSegmentDistance(e,r,n)),d=Math.min(a.pointToSegmentDistance(r,t,e),a.pointToSegmentDistance(n,t,e));return Math.min(c,d)}function pa(t,e,r,n,a){if(!vo(e,t.length)||!vo(n,r.length))return NaN;let c=1/0;for(let d=e[0];d<e[1];++d)for(let m=n[0];m<n[1];++m){if(yo(t[d],t[d+1],r[m],r[m+1]))return 0;c=Math.min(c,Kc(t[d],t[d+1],r[m],r[m+1],a))}return c}function Qu(t,e,r,n,a){if(!vo(e,t.length)||!vo(n,r.length))return NaN;let c=1/0;for(let d=e[0];d<=e[1];++d)for(let m=n[0];m<=n[1];++m)if((c=Math.min(c,a.distance(t[d],r[m])))===0)return c;return c}function nd(t,e,r){if(ha(t,e,!0))return 0;let n=1/0;for(const a of e){const c=a.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[c-1]&&(n=Math.min(n,r.pointToSegmentDistance(t,a[c-1],a[0])))===0||(n=Math.min(n,Ju(t,a,r)))===0)return n}return n}function bl(t,e,r,n){if(!vo(e,t.length))return NaN;for(let c=e[0];c<=e[1];++c)if(ha(t[c],r,!0))return 0;let a=1/0;for(let c=e[0];c<e[1];++c)for(const d of r)for(let m=0,y=d.length,v=y-1;m<y;v=m++){if(yo(t[c],t[c+1],d[v],d[m]))return 0;a=Math.min(a,Kc(t[c],t[c+1],d[v],d[m],n))}return a}function ma(t,e){for(const r of t)for(let n=0;n<=r.length-1;++n)if(ha(r[n],e,!0))return!0;return!1}function eh(t,e,r,n=1/0){const a=tc(t),c=tc(e);if(n!==1/0&&fa(a,c,r)>=n)return n;if(Qo(a,c)){if(ma(t,e))return 0}else if(ma(e,t))return 0;let d=n;for(const m of t)for(let y=0,v=m.length,w=v-1;y<v;w=y++)for(const S of e)for(let A=0,R=S.length,D=R-1;A<R;D=A++){if(yo(m[w],m[y],S[D],S[A]))return 0;d=Math.min(d,Kc(m[w],m[y],S[D],S[A],r))}return d}function wl(t,e,r,n,a,c,d){if(c===null||d===null)return;const m=fa(Hs(n,c),Hs(a,d),r);m<e&&t.push({dist:m,range1:c,range2:d})}function ic(t,e,r,n,a=1/0){let c=Math.min(n.distance(t[0],r[0][0]),a);if(c===0)return c;const d=new Zn([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ds),m=e?jo:Ba,y=tc(r);for(;d.length;){const v=d.pop();if(v.dist>=c)continue;const w=v.range1;if(es(w)<=m){if(!vo(w,t.length))return NaN;if(e){const S=bl(t,w,r,n);if((c=Math.min(c,S))===0)return c}else for(let S=w[0];S<=w[1];++S){const A=nd(t[S],r,n);if((c=Math.min(c,A))===0)return c}}else{const S=ec(w,e);if(S[0]!==null){const A=fa(Hs(t,S[0]),y,n);A<c&&d.push({dist:A,range1:S[0],range2:[0,0]})}if(S[1]!==null){const A=fa(Hs(t,S[1]),y,n);A<c&&d.push({dist:A,range1:S[1],range2:[0,0]})}}}return c}function Ua(t,e,r,n,a,c=1/0){let d=Math.min(c,a.distance(t[0],r[0]));if(d===0)return d;const m=new Zn([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],ds),y=e?jo:Ba,v=n?jo:Ba;for(;m.length;){const w=m.pop();if(w.dist>=d)continue;const S=w.range1,A=w.range2;if(es(S)<=y&&es(A)<=v){if(!vo(S,t.length)||!vo(A,r.length))return NaN;if(e&&n?d=Math.min(d,pa(t,S,r,A,a)):e||n?e&&!n?d=Math.min(d,Ls(r,A,t,S,a)):!e&&n&&(d=Math.min(d,Ls(t,S,r,A,a))):d=Math.min(d,Qu(t,S,r,A,a)),d===0)return d}else{const R=ec(S,e),D=ec(A,n);wl(m,d,a,t,r,R[0],D[0]),wl(m,d,a,t,r,R[0],D[1]),wl(m,d,a,t,r,R[1],D[0]),wl(m,d,a,t,r,R[1],D[1])}}return d}function nc(t,e,r,n,a=1/0){let c=a;const d=Hs(t,[0,t.length-1]);for(const m of r)if(!(c!==1/0&&fa(d,Hs(m,[0,m.length-1]),n)>=c)&&(c=Math.min(c,Ua(t,e,m,!0,n,c)),c===0))return c;return c}function oc(t,e,r,n,a=1/0){let c=a;const d=Hs(t,[0,t.length-1]);for(const m of r){if(c!==1/0&&fa(d,tc(m),n)>=c)continue;const y=ic(t,e,m,n,c);if(isNaN(y))return y;if((c=Math.min(c,y))===0)return c}return c}function ke(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class et{constructor(e,r){this.type=ce,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Zs(e[1])){const n=e[1];if(n.type==="FeatureCollection"){for(let a=0;a<n.features.length;++a)if(ke(n.features[a].geometry.type))return new et(n,n.features[a].geometry)}else if(n.type==="Feature"){if(ke(n.geometry.type))return new et(n,n.geometry)}else if(ke(n.type))return new et(n,n)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),n=e.canonicalID();if(r!=null&&n!=null){if(e.geometryType()==="Point")return function(a,c,d){const m=[];for(const v of a)for(const w of v)m.push(Ps(w,c));const y=new Cs(m[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Ua(m,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y):d.type==="MultiLineString"?nc(m,!1,d.coordinates,y):d.type==="Polygon"||d.type==="MultiPolygon"?oc(m,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,y):null}(r,n,this.geometries);if(e.geometryType()==="LineString")return function(a,c,d){const m=[];for(const v of a){const w=[];for(const S of v)w.push(Ps(S,c));m.push(w)}const y=new Cs(m[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return nc(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",m,y);if(d.type==="MultiLineString"){let v=1/0;for(let w=0;w<d.coordinates.length;w++){const S=nc(d.coordinates[w],!0,m,y,v);if(isNaN(S))return S;if((v=Math.min(v,S))===0)return v}return v}if(d.type==="Polygon"||d.type==="MultiPolygon"){let v=1/0;for(let w=0;w<m.length;w++){const S=oc(m[w],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,y,v);if(isNaN(S))return S;if((v=Math.min(v,S))===0)return v}return v}return null}(r,n,this.geometries);if(e.geometryType()==="Polygon")return function(a,c,d){const m=[];for(const v of function(w,S){const A=w.length;if(A<=1)return[w];const R=[];let D,k;for(let U=0;U<A;U++){const G=id(w[U]);G!==0&&(w[U].area=Math.abs(G),k===void 0&&(k=G<0),k===G<0?(D&&R.push(D),D=[w[U]]):D.push(w[U]))}return D&&R.push(D),R}(a)){const w=[];for(let S=0;S<v.length;++S)w.push(Na(v[S],c));m.push(w)}const y=new Cs(m[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return oc(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",m,y);if(d.type==="MultiLineString"){let v=1/0;for(let w=0;w<d.coordinates.length;w++){const S=oc(d.coordinates[w],!0,m,y,v);if(isNaN(S))return S;if((v=Math.min(v,S))===0)return v}return v}return d.type==="Polygon"||d.type==="MultiPolygon"?function(v,w,S){let A=1/0;for(const R of v)for(const D of w){const k=eh(R,D,S,A);if(isNaN(k))return k;if((A=Math.min(A,k))===0)return A}return A}(d.type==="Polygon"?[d.coordinates]:d.coordinates,m,y):null}(r,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var er=et;function Cr(t,e){switch(t){case"string":return Nn(e);case"number":return+e;case"boolean":return!!e;case"color":return yn.parse(e);case"formatted":return Bn.fromString(Nn(e));case"resolvedImage":return dr.fromString(Nn(e))}return e}function Ji(t,e,r,n){return n!==void 0&&(t=n*Math.round(t/n)),e!==void 0&&t<e&&(t=e),r!==void 0&&t>r&&(t=r),t}class mi{constructor(e,r,n){this.type=e,this.key=r,this.scope=n}static parse(e,r){let n=r.expectedType;if(n==null&&(n=ft),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const a=r.parse(e[1],1);if(!(a instanceof ls))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=r.parse(e[2],2);return c instanceof ls?new mi(n,Nn(a.value),Nn(c.value)):r.error("Scope of 'config' expression must be a string literal.")}return new mi(n,Nn(a.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),n=e.getConfig(r);if(!n)return null;const{type:a,value:c,values:d,minValue:m,maxValue:y,stepValue:v}=n,w=n.default.evaluate(e);let S=w;if(c){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),S=c.evaluate(e),e.scope=A}return a&&(S=Cr(a,S)),S===void 0||m===void 0&&y===void 0&&v===void 0||(typeof S=="number"?S=Ji(S,m,y,v):Array.isArray(S)&&(S=S.map(A=>typeof A=="number"?Ji(A,m,y,v):A))),c!==void 0&&S!==void 0&&d&&!d.includes(S)&&(S=w,a&&(S=Cr(a,S))),(a&&a!==this.type||S!==void 0&&Ln(S)!==this.type)&&(S=Cr(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var Qi=mi;function dn(t){if(t instanceof Kr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ql||t instanceof er)return!1;let e=!0;return t.eachChild(r=>{e&&!dn(r)&&(e=!1)}),e}function xo(t){if(t instanceof Kr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!xo(r)&&(e=!1)}),e}function Mn(t){if(t instanceof Qi)return!1;let e=!0;return t.eachChild(r=>{e&&!Mn(r)&&(e=!1)}),e}function Si(t,e){if(t instanceof Kr&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(n=>{r&&!Si(n,e)&&(r=!1)}),r}class Qn{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Qn(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var An=Qn;class eo{constructor(e,r=[],n,a=new ie,c=[],d,m){this.registry=e,this.path=r,this.key=r.map(y=>`[${y}]`).join(""),this.scope=a,this.errors=c,this.expectedType=n,this._scope=d,this.options=m}parse(e,r,n,a,c={}){return r||n?this.concat(r,n,a)._parse(e,c):this._parse(e,c)}_parse(e,r){function n(a,c,d){return d==="assert"?new cs(c,[a]):d==="coerce"?new us(c,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let c=a.parse(e,this);if(!c)return null;if(this.expectedType){const d=this.expectedType,m=c.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||m.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(d,m))return null}else c=n(c,d,r.typeAnnotation||"coerce");else c=n(c,d,r.typeAnnotation||"assert")}if(!(c instanceof ls)&&c.type.kind!=="resolvedImage"&&Ws(c)){const d=new Xu(this._scope,this.options);try{c=new ls(c.type,c.evaluate(d))}catch(m){return this.error(m.message),null}}return c}return us.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const a=typeof e=="number"?this.path.concat(e):this.path,c=n?this.scope.concat(n):this.scope;return new eo(this.registry,a,r||null,c,this.errors,this._scope,this.options)}error(e,...r){const n=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new C(n,e))}checkSubtype(e,r){const n=mt(e,r);return n&&this.error(n),n}}var fs=eo;function Ws(t){if(t instanceof An)return Ws(t.boundExpression);if(t instanceof Kr&&t.name==="error"||t instanceof Mo||t instanceof Ql||t instanceof er||t instanceof Qi)return!1;const e=t instanceof us||t instanceof cs;let r=!0;return t.eachChild(n=>{r=e?r&&Ws(n):r&&n instanceof ls}),!!r&&dn(t)&&Si(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ps(t,e){const r=t.length-1;let n,a,c=0,d=r,m=0;for(;c<=d;)if(m=Math.floor((c+d)/2),n=t[m],a=t[m+1],n<=e){if(m===r||e<a)return m;c=m+1}else{if(!(n>e))throw new Sn("Input is not a number.");d=m-1}return 0}class Rs{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[a,c]of n)this.labels.push(a),this.outputs.push(c)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,ce);if(!n)return null;const a=[];let c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],y=e[d+1],v=d,w=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(a.length&&a[a.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const S=r.parse(y,w,c);if(!S)return null;c=c||S.type,a.push([m,S])}return new Rs(c,n,a)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const c=r.length;return a>=r[c-1]?n[c-1].evaluate(e):n[ps(r,a)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var Os=Rs;const Jc=.95047,Xs=1.08883,th=4/29,Fi=6/29,Vi=3*Fi*Fi,Tl=Fi*Fi*Fi,Ys=Math.PI/180,Do=180/Math.PI;function bo(t){return t>Tl?Math.pow(t,1/3):t/Vi+th}function Vo(t){return t>Fi?t*t*t:Vi*(t-th)}function ts(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ks(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ja(t){const e=Ks(t.r),r=Ks(t.g),n=Ks(t.b),a=bo((.4124564*e+.3575761*r+.1804375*n)/Jc),c=bo((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-bo((.0193339*e+.119192*r+.9503041*n)/Xs)),alpha:t.a}}function Js(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Vo(e),r=Jc*Vo(r),n=Xs*Vo(n),new yn(ts(3.2404542*r-1.5371385*e-.4985314*n),ts(-.969266*r+1.8760108*e+.041556*n),ts(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Qs(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const _a={forward:ja,reverse:Js,interpolate:function(t,e,r){return{l:Zr(t.l,e.l,r),a:Zr(t.a,e.a,r),b:Zr(t.b,e.b,r),alpha:Zr(t.alpha,e.alpha,r)}}},Ds={forward:function(t){const{l:e,a:r,b:n}=ja(t),a=Math.atan2(n,r)*Do;return{h:a<0?a+360:a,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Ys,r=t.c;return Js({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Qs(t.h,e.h,r),c:Zr(t.c,e.c,r),l:Zr(t.l,e.l,r),alpha:Zr(t.alpha,e.alpha,r)}}};var El=Object.freeze({__proto__:null,hcl:Ds,lab:_a});class ea{constructor(e,r,n,a,c){this.type=e,this.operator=r,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,r,n,a){let c=0;if(e.name==="exponential")c=zs(r,e.base,n,a);else if(e.name==="linear")c=zs(r,1,n,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;c=new hr(d[0],d[1],d[2],d[3]).solve(zs(r,1,n,a))}return c}static parse(e,r){let[n,a,c,...d]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const v=a[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:v}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const v=a.slice(1);if(v.length!==4||v.some(w=>typeof w!="number"||w<0||w>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,ce),!c)return null;const m=[];let y=null;n==="interpolate-hcl"||n==="interpolate-lab"?y=wt:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let v=0;v<d.length;v+=2){const w=d[v],S=d[v+1],A=v+3,R=v+4;if(typeof w!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=w)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const D=r.parse(S,R,y);if(!D)return null;y=y||D.type,m.push([w,D])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new ea(y,n,a,c,m):r.error(`Type ${Tr(y)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);const c=r.length;if(a>=r[c-1])return n[c-1].evaluate(e);const d=ps(r,a),m=ea.interpolationFactor(this.interpolation,a,r[d],r[d+1]),y=n[d].evaluate(e),v=n[d+1].evaluate(e);return this.operator==="interpolate"?Hl[this.type.kind.toLowerCase()](y,v,m):this.operator==="interpolate-hcl"?Ds.reverse(Ds.interpolate(Ds.forward(y),Ds.forward(v),m)):_a.reverse(_a.interpolate(_a.forward(y),_a.forward(v),m))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function zs(t,e,r,n){const a=n-r,c=t-r;return a===0?0:e===1?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)}var Ao=ea;class ks{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const a=r.expectedType;a&&a.kind!=="value"&&(n=a);const c=[];for(const m of e.slice(1)){const y=r.parse(m,1+c.length,n,void 0,{typeAnnotation:"omit"});if(!y)return null;n=n||y.type,c.push(y)}const d=a&&c.some(m=>mt(a,m.type));return new ks(d?ft:n,c)}evaluate(e){let r,n=null,a=0;for(const c of this.args){if(a++,n=c.evaluate(e),n&&n instanceof dr&&!n.available&&(r||(r=n),n=null,a===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Va=ks;class rh{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let c=1;c<e.length-1;c+=2){const d=e[c];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const m=r.parse(e[c+1],c+1);if(!m)return null;n.push([d,m])}const a=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return a?new rh(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}var od=rh;class Ga{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,ce),a=r.parse(e[2],2,Ti(r.expectedType||ft));return n&&a?new Ga(a.type.itemType,n,a):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new Sn(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new Sn(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new Sn(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var oi=Ga;class sd{constructor(e,r){this.type=Se,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,ft),a=r.parse(e[2],2,ft);return n&&a?ht(n.type,[Se,xe,ce,me,ft])?new sd(n,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!Ei(r,["boolean","string","number","null"]))throw new Sn(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Ln(r))} instead.`);if(!Ei(n,["string","array"]))throw new Sn(`Expected second argument to be of type array or string, but found ${Tr(Ln(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var B_=sd;class ih{constructor(e,r,n){this.type=ce,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,ft),a=r.parse(e[2],2,ft);if(!n||!a)return null;if(!ht(n.type,[Se,xe,ce,me,ft]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(n.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,ce);return c?new ih(n,a,c):null}return new ih(n,a)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Ei(r,["boolean","string","number","null"]))throw new Sn(`Expected first argument to be of type boolean, string, number or null, but found ${Tr(Ln(r))} instead.`);if(!Ei(n,["string","array"]))throw new Sn(`Expected second argument to be of type array or string, but found ${Tr(Ln(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(r,a)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var lp=ih;class ad{constructor(e,r,n,a,c,d){this.inputType=e,this.type=r,this.input=n,this.cases=a,this.outputs=c,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c={},d=[];for(let v=2;v<e.length-1;v+=2){let w=e[v];const S=e[v+1];Array.isArray(w)||(w=[w]);const A=r.concat(v);if(w.length===0)return A.error("Expected at least one branch label.");for(const D of w){if(typeof D!="number"&&typeof D!="string")return A.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return A.error("Numeric branch labels must be integer values.");if(n){if(A.checkSubtype(n,Ln(D)))return null}else n=Ln(D);if(c[String(D)]!==void 0)return A.error("Branch labels must be unique.");c[String(D)]=d.length}const R=r.parse(S,v,a);if(!R)return null;a=a||R.type,d.push(R)}const m=r.parse(e[1],1,ft);if(!m)return null;const y=r.parse(e[e.length-1],e.length-1,a);return y?m.type.kind!=="value"&&r.concat(1).checkSubtype(n,m.type)?null:new ad(n,a,m,c,d,y):null}evaluate(e){const r=this.input.evaluate(e);return(Ln(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],a={};for(const d of r){const m=a[this.cases[d]];m===void 0?(a[this.cases[d]]=n.length,n.push([this.cases[d],[d]])):n[m][1].push(d)}const c=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,m]of n)e.push(m.length===1?c(m[0]):m.map(c)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var cp=ad;class nh{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const m=r.parse(e[d],d,Se);if(!m)return null;const y=r.parse(e[d+1],d+1,n);if(!y)return null;a.push([m,y]),n=n||y.type}const c=r.parse(e[e.length-1],e.length-1,n);return c?new nh(n,a,c):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var up=nh;class Qc{constructor(e,r,n,a){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,ft),a=r.parse(e[2],2,ce);if(!n||!a)return null;if(!ht(n.type,[Ti(ft),xe,ft]))return r.error(`Expected first argument to be of type array or string, but found ${Tr(n.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,ce);return c?new Qc(n.type,n,a,c):null}return new Qc(n.type,n,a)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Ei(r,["string","array"]))throw new Sn(`Expected first argument to be of type array or string, but found ${Tr(Ln(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return r.slice(n,a)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var sc=Qc;function ld(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function cd(t,e,r,n){return n.compare(e,r)===0}function ac(t,e,r){const n=t!=="=="&&t!=="!=";return class WE{constructor(c,d,m){this.type=Se,this.lhs=c,this.rhs=d,this.collator=m,this.hasUntypedArgument=c.type.kind==="value"||d.type.kind==="value"}static parse(c,d){if(c.length!==3&&c.length!==4)return d.error("Expected two or three arguments.");const m=c[0];let y=d.parse(c[1],1,ft);if(!y)return null;if(!ld(m,y.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${Tr(y.type)}'.`);let v=d.parse(c[2],2,ft);if(!v)return null;if(!ld(m,v.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${Tr(v.type)}'.`);if(y.type.kind!==v.type.kind&&y.type.kind!=="value"&&v.type.kind!=="value")return d.error(`Cannot compare types '${Tr(y.type)}' and '${Tr(v.type)}'.`);n&&(y.type.kind==="value"&&v.type.kind!=="value"?y=new cs(v.type,[y]):y.type.kind!=="value"&&v.type.kind==="value"&&(v=new cs(y.type,[v])));let w=null;if(c.length===4){if(y.type.kind!=="string"&&v.type.kind!=="string"&&y.type.kind!=="value"&&v.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(w=d.parse(c[3],3,nr),!w)return null}return new WE(y,v,w)}evaluate(c){const d=this.lhs.evaluate(c),m=this.rhs.evaluate(c);if(n&&this.hasUntypedArgument){const y=Ln(d),v=Ln(m);if(y.kind!==v.kind||y.kind!=="string"&&y.kind!=="number")throw new Sn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${v.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const y=Ln(d),v=Ln(m);if(y.kind!=="string"||v.kind!=="string")return e(c,d,m)}return this.collator?r(c,d,m,this.collator.evaluate(c)):e(c,d,m)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const ud=ac("==",function(t,e,r){return e===r},cd),hd=ac("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!cd(0,e,r,n)}),N_=ac("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),U_=ac(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),hp=ac("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),j_=ac(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0});class dd{constructor(e,r,n,a,c,d){this.type=xe,this.number=e,this.locale=r,this.currency=n,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,ce);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=r.parse(a.locale,1,xe),!c))return null;let d=null;if(a.currency&&(d=r.parse(a.currency,1,xe),!d))return null;let m=null;if(a.unit&&(m=r.parse(a.unit,1,xe),!m))return null;let y=null;if(a["min-fraction-digits"]&&(y=r.parse(a["min-fraction-digits"],1,ce),!y))return null;let v=null;return a["max-fraction-digits"]&&(v=r.parse(a["max-fraction-digits"],1,ce),!v)?null:new dd(n,c,d,m,y,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fd{constructor(e){this.type=ce,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Tr(n.type)} instead.`):new fd(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Sn(`Expected value to be of type string or array, but found ${Tr(Ln(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function dp(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const pd={"==":ud,"!=":hd,">":U_,"<":N_,">=":j_,"<=":hp,array:cs,at:oi,boolean:cs,case:up,coalesce:Va,collator:Mo,format:za,image:ua,in:B_,"index-of":lp,interpolate:Ao,"interpolate-hcl":Ao,"interpolate-lab":Ao,length:fd,let:od,literal:ls,match:cp,number:cs,"number-format":dd,object:cs,slice:sc,step:Os,string:cs,"to-boolean":us,"to-color":us,"to-number":us,"to-string":us,var:An,within:Ql,distance:er,config:Qi};function md(t,[e,r,n,a]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const c=a?a.evaluate(t):1,d=on(e,r,n,c);if(d)throw new Sn(d);return new yn(e/255*c,r/255*c,n/255*c,c)}function fp(t,[e,r,n,a]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const c=a?a.evaluate(t):1,d=function(v,w,S,A){return typeof v=="number"&&v>=0&&v<=360?typeof w=="number"&&w>=0&&w<=100&&typeof S=="number"&&S>=0&&S<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[v,w,S,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[v,w,S,A]:[v,w,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[v,w,S,A]:[v,w,S]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,n,c);if(d)throw new Sn(d);const m=`hsla(${e}, ${r}%, ${n}%, ${c})`,y=yn.parse(m);if(!y)throw new Sn(`Failed to parse HSLA color: ${m}`);return y}function _d(t,e){return t in e}function gd(t,e){const r=e[t];return r===void 0?null:r}function Sl(t){return{type:t}}Kr.register(pd,{error:[{kind:"error"},[xe],(t,[e])=>{throw new Sn(e.evaluate(t))}],typeof:[xe,[ft],(t,[e])=>Tr(Ln(e.evaluate(t)))],"to-rgba":[Ti(ce,4),[wt],(t,[e])=>e.evaluate(t).toArray()],rgb:[wt,[ce,ce,ce],md],rgba:[wt,[ce,ce,ce,ce],md],hsl:[wt,[ce,ce,ce],fp],hsla:[wt,[ce,ce,ce,ce],fp],has:{type:Se,overloads:[[[xe],(t,[e])=>_d(e.evaluate(t),t.properties())],[[xe,Ft],(t,[e,r])=>_d(e.evaluate(t),r.evaluate(t))]]},get:{type:ft,overloads:[[[xe],(t,[e])=>gd(e.evaluate(t),t.properties())],[[xe,Ft],(t,[e,r])=>gd(e.evaluate(t),r.evaluate(t))]]},"feature-state":[ft,[xe],(t,[e])=>gd(e.evaluate(t),t.featureState||{})],properties:[Ft,[],t=>t.properties()],"geometry-type":[xe,[],t=>t.geometryType()],id:[ft,[],t=>t.id()],zoom:[ce,[],t=>t.globals.zoom],pitch:[ce,[],t=>t.globals.pitch||0],"distance-from-center":[ce,[],t=>t.distanceFromCenter()],"measure-light":[ce,[xe],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ce,[],t=>t.globals.heatmapDensity||0],"line-progress":[ce,[],t=>t.globals.lineProgress||0],"raster-value":[ce,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[ce,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[ce,[],t=>t.globals.skyRadialProgress||0],accumulated:[ft,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ce,Sl(ce),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[ce,Sl(ce),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:ce,overloads:[[[ce,ce],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[ce],(t,[e])=>-e.evaluate(t)]]},"/":[ce,[ce,ce],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[ce,[ce,ce],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[ce,[],()=>Math.LN2],pi:[ce,[],()=>Math.PI],e:[ce,[],()=>Math.E],"^":[ce,[ce,ce],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[ce,[ce],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ce,[ce],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ce,[ce],(t,[e])=>Math.log(e.evaluate(t))],log2:[ce,[ce],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ce,[ce],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ce,[ce],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ce,[ce],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ce,[ce],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ce,[ce],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ce,[ce],(t,[e])=>Math.atan(e.evaluate(t))],min:[ce,Sl(ce),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[ce,Sl(ce),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[ce,[ce],(t,[e])=>Math.abs(e.evaluate(t))],round:[ce,[ce],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[ce,[ce],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ce,[ce],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Se,[xe,ft],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Se,[ft],(t,[e])=>t.id()===e.value],"filter-type-==":[Se,[xe],(t,[e])=>t.geometryType()===e.value],"filter-<":[Se,[xe,ft],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Se,[ft],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[Se,[xe,ft],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[Se,[ft],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[Se,[xe,ft],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Se,[ft],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[Se,[xe,ft],(t,[e,r])=>{const n=t.properties()[e.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Se,[ft],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[Se,[ft],(t,[e])=>e.value in t.properties()],"filter-has-id":[Se,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Se,[Ti(xe)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Se,[Ti(ft)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Se,[xe,Ti(ft)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Se,[xe,Ti(ft)],(t,[e,r])=>function(n,a,c,d){for(;c<=d;){const m=c+d>>1;if(a[m]===n)return!0;a[m]>n?d=m-1:c=m+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Se,overloads:[[[Se,Se],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Sl(Se),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Se,overloads:[[[Se,Se],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Sl(Se),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Se,[Se],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Se,[xe],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[xe,[xe],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[xe,[xe],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[xe,Sl(ft),(t,e)=>e.map(r=>Nn(r.evaluate(t))).join("")],"resolved-locale":[xe,[nr],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ce,[ce,ce,ft],(t,e)=>{const[r,n,a]=e.map(d=>d.evaluate(t));if(r>n||r===n)return r;let c;if(typeof a=="string")c=function(d){let m=0;if(d.length===0)return m;for(let y=0;y<d.length;y++)m=(m<<5)-m+d.charCodeAt(y),m|=0;return m}(a);else{if(typeof a!="number")throw new Sn(`Invalid seed input: ${a}`);c=a}return r+dp(c)()*(n-r)}]});var lc=pd;function yd(t){return{result:"success",value:t}}function Ml(t){return{result:"error",value:t}}function pp(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function oh(t){return t["property-type"]==="data-driven"}function vd(t){return pp(t.expression,"measure-light")}function mp(t){return pp(t.expression,"zoom")}function xd(t){return!!t.expression&&t.expression.interpolated}function sh(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function _p(t){return t}function bd(t,e){const r=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",a=n||!(n||t.property!==void 0),c=t.type||(xd(e)?"exponential":"interval");if(r&&((t=qc({},t)).stops&&(t.stops=t.stops.map(v=>[v[0],yn.parse(v[1])])),t.default=yn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!El[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,m,y;if(c==="exponential")d=gp;else if(c==="interval")d=G_;else if(c==="categorical"){d=V_,m=Object.create(null);for(const v of t.stops)m[v[0]]=v[1];y=typeof t.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);d=yp}if(n){const v={},w=[];for(let R=0;R<t.stops.length;R++){const D=t.stops[R],k=D[0].zoom;v[k]===void 0&&(v[k]={zoom:k,type:t.type,property:t.property,default:t.default,stops:[]},w.push(k)),v[k].stops.push([D[0].value,D[1]])}const S=[];for(const R of w)S.push([v[R].zoom,bd(v[R],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Ao.interpolationFactor.bind(void 0,A),zoomStops:S.map(R=>R[0]),evaluate:({zoom:R},D)=>gp({stops:S,base:t.base},e,R).evaluate(R,D)}}if(a){const v=c==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:Ao.interpolationFactor.bind(void 0,v),zoomStops:t.stops.map(w=>w[0]),evaluate:({zoom:w})=>d(t,e,w,m,y)}}return{kind:"source",evaluate(v,w){const S=w&&w.properties?w.properties[t.property]:void 0;return S===void 0?eu(t.default,e.default):d(t,e,S,m,y)}}}function eu(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function V_(t,e,r,n,a){return eu(typeof r===a?n[r]:void 0,t.default,e.default)}function G_(t,e,r){if(ka(r)!=="number")return eu(t.default,e.default);const n=t.stops.length;if(n===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const a=ps(t.stops.map(c=>c[0]),r);return t.stops[a][1]}function gp(t,e,r){const n=t.base!==void 0?t.base:1;if(ka(r)!=="number")return eu(t.default,e.default);const a=t.stops.length;if(a===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[a-1][0])return t.stops[a-1][1];const c=ps(t.stops.map(w=>w[0]),r),d=function(w,S,A,R){const D=R-A,k=w-A;return D===0?0:S===1?k/D:(Math.pow(S,k)-1)/(Math.pow(S,D)-1)}(r,n,t.stops[c][0],t.stops[c+1][0]),m=t.stops[c][1],y=t.stops[c+1][1];let v=Hl[e.type]||_p;if(t.colorSpace&&t.colorSpace!=="rgb"){const w=El[t.colorSpace];v=(S,A)=>w.reverse(w.interpolate(w.forward(S),w.forward(A),d))}return typeof m.evaluate=="function"?{evaluate(...w){const S=m.evaluate.apply(void 0,w),A=y.evaluate.apply(void 0,w);if(S!==void 0&&A!==void 0)return v(S,A,d)}}:v(m,y,d)}function yp(t,e,r){return e.type==="color"?r=yn.parse(r):e.type==="formatted"?r=Bn.fromString(r.toString()):e.type==="resolvedImage"?r=dr.fromString(r.toString()):ka(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),eu(r,t.default,e.default)}class ah{constructor(e,r,n,a){this.expression=e,this._warningHistory={},this._evaluator=new Xu(n,a),this._defaultValue=r?function(c){return c.type==="color"&&(sh(c.default)||Array.isArray(c.default))?new yn(0,0,0,0):c.type==="color"?yn.parse(c.default)||null:c.default===void 0?null:c.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,a,c,d,m,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,a,c,d,m,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Sn(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function tu(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in lc}function lh(t,e,r,n){const a=new fs(lc,[],e?function(d){const m={color:wt,string:xe,number:ce,enum:xe,boolean:Se,formatted:qt,resolvedImage:Gr};return d.type==="array"?Ti(m[d.value]||ft,d.length):m[d.type]}(e):void 0,void 0,void 0,r,n),c=a.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?yd(new ah(c,e,r,n)):Ml(a.errors)}class wd{constructor(e,r,n){this.kind=e,this._styleExpression=r,this.isLightConstant=n,this.isStateDependent=e!=="constant"&&!xo(r.expression),this.isConfigDependent=!Mn(r.expression)}evaluateWithoutErrorHandling(e,r,n,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,c,d)}evaluate(e,r,n,a,c,d){return this._styleExpression.evaluate(e,r,n,a,c,d)}}class ru{constructor(e,r,n,a,c){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!xo(r.expression),this.isLightConstant=c,this.isConfigDependent=!Mn(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,n,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,c,d)}evaluate(e,r,n,a,c,d){return this._styleExpression.evaluate(e,r,n,a,c,d)}interpolationFactor(e,r,n){return this.interpolationType?Ao.interpolationFactor(this.interpolationType,e,r,n):0}}function ch(t,e,r,n){if((t=lh(t,e,r,n)).result==="error")return t;const a=t.value.expression,c=dn(a);if(!c&&!oh(e))return Ml([new C("","data expressions not supported")]);const d=Si(a,["zoom","pitch","distance-from-center"]);if(!d&&!mp(e))return Ml([new C("","zoom expressions not supported")]);const m=Si(a,["measure-light"]);if(!m&&!vd(e))return Ml([new C("","measure-light expression not supported")]);const y=e.expression&&e.expression.relaxZoomRestriction,v=nu(a);return v||d||y?v instanceof C?Ml([v]):v instanceof Ao&&!xd(e)?Ml([new C("",'"interpolate" expressions cannot be used with this property')]):yd(v?new ru(c?"camera":"composite",t.value,v.labels,v instanceof Ao?v.interpolation:void 0,m):new wd(c?"constant":"source",t.value,m)):Ml([new C("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class iu{constructor(e,r){this._parameters=e,this._specification=r,qc(this,bd(this._parameters,this._specification))}static deserialize(e){return new iu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function nu(t){let e=null;if(t instanceof od)e=nu(t.result);else if(t instanceof Va){for(const r of t.args)if(e=nu(r),e)break}else(t instanceof Os||t instanceof Ao)&&t.input instanceof Kr&&t.input.name==="zoom"&&(e=t);return e instanceof C||t.eachChild(r=>{const n=nu(r);n instanceof C?e=n:e&&n&&e!==n&&(e=new C("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var $_=Bs,Fs=3;function Bs(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(r=a[2]);for(var c=0;c<this.d*this.d;c++){var d=a[Fs+c],m=a[Fs+c+1];n.push(d===m?null:a.subarray(d,m))}var y=a[Fs+n.length+1];this.keys=a.subarray(a[Fs+n.length],y),this.bboxes=a.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var v=0;v<this.d*this.d;v++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var w=r/e*t;this.min=-w,this.max=t+w}Bs.prototype.insert=function(t,e,r,n,a){this._forEachCell(e,r,n,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(a)},Bs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Bs.prototype._insertCell=function(t,e,r,n,a,c){this.cells[a].push(c)},Bs.prototype.query=function(t,e,r,n,a){var c=this.min,d=this.max;if(t<=c&&e<=c&&d<=r&&d<=n&&!a)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,r,n,this._queryCell,m,{},a),m},Bs.prototype._queryCell=function(t,e,r,n,a,c,d,m){var y=this.cells[a];if(y!==null)for(var v=this.keys,w=this.bboxes,S=0;S<y.length;S++){var A=y[S];if(d[A]===void 0){var R=4*A;(m?m(w[R+0],w[R+1],w[R+2],w[R+3]):t<=w[R+2]&&e<=w[R+3]&&r>=w[R+0]&&n>=w[R+1])?(d[A]=!0,c.push(v[A])):d[A]=!1}}},Bs.prototype._forEachCell=function(t,e,r,n,a,c,d,m){for(var y=this._convertToCellCoord(t),v=this._convertToCellCoord(e),w=this._convertToCellCoord(r),S=this._convertToCellCoord(n),A=y;A<=w;A++)for(var R=v;R<=S;R++){var D=this.d*R+A;if((!m||m(this._convertFromCellCoord(A),this._convertFromCellCoord(R),this._convertFromCellCoord(A+1),this._convertFromCellCoord(R+1)))&&a.call(this,t,e,r,n,D,c,d,m))return}},Bs.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Bs.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Bs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Fs+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var a=new Int32Array(e+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=e,d=0;d<t.length;d++){var m=t[d];a[Fs+d]=c,a.set(m,c),c+=m.length}return a[Fs+t.length]=c,a.set(this.keys,c),a[Fs+t.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};var ga=It($_);const ou={};function Gt(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ou[e]={klass:t,omit:r.omit||[]}}Gt(Object,"Object"),ga.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},ga.deserialize=function(t){return new ga(t.buffer)},Object.defineProperty(ga,"name",{value:"Grid"}),Gt(ga,"Grid"),Gt(yn,"Color"),Gt(Error,"Error"),Gt(Bn,"Formatted"),Gt(hn,"FormattedSection"),Gt(Tn,"AJAXError"),Gt(dr,"ResolvedImage"),Gt(iu,"StylePropertyFunction"),Gt(ah,"StyleExpression",{omit:["_evaluator"]}),Gt(ru,"ZoomDependentExpression"),Gt(wd,"ZoomConstantExpression"),Gt(Kr,"CompoundExpression",{omit:["_evaluate"]});for(const t in lc)ou[lc[t]._classRegistryKey]||Gt(lc[t],`Expression${t}`);function vp(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function uh(t){return self.ImageBitmap&&t instanceof ImageBitmap}function $a(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(vp(t)||uh(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push($a(n,e));return r}if(t instanceof Map){const r={$name:"Map"};for(const[n,a]of t.entries())r[n]=$a(a);return r}if(typeof t=="object"){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const a=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const c in t)t.hasOwnProperty(c)&&(ou[n].omit.indexOf(c)>=0||(a[c]=$a(t[c],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof t)}function Al(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||vp(t)||uh(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(Al);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const a=new Map;for(const c of Object.keys(t))c!=="$name"&&a.set(c,Al(t[c]));return a}const{klass:r}=ou[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const a of Object.keys(t))a!=="$name"&&(n[a]=Al(t[a]));return n}throw new Error("can't deserialize object of type "+typeof t)}const Jt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function qa(t){for(const e of t)if(Td(e.charCodeAt(0)))return!0;return!1}function q_(t){for(const e of t)if(!Z_(e.charCodeAt(0)))return!1;return!0}function Z_(t){return!(Jt.Arabic(t)||Jt["Arabic Supplement"](t)||Jt["Arabic Extended-A"](t)||Jt["Arabic Presentation Forms-A"](t)||Jt["Arabic Presentation Forms-B"](t))}function Td(t){return!(t!==746&&t!==747&&(t<4352||!(Jt["Bopomofo Extended"](t)||Jt.Bopomofo(t)||Jt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Jt["CJK Compatibility Ideographs"](t)||Jt["CJK Compatibility"](t)||Jt["CJK Radicals Supplement"](t)||Jt["CJK Strokes"](t)||!(!Jt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Jt["CJK Unified Ideographs Extension A"](t)||Jt["CJK Unified Ideographs"](t)||Jt["Enclosed CJK Letters and Months"](t)||Jt["Hangul Compatibility Jamo"](t)||Jt["Hangul Jamo Extended-A"](t)||Jt["Hangul Jamo Extended-B"](t)||Jt["Hangul Jamo"](t)||Jt["Hangul Syllables"](t)||Jt.Hiragana(t)||Jt["Ideographic Description Characters"](t)||Jt.Kanbun(t)||Jt["Kangxi Radicals"](t)||Jt["Katakana Phonetic Extensions"](t)||Jt.Katakana(t)&&t!==12540||!(!Jt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Jt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Jt["Unified Canadian Aboriginal Syllabics"](t)||Jt["Unified Canadian Aboriginal Syllabics Extended"](t)||Jt["Vertical Forms"](t)||Jt["Yijing Hexagram Symbols"](t)||Jt["Yi Syllables"](t)||Jt["Yi Radicals"](t))))}function xp(t){return!(Td(t)||function(e){return!!(Jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Jt["Letterlike Symbols"](e)||Jt["Number Forms"](e)||Jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Jt["Control Pictures"](e)&&e!==9251||Jt["Optical Character Recognition"](e)||Jt["Enclosed Alphanumerics"](e)||Jt["Geometric Shapes"](e)||Jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Jt["CJK Symbols and Punctuation"](e)||Jt.Katakana(e)||Jt["Private Use Area"](e)||Jt["CJK Compatibility Forms"](e)||Jt["Small Form Variants"](e)||Jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function bp(t){return t>=1424&&t<=2303||Jt["Arabic Presentation Forms-A"](t)||Jt["Arabic Presentation Forms-B"](t)}function wp(t,e){return!(!e&&bp(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Jt.Khmer(t))}function Ed(t){for(const e of t)if(bp(e.charCodeAt(0)))return!0;return!1}const Sd="deferred",Md="loading",Ad="loaded";let Id=null,Go="unavailable",Za=null;const Tp=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Go="error"),Id&&Id(t)};function Cd(){Pd.fire(new as("pluginStateChange",{pluginStatus:Go,pluginURL:Za}))}const Pd=new No,Ha=function(){return Go},Ld=function(){if(Go!==Sd||!Za)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Go=Md,Cd(),Za&&Xe({url:Za},t=>{t?Tp(t):(Go=Ad,Cd())})},rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Go===Ad||rs.applyArabicShaping!=null,isLoading:()=>Go===Md,setState(t){Go=t.pluginStatus,Za=t.pluginURL},isParsed:()=>rs.applyArabicShaping!=null&&rs.processBidirectionalText!=null&&rs.processStyledBidirectionalText!=null,getPluginURL:()=>Za};class sn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,n){for(const a of r)if(!wp(a.charCodeAt(0),n))return!1;return!0}(e,rs.isLoaded())}}class hh{constructor(e,r,n,a){this.property=e,this.value=r,this.expression=function(c,d,m,y){if(sh(c))return new iu(c,d);if(tu(c)||Array.isArray(c)&&c.length>0){const v=ch(c,d,m,y);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));return v.value}{let v=c;return typeof c=="string"&&d.type==="color"&&(v=yn.parse(c)),{kind:"constant",isConfigDependent:!1,evaluate:()=>v}}}(r===void 0?e.specification.default:r,e.specification,n,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class Rd{constructor(e,r,n){this.property=e,this.value=new hh(e,void 0,r,n)}transitioned(e,r){return new Od(this.property,this.value,r,_r({},e.transition,this.transition),e.now)}untransitioned(){return new Od(this.property,this.value,null,{},0)}}class ya{constructor(e,r,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=n,this.isConfigDependent=!1}getValue(e){return bi(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Rd(this._values[e].property,this._scope,this._options)),this._values[e].value=new hh(this._values[e].property,r===null?void 0:bi(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,r){r&&(this._options=r);const n=this._properties.properties;if(e)for(const a in e){const c=e[a];if(kt(a,"-transition")){const d=a.slice(0,-11);n[d]&&this.setTransition(d,c)}else n[a]&&this.setValue(a,c)}}getTransition(e){return bi(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Rd(this._values[e].property)),this._values[e].transition=bi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){const n=new Il(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,r._values[a]);return n}untransitioned(){const e=new Il(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Od{constructor(e,r,n,a,c){const d=a.delay||0,m=a.duration||0;c=c||0,this.property=e,this.value=r,this.begin=c+d,this.end=this.begin+m,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const a=e.now||0,c=this.value.possiblyEvaluate(e,r,n),d=this.prior;if(d){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return d.possiblyEvaluate(e,r,n);{const m=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,n),c,Ct(m))}}return c}}class Il{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const a=new su(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,r,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class H_{constructor(e,r,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=n,this.isConfigDependent=!1}getValue(e){return bi(this._values[e].value)}setValue(e,r){this._values[e]=new hh(this._values[e].property,r===null?void 0:bi(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const a=new su(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,r,n);return a}}class cc{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,a){return this.property.evaluate(this.value,this.parameters,e,r,n,a)}}class su{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class xt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const a=Hl[this.specification.type];return a?a(e,r,n):e}}class fr{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,a){return new cc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,a)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new cc(this,{kind:"constant",value:void 0},e.parameters);const a=Hl[this.specification.type];return a?new cc(this,{kind:"constant",value:a(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,a,c,d){return e.kind==="constant"?e.value:e.evaluate(r,n,a,c,d)}}class Cl{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){return!!e.expression.evaluate(r,null,{},n,a)}interpolate(){return!1}}class an{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new sn(0,{});for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new hh(a,void 0),d=this.defaultTransitionablePropertyValues[n]=new Rd(a);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate(r)}}}function au(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function lu(t){if(Array.isArray(t))return t.map(lu);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=lu(t[r]);return e}return au(t)}Gt(fr,"DataDrivenProperty"),Gt(xt,"DataConstantProperty"),Gt(Cl,"ColorRampProperty");var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Dd(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Dd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function is(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Dd(t)||(t=cu(t));const r=t;let n=!0;try{n=function(v){if(!uc(v))return v;let w=lu(v);return zd(w),w=Ep(w),w}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const a=Re[`filter_${e}`],c=lh(n,a);let d=null;if(c.result==="error")throw new Error(c.value.map(v=>`${v.key}: ${v.message}`).join(", "));d=(v,w,S)=>c.value.evaluate(v,w,{},S);let m=null,y=null;if(n!==r){const v=lh(r,a);if(v.result==="error")throw new Error(v.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,S,A,R,D)=>v.value.evaluate(w,S,{},A,void 0,void 0,R,D),y=!dn(v.value.expression)}return{filter:d,dynamicFilter:m||void 0,needGeometry:Sp(n),needFeature:!!y}}function Ep(t){if(!Array.isArray(t))return t;const e=function(r){if(W_.has(r[0])){for(let n=1;n<r.length;n++)if(uc(r[n]))return!0}return r}(t);return e===!0?e:e.map(r=>Ep(r))}function zd(t){let e=!1;const r=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||uc(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||uc(t[1]);for(let n=2;n<t.length-1;n+=2)r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||uc(t[1]);for(let n=1;n<t.length-1;n+=2)r.push(t[n+1])}e&&(t.length=0,t.push("any",...r));for(let n=1;n<t.length;n++)zd(t[n])}function uc(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(uc(t[r]))return!0;return!1}const W_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function X_(t,e){return t<e?-1:t>e?1:0}function Sp(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Sp(t[e]))return!0;return!1}function cu(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?uu(t[1],t[2],"=="):e==="!="?hu(uu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?uu(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(cu))):e==="all"?["all"].concat(t.slice(1).map(cu)):e==="none"?["all"].concat(t.slice(1).map(cu).map(hu)):e==="in"?kd(t[1],t.slice(2)):e==="!in"?hu(kd(t[1],t.slice(2))):e==="has"?Mp(t[1]):e!=="!has"||hu(Mp(t[1]));var r}function uu(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function kd(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(X_)]]:["filter-in-small",t,["literal",e]]}}function Mp(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function hu(t){return["!",t]}const dh="";function Fd(t,e){return e?`${t}${dh}${e}`:t}const du="-transition";class $o extends No{constructor(e,r,n,a){if(super(),this.id=e.id,this.fqid=Fd(this.id,n),this.type=e.type,this.scope=n,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new H_(r.layout,this.scope,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new ya(r.paint,this.scope,a);for(const c in e.paint)this.setPaintProperty(c,e.paint[c]);for(const c in e.layout)this.setLayoutProperty(c,e.layout[c]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new su(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,r),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return kt(e,du)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const n=this._transitionablePaint,a=n._properties.properties;if(kt(e,du)){const S=e.slice(0,-11);return a[S]&&n.setTransition(S,r||void 0),!1}if(!a[e])return!1;const c=n._values[e],d=c.value.isDataDriven(),m=c.value;n.setValue(e,r),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const y=n._values[e].value,v=y.isDataDriven(),w=kt(e,"pattern")||e==="line-dasharray";return v||d||w||this._handleOverridablePaintPropertyUpdate(e,m,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return ai({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof cc&&oh(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=is(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const Y_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fh{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xi(t,e=1){let r=0,n=0;return{members:t.map(a=>{const c=Y_[a.type].BYTES_PER_ELEMENT,d=r=fu(r,Math.max(e,c)),m=a.components||1;return n=Math.max(n,c),r+=c*m,{name:a.name,type:a.type,components:m,offset:d}}),size:fu(r,Math.max(n,e)),alignment:e}}function fu(t,e){return Math.ceil(t/e)*e}class Ns extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.int16[a+0]=r,this.int16[a+1]=n,e}}Ns.prototype.bytesPerElement=4,Gt(Ns,"StructArrayLayout2i4");class zo extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const c=3*e;return this.int16[c+0]=r,this.int16[c+1]=n,this.int16[c+2]=a,e}}zo.prototype.bytesPerElement=6,Gt(zo,"StructArrayLayout3i6");class va extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,a)}emplace(e,r,n,a,c){const d=4*e;return this.int16[d+0]=r,this.int16[d+1]=n,this.int16[d+2]=a,this.int16[d+3]=c,e}}va.prototype.bytesPerElement=8,Gt(va,"StructArrayLayout4i8");class Bd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,a,c)}emplace(e,r,n,a,c,d){const m=5*e;return this.int16[m+0]=r,this.int16[m+1]=n,this.int16[m+2]=a,this.int16[m+3]=c,this.int16[m+4]=d,e}}Bd.prototype.bytesPerElement=10,Gt(Bd,"StructArrayLayout5i10");class Nd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,c,d,m)}emplace(e,r,n,a,c,d,m,y){const v=6*e,w=12*e,S=3*e;return this.int16[v+0]=r,this.int16[v+1]=n,this.uint8[w+4]=a,this.uint8[w+5]=c,this.uint8[w+6]=d,this.uint8[w+7]=m,this.float32[S+2]=y,e}}Nd.prototype.bytesPerElement=12,Gt(Nd,"StructArrayLayout2i4ub1f12");class Wa extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,a)}emplace(e,r,n,a,c){const d=4*e;return this.float32[d+0]=r,this.float32[d+1]=n,this.float32[d+2]=a,this.float32[d+3]=c,e}}Wa.prototype.bytesPerElement=16,Gt(Wa,"StructArrayLayout4f16");class Xa extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,a,c)}emplace(e,r,n,a,c,d){const m=6*e,y=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=n,this.uint16[m+2]=a,this.uint16[m+3]=c,this.float32[y+2]=d,e}}Xa.prototype.bytesPerElement=12,Gt(Xa,"StructArrayLayout4ui1f12");class hc extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,a)}emplace(e,r,n,a,c){const d=4*e;return this.uint16[d+0]=r,this.uint16[d+1]=n,this.uint16[d+2]=a,this.uint16[d+3]=c,e}}hc.prototype.bytesPerElement=8,Gt(hc,"StructArrayLayout4ui8");class ph extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,c,d)}emplace(e,r,n,a,c,d,m){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=a,this.int16[y+3]=c,this.int16[y+4]=d,this.int16[y+5]=m,e}}ph.prototype.bytesPerElement=12,Gt(ph,"StructArrayLayout6i12");class pu extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m,y,v,w,S,A){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,n,a,c,d,m,y,v,w,S,A)}emplace(e,r,n,a,c,d,m,y,v,w,S,A,R){const D=12*e;return this.int16[D+0]=r,this.int16[D+1]=n,this.int16[D+2]=a,this.int16[D+3]=c,this.uint16[D+4]=d,this.uint16[D+5]=m,this.uint16[D+6]=y,this.uint16[D+7]=v,this.int16[D+8]=w,this.int16[D+9]=S,this.int16[D+10]=A,this.int16[D+11]=R,e}}pu.prototype.bytesPerElement=24,Gt(pu,"StructArrayLayout4i4ui4i24");class Ud extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,c,d)}emplace(e,r,n,a,c,d,m){const y=10*e,v=5*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=a,this.float32[v+2]=c,this.float32[v+3]=d,this.float32[v+4]=m,e}}Ud.prototype.bytesPerElement=20,Gt(Ud,"StructArrayLayout3i3f20");class jd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}jd.prototype.bytesPerElement=4,Gt(jd,"StructArrayLayout1ul4");class ta extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=n,e}}ta.prototype.bytesPerElement=4,Gt(ta,"StructArrayLayout2ui4");class Vd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m,y,v,w,S,A,R){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,n,a,c,d,m,y,v,w,S,A,R)}emplace(e,r,n,a,c,d,m,y,v,w,S,A,R,D){const k=20*e,U=10*e;return this.int16[k+0]=r,this.int16[k+1]=n,this.int16[k+2]=a,this.int16[k+3]=c,this.int16[k+4]=d,this.float32[U+3]=m,this.float32[U+4]=y,this.float32[U+5]=v,this.float32[U+6]=w,this.int16[k+14]=S,this.uint32[U+8]=A,this.uint16[k+18]=R,this.uint16[k+19]=D,e}}Vd.prototype.bytesPerElement=40,Gt(Vd,"StructArrayLayout5i4f1i1ul2ui40");class mu extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,c,d,m)}emplace(e,r,n,a,c,d,m,y){const v=8*e;return this.int16[v+0]=r,this.int16[v+1]=n,this.int16[v+2]=a,this.int16[v+4]=c,this.int16[v+5]=d,this.int16[v+6]=m,this.int16[v+7]=y,e}}mu.prototype.bytesPerElement=16,Gt(mu,"StructArrayLayout3i2i2i16");class mh extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,a,c)}emplace(e,r,n,a,c,d){const m=4*e,y=8*e;return this.float32[m+0]=r,this.float32[m+1]=n,this.float32[m+2]=a,this.int16[y+6]=c,this.int16[y+7]=d,e}}mh.prototype.bytesPerElement=16,Gt(mh,"StructArrayLayout2f1f2i16");class Gd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,a)}emplace(e,r,n,a,c){const d=12*e,m=3*e;return this.uint8[d+0]=r,this.uint8[d+1]=n,this.float32[m+1]=a,this.float32[m+2]=c,e}}Gd.prototype.bytesPerElement=12,Gt(Gd,"StructArrayLayout2ub2f12");class Hn extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const c=3*e;return this.uint16[c+0]=r,this.uint16[c+1]=n,this.uint16[c+2]=a,e}}Hn.prototype.bytesPerElement=6,Gt(Hn,"StructArrayLayout3ui6");class dc extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue)}emplace(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue,le){const pe=30*e,be=15*e,Ie=60*e;return this.int16[pe+0]=r,this.int16[pe+1]=n,this.int16[pe+2]=a,this.float32[be+2]=c,this.float32[be+3]=d,this.uint16[pe+8]=m,this.uint16[pe+9]=y,this.uint32[be+5]=v,this.uint32[be+6]=w,this.uint32[be+7]=S,this.uint16[pe+16]=A,this.uint16[pe+17]=R,this.uint16[pe+18]=D,this.float32[be+10]=k,this.float32[be+11]=U,this.uint8[Ie+48]=G,this.uint8[Ie+49]=Y,this.uint8[Ie+50]=te,this.uint32[be+13]=ee,this.int16[pe+28]=ue,this.uint8[Ie+58]=le,e}}dc.prototype.bytesPerElement=60,Gt(dc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _h extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue,le,pe,be,Ie,ze,Pe,qe,Qe,Ve,Je,Ne){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue,le,pe,be,Ie,ze,Pe,qe,Qe,Ve,Je,Ne)}emplace(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue,le,pe,be,Ie,ze,Pe,qe,Qe,Ve,Je,Ne,Ke){const Et=20*e,tt=40*e,Xt=80*e;return this.float32[Et+0]=r,this.float32[Et+1]=n,this.int16[tt+4]=a,this.int16[tt+5]=c,this.int16[tt+6]=d,this.int16[tt+7]=m,this.int16[tt+8]=y,this.int16[tt+9]=v,this.int16[tt+10]=w,this.int16[tt+11]=S,this.int16[tt+12]=A,this.uint16[tt+13]=R,this.uint16[tt+14]=D,this.uint16[tt+15]=k,this.uint16[tt+16]=U,this.uint16[tt+17]=G,this.uint16[tt+18]=Y,this.uint16[tt+19]=te,this.uint16[tt+20]=ee,this.uint16[tt+21]=ue,this.uint16[tt+22]=le,this.uint16[tt+23]=pe,this.uint16[tt+24]=be,this.uint16[tt+25]=Ie,this.uint16[tt+26]=ze,this.uint16[tt+27]=Pe,this.uint32[Et+14]=qe,this.float32[Et+15]=Qe,this.float32[Et+16]=Ve,this.float32[Et+17]=Je,this.float32[Et+18]=Ne,this.uint8[Xt+76]=Ke,e}}_h.prototype.bytesPerElement=80,Gt(_h,"StructArrayLayout2f9i15ui1ul4f1ub80");class _u extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}_u.prototype.bytesPerElement=4,Gt(_u,"StructArrayLayout1f4");class Ya extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,a,c)}emplace(e,r,n,a,c,d){const m=5*e;return this.float32[m+0]=r,this.float32[m+1]=n,this.float32[m+2]=a,this.float32[m+3]=c,this.float32[m+4]=d,e}}Ya.prototype.bytesPerElement=20,Gt(Ya,"StructArrayLayout5f20");class $d extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,c,d,m)}emplace(e,r,n,a,c,d,m,y){const v=7*e;return this.float32[v+0]=r,this.float32[v+1]=n,this.float32[v+2]=a,this.float32[v+3]=c,this.float32[v+4]=d,this.float32[v+5]=m,this.float32[v+6]=y,e}}$d.prototype.bytesPerElement=28,Gt($d,"StructArrayLayout7f28");class gu extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n,a)}emplace(e,r,n,a,c){const d=6*e;return this.uint32[3*e+0]=r,this.uint16[d+2]=n,this.uint16[d+3]=a,this.uint16[d+4]=c,e}}gu.prototype.bytesPerElement=12,Gt(gu,"StructArrayLayout1ul3ui12");class qd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}qd.prototype.bytesPerElement=2,Gt(qd,"StructArrayLayout1ui2");class Pl extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){const c=3*e;return this.float32[c+0]=r,this.float32[c+1]=n,this.float32[c+2]=a,e}}Pl.prototype.bytesPerElement=12,Gt(Pl,"StructArrayLayout3f12");class yu extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const a=2*e;return this.float32[a+0]=r,this.float32[a+1]=n,e}}yu.prototype.bytesPerElement=8,Gt(yu,"StructArrayLayout2f8");class Zd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U){const G=this.length;return this.resize(G+1),this.emplace(G,e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U)}emplace(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G){const Y=16*e;return this.float32[Y+0]=r,this.float32[Y+1]=n,this.float32[Y+2]=a,this.float32[Y+3]=c,this.float32[Y+4]=d,this.float32[Y+5]=m,this.float32[Y+6]=y,this.float32[Y+7]=v,this.float32[Y+8]=w,this.float32[Y+9]=S,this.float32[Y+10]=A,this.float32[Y+11]=R,this.float32[Y+12]=D,this.float32[Y+13]=k,this.float32[Y+14]=U,this.float32[Y+15]=G,e}}Zd.prototype.bytesPerElement=64,Gt(Zd,"StructArrayLayout16f64");class vu extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,c,d,m)}emplace(e,r,n,a,c,d,m,y){const v=10*e,w=5*e;return this.uint16[v+0]=r,this.uint16[v+1]=n,this.uint16[v+2]=a,this.uint16[v+3]=c,this.float32[w+2]=d,this.float32[w+3]=m,this.float32[w+4]=y,e}}vu.prototype.bytesPerElement=20,Gt(vu,"StructArrayLayout4ui3f20");class Hd extends Xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Hd.prototype.bytesPerElement=1,Gt(Hd,"StructArrayLayout1ub1");class Ap extends fh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ap.prototype.size=40;class Ip extends Vd{get(e){return new Ap(this,e)}}Gt(Ip,"CollisionBoxArray");class Cp extends fh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Cp.prototype.size=60;class Pp extends dc{get(e){return new Cp(this,e)}}Gt(Pp,"PlacedSymbolArray");class Lp extends fh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Lp.prototype.size=80;class Rp extends _h{get(e){return new Lp(this,e)}}Gt(Rp,"SymbolInstanceArray");class Op extends _u{getoffsetX(e){return this.float32[1*e+0]}}Gt(Op,"GlyphOffsetArray");class xu extends Ns{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Gt(xu,"SymbolLineVertexArray");class Dp extends fh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Dp.prototype.size=12;class zp extends gu{get(e){return new Dp(this,e)}}Gt(zp,"FeatureIndexArray");class bu extends ta{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Gt(bu,"FillExtrusionCentroidArray");const K_=xi([{name:"a_pos",components:2,type:"Int16"}],4),kp=xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class vn{constructor(e=[]){this.segments=e}_prepareSegment(e,r,n,a){let c=this.segments[this.segments.length-1];return e>vn.MAX_VERTEX_ARRAY_LENGTH&&ve(`Max vertices per segment is ${vn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>vn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:r,primitiveOffset:n,vertexLength:0,primitiveLength:0},a!==void 0&&(c.sortKey=a),this.segments.push(c)),c}prepareSegment(e,r,n,a){return this._prepareSegment(e,r.length,n.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,a){return new vn([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}function Wd(t,e){return 256*(t=Zt(Math.floor(t),0,255))+Zt(Math.floor(e),0,255)}vn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gt(vn,"SegmentVector");const Fp=xi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Bp=xi([{name:"a_dash",components:4,type:"Uint16"}]);var wu={exports:{}},gh={exports:{}};(function(t){t.exports=function(e,r){var n,a,c,d,m,y,v,w;for(a=e.length-(n=3&e.length),c=r,m=3432918353,y=461845907,w=0;w<a;)v=255&e.charCodeAt(w)|(255&e.charCodeAt(++w))<<8|(255&e.charCodeAt(++w))<<16|(255&e.charCodeAt(++w))<<24,++w,c=27492+(65535&(d=5*(65535&(c=(c^=v=(65535&(v=(v=(65535&v)*m+(((v>>>16)*m&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(v=0,n){case 3:v^=(255&e.charCodeAt(w+2))<<16;case 2:v^=(255&e.charCodeAt(w+1))<<8;case 1:c^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(w)))*m+(((v>>>16)*m&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}})(gh);var Xd=gh.exports,Np={exports:{}};(function(t){t.exports=function(e,r){for(var n,a=e.length,c=r^a,d=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}})(Np);var Up=Xd,jp=Np.exports;wu.exports=Up,wu.exports.murmur3=Up,wu.exports.murmur2=jp;var Yd=It(wu.exports);class Tu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,n,a){this.ids.push(Vp(e)),this.positions.push(r,n,a)}eachPosition(e,r){const n=Vp(e);let a=0,c=this.ids.length-1;for(;a<c;){const d=a+c>>1;this.ids[d]>=n?c=d:a=d+1}for(;this.ids[a]===n;)r(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,r){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Kd(n,a,0,n.length-1),r&&(r.add(n.buffer),r.add(a.buffer)),{ids:n,positions:a}}static deserialize(e){const r=new Tu;let n;r.ids=e.ids,r.positions=e.positions;for(const a of r.ids)a!==n&&r.uniqueIds.push(a),n=a;return r.indexed=!0,r}}function Vp(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Yd(String(t))}function Kd(t,e,r,n){for(;r<n;){const a=t[r+n>>1];let c=r-1,d=n+1;for(;;){do c++;while(t[c]<a);do d--;while(t[d]>a);if(c>=d)break;yh(t,c,d),yh(e,3*c,3*d),yh(e,3*c+1,3*d+1),yh(e,3*c+2,3*d+2)}d-r<n-d?(Kd(t,e,r,d),r=d+1):(Kd(t,e,d+1,n),n=d)}}function yh(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}Gt(Tu,"FeaturePositionMap");class xa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class vh extends xa{constructor(e){super(e),this.current=0}set(e,r,n){this.fetchUniformLocation(e,r)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class Io extends xa{constructor(e){super(e),this.current=0}set(e,r,n){this.fetchUniformLocation(e,r)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Ka extends xa{constructor(e){super(e),this.current=[0,0]}set(e,r,n){this.fetchUniformLocation(e,r)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class Gp extends xa{constructor(e){super(e),this.current=[0,0,0]}set(e,r,n){this.fetchUniformLocation(e,r)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class u extends xa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,n){this.fetchUniformLocation(e,r)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class i extends xa{constructor(e){super(e),this.current=yn.transparent}set(e,r,n){this.fetchUniformLocation(e,r)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const o=new Float32Array(16);class h extends xa{constructor(e){super(e),this.current=o}set(e,r,n){if(this.fetchUniformLocation(e,r)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const p=new Float32Array(9),_=new Float32Array(4);class x extends xa{constructor(e){super(e),this.current=_}set(e,r,n){if(this.fetchUniformLocation(e,r)){for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}}function T(t){return[Wd(255*t.r,255*t.g),Wd(255*t.b,255*t.a)]}class M{constructor(e,r,n){this.value=e,this.uniformNames=r.map(a=>`u_${a}`),this.type=n}setUniform(e,r,n,a,c){r.set(e,c,a.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new i(e):new Io(e)}}class I{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,n,a,c){const d=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;d&&r.set(e,c,d)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new u(e):new Io(e)}}class L{constructor(e,r,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,n,a,c,d,m){const y=this.paintVertexArray.length,v=this.expression.evaluate(new sn(0,{brightness:d}),r,{},c,a,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,r,n,a,c,d,m){const y=this.expression.evaluate({zoom:0,brightness:m},n,a,void 0,c);this._setPaintValue(e,r,y)}_setPaintValue(e,r,n){if(this.type==="color"){const a=T(n);for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=e;a<r;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class O{constructor(e,r,n,a,c,d){this.expression=e,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,n,a,c,d,m){const y=this.expression.evaluate(new sn(this.zoom,{brightness:d}),r,{},c,a,m),v=this.expression.evaluate(new sn(this.zoom+1,{brightness:d}),r,{},c,a,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,v)}updatePaintArray(e,r,n,a,c,d,m){const y=this.expression.evaluate({zoom:this.zoom,brightness:m},n,a,void 0,c),v=this.expression.evaluate({zoom:this.zoom+1,brightness:m},n,a,void 0,c);this._setPaintValue(e,r,y,v)}_setPaintValue(e,r,n,a){if(this.type==="color"){const c=T(n),d=T(a);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,c[0],c[1],d[0],d[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,n,a,c){const d=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,m=Zt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(e,c,m)}getBinding(e,r){return new Io(e)}}class F{constructor(e,r,n,a,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(n==="array"?Bp:Fp).members;for(let d=0;d<r.length;++d);this.paintVertexArray=new a}populatePaintArray(e,r,n){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,a,c,d,m){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],d)}_setPaintValues(e,r,n,a){if(!a||!n)return;const c=a[n];if(!c)return;const{tl:d,br:m,pixelRatio:y}=c;for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,d[0],d[1],m[0],m[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class N{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const c in e.paint._values){const d=e.paint.get(c);if(!n(c)||!(d instanceof cc&&oh(d.property.specification)))continue;const m=Z(c,e.type),y=d.value,v=d.property.specification.type,w=!!d.property.useIntegerZoom,S=c==="line-dasharray"||c.endsWith("pattern"),A=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||A)if(y.kind==="source"||A||S){const R=ne(c,v,"source");this.binders[c]=S?new F(y,m,v,R,e.id):new L(y,m,v,R),a.push(`/a_${c}`)}else{const R=ne(c,v,"composite");this.binders[c]=new O(y,m,v,w,r,R),a.push(`/z_${c}`)}else this.binders[c]=S?new I(y.value,m):new M(y.value,m,v),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof L||r instanceof O?r.maxValue:0}populatePaintArrays(e,r,n,a,c,d,m){for(const y in this.binders){const v=this.binders[y];(v instanceof L||v instanceof O||v instanceof F)&&v.populatePaintArray(e,r,n,a,c,d,m)}}setConstantPatternPositions(e){for(const r in this.binders){const n=this.binders[r];n instanceof I&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,r,n,a,c,d,m,y){let v=!1;const w=Object.keys(e),S=w.length!==0,A=S?w:r.uniqueIds;for(const R in this.binders){const D=this.binders[R];if((D instanceof L||D instanceof O||D instanceof F)&&(D.expression.isStateDependent===!0||D.expression.isLightConstant===!1)){const k=c.paint.get(R);D.expression=k.value;for(const U of A){const G=e[U.toString()];r.eachPosition(U,(Y,te,ee)=>{const ue=a.feature(Y);D.updatePaintArray(te,ee,ue,G,d,m,y)})}if(!S)for(const U of n.uniqueIds){const G=e[U.toString()];n.eachPosition(U,(Y,te,ee)=>{const ue=a.feature(Y);D.updatePaintArray(te,ee,ue,G,d,m,y)})}v=!0}}return v}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof M||n instanceof I)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof L||n instanceof O||n instanceof F)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof M||n instanceof I||n instanceof O)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof M||a instanceof I||a instanceof O)for(const c of a.uniformNames)r.push({name:c,property:n,binding:a.getBinding(e,c)})}return r}setUniforms(e,r,n,a,c){for(const{name:d,property:m,binding:y}of n)this.binders[m].setUniform(e,y,c,a.get(m),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof L||r instanceof O||r instanceof F)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof L||n instanceof O||n instanceof F)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof L||r instanceof O||r instanceof F)&&r.destroy()}}}class q{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new N(a,r,n);this.needsUpload=!1,this._featureMap=new Tu,this._featureMapWithoutIds=new Tu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,n,a,c,d,m,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,a,c,d,m,y);r.id!==void 0?this._featureMap.add(r.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,a,c,d){for(const m of n)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,m,a,c,d||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const $={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Z(t,e){return $[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const V={"line-pattern":{source:Xa,composite:Xa},"fill-pattern":{source:Xa,composite:Xa},"fill-extrusion-pattern":{source:Xa,composite:Xa},"line-dasharray":{source:hc,composite:hc}},X={color:{source:yu,composite:Wa},number:{source:_u,composite:yu}};function ne(t,e,r){const n=V[t];return n&&n[r]||X[e][r]}Gt(M,"ConstantBinder"),Gt(I,"PatternConstantBinder"),Gt(L,"SourceExpressionBinder"),Gt(F,"PatternCompositeBinder"),Gt(O,"CompositeExpressionBinder"),Gt(N,"ProgramConfiguration",{omit:["_buffers"]}),Gt(q,"ProgramConfigurationSet");const J=Mt/Math.PI/2,oe=5,H=6,ae=16383,he=64,fe=[he,32,16],ye=-J,De=J;function Te(t,e,r,n=J){return r=br(r),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function $e(t,e,r){return Te(Math.cos(br(t)),Math.sin(br(t)),e,r)}const je=63710088e-1,it=2*Math.PI*je;class Ae{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ae(kn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,a=e.lat*r,c=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return je*Math.acos(Math.min(c,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new Be({lng:this.lng-n,lat:this.lat-r},{lng:this.lng+n,lat:this.lat+r})}toEcef(e){return $e(this.lat,this.lng,J+e*J/je)}static convert(e){if(e instanceof Ae)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ae(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ae(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Be{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Ae?new Ae(e.lng,e.lat):Ae.convert(e),this}setSouthWest(e){return this._sw=e instanceof Ae?new Ae(e.lng,e.lat):Ae.convert(e),this}extend(e){const r=this._sw,n=this._ne;let a,c;if(e instanceof Ae)a=e,c=e;else{if(!(e instanceof Be))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Be.convert(e)):this.extend(Ae.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Ae.convert(e)):this;if(a=e._sw,c=e._ne,!a||!c)return this}return r||n?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),n.lng=Math.max(c.lng,n.lng),n.lat=Math.max(c.lat,n.lat)):(this._sw=new Ae(a.lng,a.lat),this._ne=new Ae(c.lng,c.lat)),this}getCenter(){return new Ae((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ae(this.getWest(),this.getNorth())}getSouthEast(){return new Ae(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=Ae.convert(e);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Be?e:new Be(e)}}var _e={};(function(t,e){(function(r){function n(c,d,m){var y=a(256*c,256*(d=Math.pow(2,m)-d-1),m),v=a(256*(c+1),256*(d+1),m);return y[0]+","+y[1]+","+v[0]+","+v[1]}function a(c,d,m){var y=2*Math.PI*6378137/256/Math.pow(2,m);return[c*y-2*Math.PI*6378137/2,d*y-2*Math.PI*6378137/2]}r.getURL=function(c,d,m,y,v,w){return w=w||{},c+"?"+["bbox="+n(m,y,v),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+d].join("&")},r.getTileBBox=n,r.getMercCoords=a,Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,_e);var Le=_e;class ot{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=Ot(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=Le.getTileBBox(this.x,this.y,this.z),a=function(c,d,m){let y,v="";for(let w=c;w>0;w--)y=1<<w-1,v+=(d&y?1:0)+(m&y?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class vt{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Ot(e,r.z,r.z,r.x,r.y)}}class _t{constructor(e,r,n,a,c){this.overscaledZ=e,this.wrap=r,this.canonical=new ot(n,+a,+c),this.key=r===0&&e===n?this.canonical.key:Ot(r,e,n,a,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new _t(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _t(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Ot(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Ot(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new _t(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new _t(r,this.wrap,r,n,a),new _t(r,this.wrap,r,n+1,a),new _t(r,this.wrap,r,n,a+1),new _t(r,this.wrap,r,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new _t(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new _t(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new vt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ot(t,e,r,n,a){const c=1<<Math.min(r,22);let d=c*(a%c)+n%c;return t&&r<22&&(d+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*d+r)+(e-r)}const Kt=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new _t(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new _t(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new _t(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new _t(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Gt(ot,"CanonicalTileID"),Gt(_t,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ur=0,tr=25.5;function ar(t){return it*Math.cos(t*Math.PI/180)}function Br(t){return(180+t)/360}function Mr(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Or(t,e){return t/ar(e)}function Lr(t){return 360*t-180}function ri(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Bi(t,e){return t*ar(ri(e))}const Hr=85.051129;function ln(t){return Math.cos(br(Zt(t,-Hr,Hr)))}function Wr(t,e){const r=Zt(e,ur,tr),n=Math.pow(2,r);return ln(t)*it/(512*n)}function li(t){return 1/Math.cos(t*Math.PI/180)}function Xr(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/Mt)/(1<<t.z)*2));return 80150034*r/(r*r+1)/Mt/(1<<t.z)}class si{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=Ae.convert(e);return new si(Br(n.lng),Mr(n.lat),Or(r,n.lat))}toLngLat(){return new Ae(Lr(this.x),ri(this.y))}toAltitude(){return Bi(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/it*li(ri(this.y))}}function qi(t,e,r,n,a,c,d,m,y){const v=(e+n)/2,w=(r+a)/2,S=new dt(v,w);m(S),function(A,R,D,k,U,G){const Y=D-U,te=k-G;return Math.abs((k-R)*Y-(D-A)*te)/Math.hypot(Y,te)}(S.x,S.y,c.x,c.y,d.x,d.y)>=y?(qi(t,e,r,v,w,c,S,m,y),qi(t,v,w,n,a,S,d,m,y)):t.push(d)}function pi(t,e,r){let n=t[0],a=n.x,c=n.y;e(n);const d=[n];for(let m=1;m<t.length;m++){const y=t[m],{x:v,y:w}=y;e(y),qi(d,a,c,v,w,n,y,e,r),a=v,c=w,n=y}return d}function Wn(t,e,r,n){if(n(e,r)){const a=e.add(r)._mult(.5);Wn(t,e,a,n),Wn(t,a,r,n)}else t.push(r)}function ho(t,e){let r=t[0];const n=[r];for(let a=1;a<t.length;a++){const c=t[a];Wn(n,r,c,e),r=c}return n}const qo=Math.pow(2,14)-1,ra=-qo-1;function Zo(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Zt(r,ra,qo),t.y=Zt(n,ra,qo),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&ve("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Xn(t,e,r){const n=t.loadGeometry(),a=t.extent,c=Mt/a;if(e&&r&&r.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:m,x:y,y:v,projection:w}=r,S=A=>{const R=Lr((e.x+A.x/a)/d),D=ri((e.y+A.y/a)/d),k=w.project(R,D);A.x=(k.x*m-y)*a,A.y=(k.y*m-v)*a};for(let A=0;A<n.length;A++)if(t.type!==1)n[A]=pi(n[A],S,1);else{const R=[];for(const D of n[A])D.x<0||D.x>=a||D.y<0||D.y>=a||(S(D),R.push(D));n[A]=R}}for(const d of n)for(const m of d)Zo(m,c);return n}function Un(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Xn(t):[]}}function Co(t,e,r,n,a){t.emplaceBack(2*e+(n+1)/2,2*r+(a+1)/2)}function ko(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ho{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ns,this.indexArray=new Hn,this.segments=new vn,this.programConfigurations=new q(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){const c=this.layers[0],d=[];let m=null;c.type==="circle"&&(m=c.layout.get("circle-sort-key"));for(const{feature:v,id:w,index:S,sourceLayerIndex:A}of e){const R=this.layers[0]._featureFilter.needGeometry,D=Un(v,R);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),D,n))continue;const k=m?m.evaluate(D,{},n):void 0,U={id:w,properties:v.properties,type:v.type,sourceLayerIndex:A,index:S,geometry:R?D.geometry:Xn(v,n,a),patterns:{},sortKey:k};d.push(U)}m&&d.sort((v,w)=>v.sortKey-w.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new ph,y=a.projection);for(const v of d){const{geometry:w,index:S,sourceLayerIndex:A}=v,R=e[S].feature;this.addFeature(v,w,S,r.availableImages,n,y,r.brightness),r.featureIndex.insert(R,w,S,A,this.index)}}update(e,r,n,a,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,d?this.stateDependentLayers:this.layers,n,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,n,a,c,d,m){for(const y of r)for(const v of y){const w=v.x,S=v.y;if(w<0||w>=Mt||S<0||S>=Mt)continue;if(d){const D=d.projectTilePoint(w,S,c),k=d.upVector(c,w,S),U=this.globeExtVertexArray;ko(U,D,k),ko(U,D,k),ko(U,D,k),ko(U,D,k)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=A.vertexLength;Co(this.layoutVertexArray,w,S,-1,-1),Co(this.layoutVertexArray,w,S,1,-1),Co(this.layoutVertexArray,w,S,1,1),Co(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,c,m)}}function ia(t,e){for(let r=0;r<t.length;r++)if(ba(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(ba(t,e[r]))return!0;return!!Su(t,e)}function Ja(t,e,r){return!!ba(t,e)||!!Mu(e,t,r)}function Ll(t,e){if(t.length===1)return xh(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let a=0;a<n.length;a++)if(ba(t,n[a]))return!0}for(let r=0;r<t.length;r++)if(xh(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Su(t,e[r]))return!0;return!1}function Eu(t,e,r){if(t.length>1){if(Su(t,e))return!0;for(let n=0;n<e.length;n++)if(Mu(e[n],t,r))return!0}for(let n=0;n<t.length;n++)if(Mu(t[n],e,r))return!0;return!1}function Su(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const n=t[r],a=t[r+1];for(let c=0;c<e.length-1;c++)if(Jd(n,a,e[c],e[c+1]))return!0}return!1}function Jd(t,e,r,n){return We(t,r,n)!==We(e,r,n)&&We(t,e,r)!==We(t,e,n)}function Mu(t,e,r){const n=r*r;if(e.length===1)return t.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(fc(t,e[a-1],e[a])<n)return!0;return!1}function fc(t,e,r){const n=e.distSqr(r);if(n===0)return t.distSqr(e);const a=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function xh(t,e){let r,n,a,c=!1;for(let d=0;d<t.length;d++){r=t[d];for(let m=0,y=r.length-1;m<r.length;y=m++)n=r[m],a=r[y],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(c=!c)}return c}function ba(t,e){let r=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){const c=t[n],d=t[a];c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(r=!r)}return r}function D0(t,e,r,n,a){for(const d of t)if(e<=d.x&&r<=d.y&&n>=d.x&&a>=d.y)return!0;const c=[new dt(e,r),new dt(e,a),new dt(n,a),new dt(n,r)];if(t.length>2){for(const d of c)if(ba(t,d))return!0}for(let d=0;d<t.length-1;d++)if(nM(t[d],t[d+1],c))return!0;return!1}function nM(t,e,r){const n=r[0],a=r[2];if(t.x<n.x&&e.x<n.x||t.x>a.x&&e.x>a.x||t.y<n.y&&e.y<n.y||t.y>a.y&&e.y>a.y)return!1;const c=We(t,e,r[0]);return c!==We(t,e,r[1])||c!==We(t,e,r[2])||c!==We(t,e,r[3])}function bh(t,e,r,n,a,c){let d=e.y-t.y,m=t.x-e.x;if(c=c||0){const y=d*d+m*m;if(y===0)return!0;const v=Math.sqrt(y);d/=v,m/=v}return!((r.x-t.x)*d+(r.y-t.y)*m-c<0||(n.x-t.x)*d+(n.y-t.y)*m-c<0||(a.x-t.x)*d+(a.y-t.y)*m-c<0)}function J_(t,e,r,n,a,c,d){return!(bh(t,e,n,a,c,d)||bh(e,r,n,a,c,d)||bh(r,t,n,a,c,d)||bh(n,a,t,e,r,d)||bh(a,c,t,e,r,d)||bh(c,n,t,e,r,d))}function wh(t,e,r){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function $p(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function z0(t,e,r,n,a){if(!e[0]&&!e[1])return t;const c=dt.convert(e)._mult(a);r==="viewport"&&c._rotate(-n);const d=[];for(let m=0;m<t.length;m++)d.push(t[m].sub(c));return d}function k0(t,e,r,n){const a=dt.convert(t)._mult(n);return e==="viewport"&&a._rotate(-r),a}Gt(Ho,"CircleBucket",{omit:["layers"]});const oM=new an({"circle-sort-key":new fr(Re.layout_circle["circle-sort-key"]),visibility:new xt(Re.layout_circle.visibility)});var sM={paint:new an({"circle-radius":new fr(Re.paint_circle["circle-radius"]),"circle-color":new fr(Re.paint_circle["circle-color"]),"circle-blur":new fr(Re.paint_circle["circle-blur"]),"circle-opacity":new fr(Re.paint_circle["circle-opacity"]),"circle-translate":new xt(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fr(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fr(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fr(Re.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new xt(Re.paint_circle["circle-emissive-strength"])}),layout:oM},to={},ro={};Object.defineProperty(ro,"__esModule",{value:!0}),ro.setMatrixArrayType=function(t){ro.ARRAY_TYPE=B0=t},ro.toRadian=function(t){return t*lM},ro.equals=function(t,e){return Math.abs(t-e)<=F0*Math.max(1,Math.abs(t),Math.abs(e))},ro.RANDOM=ro.ARRAY_TYPE=ro.EPSILON=void 0;var F0=1e-6;ro.EPSILON=F0;var B0=typeof Float32Array<"u"?Float32Array:Array;ro.ARRAY_TYPE=B0;var aM=Math.random;ro.RANDOM=aM;var lM=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var cn={};function Q_(t){return Q_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q_(t)}Object.defineProperty(cn,"__esModule",{value:!0}),cn.create=function(){var t=new pc.ARRAY_TYPE(4);return pc.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},cn.clone=function(t){var e=new pc.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},cn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},cn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},cn.fromValues=function(t,e,r,n){var a=new pc.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},cn.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},cn.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},cn.invert=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=r*c-a*n;return d?(t[0]=c*(d=1/d),t[1]=-n*d,t[2]=-a*d,t[3]=r*d,t):null},cn.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},cn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},cn.multiply=U0,cn.rotate=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return t[0]=n*y+c*m,t[1]=a*y+d*m,t[2]=n*-m+c*y,t[3]=a*-m+d*y,t},cn.scale=function(t,e,r){var n=e[1],a=e[2],c=e[3],d=r[0],m=r[1];return t[0]=e[0]*d,t[1]=n*d,t[2]=a*m,t[3]=c*m,t},cn.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},cn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},cn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},cn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},cn.LDU=function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},cn.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},cn.subtract=j0,cn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},cn.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=t[3],d=e[0],m=e[1],y=e[2],v=e[3];return Math.abs(r-d)<=pc.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-m)<=pc.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=pc.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-v)<=pc.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))},cn.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},cn.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},cn.sub=cn.mul=void 0;var pc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Q_(t)!=="object"&&typeof t!="function")return{default:t};var r=N0(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function N0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(N0=function(n){return n?r:e})(t)}function U0(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=r[0],y=r[1],v=r[2],w=r[3];return t[0]=n*m+c*y,t[1]=a*m+d*y,t[2]=n*v+c*w,t[3]=a*v+d*w,t}function j0(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}cn.mul=U0,cn.sub=j0;var fn={};function eg(t){return eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},eg(t)}Object.defineProperty(fn,"__esModule",{value:!0}),fn.create=function(){var t=new Qa.ARRAY_TYPE(6);return Qa.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},fn.clone=function(t){var e=new Qa.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},fn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fn.fromValues=function(t,e,r,n,a,c){var d=new Qa.ARRAY_TYPE(6);return d[0]=t,d[1]=e,d[2]=r,d[3]=n,d[4]=a,d[5]=c,d},fn.set=function(t,e,r,n,a,c,d){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t},fn.invert=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=r*c-n*a;return y?(t[0]=c*(y=1/y),t[1]=-n*y,t[2]=-a*y,t[3]=r*y,t[4]=(a*m-c*d)*y,t[5]=(n*d-r*m)*y,t):null},fn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},fn.multiply=G0,fn.rotate=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=Math.sin(r),w=Math.cos(r);return t[0]=n*w+c*v,t[1]=a*w+d*v,t[2]=n*-v+c*w,t[3]=a*-v+d*w,t[4]=m,t[5]=y,t},fn.scale=function(t,e,r){var n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=r[0],v=r[1];return t[0]=e[0]*y,t[1]=n*y,t[2]=a*v,t[3]=c*v,t[4]=d,t[5]=m,t},fn.translate=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=r[0],w=r[1];return t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=n*v+c*w+m,t[5]=a*v+d*w+y,t},fn.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},fn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},fn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},fn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},fn.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},fn.subtract=$0,fn.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},fn.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},fn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},fn.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],y=e[0],v=e[1],w=e[2],S=e[3],A=e[4],R=e[5];return Math.abs(r-y)<=Qa.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-v)<=Qa.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-w)<=Qa.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-S)<=Qa.EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(d-A)<=Qa.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(m-R)<=Qa.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))},fn.sub=fn.mul=void 0;var Qa=function(t,e){if(t&&t.__esModule)return t;if(t===null||eg(t)!=="object"&&typeof t!="function")return{default:t};var r=V0(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function V0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(V0=function(n){return n?r:e})(t)}function G0(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=r[0],w=r[1],S=r[2],A=r[3],R=r[4],D=r[5];return t[0]=n*v+c*w,t[1]=a*v+d*w,t[2]=n*S+c*A,t[3]=a*S+d*A,t[4]=n*R+c*D+m,t[5]=a*R+d*D+y,t}function $0(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}fn.mul=G0,fn.sub=$0;var Ri={};function tg(t){return tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tg(t)}Object.defineProperty(Ri,"__esModule",{value:!0}),Ri.create=function(){var t=new Us.ARRAY_TYPE(9);return Us.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Ri.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Ri.clone=function(t){var e=new Us.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Ri.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Ri.fromValues=function(t,e,r,n,a,c,d,m,y){var v=new Us.ARRAY_TYPE(9);return v[0]=t,v[1]=e,v[2]=r,v[3]=n,v[4]=a,v[5]=c,v[6]=d,v[7]=m,v[8]=y,v},Ri.set=function(t,e,r,n,a,c,d,m,y,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t[6]=m,t[7]=y,t[8]=v,t},Ri.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ri.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Ri.invert=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=e[6],v=e[7],w=e[8],S=w*d-m*v,A=-w*c+m*y,R=v*c-d*y,D=r*S+n*A+a*R;return D?(t[0]=S*(D=1/D),t[1]=(-w*n+a*v)*D,t[2]=(m*n-a*d)*D,t[3]=A*D,t[4]=(w*r-a*y)*D,t[5]=(-m*r+a*c)*D,t[6]=R*D,t[7]=(-v*r+n*y)*D,t[8]=(d*r-n*c)*D,t):null},Ri.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=e[6],v=e[7],w=e[8];return t[0]=d*w-m*v,t[1]=a*v-n*w,t[2]=n*m-a*d,t[3]=m*y-c*w,t[4]=r*w-a*y,t[5]=a*c-r*m,t[6]=c*v-d*y,t[7]=n*y-r*v,t[8]=r*d-n*c,t},Ri.determinant=function(t){var e=t[3],r=t[4],n=t[5],a=t[6],c=t[7],d=t[8];return t[0]*(d*r-n*c)+t[1]*(-d*e+n*a)+t[2]*(c*e-r*a)},Ri.multiply=Z0,Ri.translate=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=r[0],R=r[1];return t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=m,t[5]=y,t[6]=A*n+R*d+v,t[7]=A*a+R*m+w,t[8]=A*c+R*y+S,t},Ri.rotate=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=Math.sin(r),R=Math.cos(r);return t[0]=R*n+A*d,t[1]=R*a+A*m,t[2]=R*c+A*y,t[3]=R*d-A*n,t[4]=R*m-A*a,t[5]=R*y-A*c,t[6]=v,t[7]=w,t[8]=S,t},Ri.scale=function(t,e,r){var n=r[0],a=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Ri.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Ri.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ri.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Ri.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Ri.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=r+r,m=n+n,y=a+a,v=r*d,w=n*d,S=n*m,A=a*d,R=a*m,D=a*y,k=c*d,U=c*m,G=c*y;return t[0]=1-S-D,t[3]=w-G,t[6]=A+U,t[1]=w+G,t[4]=1-v-D,t[7]=R-k,t[2]=A-U,t[5]=R+k,t[8]=1-v-S,t},Ri.normalFromMat4=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=e[6],v=e[7],w=e[8],S=e[9],A=e[10],R=e[11],D=e[12],k=e[13],U=e[14],G=e[15],Y=r*m-n*d,te=r*y-a*d,ee=r*v-c*d,ue=n*y-a*m,le=n*v-c*m,pe=a*v-c*y,be=w*k-S*D,Ie=w*U-A*D,ze=w*G-R*D,Pe=S*U-A*k,qe=S*G-R*k,Qe=A*G-R*U,Ve=Y*Qe-te*qe+ee*Pe+ue*ze-le*Ie+pe*be;return Ve?(t[0]=(m*Qe-y*qe+v*Pe)*(Ve=1/Ve),t[1]=(y*ze-d*Qe-v*Ie)*Ve,t[2]=(d*qe-m*ze+v*be)*Ve,t[3]=(a*qe-n*Qe-c*Pe)*Ve,t[4]=(r*Qe-a*ze+c*Ie)*Ve,t[5]=(n*ze-r*qe-c*be)*Ve,t[6]=(k*pe-U*le+G*ue)*Ve,t[7]=(U*ee-D*pe-G*te)*Ve,t[8]=(D*le-k*ee+G*Y)*Ve,t):null},Ri.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Ri.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Ri.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Ri.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},Ri.subtract=H0,Ri.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},Ri.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},Ri.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Ri.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],y=t[6],v=t[7],w=t[8],S=e[0],A=e[1],R=e[2],D=e[3],k=e[4],U=e[5],G=e[6],Y=e[7],te=e[8];return Math.abs(r-S)<=Us.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(n-A)<=Us.EPSILON*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(a-R)<=Us.EPSILON*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(c-D)<=Us.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(d-k)<=Us.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(m-U)<=Us.EPSILON*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(y-G)<=Us.EPSILON*Math.max(1,Math.abs(y),Math.abs(G))&&Math.abs(v-Y)<=Us.EPSILON*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(w-te)<=Us.EPSILON*Math.max(1,Math.abs(w),Math.abs(te))},Ri.sub=Ri.mul=void 0;var Us=function(t,e){if(t&&t.__esModule)return t;if(t===null||tg(t)!=="object"&&typeof t!="function")return{default:t};var r=q0(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function q0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(q0=function(n){return n?r:e})(t)}function Z0(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=r[0],R=r[1],D=r[2],k=r[3],U=r[4],G=r[5],Y=r[6],te=r[7],ee=r[8];return t[0]=A*n+R*d+D*v,t[1]=A*a+R*m+D*w,t[2]=A*c+R*y+D*S,t[3]=k*n+U*d+G*v,t[4]=k*a+U*m+G*w,t[5]=k*c+U*y+G*S,t[6]=Y*n+te*d+ee*v,t[7]=Y*a+te*m+ee*w,t[8]=Y*c+te*y+ee*S,t}function H0(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}Ri.mul=Z0,Ri.sub=H0;var Ur={};function rg(t){return rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rg(t)}Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.create=function(){var t=new In.ARRAY_TYPE(16);return In.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Ur.clone=function(t){var e=new In.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Ur.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ur.fromValues=function(t,e,r,n,a,c,d,m,y,v,w,S,A,R,D,k){var U=new In.ARRAY_TYPE(16);return U[0]=t,U[1]=e,U[2]=r,U[3]=n,U[4]=a,U[5]=c,U[6]=d,U[7]=m,U[8]=y,U[9]=v,U[10]=w,U[11]=S,U[12]=A,U[13]=R,U[14]=D,U[15]=k,U},Ur.set=function(t,e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t[6]=m,t[7]=y,t[8]=v,t[9]=w,t[10]=S,t[11]=A,t[12]=R,t[13]=D,t[14]=k,t[15]=U,t},Ur.identity=X0,Ur.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],a=e[3],c=e[6],d=e[7],m=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=c,t[11]=e[14],t[12]=a,t[13]=d,t[14]=m}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Ur.invert=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=e[6],v=e[7],w=e[8],S=e[9],A=e[10],R=e[11],D=e[12],k=e[13],U=e[14],G=e[15],Y=r*m-n*d,te=r*y-a*d,ee=r*v-c*d,ue=n*y-a*m,le=n*v-c*m,pe=a*v-c*y,be=w*k-S*D,Ie=w*U-A*D,ze=w*G-R*D,Pe=S*U-A*k,qe=S*G-R*k,Qe=A*G-R*U,Ve=Y*Qe-te*qe+ee*Pe+ue*ze-le*Ie+pe*be;return Ve?(t[0]=(m*Qe-y*qe+v*Pe)*(Ve=1/Ve),t[1]=(a*qe-n*Qe-c*Pe)*Ve,t[2]=(k*pe-U*le+G*ue)*Ve,t[3]=(A*le-S*pe-R*ue)*Ve,t[4]=(y*ze-d*Qe-v*Ie)*Ve,t[5]=(r*Qe-a*ze+c*Ie)*Ve,t[6]=(U*ee-D*pe-G*te)*Ve,t[7]=(w*pe-A*ee+R*te)*Ve,t[8]=(d*qe-m*ze+v*be)*Ve,t[9]=(n*ze-r*qe-c*be)*Ve,t[10]=(D*le-k*ee+G*Y)*Ve,t[11]=(S*ee-w*le-R*Y)*Ve,t[12]=(m*Ie-d*Pe-y*be)*Ve,t[13]=(r*Pe-n*Ie+a*be)*Ve,t[14]=(k*te-D*ue-U*Y)*Ve,t[15]=(w*ue-S*te+A*Y)*Ve,t):null},Ur.adjoint=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],y=e[6],v=e[7],w=e[8],S=e[9],A=e[10],R=e[11],D=e[12],k=e[13],U=e[14],G=e[15];return t[0]=m*(A*G-R*U)-S*(y*G-v*U)+k*(y*R-v*A),t[1]=-(n*(A*G-R*U)-S*(a*G-c*U)+k*(a*R-c*A)),t[2]=n*(y*G-v*U)-m*(a*G-c*U)+k*(a*v-c*y),t[3]=-(n*(y*R-v*A)-m*(a*R-c*A)+S*(a*v-c*y)),t[4]=-(d*(A*G-R*U)-w*(y*G-v*U)+D*(y*R-v*A)),t[5]=r*(A*G-R*U)-w*(a*G-c*U)+D*(a*R-c*A),t[6]=-(r*(y*G-v*U)-d*(a*G-c*U)+D*(a*v-c*y)),t[7]=r*(y*R-v*A)-d*(a*R-c*A)+w*(a*v-c*y),t[8]=d*(S*G-R*k)-w*(m*G-v*k)+D*(m*R-v*S),t[9]=-(r*(S*G-R*k)-w*(n*G-c*k)+D*(n*R-c*S)),t[10]=r*(m*G-v*k)-d*(n*G-c*k)+D*(n*v-c*m),t[11]=-(r*(m*R-v*S)-d*(n*R-c*S)+w*(n*v-c*m)),t[12]=-(d*(S*U-A*k)-w*(m*U-y*k)+D*(m*A-y*S)),t[13]=r*(S*U-A*k)-w*(n*U-a*k)+D*(n*A-a*S),t[14]=-(r*(m*U-y*k)-d*(n*U-a*k)+D*(n*y-a*m)),t[15]=r*(m*A-y*S)-d*(n*A-a*S)+w*(n*y-a*m),t},Ur.determinant=function(t){var e=t[0],r=t[1],n=t[2],a=t[3],c=t[4],d=t[5],m=t[6],y=t[7],v=t[8],w=t[9],S=t[10],A=t[11],R=t[12],D=t[13],k=t[14],U=t[15];return(e*d-r*c)*(S*U-A*k)-(e*m-n*c)*(w*U-A*D)+(e*y-a*c)*(w*k-S*D)+(r*m-n*d)*(v*U-A*R)-(r*y-a*d)*(v*k-S*R)+(n*y-a*m)*(v*D-w*R)},Ur.multiply=Y0,Ur.translate=function(t,e,r){var n,a,c,d,m,y,v,w,S,A,R,D,k=r[0],U=r[1],G=r[2];return e===t?(t[12]=e[0]*k+e[4]*U+e[8]*G+e[12],t[13]=e[1]*k+e[5]*U+e[9]*G+e[13],t[14]=e[2]*k+e[6]*U+e[10]*G+e[14],t[15]=e[3]*k+e[7]*U+e[11]*G+e[15]):(a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=e[9],R=e[10],D=e[11],t[0]=n=e[0],t[1]=a,t[2]=c,t[3]=d,t[4]=m,t[5]=y,t[6]=v,t[7]=w,t[8]=S,t[9]=A,t[10]=R,t[11]=D,t[12]=n*k+m*U+S*G+e[12],t[13]=a*k+y*U+A*G+e[13],t[14]=c*k+v*U+R*G+e[14],t[15]=d*k+w*U+D*G+e[15]),t},Ur.scale=function(t,e,r){var n=r[0],a=r[1],c=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Ur.rotate=function(t,e,r,n){var a,c,d,m,y,v,w,S,A,R,D,k,U,G,Y,te,ee,ue,le,pe,be,Ie,ze,Pe,qe=n[0],Qe=n[1],Ve=n[2],Je=Math.hypot(qe,Qe,Ve);return Je<In.EPSILON?null:(qe*=Je=1/Je,Qe*=Je,Ve*=Je,a=Math.sin(r),c=Math.cos(r),y=e[1],v=e[2],w=e[3],A=e[5],R=e[6],D=e[7],U=e[9],G=e[10],Y=e[11],te=qe*qe*(d=1-c)+c,le=qe*Qe*d-Ve*a,pe=Qe*Qe*d+c,be=Ve*Qe*d+qe*a,Ie=qe*Ve*d+Qe*a,ze=Qe*Ve*d-qe*a,Pe=Ve*Ve*d+c,t[0]=(m=e[0])*te+(S=e[4])*(ee=Qe*qe*d+Ve*a)+(k=e[8])*(ue=Ve*qe*d-Qe*a),t[1]=y*te+A*ee+U*ue,t[2]=v*te+R*ee+G*ue,t[3]=w*te+D*ee+Y*ue,t[4]=m*le+S*pe+k*be,t[5]=y*le+A*pe+U*be,t[6]=v*le+R*pe+G*be,t[7]=w*le+D*pe+Y*be,t[8]=m*Ie+S*ze+k*Pe,t[9]=y*Ie+A*ze+U*Pe,t[10]=v*Ie+R*ze+G*Pe,t[11]=w*Ie+D*ze+Y*Pe,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Ur.rotateX=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),c=e[4],d=e[5],m=e[6],y=e[7],v=e[8],w=e[9],S=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*a+v*n,t[5]=d*a+w*n,t[6]=m*a+S*n,t[7]=y*a+A*n,t[8]=v*a-c*n,t[9]=w*a-d*n,t[10]=S*a-m*n,t[11]=A*a-y*n,t},Ur.rotateY=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),c=e[0],d=e[1],m=e[2],y=e[3],v=e[8],w=e[9],S=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a-v*n,t[1]=d*a-w*n,t[2]=m*a-S*n,t[3]=y*a-A*n,t[8]=c*n+v*a,t[9]=d*n+w*a,t[10]=m*n+S*a,t[11]=y*n+A*a,t},Ur.rotateZ=function(t,e,r){var n=Math.sin(r),a=Math.cos(r),c=e[0],d=e[1],m=e[2],y=e[3],v=e[4],w=e[5],S=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a+v*n,t[1]=d*a+w*n,t[2]=m*a+S*n,t[3]=y*a+A*n,t[4]=v*a-c*n,t[5]=w*a-d*n,t[6]=S*a-m*n,t[7]=A*a-y*n,t},Ur.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Ur.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ur.fromRotation=function(t,e,r){var n,a,c,d=r[0],m=r[1],y=r[2],v=Math.hypot(d,m,y);return v<In.EPSILON?null:(d*=v=1/v,m*=v,y*=v,n=Math.sin(e),a=Math.cos(e),t[0]=d*d*(c=1-a)+a,t[1]=m*d*c+y*n,t[2]=y*d*c-m*n,t[3]=0,t[4]=d*m*c-y*n,t[5]=m*m*c+a,t[6]=y*m*c+d*n,t[7]=0,t[8]=d*y*c+m*n,t[9]=m*y*c-d*n,t[10]=y*y*c+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Ur.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ur.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ur.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ur.fromRotationTranslation=K0,Ur.fromQuat2=function(t,e){var r=new In.ARRAY_TYPE(3),n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=n*n+a*a+c*c+d*d;return S>0?(r[0]=2*(m*d+w*n+y*c-v*a)/S,r[1]=2*(y*d+w*a+v*n-m*c)/S,r[2]=2*(v*d+w*c+m*a-y*n)/S):(r[0]=2*(m*d+w*n+y*c-v*a),r[1]=2*(y*d+w*a+v*n-m*c),r[2]=2*(v*d+w*c+m*a-y*n)),K0(t,e,r),t},Ur.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Ur.getScaling=J0,Ur.getRotation=function(t,e){var r=new In.ARRAY_TYPE(3);J0(r,e);var n=1/r[0],a=1/r[1],c=1/r[2],d=e[0]*n,m=e[1]*a,y=e[2]*c,v=e[4]*n,w=e[5]*a,S=e[6]*c,A=e[8]*n,R=e[9]*a,D=e[10]*c,k=d+w+D,U=0;return k>0?(U=2*Math.sqrt(k+1),t[3]=.25*U,t[0]=(S-R)/U,t[1]=(A-y)/U,t[2]=(m-v)/U):d>w&&d>D?(U=2*Math.sqrt(1+d-w-D),t[3]=(S-R)/U,t[0]=.25*U,t[1]=(m+v)/U,t[2]=(A+y)/U):w>D?(U=2*Math.sqrt(1+w-d-D),t[3]=(A-y)/U,t[0]=(m+v)/U,t[1]=.25*U,t[2]=(S+R)/U):(U=2*Math.sqrt(1+D-d-w),t[3]=(m-v)/U,t[0]=(A+y)/U,t[1]=(S+R)/U,t[2]=.25*U),t},Ur.fromRotationTranslationScale=function(t,e,r,n){var a=e[0],c=e[1],d=e[2],m=e[3],y=a+a,v=c+c,w=d+d,S=a*y,A=a*v,R=a*w,D=c*v,k=c*w,U=d*w,G=m*y,Y=m*v,te=m*w,ee=n[0],ue=n[1],le=n[2];return t[0]=(1-(D+U))*ee,t[1]=(A+te)*ee,t[2]=(R-Y)*ee,t[3]=0,t[4]=(A-te)*ue,t[5]=(1-(S+U))*ue,t[6]=(k+G)*ue,t[7]=0,t[8]=(R+Y)*le,t[9]=(k-G)*le,t[10]=(1-(S+D))*le,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},Ur.fromRotationTranslationScaleOrigin=function(t,e,r,n,a){var c=e[0],d=e[1],m=e[2],y=e[3],v=c+c,w=d+d,S=m+m,A=c*v,R=c*w,D=c*S,k=d*w,U=d*S,G=m*S,Y=y*v,te=y*w,ee=y*S,ue=n[0],le=n[1],pe=n[2],be=a[0],Ie=a[1],ze=a[2],Pe=(1-(k+G))*ue,qe=(R+ee)*ue,Qe=(D-te)*ue,Ve=(R-ee)*le,Je=(1-(A+G))*le,Ne=(U+Y)*le,Ke=(D+te)*pe,Et=(U-Y)*pe,tt=(1-(A+k))*pe;return t[0]=Pe,t[1]=qe,t[2]=Qe,t[3]=0,t[4]=Ve,t[5]=Je,t[6]=Ne,t[7]=0,t[8]=Ke,t[9]=Et,t[10]=tt,t[11]=0,t[12]=r[0]+be-(Pe*be+Ve*Ie+Ke*ze),t[13]=r[1]+Ie-(qe*be+Je*Ie+Et*ze),t[14]=r[2]+ze-(Qe*be+Ne*Ie+tt*ze),t[15]=1,t},Ur.fromQuat=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=r+r,m=n+n,y=a+a,v=r*d,w=n*d,S=n*m,A=a*d,R=a*m,D=a*y,k=c*d,U=c*m,G=c*y;return t[0]=1-S-D,t[1]=w+G,t[2]=A-U,t[3]=0,t[4]=w-G,t[5]=1-v-D,t[6]=R+k,t[7]=0,t[8]=A+U,t[9]=R-k,t[10]=1-v-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ur.frustum=function(t,e,r,n,a,c,d){var m=1/(r-e),y=1/(a-n),v=1/(c-d);return t[0]=2*c*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*c*y,t[6]=0,t[7]=0,t[8]=(r+e)*m,t[9]=(a+n)*y,t[10]=(d+c)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*v,t[15]=0,t},Ur.perspectiveNO=Q0,Ur.perspectiveZO=function(t,e,r,n,a){var c,d=1/Math.tan(e/2);return t[0]=d/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=a*(c=1/(n-a)),t[14]=a*n*c):(t[10]=-1,t[14]=-n),t},Ur.perspectiveFromFieldOfView=function(t,e,r,n){var a=Math.tan(e.upDegrees*Math.PI/180),c=Math.tan(e.downDegrees*Math.PI/180),d=Math.tan(e.leftDegrees*Math.PI/180),m=Math.tan(e.rightDegrees*Math.PI/180),y=2/(d+m),v=2/(a+c);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=v,t[6]=0,t[7]=0,t[8]=-(d-m)*y*.5,t[9]=(a-c)*v*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},Ur.orthoNO=ev,Ur.orthoZO=function(t,e,r,n,a,c,d){var m=1/(e-r),y=1/(n-a),v=1/(c-d);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=v,t[11]=0,t[12]=(e+r)*m,t[13]=(a+n)*y,t[14]=c*v,t[15]=1,t},Ur.lookAt=function(t,e,r,n){var a,c,d,m,y,v,w,S,A,R,D=e[0],k=e[1],U=e[2],G=n[0],Y=n[1],te=n[2],ee=r[0],ue=r[1],le=r[2];return Math.abs(D-ee)<In.EPSILON&&Math.abs(k-ue)<In.EPSILON&&Math.abs(U-le)<In.EPSILON?X0(t):(w=D-ee,S=k-ue,A=U-le,a=Y*(A*=R=1/Math.hypot(w,S,A))-te*(S*=R),c=te*(w*=R)-G*A,d=G*S-Y*w,(R=Math.hypot(a,c,d))?(a*=R=1/R,c*=R,d*=R):(a=0,c=0,d=0),m=S*d-A*c,y=A*a-w*d,v=w*c-S*a,(R=Math.hypot(m,y,v))?(m*=R=1/R,y*=R,v*=R):(m=0,y=0,v=0),t[0]=a,t[1]=m,t[2]=w,t[3]=0,t[4]=c,t[5]=y,t[6]=S,t[7]=0,t[8]=d,t[9]=v,t[10]=A,t[11]=0,t[12]=-(a*D+c*k+d*U),t[13]=-(m*D+y*k+v*U),t[14]=-(w*D+S*k+A*U),t[15]=1,t)},Ur.targetTo=function(t,e,r,n){var a=e[0],c=e[1],d=e[2],m=n[0],y=n[1],v=n[2],w=a-r[0],S=c-r[1],A=d-r[2],R=w*w+S*S+A*A;R>0&&(w*=R=1/Math.sqrt(R),S*=R,A*=R);var D=y*A-v*S,k=v*w-m*A,U=m*S-y*w;return(R=D*D+k*k+U*U)>0&&(D*=R=1/Math.sqrt(R),k*=R,U*=R),t[0]=D,t[1]=k,t[2]=U,t[3]=0,t[4]=S*U-A*k,t[5]=A*D-w*U,t[6]=w*k-S*D,t[7]=0,t[8]=w,t[9]=S,t[10]=A,t[11]=0,t[12]=a,t[13]=c,t[14]=d,t[15]=1,t},Ur.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Ur.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Ur.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},Ur.subtract=tv,Ur.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},Ur.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},Ur.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Ur.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],y=t[6],v=t[7],w=t[8],S=t[9],A=t[10],R=t[11],D=t[12],k=t[13],U=t[14],G=t[15],Y=e[0],te=e[1],ee=e[2],ue=e[3],le=e[4],pe=e[5],be=e[6],Ie=e[7],ze=e[8],Pe=e[9],qe=e[10],Qe=e[11],Ve=e[12],Je=e[13],Ne=e[14],Ke=e[15];return Math.abs(r-Y)<=In.EPSILON*Math.max(1,Math.abs(r),Math.abs(Y))&&Math.abs(n-te)<=In.EPSILON*Math.max(1,Math.abs(n),Math.abs(te))&&Math.abs(a-ee)<=In.EPSILON*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(c-ue)<=In.EPSILON*Math.max(1,Math.abs(c),Math.abs(ue))&&Math.abs(d-le)<=In.EPSILON*Math.max(1,Math.abs(d),Math.abs(le))&&Math.abs(m-pe)<=In.EPSILON*Math.max(1,Math.abs(m),Math.abs(pe))&&Math.abs(y-be)<=In.EPSILON*Math.max(1,Math.abs(y),Math.abs(be))&&Math.abs(v-Ie)<=In.EPSILON*Math.max(1,Math.abs(v),Math.abs(Ie))&&Math.abs(w-ze)<=In.EPSILON*Math.max(1,Math.abs(w),Math.abs(ze))&&Math.abs(S-Pe)<=In.EPSILON*Math.max(1,Math.abs(S),Math.abs(Pe))&&Math.abs(A-qe)<=In.EPSILON*Math.max(1,Math.abs(A),Math.abs(qe))&&Math.abs(R-Qe)<=In.EPSILON*Math.max(1,Math.abs(R),Math.abs(Qe))&&Math.abs(D-Ve)<=In.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ve))&&Math.abs(k-Je)<=In.EPSILON*Math.max(1,Math.abs(k),Math.abs(Je))&&Math.abs(U-Ne)<=In.EPSILON*Math.max(1,Math.abs(U),Math.abs(Ne))&&Math.abs(G-Ke)<=In.EPSILON*Math.max(1,Math.abs(G),Math.abs(Ke))},Ur.sub=Ur.mul=Ur.ortho=Ur.perspective=void 0;var In=function(t,e){if(t&&t.__esModule)return t;if(t===null||rg(t)!=="object"&&typeof t!="function")return{default:t};var r=W0(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function W0(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(W0=function(n){return n?r:e})(t)}function X0(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y0(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=e[9],R=e[10],D=e[11],k=e[12],U=e[13],G=e[14],Y=e[15],te=r[0],ee=r[1],ue=r[2],le=r[3];return t[0]=te*n+ee*m+ue*S+le*k,t[1]=te*a+ee*y+ue*A+le*U,t[2]=te*c+ee*v+ue*R+le*G,t[3]=te*d+ee*w+ue*D+le*Y,t[4]=(te=r[4])*n+(ee=r[5])*m+(ue=r[6])*S+(le=r[7])*k,t[5]=te*a+ee*y+ue*A+le*U,t[6]=te*c+ee*v+ue*R+le*G,t[7]=te*d+ee*w+ue*D+le*Y,t[8]=(te=r[8])*n+(ee=r[9])*m+(ue=r[10])*S+(le=r[11])*k,t[9]=te*a+ee*y+ue*A+le*U,t[10]=te*c+ee*v+ue*R+le*G,t[11]=te*d+ee*w+ue*D+le*Y,t[12]=(te=r[12])*n+(ee=r[13])*m+(ue=r[14])*S+(le=r[15])*k,t[13]=te*a+ee*y+ue*A+le*U,t[14]=te*c+ee*v+ue*R+le*G,t[15]=te*d+ee*w+ue*D+le*Y,t}function K0(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=n+n,y=a+a,v=c+c,w=n*m,S=n*y,A=n*v,R=a*y,D=a*v,k=c*v,U=d*m,G=d*y,Y=d*v;return t[0]=1-(R+k),t[1]=S+Y,t[2]=A-G,t[3]=0,t[4]=S-Y,t[5]=1-(w+k),t[6]=D+U,t[7]=0,t[8]=A+G,t[9]=D-U,t[10]=1-(w+R),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function J0(t,e){var r=e[4],n=e[5],a=e[6],c=e[8],d=e[9],m=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,n,a),t[2]=Math.hypot(c,d,m),t}function Q0(t,e,r,n,a){var c,d=1/Math.tan(e/2);return t[0]=d/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+n)*(c=1/(n-a)),t[14]=2*a*n*c):(t[10]=-1,t[14]=-2*n),t}function ev(t,e,r,n,a,c,d){var m=1/(e-r),y=1/(n-a),v=1/(c-d);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+r)*m,t[13]=(a+n)*y,t[14]=(d+c)*v,t[15]=1,t}function tv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}Ur.perspective=Q0,Ur.ortho=ev,Ur.mul=Y0,Ur.sub=tv;var kr={},Nr={};function ig(t){return ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ig(t)}Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.create=iv,Nr.clone=function(t){var e=new Rl.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Nr.length=nv,Nr.fromValues=function(t,e,r){var n=new Rl.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=r,n},Nr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Nr.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},Nr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},Nr.subtract=ov,Nr.multiply=sv,Nr.divide=av,Nr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Nr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Nr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},Nr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},Nr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Nr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},Nr.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},Nr.distance=lv,Nr.squaredDistance=cv,Nr.squaredLength=uv,Nr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Nr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Nr.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],c=r*r+n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t},Nr.dot=hv,Nr.cross=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=r[0],m=r[1],y=r[2];return t[0]=a*y-c*m,t[1]=c*d-n*y,t[2]=n*m-a*d,t},Nr.lerp=function(t,e,r,n){var a=e[0],c=e[1],d=e[2];return t[0]=a+n*(r[0]-a),t[1]=c+n*(r[1]-c),t[2]=d+n*(r[2]-d),t},Nr.hermite=function(t,e,r,n,a,c){var d=c*c,m=d*(2*c-3)+1,y=d*(c-2)+c,v=d*(c-1),w=d*(3-2*c);return t[0]=e[0]*m+r[0]*y+n[0]*v+a[0]*w,t[1]=e[1]*m+r[1]*y+n[1]*v+a[1]*w,t[2]=e[2]*m+r[2]*y+n[2]*v+a[2]*w,t},Nr.bezier=function(t,e,r,n,a,c){var d=1-c,m=d*d,y=c*c,v=m*d,w=3*c*m,S=3*y*d,A=y*c;return t[0]=e[0]*v+r[0]*w+n[0]*S+a[0]*A,t[1]=e[1]*v+r[1]*w+n[1]*S+a[1]*A,t[2]=e[2]*v+r[2]*w+n[2]*S+a[2]*A,t},Nr.random=function(t,e){e=e||1;var r=2*Rl.RANDOM()*Math.PI,n=2*Rl.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*a,t[1]=Math.sin(r)*a,t[2]=n*e,t},Nr.transformMat4=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=r[3]*n+r[7]*a+r[11]*c+r[15];return t[0]=(r[0]*n+r[4]*a+r[8]*c+r[12])/(d=d||1),t[1]=(r[1]*n+r[5]*a+r[9]*c+r[13])/d,t[2]=(r[2]*n+r[6]*a+r[10]*c+r[14])/d,t},Nr.transformMat3=function(t,e,r){var n=e[0],a=e[1],c=e[2];return t[0]=n*r[0]+a*r[3]+c*r[6],t[1]=n*r[1]+a*r[4]+c*r[7],t[2]=n*r[2]+a*r[5]+c*r[8],t},Nr.transformQuat=function(t,e,r){var n=r[0],a=r[1],c=r[2],d=e[0],m=e[1],y=e[2],v=a*y-c*m,w=c*d-n*y,S=n*m-a*d,A=a*S-c*w,R=c*v-n*S,D=n*w-a*v,k=2*r[3];return w*=k,S*=k,R*=2,D*=2,t[0]=d+(v*=k)+(A*=2),t[1]=m+w+R,t[2]=y+S+D,t},Nr.rotateX=function(t,e,r,n){var a=[],c=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],c[0]=a[0],c[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),c[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=c[0]+r[0],t[1]=c[1]+r[1],t[2]=c[2]+r[2],t},Nr.rotateY=function(t,e,r,n){var a=[],c=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],c[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),c[1]=a[1],c[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=c[0]+r[0],t[1]=c[1]+r[1],t[2]=c[2]+r[2],t},Nr.rotateZ=function(t,e,r,n){var a=[],c=[];return a[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],c[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),c[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),c[2]=a[2],t[0]=c[0]+r[0],t[1]=c[1]+r[1],t[2]=c[2]+r[2],t},Nr.angle=function(t,e){var r=t[0],n=t[1],a=t[2],c=e[0],d=e[1],m=e[2],y=Math.sqrt(r*r+n*n+a*a)*Math.sqrt(c*c+d*d+m*m),v=y&&hv(t,e)/y;return Math.acos(Math.min(Math.max(v,-1),1))},Nr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Nr.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Nr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Nr.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=e[0],d=e[1],m=e[2];return Math.abs(r-c)<=Rl.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-d)<=Rl.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-m)<=Rl.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))},Nr.forEach=Nr.sqrLen=Nr.len=Nr.sqrDist=Nr.dist=Nr.div=Nr.mul=Nr.sub=void 0;var Rl=function(t,e){if(t&&t.__esModule)return t;if(t===null||ig(t)!=="object"&&typeof t!="function")return{default:t};var r=rv(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function rv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(rv=function(n){return n?r:e})(t)}function iv(){var t=new Rl.ARRAY_TYPE(3);return Rl.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function nv(t){return Math.hypot(t[0],t[1],t[2])}function ov(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function sv(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function av(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function lv(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function cv(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return r*r+n*n+a*a}function uv(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function hv(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Nr.sub=ov,Nr.mul=sv,Nr.div=av,Nr.dist=lv,Nr.sqrDist=cv,Nr.len=nv,Nr.sqrLen=uv;var Ol,cM=(Ol=iv(),function(t,e,r,n,a,c){var d,m;for(e||(e=3),r||(r=0),m=n?Math.min(n*e+r,t.length):t.length,d=r;d<m;d+=e)Ol[0]=t[d],Ol[1]=t[d+1],Ol[2]=t[d+2],a(Ol,Ol,c),t[d]=Ol[0],t[d+1]=Ol[1],t[d+2]=Ol[2];return t});Nr.forEach=cM;var Qr={};function ng(t){return ng=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ng(t)}Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.create=fv,Qr.clone=function(t){var e=new na.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Qr.fromValues=function(t,e,r,n){var a=new na.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a},Qr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Qr.set=function(t,e,r,n,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t},Qr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Qr.subtract=pv,Qr.multiply=mv,Qr.divide=_v,Qr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Qr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Qr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},Qr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},Qr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Qr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Qr.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},Qr.distance=gv,Qr.squaredDistance=yv,Qr.length=vv,Qr.squaredLength=xv,Qr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Qr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Qr.normalize=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=r*r+n*n+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=r*d,t[1]=n*d,t[2]=a*d,t[3]=c*d,t},Qr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Qr.cross=function(t,e,r,n){var a=r[0]*n[1]-r[1]*n[0],c=r[0]*n[2]-r[2]*n[0],d=r[0]*n[3]-r[3]*n[0],m=r[1]*n[2]-r[2]*n[1],y=r[1]*n[3]-r[3]*n[1],v=r[2]*n[3]-r[3]*n[2],w=e[0],S=e[1],A=e[2],R=e[3];return t[0]=S*v-A*y+R*m,t[1]=-w*v+A*d-R*c,t[2]=w*y-S*d+R*a,t[3]=-w*m+S*c-A*a,t},Qr.lerp=function(t,e,r,n){var a=e[0],c=e[1],d=e[2],m=e[3];return t[0]=a+n*(r[0]-a),t[1]=c+n*(r[1]-c),t[2]=d+n*(r[2]-d),t[3]=m+n*(r[3]-m),t},Qr.random=function(t,e){var r,n,a,c,d,m;e=e||1;do d=(r=2*na.RANDOM()-1)*r+(n=2*na.RANDOM()-1)*n;while(d>=1);do m=(a=2*na.RANDOM()-1)*a+(c=2*na.RANDOM()-1)*c;while(m>=1);var y=Math.sqrt((1-d)/m);return t[0]=e*r,t[1]=e*n,t[2]=e*a*y,t[3]=e*c*y,t},Qr.transformMat4=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3];return t[0]=r[0]*n+r[4]*a+r[8]*c+r[12]*d,t[1]=r[1]*n+r[5]*a+r[9]*c+r[13]*d,t[2]=r[2]*n+r[6]*a+r[10]*c+r[14]*d,t[3]=r[3]*n+r[7]*a+r[11]*c+r[15]*d,t},Qr.transformQuat=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=r[0],m=r[1],y=r[2],v=r[3],w=v*n+m*c-y*a,S=v*a+y*n-d*c,A=v*c+d*a-m*n,R=-d*n-m*a-y*c;return t[0]=w*v+R*-d+S*-y-A*-m,t[1]=S*v+R*-m+A*-d-w*-y,t[2]=A*v+R*-y+w*-m-S*-d,t[3]=e[3],t},Qr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Qr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Qr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Qr.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=t[3],d=e[0],m=e[1],y=e[2],v=e[3];return Math.abs(r-d)<=na.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-m)<=na.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=na.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-v)<=na.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))},Qr.forEach=Qr.sqrLen=Qr.len=Qr.sqrDist=Qr.dist=Qr.div=Qr.mul=Qr.sub=void 0;var na=function(t,e){if(t&&t.__esModule)return t;if(t===null||ng(t)!=="object"&&typeof t!="function")return{default:t};var r=dv(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function dv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(dv=function(n){return n?r:e})(t)}function fv(){var t=new na.ARRAY_TYPE(4);return na.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function mv(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function _v(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function gv(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function yv(t,e){var r=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],c=e[3]-t[3];return r*r+n*n+a*a+c*c}function vv(t){return Math.hypot(t[0],t[1],t[2],t[3])}function xv(t){var e=t[0],r=t[1],n=t[2],a=t[3];return e*e+r*r+n*n+a*a}Qr.sub=pv,Qr.mul=mv,Qr.div=_v,Qr.dist=gv,Qr.sqrDist=yv,Qr.len=vv,Qr.sqrLen=xv;var uM=function(){var t=fv();return function(e,r,n,a,c,d){var m,y;for(r||(r=4),n||(n=0),y=a?Math.min(a*r+n,e.length):e.length,m=n;m<y;m+=r)t[0]=e[m],t[1]=e[m+1],t[2]=e[m+2],t[3]=e[m+3],c(t,t,d),e[m]=t[0],e[m+1]=t[1],e[m+2]=t[2],e[m+3]=t[3];return e}}();function og(t){return og=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},og(t)}Qr.forEach=uM,Object.defineProperty(kr,"__esModule",{value:!0}),kr.create=sg,kr.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},kr.setAxisAngle=wv,kr.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>Au.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},kr.getAngle=function(t,e){var r=Iv(t,e);return Math.acos(2*r*r-1)},kr.multiply=Tv,kr.rotateX=function(t,e,r){r*=.5;var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return t[0]=n*y+d*m,t[1]=a*y+c*m,t[2]=c*y-a*m,t[3]=d*y-n*m,t},kr.rotateY=function(t,e,r){r*=.5;var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return t[0]=n*y-c*m,t[1]=a*y+d*m,t[2]=c*y+n*m,t[3]=d*y-a*m,t},kr.rotateZ=function(t,e,r){r*=.5;var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return t[0]=n*y+a*m,t[1]=a*y-n*m,t[2]=c*y+d*m,t[3]=d*y-c*m,t},kr.calculateW=function(t,e){var r=e[0],n=e[1],a=e[2];return t[0]=r,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-a*a)),t},kr.exp=Ev,kr.ln=Sv,kr.pow=function(t,e,r){return Sv(t,e),Av(t,t,r),Ev(t,t),t},kr.slerp=Zp,kr.random=function(t){var e=Au.RANDOM(),r=Au.RANDOM(),n=Au.RANDOM(),a=Math.sqrt(1-e),c=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*r),t[1]=a*Math.cos(2*Math.PI*r),t[2]=c*Math.sin(2*Math.PI*n),t[3]=c*Math.cos(2*Math.PI*n),t},kr.invert=function(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=r*r+n*n+a*a+c*c,m=d?1/d:0;return t[0]=-r*m,t[1]=-n*m,t[2]=-a*m,t[3]=c*m,t},kr.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},kr.fromMat3=Mv,kr.fromEuler=function(t,e,r,n){var a=.5*Math.PI/180;e*=a,r*=a,n*=a;var c=Math.sin(e),d=Math.cos(e),m=Math.sin(r),y=Math.cos(r),v=Math.sin(n),w=Math.cos(n);return t[0]=c*y*w-d*m*v,t[1]=d*m*w+c*y*v,t[2]=d*y*v-c*m*w,t[3]=d*y*w+c*m*v,t},kr.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},kr.setAxes=kr.sqlerp=kr.rotationTo=kr.equals=kr.exactEquals=kr.normalize=kr.sqrLen=kr.squaredLength=kr.len=kr.length=kr.lerp=kr.dot=kr.scale=kr.mul=kr.add=kr.set=kr.copy=kr.fromValues=kr.clone=void 0;var Au=qp(ro),hM=qp(Ri),Dl=qp(Nr),js=qp(Qr);function bv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(bv=function(n){return n?r:e})(t)}function qp(t,e){if(t&&t.__esModule)return t;if(t===null||og(t)!=="object"&&typeof t!="function")return{default:t};var r=bv(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}function sg(){var t=new Au.ARRAY_TYPE(4);return Au.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function wv(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Tv(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=r[0],y=r[1],v=r[2],w=r[3];return t[0]=n*w+d*m+a*v-c*y,t[1]=a*w+d*y+c*m-n*v,t[2]=c*w+d*v+n*y-a*m,t[3]=d*w-n*m-a*y-c*v,t}function Ev(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=Math.sqrt(r*r+n*n+a*a),m=Math.exp(c),y=d>0?m*Math.sin(d)/d:0;return t[0]=r*y,t[1]=n*y,t[2]=a*y,t[3]=m*Math.cos(d),t}function Sv(t,e){var r=e[0],n=e[1],a=e[2],c=e[3],d=Math.sqrt(r*r+n*n+a*a),m=d>0?Math.atan2(d,c)/d:0;return t[0]=r*m,t[1]=n*m,t[2]=a*m,t[3]=.5*Math.log(r*r+n*n+a*a+c*c),t}function Zp(t,e,r,n){var a,c,d,m,y,v=e[0],w=e[1],S=e[2],A=e[3],R=r[0],D=r[1],k=r[2],U=r[3];return(c=v*R+w*D+S*k+A*U)<0&&(c=-c,R=-R,D=-D,k=-k,U=-U),1-c>Au.EPSILON?(a=Math.acos(c),d=Math.sin(a),m=Math.sin((1-n)*a)/d,y=Math.sin(n*a)/d):(m=1-n,y=n),t[0]=m*v+y*R,t[1]=m*w+y*D,t[2]=m*S+y*k,t[3]=m*A+y*U,t}function Mv(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var c=(a+1)%3,d=(a+2)%3;r=Math.sqrt(e[3*a+a]-e[3*c+c]-e[3*d+d]+1),t[a]=.5*r,t[3]=(e[3*c+d]-e[3*d+c])*(r=.5/r),t[c]=(e[3*c+a]+e[3*a+c])*r,t[d]=(e[3*d+a]+e[3*a+d])*r}return t}kr.clone=js.clone,kr.fromValues=js.fromValues,kr.copy=js.copy,kr.set=js.set,kr.add=js.add,kr.mul=Tv;var Av=js.scale;kr.scale=Av;var Iv=js.dot;kr.dot=Iv,kr.lerp=js.lerp;var Cv=js.length;kr.length=Cv,kr.len=Cv;var Pv=js.squaredLength;kr.squaredLength=Pv,kr.sqrLen=Pv;var ag=js.normalize;kr.normalize=ag,kr.exactEquals=js.exactEquals,kr.equals=js.equals;var wa,Lv,Rv,dM=(wa=Dl.create(),Lv=Dl.fromValues(1,0,0),Rv=Dl.fromValues(0,1,0),function(t,e,r){var n=Dl.dot(e,r);return n<-.999999?(Dl.cross(wa,Lv,e),Dl.len(wa)<1e-6&&Dl.cross(wa,Rv,e),Dl.normalize(wa,wa),wv(t,wa,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Dl.cross(wa,e,r),t[0]=wa[0],t[1]=wa[1],t[2]=wa[2],t[3]=1+n,ag(t,t))});kr.rotationTo=dM;var lg,cg,fM=(lg=sg(),cg=sg(),function(t,e,r,n,a,c){return Zp(lg,e,a,c),Zp(cg,r,n,c),Zp(t,lg,cg,2*c*(1-c)),t});kr.sqlerp=fM;var Ta,pM=(Ta=hM.create(),function(t,e,r,n){return Ta[0]=r[0],Ta[3]=r[1],Ta[6]=r[2],Ta[1]=n[0],Ta[4]=n[1],Ta[7]=n[2],Ta[2]=-e[0],Ta[5]=-e[1],Ta[8]=-e[2],ag(t,Mv(t,Ta))});kr.setAxes=pM;var ni={};function ug(t){return ug=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ug(t)}Object.defineProperty(ni,"__esModule",{value:!0}),ni.create=function(){var t=new ns.ARRAY_TYPE(8);return ns.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},ni.clone=function(t){var e=new ns.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},ni.fromValues=function(t,e,r,n,a,c,d,m){var y=new ns.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=r,y[3]=n,y[4]=a,y[5]=c,y[6]=d,y[7]=m,y},ni.fromRotationTranslationValues=function(t,e,r,n,a,c,d){var m=new ns.ARRAY_TYPE(8);m[0]=t,m[1]=e,m[2]=r,m[3]=n;var y=.5*a,v=.5*c,w=.5*d;return m[4]=y*n+v*r-w*e,m[5]=v*n+w*t-y*r,m[6]=w*n+y*e-v*t,m[7]=-y*t-v*e-w*r,m},ni.fromRotationTranslation=zv,ni.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},ni.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},ni.fromMat4=function(t,e){var r=zl.create();Ov.getRotation(r,e);var n=new ns.ARRAY_TYPE(3);return Ov.getTranslation(n,e),zv(t,r,n),t},ni.copy=kv,ni.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},ni.set=function(t,e,r,n,a,c,d,m,y){return t[0]=e,t[1]=r,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t[6]=m,t[7]=y,t},ni.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},ni.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},ni.getTranslation=function(t,e){var r=e[4],n=e[5],a=e[6],c=e[7],d=-e[0],m=-e[1],y=-e[2],v=e[3];return t[0]=2*(r*v+c*d+n*y-a*m),t[1]=2*(n*v+c*m+a*d-r*y),t[2]=2*(a*v+c*y+r*m-n*d),t},ni.translate=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=.5*r[0],y=.5*r[1],v=.5*r[2],w=e[4],S=e[5],A=e[6],R=e[7];return t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=d*m+a*v-c*y+w,t[5]=d*y+c*m-n*v+S,t[6]=d*v+n*y-a*m+A,t[7]=-n*m-a*y-c*v+R,t},ni.rotateX=function(t,e,r){var n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=m*d+w*n+y*c-v*a,A=y*d+w*a+v*n-m*c,R=v*d+w*c+m*a-y*n,D=w*d-m*n-y*a-v*c;return zl.rotateX(t,e,r),t[4]=S*(d=t[3])+D*(n=t[0])+A*(c=t[2])-R*(a=t[1]),t[5]=A*d+D*a+R*n-S*c,t[6]=R*d+D*c+S*a-A*n,t[7]=D*d-S*n-A*a-R*c,t},ni.rotateY=function(t,e,r){var n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=m*d+w*n+y*c-v*a,A=y*d+w*a+v*n-m*c,R=v*d+w*c+m*a-y*n,D=w*d-m*n-y*a-v*c;return zl.rotateY(t,e,r),t[4]=S*(d=t[3])+D*(n=t[0])+A*(c=t[2])-R*(a=t[1]),t[5]=A*d+D*a+R*n-S*c,t[6]=R*d+D*c+S*a-A*n,t[7]=D*d-S*n-A*a-R*c,t},ni.rotateZ=function(t,e,r){var n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],y=e[5],v=e[6],w=e[7],S=m*d+w*n+y*c-v*a,A=y*d+w*a+v*n-m*c,R=v*d+w*c+m*a-y*n,D=w*d-m*n-y*a-v*c;return zl.rotateZ(t,e,r),t[4]=S*(d=t[3])+D*(n=t[0])+A*(c=t[2])-R*(a=t[1]),t[5]=A*d+D*a+R*n-S*c,t[6]=R*d+D*c+S*a-A*n,t[7]=D*d-S*n-A*a-R*c,t},ni.rotateByQuatAppend=function(t,e,r){var n=r[0],a=r[1],c=r[2],d=r[3],m=e[0],y=e[1],v=e[2],w=e[3];return t[0]=m*d+w*n+y*c-v*a,t[1]=y*d+w*a+v*n-m*c,t[2]=v*d+w*c+m*a-y*n,t[3]=w*d-m*n-y*a-v*c,t[4]=(m=e[4])*d+(w=e[7])*n+(y=e[5])*c-(v=e[6])*a,t[5]=y*d+w*a+v*n-m*c,t[6]=v*d+w*c+m*a-y*n,t[7]=w*d-m*n-y*a-v*c,t},ni.rotateByQuatPrepend=function(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=r[0],y=r[1],v=r[2],w=r[3];return t[0]=n*w+d*m+a*v-c*y,t[1]=a*w+d*y+c*m-n*v,t[2]=c*w+d*v+n*y-a*m,t[3]=d*w-n*m-a*y-c*v,t[4]=n*(w=r[7])+d*(m=r[4])+a*(v=r[6])-c*(y=r[5]),t[5]=a*w+d*y+c*m-n*v,t[6]=c*w+d*v+n*y-a*m,t[7]=d*w-n*m-a*y-c*v,t},ni.rotateAroundAxis=function(t,e,r,n){if(Math.abs(n)<ns.EPSILON)return kv(t,e);var a=Math.hypot(r[0],r[1],r[2]);n*=.5;var c=Math.sin(n),d=c*r[0]/a,m=c*r[1]/a,y=c*r[2]/a,v=Math.cos(n),w=e[0],S=e[1],A=e[2],R=e[3];t[0]=w*v+R*d+S*y-A*m,t[1]=S*v+R*m+A*d-w*y,t[2]=A*v+R*y+w*m-S*d,t[3]=R*v-w*d-S*m-A*y;var D=e[4],k=e[5],U=e[6],G=e[7];return t[4]=D*v+G*d+k*y-U*m,t[5]=k*v+G*m+U*d-D*y,t[6]=U*v+G*y+D*m-k*d,t[7]=G*v-D*d-k*m-U*y,t},ni.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},ni.multiply=Fv,ni.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},ni.lerp=function(t,e,r,n){var a=1-n;return Bv(e,r)<0&&(n=-n),t[0]=e[0]*a+r[0]*n,t[1]=e[1]*a+r[1]*n,t[2]=e[2]*a+r[2]*n,t[3]=e[3]*a+r[3]*n,t[4]=e[4]*a+r[4]*n,t[5]=e[5]*a+r[5]*n,t[6]=e[6]*a+r[6]*n,t[7]=e[7]*a+r[7]*n,t},ni.invert=function(t,e){var r=Hp(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},ni.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},ni.normalize=function(t,e){var r=Hp(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,a=e[1]/r,c=e[2]/r,d=e[3]/r,m=e[4],y=e[5],v=e[6],w=e[7],S=n*m+a*y+c*v+d*w;t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=(m-n*S)/r,t[5]=(y-a*S)/r,t[6]=(v-c*S)/r,t[7]=(w-d*S)/r}return t},ni.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},ni.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},ni.equals=function(t,e){var r=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],y=t[6],v=t[7],w=e[0],S=e[1],A=e[2],R=e[3],D=e[4],k=e[5],U=e[6],G=e[7];return Math.abs(r-w)<=ns.EPSILON*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(n-S)<=ns.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(a-A)<=ns.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-R)<=ns.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(d-D)<=ns.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(m-k)<=ns.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(y-U)<=ns.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(v-G)<=ns.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))},ni.sqrLen=ni.squaredLength=ni.len=ni.length=ni.dot=ni.mul=ni.setReal=ni.getReal=void 0;var ns=hg(ro),zl=hg(kr),Ov=hg(Ur);function Dv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Dv=function(n){return n?r:e})(t)}function hg(t,e){if(t&&t.__esModule)return t;if(t===null||ug(t)!=="object"&&typeof t!="function")return{default:t};var r=Dv(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}function zv(t,e,r){var n=.5*r[0],a=.5*r[1],c=.5*r[2],d=e[0],m=e[1],y=e[2],v=e[3];return t[0]=d,t[1]=m,t[2]=y,t[3]=v,t[4]=n*v+a*y-c*m,t[5]=a*v+c*d-n*y,t[6]=c*v+n*m-a*d,t[7]=-n*d-a*m-c*y,t}function kv(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Fv(t,e,r){var n=e[0],a=e[1],c=e[2],d=e[3],m=r[4],y=r[5],v=r[6],w=r[7],S=e[4],A=e[5],R=e[6],D=e[7],k=r[0],U=r[1],G=r[2],Y=r[3];return t[0]=n*Y+d*k+a*G-c*U,t[1]=a*Y+d*U+c*k-n*G,t[2]=c*Y+d*G+n*U-a*k,t[3]=d*Y-n*k-a*U-c*G,t[4]=n*w+d*m+a*v-c*y+S*Y+D*k+A*G-R*U,t[5]=a*w+d*y+c*m-n*v+A*Y+D*U+R*k-S*G,t[6]=c*w+d*v+n*y-a*m+R*Y+D*G+S*U-A*k,t[7]=d*w-n*m-a*y-c*v+D*Y-S*k-A*U-R*G,t}ni.getReal=zl.copy,ni.setReal=zl.copy,ni.mul=Fv;var Bv=zl.dot;ni.dot=Bv;var Nv=zl.length;ni.length=Nv,ni.len=Nv;var Hp=zl.squaredLength;ni.squaredLength=Hp,ni.sqrLen=Hp;var qr={};function dg(t){return dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dg(t)}Object.defineProperty(qr,"__esModule",{value:!0}),qr.create=jv,qr.clone=function(t){var e=new Iu.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},qr.fromValues=function(t,e){var r=new Iu.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},qr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},qr.set=function(t,e,r){return t[0]=e,t[1]=r,t},qr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},qr.subtract=Vv,qr.multiply=Gv,qr.divide=$v,qr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},qr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},qr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},qr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},qr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},qr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},qr.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},qr.distance=qv,qr.squaredDistance=Zv,qr.length=Hv,qr.squaredLength=Wv,qr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},qr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},qr.normalize=function(t,e){var r=e[0],n=e[1],a=r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},qr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},qr.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},qr.lerp=function(t,e,r,n){var a=e[0],c=e[1];return t[0]=a+n*(r[0]-a),t[1]=c+n*(r[1]-c),t},qr.random=function(t,e){e=e||1;var r=2*Iu.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},qr.transformMat2=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a,t[1]=r[1]*n+r[3]*a,t},qr.transformMat2d=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[2]*a+r[4],t[1]=r[1]*n+r[3]*a+r[5],t},qr.transformMat3=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[3]*a+r[6],t[1]=r[1]*n+r[4]*a+r[7],t},qr.transformMat4=function(t,e,r){var n=e[0],a=e[1];return t[0]=r[0]*n+r[4]*a+r[12],t[1]=r[1]*n+r[5]*a+r[13],t},qr.rotate=function(t,e,r,n){var a=e[0]-r[0],c=e[1]-r[1],d=Math.sin(n),m=Math.cos(n);return t[0]=a*m-c*d+r[0],t[1]=a*d+c*m+r[1],t},qr.angle=function(t,e){var r=t[0],n=t[1],a=e[0],c=e[1],d=Math.sqrt(r*r+n*n)*Math.sqrt(a*a+c*c);return Math.acos(Math.min(Math.max(d&&(r*a+n*c)/d,-1),1))},qr.zero=function(t){return t[0]=0,t[1]=0,t},qr.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},qr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},qr.equals=function(t,e){var r=t[0],n=t[1],a=e[0],c=e[1];return Math.abs(r-a)<=Iu.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=Iu.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))},qr.forEach=qr.sqrLen=qr.sqrDist=qr.dist=qr.div=qr.mul=qr.sub=qr.len=void 0;var Iu=function(t,e){if(t&&t.__esModule)return t;if(t===null||dg(t)!=="object"&&typeof t!="function")return{default:t};var r=Uv(void 0);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}(ro);function Uv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Uv=function(n){return n?r:e})(t)}function jv(){var t=new Iu.ARRAY_TYPE(2);return Iu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Vv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Gv(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function $v(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function qv(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Zv(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Hv(t){return Math.hypot(t[0],t[1])}function Wv(t){var e=t[0],r=t[1];return e*e+r*r}qr.len=Hv,qr.sub=Vv,qr.mul=Gv,qr.div=$v,qr.dist=qv,qr.sqrDist=Zv,qr.sqrLen=Wv;var mM=function(){var t=jv();return function(e,r,n,a,c,d){var m,y;for(r||(r=2),n||(n=0),y=a?Math.min(a*r+n,e.length):e.length,m=n;m<y;m+=r)t[0]=e[m],t[1]=e[m+1],c(t,t,d),e[m]=t[0],e[m+1]=t[1];return e}}();function fg(t){return fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fg(t)}qr.forEach=mM,Object.defineProperty(to,"__esModule",{value:!0}),s.a7=to.vec4=s.N=to.vec3=to.vec2=to.quat2=s.bi=to.quat=s.a6=to.mat4=s.co=to.mat3=to.mat2d=s.b4=to.mat2=to.glMatrix=void 0;var _M=el(ro);to.glMatrix=_M;var gM=el(cn);s.b4=to.mat2=gM;var yM=el(fn);to.mat2d=yM;var vM=el(Ri);s.co=to.mat3=vM;var xM=el(Ur);s.a6=to.mat4=xM;var bM=el(kr);s.bi=to.quat=bM;var wM=el(ni);to.quat2=wM;var TM=el(qr);to.vec2=TM;var EM=el(Nr);s.N=to.vec3=EM;var SM=el(Qr);function Xv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Xv=function(n){return n?r:e})(t)}function el(t,e){if(t&&t.__esModule)return t;if(t===null||fg(t)!=="object"&&typeof t!="function")return{default:t};var r=Xv(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,r&&r.set(t,n),n}s.a7=to.vec4=SM;class pg{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,n){const a=s.N.dot(r,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/a;return n[0]=this.pos[0]+this.dir[0]*c,n[1]=this.pos[1]+this.dir[1]*c,n[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,r,n){if(s.N.equals(this.pos,e)||r===0)return n[0]=n[1]=n[2]=0,!1;const[a,c,d]=this.dir,m=this.pos[0]-e[0],y=this.pos[1]-e[1],v=this.pos[2]-e[2],w=a*a+c*c+d*d,S=2*(m*a+y*c+v*d),A=S*S-4*w*(m*m+y*y+v*v-r*r);if(A<0){const R=Math.max(-S/2,0),D=m+a*R,k=y+c*R,U=v+d*R,G=Math.hypot(D,k,U);return n[0]=D*r/G,n[1]=k*r/G,n[2]=U*r/G,!1}{const R=(-S-Math.sqrt(A))/(2*w);if(R<0){const D=Math.hypot(m,y,v);return n[0]=m*r/D,n[1]=y*r/D,n[2]=v*r/D,!1}return n[0]=m+a*R,n[1]=y+c*R,n[2]=v+d*R,!0}}}class mg{constructor(e,r,n,a,c){this.TL=e,this.TR=r,this.BR=n,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(e,r,n){const a=[-1,1,1],c=[1,1,1],d=[1,-1,1],m=[-1,-1,1],y=s.N.transformMat4(a,a,e),v=s.N.transformMat4(c,c,e),w=s.N.transformMat4(d,d,e),S=s.N.transformMat4(m,m,e);return new mg(y,v,w,S,r/n)}}function Qd(t,e,r){let n=1/0,a=-1/0;const c=[];for(const d of t){s.N.sub(c,d,e);const m=s.N.dot(c,r);n=Math.min(n,m),a=Math.max(a,m)}return[n,a]}function Yv(t,e){let r=!0;for(let n=0;n<t.planes.length;n++){const a=t.planes[n];let c=0;for(let d=0;d<e.length;d++)c+=s.N.dot(a,e[d])+a[3]>=0;if(c===0)return 0;c!==e.length&&(r=!1)}return r?2:1}function Kv(t,e){for(const r of t.projections){const n=Qd(e,t.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function Jv(t,e){let r=0;const n=[0,0,0,0];for(let a=0;a<t.length;a++)n[0]=t[a][0],n[1]=t[a][1],n[2]=t[a][2],n[3]=1,s.a7.dot(n,e)>=0&&r++;return r}class _g{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=pn.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.N.sub([],this.points[2],this.points[3]),s.N.sub([],this.points[0],this.points[3]),s.N.sub([],this.points[4],this.points[0]),s.N.sub([],this.points[5],this.points[1]),s.N.sub([],this.points[6],this.points[2]),s.N.sub([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const a=[0,-n[2],n[1]],c=[n[2],0,-n[0]];this.projections.push({axis:a,projection:Qd(this.points,this.points[0],a)}),this.projections.push({axis:c,projection:Qd(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,r,n,a){const c=Math.pow(2,n),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const w=s.a7.transformMat4([],v,e),S=1/w[3]/r*c;return s.a7.mul(w,w,[S,S,a?1/w[3]:S,S])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const w=s.N.sub([],d[v[0]],d[v[1]]),S=s.N.sub([],d[v[2]],d[v[1]]),A=s.N.normalize([],s.N.cross([],w,S)),R=-s.N.dot(A,d[v[1]]);return A.concat(R)}),y=[];for(let v=0;v<d.length;v++)y.push([d[v][0],d[v][1],d[v][2]]);return new _g(y,m)}intersectsPrecise(e,r,n){for(let a=0;a<r.length;a++)if(!Jv(e,r[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Jv(e,this.planes[a]))return 0;for(const a of n)for(const c of this.frustumEdges){const d=s.N.cross([],a,c),m=s.N.length(d);if(m===0)continue;s.N.scale(d,d,1/m);const y=Qd(this.points,this.points[0],d),v=Qd(e,this.points[0],d);if(y[0]>v[1]||v[0]>y[1])return 0}return 1}}class pn{static fromPoints(e){const r=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const a of e)s.N.min(r,r,a),s.N.max(n,n,a);return new pn(r,n)}static fromTileIdAndHeight(e,r,n){const a=1<<e.canonical.z,c=e.canonical.x,d=e.canonical.y;return new pn([c/a,d/a,r],[(c+1)/a,(d+1)/a,n])}static applyTransform(e,r){const n=e.getCorners();for(let a=0;a<n.length;++a)s.N.transformMat4(n[a],n[a],r);return pn.fromPoints(n)}static projectAabbCorners(e,r){const n=e.getCorners();for(let a=0;a<n.length;++a)s.N.transformMat4(n[a],n[a],r);return n}constructor(e,r){this.min=e,this.max=r,this.center=s.N.scale([],s.N.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=s.N.clone(this.min),a=s.N.clone(this.max);for(let c=0;c<r.length;c++)n[c]=r[c]?this.min[c]:this.center[c],a[c]=r[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new pn(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Yv(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Yv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Kv(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Kv(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Gt(pn,"Aabb");const MM=xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Wp}=MM,AM=xi([{name:"a_pos_3",components:3,type:"Int16"}]);var Qv=xi([{name:"a_pos",type:"Int16",components:2}]);function Xp(t){return t*J/je}const IM=[new pn([ye,ye,ye],[De,De,De]),new pn([ye,ye,ye],[0,0,De]),new pn([0,ye,ye],[De,0,De]),new pn([ye,0,ye],[0,De,De]),new pn([0,0,ye],[De,De,De])];function ex(t,e,r,n=!0){const a=s.N.scale([],t._camera.position,t.worldSize),c=[e,r,1,1];s.a7.transformMat4(c,c,t.pixelMatrixInverse),s.a7.scale(c,c,1/c[3]);const d=s.N.sub([],c,a),m=s.N.normalize([],d),y=t.globeMatrix,v=[y[12],y[13],y[14]],w=s.N.sub([],v,a),S=s.N.length(w),A=s.N.normalize([],w),R=t.worldSize/(2*Math.PI),D=s.N.dot(A,m),k=Math.asin(R/S);if(k<Math.acos(D)){if(!n)return null;const Pe=[],qe=[];s.N.scale(Pe,m,S/D),s.N.normalize(qe,s.N.sub(qe,Pe,w)),s.N.normalize(m,s.N.add(m,w,s.N.scale(m,qe,Math.tan(k)*S)))}const U=[];new pg(a,m).closestPointOnSphere(v,R,U);const G=s.N.normalize([],se(y,0)),Y=s.N.normalize([],se(y,1)),te=s.N.normalize([],se(y,2)),ee=s.N.dot(G,U),ue=s.N.dot(Y,U),le=s.N.dot(te,U),pe=zi(Math.asin(-ue/R));let be=zi(Math.atan2(ee,le));be=t.center.lng+function(Pe,qe){const Qe=(qe-Pe+180)%360-180;return Qe<-180?Qe+360:Qe}(t.center.lng,be);const Ie=Br(be),ze=Zt(Mr(pe),0,1);return new si(Ie,ze)}class CM{constructor(e,r,n){this.a=s.N.sub([],e,n),this.b=s.N.sub([],r,n),this.center=n;const a=s.N.normalize([],this.a),c=s.N.normalize([],this.b);this.angle=Math.acos(s.N.dot(a,c))}}function gg(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(n,a,c,d){const m=Math.sin(c);return n*(Math.sin((1-d)*c)/m)+a*(Math.sin(d*c)/m)}(t.a[e],t.b[e],t.angle,Zt(r,0,1))+t.center[e]}function tl(t){if(t.z<=1)return IM[t.z+2*t.y+t.x];const e=yg(Yp(t));return pn.fromPoints(e)}function kl(t,e,r){return s.N.scale(t,t,1-r),s.N.scaleAndAdd(t,t,e,r)}function tx(t,e,r){for(const n of t)s.N.transformMat4(n,n,e),s.N.scale(n,n,r)}function rx(t,e,r,n){const a=e/t.worldSize,c=t.globeMatrix;if(r.z<=1){const Ie=tl(r).getCorners();return tx(Ie,c,a),pn.fromPoints(Ie)}const d=Yp(r,n),m=yg(d,J+Xp(t._tileCoverLift));tx(m,c,a);const y=Number.MAX_VALUE,v=[-y,-y,-y],w=[y,y,y];if(d.contains(t.center)){for(const Pe of m)s.N.min(w,w,Pe),s.N.max(v,v,Pe);v[2]=0;const Ie=t.point,ze=[Ie.x*a,Ie.y*a,0];return s.N.min(w,w,ze),s.N.max(v,v,ze),new pn(w,v)}if(t._tileCoverLift>0){for(const Ie of m)s.N.min(w,w,Ie),s.N.max(v,v,Ie);return new pn(w,v)}const S=[c[12]*a,c[13]*a,c[14]*a],A=d.getCenter(),R=Zt(t.center.lat,-Hr,Hr),D=Zt(A.lat,-Hr,Hr),k=Br(t.center.lng),U=Mr(R);let G=k-Br(A.lng);const Y=U-Mr(D);G>.5?G-=1:G<-.5&&(G+=1);let te=0;if(Math.abs(G)>Math.abs(Y))te=G>=0?1:3;else{te=Y>=0?0:2;const Ie=[c[4]*a,c[5]*a,c[6]*a],ze=-Math.sin(br(Y>=0?d.getSouth():d.getNorth()))*J;s.N.scaleAndAdd(S,S,Ie,ze)}const ee=m[te],ue=m[(te+1)%4],le=new CM(ee,ue,S),pe=[gg(le,0)||ee[0],gg(le,1)||ee[1],gg(le,2)||ee[2]],be=mc(t.zoom);if(be>0){const Ie=function({x:Pe,y:qe,z:Qe},Ve,Je,Ne,Ke){const Et=1/(1<<Qe);let tt=Pe*Et,Xt=tt+Et,Bt=qe*Et,st=Bt+Et,xr=0;const or=(tt+Xt)/2-Ne;return or>.5?xr=-1:or<-.5&&(xr=1),tt=((tt+xr)*Ve-(Ne*=Ve))*Je+Ne,Xt=((Xt+xr)*Ve-Ne)*Je+Ne,Bt=(Bt*Ve-(Ke*=Ve))*Je+Ke,st=(st*Ve-Ke)*Je+Ke,[[tt,st,0],[Xt,st,0],[Xt,Bt,0],[tt,Bt,0]]}(r,e,t._pixelsPerMercatorPixel,k,U);for(let Pe=0;Pe<m.length;Pe++)kl(m[Pe],Ie[Pe],be);const ze=s.N.add([],Ie[te],Ie[(te+1)%4]);s.N.scale(ze,ze,.5),kl(pe,ze,be)}for(const Ie of m)s.N.min(w,w,Ie),s.N.max(v,v,Ie);return w[2]=Math.min(ee[2],ue[2]),s.N.min(w,w,pe),s.N.max(v,v,pe),new pn(w,v)}function Yp({x:t,y:e,z:r},n=!1){const a=1/(1<<r),c=new Ae(Lr(t*a),e===(1<<r)-1&&n?-90:ri((e+1)*a)),d=new Ae(Lr((t+1)*a),e===0&&n?90:ri(e*a));return new Be(c,d)}function yg(t,e=J){const r=br(t.getNorth()),n=br(t.getSouth()),a=Math.cos(r),c=Math.cos(n),d=Math.sin(r),m=Math.sin(n),y=t.getWest(),v=t.getEast();return[Te(c,m,y,e),Te(c,m,v,e),Te(a,d,v,e),Te(a,d,y,e)]}function ef(t,e,r,n){const a=1<<r.z,c=(t/Mt+r.x)/a;return $e(ri((e/Mt+r.y)/a),Lr(c),n)}function Kp({min:t,max:e}){return ae/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const ix=new Float64Array(16);function Jp(t){const e=Kp(t),r=s.a6.fromScaling(ix,[e,e,e]);return s.a6.translate(r,r,s.N.negate([],t.min))}function vg(t){const e=s.a6.fromTranslation(ix,t.min),r=1/Kp(t);return s.a6.scale(e,e,[r,r,r])}function xg(t){const e=Mt/(2*Math.PI);return t/(2*Math.PI)/e}function nx(t,e){return Mt/(512*Math.pow(2,t))*Kp(tl(e))}function ox(t,e,r,n,a){const c=xg(r),d=[t,e,-r/(2*Math.PI)],m=s.a6.identity(new Float64Array(16));return s.a6.translate(m,m,d),s.a6.scale(m,m,[c,c,c]),s.a6.rotateX(m,m,br(-a)),s.a6.rotateY(m,m,br(-n)),m}function mc(t){return Pn(oe,H,t)}function sx(t,e){const r=$e(e.lat,e.lng),n=function(c){const d=$e(c._center.lat,c._center.lng),m=s.N.fromValues(0,1,0);let y=s.N.cross([],m,d);const v=s.a6.fromRotation([],-c.angle,d);y=s.N.transformMat4(y,y,v),s.a6.fromRotation(v,-c._pitch,y);const w=s.N.normalize([],d);return s.N.scale(w,w,Xp(c.cameraToCenterDistance/c.pixelsPerMeter)),s.N.transformMat4(w,w,v),s.N.add([],d,w)}(t),a=s.N.subtract([],n,r);return s.N.angle(a,r)}function bg(t,e){return sx(t,e)>Math.PI/2*1.01}const ax=br(85),PM=Math.cos(ax),LM=Math.sin(ax),RM=s.a6.create(),lx=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function cx(t,e,r,n,a,c,d,m,y){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(y*=t.pixelToTileUnitsFactor);const v=t.tileID.canonical,w=r.projection.upVectorScale(v,r.center.lat,r.worldSize).metersToTile;for(const S of e)for(const A of S){const R=A.add(m),D=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(R.x,R.y,!0):0,k=r.projection.projectTilePoint(R.x,R.y,v);if(D>0){const te=r.projection.upVector(v,R.x,R.y);k.x+=te[0]*w*D,k.y+=te[1]*w*D,k.z+=te[2]*w*D}const U=c?R:OM(k.x,k.y,k.z,n),G=c?t.tilespaceRays.map(te=>zM(te,D)):t.queryGeometry.screenGeometry,Y=s.a7.transformMat4([],[k.x,k.y,k.z,1],n);if(!d&&c?y*=Y[3]/r.cameraToCenterDistance:d&&!c&&(y*=r.cameraToCenterDistance/Y[3]),c){const te=ri((A.y/Mt+v.y)/(1<<v.z));y/=r.projection.pixelsPerMeter(te,1)/Or(1,te)}if(Ja(G,U,y))return!0}return!1}function OM(t,e,r,n){const a=s.a7.transformMat4([],[t,e,r,1],n);return new dt(a[0]/a[3],a[1]/a[3])}const ux=s.N.fromValues(0,0,0),DM=s.N.fromValues(0,0,1);function zM(t,e){const r=s.N.create();return ux[2]=e,t.intersectsPlane(ux,DM,r),new dt(r[0],r[1])}class hx extends Ho{}function dx(t,{width:e,height:r},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=a,t}function fx(t,e,r){const{width:n,height:a}=e;n===t.width&&a===t.height||(wg(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,a)},r),t.width=n,t.height=a,t.data=e.data)}function wg(t,e,r,n,a,c,d){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||r.x>t.width-a.width||r.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,y=e.data,v=c===4&&d;for(let w=0;w<a.height;w++){const S=((r.y+w)*t.width+r.x)*c,A=((n.y+w)*e.width+n.x)*c;if(v)for(let R=0;R<a.width;R++){const D=S+R*c+3,k=A+R*c;y[k+0]=255,y[k+1]=255,y[k+2]=255,y[k+3]=m[D]}else for(let R=0;R<a.width*c;R++)y[A+R]=m[S+R]}return e}Gt(hx,"HeatmapBucket",{omit:["layers"]});class _c{constructor(e,r){dx(this,e,1,r)}resize(e){fx(this,new _c(e),1)}clone(){return new _c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,c){wg(e,r,n,a,c,1)}}class Vs{constructor(e,r){dx(this,e,4,r)}resize(e){fx(this,new Vs(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,c,d){wg(e,r,n,a,c,4,d)}}class px{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}Gt(_c,"AlphaImage"),Gt(Vs,"RGBAImage");const kM=new an({visibility:new xt(Re.layout_heatmap.visibility)});var FM={paint:new an({"heatmap-radius":new fr(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fr(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cl(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(Re.paint_heatmap["heatmap-opacity"])}),layout:kM};function tf(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,a=t.image||new Vs({width:r,height:n}),c=(d,m,y)=>{e[t.evaluationKey]=y;const v=t.expression.evaluate(e);v&&(a.data[d+m+0]=Math.floor(255*v.r/v.a),a.data[d+m+1]=Math.floor(255*v.g/v.a),a.data[d+m+2]=Math.floor(255*v.b/v.a),a.data[d+m+3]=Math.floor(255*v.a))};if(t.clips)for(let d=0,m=0;d<n;++d,m+=4*r)for(let y=0,v=0;y<r;y++,v+=4){const w=y/(r-1),{start:S,end:A}=t.clips[d];c(m,v,S*(1-w)+A*w)}else for(let d=0,m=0;d<r;d++,m+=4)c(0,m,d/(r-1));return a}const BM=new an({visibility:new xt(Re.layout_hillshade.visibility)});var NM={paint:new an({"hillshade-illumination-direction":new xt(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xt(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new xt(Re.paint_hillshade["hillshade-emissive-strength"])}),layout:BM};const UM=xi([{name:"a_pos",components:2,type:"Int16"}],4),{members:jM}=UM;var Tg={exports:{}};function Qp(t,e,r){r=r||2;var n,a,c,d,m,y,v,w=e&&e.length,S=w?e[0]*r:t.length,A=mx(t,0,S,r,!0),R=[];if(!A||A.next===A.prev)return R;if(w&&(A=function(k,U,G,Y){var te,ee,ue,le=[];for(te=0,ee=U.length;te<ee;te++)(ue=mx(k,U[te]*Y,te<ee-1?U[te+1]*Y:k.length,Y,!1))===ue.next&&(ue.steiner=!0),le.push(XM(ue));for(le.sort(ZM),te=0;te<le.length;te++)G=HM(le[te],G);return G}(t,e,A,r)),t.length>80*r){n=c=t[0],a=d=t[1];for(var D=r;D<S;D+=r)(m=t[D])<n&&(n=m),(y=t[D+1])<a&&(a=y),m>c&&(c=m),y>d&&(d=y);v=(v=Math.max(c-n,d-a))!==0?32767/v:0}return rf(A,R,r,n,a,v,0),R}function mx(t,e,r,n,a){var c,d;if(a===Mg(t,e,r,n)>0)for(c=e;c<r;c+=n)d=yx(c,t[c],t[c+1],d);else for(c=r-n;c>=e;c-=n)d=yx(c,t[c],t[c+1],d);return d&&em(d,d.next)&&(of(d),d=d.next),d}function Cu(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!em(n,n.next)&&Vn(n.prev,n,n.next)!==0)n=n.next;else{if(of(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function rf(t,e,r,n,a,c,d){if(t){!d&&c&&function(w,S,A,R){var D=w;do D.z===0&&(D.z=Eg(D.x,D.y,S,A,R)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==w);D.prevZ.nextZ=null,D.prevZ=null,function(k){var U,G,Y,te,ee,ue,le,pe,be=1;do{for(G=k,k=null,ee=null,ue=0;G;){for(ue++,Y=G,le=0,U=0;U<be&&(le++,Y=Y.nextZ);U++);for(pe=be;le>0||pe>0&&Y;)le!==0&&(pe===0||!Y||G.z<=Y.z)?(te=G,G=G.nextZ,le--):(te=Y,Y=Y.nextZ,pe--),ee?ee.nextZ=te:k=te,te.prevZ=ee,ee=te;G=Y}ee.nextZ=null,be*=2}while(ue>1)}(D)}(t,n,a,c);for(var m,y,v=t;t.prev!==t.next;)if(m=t.prev,y=t.next,c?GM(t,n,a,c):VM(t))e.push(m.i/r|0),e.push(t.i/r|0),e.push(y.i/r|0),of(t),t=y.next,v=y.next;else if((t=y)===v){d?d===1?rf(t=$M(Cu(t),e,r),e,r,n,a,c,2):d===2&&qM(t,e,r,n,a,c):rf(Cu(t),e,r,n,a,c,1);break}}}function VM(t){var e=t.prev,r=t,n=t.next;if(Vn(e,r,n)>=0)return!1;for(var a=e.x,c=r.x,d=n.x,m=e.y,y=r.y,v=n.y,w=a<c?a<d?a:d:c<d?c:d,S=m<y?m<v?m:v:y<v?y:v,A=a>c?a>d?a:d:c>d?c:d,R=m>y?m>v?m:v:y>v?y:v,D=n.next;D!==e;){if(D.x>=w&&D.x<=A&&D.y>=S&&D.y<=R&&Th(a,m,c,y,d,v,D.x,D.y)&&Vn(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function GM(t,e,r,n){var a=t.prev,c=t,d=t.next;if(Vn(a,c,d)>=0)return!1;for(var m=a.x,y=c.x,v=d.x,w=a.y,S=c.y,A=d.y,R=m<y?m<v?m:v:y<v?y:v,D=w<S?w<A?w:A:S<A?S:A,k=m>y?m>v?m:v:y>v?y:v,U=w>S?w>A?w:A:S>A?S:A,G=Eg(R,D,e,r,n),Y=Eg(k,U,e,r,n),te=t.prevZ,ee=t.nextZ;te&&te.z>=G&&ee&&ee.z<=Y;){if(te.x>=R&&te.x<=k&&te.y>=D&&te.y<=U&&te!==a&&te!==d&&Th(m,w,y,S,v,A,te.x,te.y)&&Vn(te.prev,te,te.next)>=0||(te=te.prevZ,ee.x>=R&&ee.x<=k&&ee.y>=D&&ee.y<=U&&ee!==a&&ee!==d&&Th(m,w,y,S,v,A,ee.x,ee.y)&&Vn(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;te&&te.z>=G;){if(te.x>=R&&te.x<=k&&te.y>=D&&te.y<=U&&te!==a&&te!==d&&Th(m,w,y,S,v,A,te.x,te.y)&&Vn(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ee&&ee.z<=Y;){if(ee.x>=R&&ee.x<=k&&ee.y>=D&&ee.y<=U&&ee!==a&&ee!==d&&Th(m,w,y,S,v,A,ee.x,ee.y)&&Vn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function $M(t,e,r){var n=t;do{var a=n.prev,c=n.next.next;!em(a,c)&&_x(a,n,n.next,c)&&nf(a,c)&&nf(c,a)&&(e.push(a.i/r|0),e.push(n.i/r|0),e.push(c.i/r|0),of(n),of(n.next),n=t=c),n=n.next}while(n!==t);return Cu(n)}function qM(t,e,r,n,a,c){var d=t;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&YM(d,m)){var y=gx(d,m);return d=Cu(d,d.next),y=Cu(y,y.next),rf(d,e,r,n,a,c,0),void rf(y,e,r,n,a,c,0)}m=m.next}d=d.next}while(d!==t)}function ZM(t,e){return t.x-e.x}function HM(t,e){var r=function(a,c){var d,m=c,y=a.x,v=a.y,w=-1/0;do{if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){var S=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(S<=y&&S>w&&(w=S,d=m.x<m.next.x?m:m.next,S===y))return d}m=m.next}while(m!==c);if(!d)return null;var A,R=d,D=d.x,k=d.y,U=1/0;m=d;do y>=m.x&&m.x>=D&&y!==m.x&&Th(v<k?y:w,v,D,k,v<k?w:y,v,m.x,m.y)&&(A=Math.abs(v-m.y)/(y-m.x),nf(m,a)&&(A<U||A===U&&(m.x>d.x||m.x===d.x&&WM(d,m)))&&(d=m,U=A)),m=m.next;while(m!==R);return d}(t,e);if(!r)return e;var n=gx(r,t);return Cu(n,n.next),Cu(r,r.next)}function WM(t,e){return Vn(t.prev,t,e.prev)<0&&Vn(e.next,t,t.next)<0}function Eg(t,e,r,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function XM(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Th(t,e,r,n,a,c,d,m){return(a-d)*(e-m)>=(t-d)*(c-m)&&(t-d)*(n-m)>=(r-d)*(e-m)&&(r-d)*(c-m)>=(a-d)*(n-m)}function YM(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,n){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==n.i&&a.next.i!==n.i&&_x(a,a.next,r,n))return!0;a=a.next}while(a!==r);return!1}(t,e)&&(nf(t,e)&&nf(e,t)&&function(r,n){var a=r,c=!1,d=(r.x+n.x)/2,m=(r.y+n.y)/2;do a.y>m!=a.next.y>m&&a.next.y!==a.y&&d<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==r);return c}(t,e)&&(Vn(t.prev,t,e.prev)||Vn(t,e.prev,e))||em(t,e)&&Vn(t.prev,t,t.next)>0&&Vn(e.prev,e,e.next)>0)}function Vn(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function em(t,e){return t.x===e.x&&t.y===e.y}function _x(t,e,r,n){var a=rm(Vn(t,e,r)),c=rm(Vn(t,e,n)),d=rm(Vn(r,n,t)),m=rm(Vn(r,n,e));return a!==c&&d!==m||!(a!==0||!tm(t,r,e))||!(c!==0||!tm(t,n,e))||!(d!==0||!tm(r,t,n))||!(m!==0||!tm(r,e,n))}function tm(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function rm(t){return t>0?1:t<0?-1:0}function nf(t,e){return Vn(t.prev,t,t.next)<0?Vn(t,e,t.next)>=0&&Vn(t,t.prev,e)>=0:Vn(t,e,t.prev)<0||Vn(t,t.next,e)<0}function gx(t,e){var r=new Sg(t.i,t.x,t.y),n=new Sg(e.i,e.x,e.y),a=t.next,c=e.prev;return t.next=e,e.prev=t,r.next=a,a.prev=r,n.next=r,r.prev=n,c.next=n,n.prev=c,n}function yx(t,e,r,n){var a=new Sg(t,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function of(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sg(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mg(t,e,r,n){for(var a=0,c=e,d=r-n;c<r;c+=n)a+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return a}Tg.exports=Qp,Tg.exports.default=Qp,Qp.deviation=function(t,e,r,n){var a=e&&e.length,c=Math.abs(Mg(t,0,a?e[0]*r:t.length,r));if(a)for(var d=0,m=e.length;d<m;d++)c-=Math.abs(Mg(t,e[d]*r,d<m-1?e[d+1]*r:t.length,r));var y=0;for(d=0;d<n.length;d+=3){var v=n[d]*r,w=n[d+1]*r,S=n[d+2]*r;y+=Math.abs((t[v]-t[S])*(t[w+1]-t[v+1])-(t[v]-t[w])*(t[S+1]-t[v+1]))}return c===0&&y===0?0:Math.abs((y-c)/c)},Qp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var c=0;c<t[a].length;c++)for(var d=0;d<e;d++)r.vertices.push(t[a][c][d]);a>0&&r.holes.push(n+=t[a-1].length)}return r};var im=It(Tg.exports);function Ag(t,e){const r=t.length;if(r<=1)return[t];const n=[];let a,c;for(let d=0;d<r;d++){const m=rt(t[d]);m!==0&&(t[d].area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(a&&n.push(a),a=[t[d]]):a.push(t[d]))}if(a&&n.push(a),e>1)for(let d=0;d<n.length;d++)n[d].length<=e||(Yu(n[d],e,1,n[d].length-1,KM),n[d]=n[d].slice(0,e));return n}function KM(t,e){return e.area-t.area}function Ig(t,e,r){const n=r.patternDependencies;let a=!1;for(const c of e){const d=c.paint.get(`${t}-pattern`);d.isConstant()||(a=!0);const m=d.constantOr(null);m&&(a=!0,n[m]=!0)}return a}function Cg(t,e,r,n,a){const c=a.patternDependencies;for(const d of e){const m=d.paint.get(`${t}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:n},r,{},a.availableImages);y=y&&y.name?y.name:y,c[y]=!0,r.patterns[d.id]=y}}return r}class Pg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ns,this.indexArray=new Hn,this.indexArray2=new ta,this.programConfigurations=new q(e.layers,e.zoom),this.segments=new vn,this.segments2=new vn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,n,a){this.hasPattern=Ig("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:m,id:y,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,A=Un(m,S);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),A,n))continue;const R=c?c.evaluate(A,{},n,r.availableImages):void 0,D={id:y,properties:m.properties,type:m.type,sourceLayerIndex:w,index:v,geometry:S?A.geometry:Xn(m,n,a),patterns:{},sortKey:R};d.push(D)}c&&d.sort((m,y)=>m.sortKey-y.sortKey);for(const m of d){const{geometry:y,index:v,sourceLayerIndex:w}=m;if(this.hasPattern){const S=Cg("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(S)}else this.addFeature(m,y,v,n,{},r.availableImages,r.brightness);r.featureIndex.insert(e[v].feature,y,v,w,this.index)}}update(e,r,n,a,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,d?this.stateDependentLayers:this.layers,n,a,c)}addFeatures(e,r,n,a,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,n,a,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,a,c,d=[],m){for(const y of Ag(r,500)){let v=0;for(const k of y)v+=k.length;const w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),S=w.vertexLength,A=[],R=[];for(const k of y){if(k.length===0)continue;k!==y[0]&&R.push(A.length/2);const U=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),G=U.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(G+k.length-1,G),A.push(k[0].x),A.push(k[0].y);for(let Y=1;Y<k.length;Y++)this.layoutVertexArray.emplaceBack(k[Y].x,k[Y].y),this.indexArray2.emplaceBack(G+Y-1,G+Y),A.push(k[Y].x),A.push(k[Y].y);U.vertexLength+=k.length,U.primitiveLength+=k.length}const D=im(A,R);for(let k=0;k<D.length;k+=3)this.indexArray.emplaceBack(S+D[k],S+D[k+1],S+D[k+2]);w.vertexLength+=v,w.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,a,m)}}Gt(Pg,"FillBucket",{omit:["layers","patternFeatures"]});const JM=new an({"fill-sort-key":new fr(Re.layout_fill["fill-sort-key"]),visibility:new xt(Re.layout_fill.visibility)});var QM={paint:new an({"fill-antialias":new xt(Re.paint_fill["fill-antialias"]),"fill-opacity":new fr(Re.paint_fill["fill-opacity"]),"fill-color":new fr(Re.paint_fill["fill-color"]),"fill-outline-color":new fr(Re.paint_fill["fill-outline-color"]),"fill-translate":new xt(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new fr(Re.paint_fill["fill-pattern"]),"fill-emissive-strength":new xt(Re.paint_fill["fill-emissive-strength"])}),layout:JM};const eA=xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tA=xi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rA=xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iA=xi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),nA=xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oA}=eA;var nm={},sA=Ai,vx=Eh;function Eh(t,e,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(aA,this,e)}function aA(t,e,r){t==1?e.id=r.readVarint():t==2?function(n,a){for(var c=n.readVarint()+n.pos;n.pos<c;){var d=a._keys[n.readVarint()],m=a._values[n.readVarint()];a.properties[d]=m}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function lA(t){for(var e,r,n=0,a=0,c=t.length,d=c-1;a<c;d=a++)n+=((r=t[d]).x-(e=t[a]).x)*(e.y+r.y);return n}Eh.types=["Unknown","Point","LineString","Polygon"],Eh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,a=0,c=0,d=0,m=[];t.pos<r;){if(a<=0){var y=t.readVarint();n=7&y,a=y>>3}if(a--,n===1||n===2)c+=t.readSVarint(),d+=t.readSVarint(),n===1&&(e&&m.push(e),e=[]),e.push(new sA(c,d));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Eh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,a=0,c=0,d=1/0,m=-1/0,y=1/0,v=-1/0;t.pos<e;){if(n<=0){var w=t.readVarint();r=7&w,n=w>>3}if(n--,r===1||r===2)(a+=t.readSVarint())<d&&(d=a),a>m&&(m=a),(c+=t.readSVarint())<y&&(y=c),c>v&&(v=c);else if(r!==7)throw new Error("unknown command "+r)}return[d,y,m,v]},Eh.prototype.toGeoJSON=function(t,e,r){var n,a,c=this.extent*Math.pow(2,r),d=this.extent*t,m=this.extent*e,y=this.loadGeometry(),v=Eh.types[this.type];function w(R){for(var D=0;D<R.length;D++){var k=R[D];R[D]=[360*(k.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(k.y+m)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(n=0;n<y.length;n++)S[n]=y[n][0];w(y=S);break;case 2:for(n=0;n<y.length;n++)w(y[n]);break;case 3:for(y=function(R){var D=R.length;if(D<=1)return[R];for(var k,U,G=[],Y=0;Y<D;Y++){var te=lA(R[Y]);te!==0&&(U===void 0&&(U=te<0),U===te<0?(k&&G.push(k),k=[R[Y]]):k.push(R[Y]))}return k&&G.push(k),G}(y),n=0;n<y.length;n++)for(a=0;a<y[n].length;a++)w(y[n][a])}y.length===1?y=y[0]:v="Multi"+v;var A={type:"Feature",geometry:{type:v,coordinates:y},properties:this.properties};return"id"in this&&(A.id=this.id),A};var cA=vx,xx=bx;function bx(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(uA,this,e),this.length=this._features.length}function uA(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(n){for(var a=null,c=n.readVarint()+n.pos;n.pos<c;){var d=n.readVarint()>>3;a=d===1?n.readString():d===2?n.readFloat():d===3?n.readDouble():d===4?n.readVarint64():d===5?n.readVarint():d===6?n.readSVarint():d===7?n.readBoolean():null}return a}(r))}bx.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new cA(this._pbf,e,this.extent,this._keys,this._values)};var hA=xx;function dA(t,e,r){if(t===3){var n=new hA(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}var Lg=nm.VectorTile=function(t,e){this.layers=t.readFields(dA,{},e)},om=nm.VectorTileFeature=vx;function sm(t,e,r,n){const a=[],c=n===0?(d,m,y,v,w,S)=>{d.push(new dt(S,y+(S-m)/(v-m)*(w-y)))}:(d,m,y,v,w,S)=>{d.push(new dt(m+(S-y)/(w-y)*(v-m),S))};for(const d of t){const m=[];for(const y of d){if(y.length<=2)continue;const v=[];for(let A=0;A<y.length-1;A++){const R=y[A].x,D=y[A].y,k=y[A+1].x,U=y[A+1].y,G=n===0?R:D,Y=n===0?k:U;G<e?Y>e&&c(v,R,D,k,U,e):G>r?Y<r&&c(v,R,D,k,U,r):v.push(y[A]),Y<e&&G>=e&&c(v,R,D,k,U,e),Y>r&&G<=r&&c(v,R,D,k,U,r)}let w=y[y.length-1];const S=n===0?w.x:w.y;S>=e&&S<=r&&v.push(w),v.length&&(w=v[v.length-1],v[0].x===w.x&&v[0].y===w.y||v.push(v[0]),m.push(v))}m.length&&a.push(m)}return a}function am(t,e){return t.x-e.x||t.y-e.y}function wx(t,e){return am(t.min,e.min)===0&&am(t.max,e.max)===0}function Tx(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Ex(t,e,r){const n=1/Mt,a=1/(1<<r.canonical.z),c=(e.x*n+r.canonical.x)*a+r.wrap,d=(e.y*n+r.canonical.y)*a;return{min:new dt((t.x*n+r.canonical.x)*a+r.wrap,(t.y*n+r.canonical.y)*a),max:new dt(c,d)}}function fA(t,e,r){const n=1<<r.canonical.z,a=((e.x-r.wrap)*n-r.canonical.x)*Mt,c=(e.y*n-r.canonical.y)*Mt;return{min:new dt(((t.x-r.wrap)*n-r.canonical.x)*Mt,(t.y*n-r.canonical.y)*Mt),max:new dt(a,c)}}function Sx(t,e,r,n,a,c,d){const m=t.indices,y=t.vertices,v=[];for(let w=n;w<n+a;w+=3){const S=e[r[w+0]+c],A=e[r[w+1]+c],R=e[r[w+2]+c],D=Math.min(S.x,A.x,R.x),k=Math.max(S.x,A.x,R.x),U=Math.min(S.y,A.y,R.y),G=Math.max(S.y,A.y,R.y);v.length=0,t.grid.query(new dt(D,U),new dt(k,G),v);for(let Y=0;Y<v.length;Y++){const te=v[Y];if(J_(y[m[3*te+0]],y[m[3*te+1]],y[m[3*te+2]],S,A,R,d))return!0}}return!1}function Mx(t,e,r,n){if(!t||!r)return!1;let a=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(r.vertices.length<t.vertices.length)return Mx(r,n,t,e);const c=e.canonical,d=n.canonical,m=Math.pow(2,d.z-c.z);a=t.vertices.map(y=>new dt(y.x*c.x*Mt*m-d.x*Mt,y.y*c.y*Mt*m-d.y*Mt))}return Sx(r,a,t.indices,0,t.indices.length,0,0)}nm.VectorTileLayer=xx;class Ax{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Ix(t,e,r,n){let a=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(n[d])<1e-15){if(r[d]<t[d]||r[d]>e[d])return null}else{const m=1/n[d];let y=(t[d]-r[d])*m,v=(e[d]-r[d])*m;if(y>v){const w=y;y=v,v=w}if(y>a&&(a=y),v<c&&(c=v),a>c)return null}return a}function Cx(t,e,r,n,a,c,d,m,y,v,w){const S=n-t,A=a-e,R=c-r,D=d-t,k=m-e,U=y-r,G=w[1]*U-w[2]*k,Y=w[2]*D-w[0]*U,te=w[0]*k-w[1]*D,ee=S*G+A*Y+R*te;if(Math.abs(ee)<1e-15)return null;const ue=1/ee,le=v[0]-t,pe=v[1]-e,be=v[2]-r,Ie=(le*G+pe*Y+be*te)*ue;if(Ie<0||Ie>1)return null;const ze=pe*R-be*A,Pe=be*S-le*R,qe=le*A-pe*S,Qe=(w[0]*ze+w[1]*Pe+w[2]*qe)*ue;return Qe<0||Ie+Qe>1?null:(D*ze+k*Pe+U*qe)*ue}function Px(t,e,r){return(t-e)/(r-e)}function Lx(t,e,r,n,a,c,d,m,y){const v=1<<r,w=c-n,S=d-a,A=(t+1)/v*w+n,R=(e+0)/v*S+a,D=(e+1)/v*S+a;m[0]=(t+0)/v*w+n,m[1]=R,y[0]=A,y[1]=D}class Rx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const d=Math.ceil(Math.log2(c.dim/8)),m=[];let y=Math.ceil(Math.pow(2,d));const v=1/y,w=(R,D,k,U,G)=>{const Y=U?1:0,te=(R+1)*k-Y,ee=D*k,ue=(D+1)*k-Y;G[0]=R*k,G[1]=ee,G[2]=te,G[3]=ue};let S=new Ax(y);const A=[];for(let R=0;R<y*y;R++){w(R%y,Math.floor(R/y),v,!1,A);const D=gc(A[0],A[1],c),k=gc(A[2],A[1],c),U=gc(A[2],A[3],c),G=gc(A[0],A[3],c);S.minimums.push(Math.min(D,k,U,G)),S.maximums.push(Math.max(D,k,U,G)),S.leaves.push(1)}for(m.push(S),y/=2;y>=1;y/=2){const R=m[m.length-1];S=new Ax(y);for(let D=0;D<y*y;D++){w(D%y,Math.floor(D/y),2,!0,A);const k=R.getElevation(A[0],A[1]),U=R.getElevation(A[2],A[1]),G=R.getElevation(A[2],A[3]),Y=R.getElevation(A[0],A[3]),te=R.isLeaf(A[0],A[1]),ee=R.isLeaf(A[2],A[1]),ue=R.isLeaf(A[2],A[3]),le=R.isLeaf(A[0],A[3]),pe=Math.min(k.min,U.min,G.min,Y.min),be=Math.max(k.max,U.max,G.max,Y.max),Ie=te&&ee&&ue&&le;S.maximums.push(be),S.minimums.push(pe),S.leaves.push(be-pe<=5&&Ie?1:0)}m.push(S)}return m}(this.dem),n=r.length-1,a=r[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,a,c,d,m=1){return Ix([e,r,-100],[n,a,this.maximums[0]*m],c,d)}raycast(e,r,n,a,c,d,m=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,r,n,a,c,d,m);if(y==null)return null;const v=[],w=[],S=[],A=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:D,t:k,nodex:U,nodey:G,depth:Y}=R.pop();if(this.leaves[D]){Lx(U,G,Y,e,r,n,a,S,A);const ee=1<<Y,ue=(U+0)/ee,le=(U+1)/ee,pe=(G+0)/ee,be=(G+1)/ee,Ie=gc(ue,pe,this.dem)*m,ze=gc(le,pe,this.dem)*m,Pe=gc(le,be,this.dem)*m,qe=gc(ue,be,this.dem)*m,Qe=Cx(S[0],S[1],Ie,A[0],S[1],ze,A[0],A[1],Pe,c,d),Ve=Cx(A[0],A[1],Pe,S[0],A[1],qe,S[0],S[1],Ie,c,d),Je=Math.min(Qe!==null?Qe:Number.MAX_VALUE,Ve!==null?Ve:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const Ne=s.N.scaleAndAdd([],c,d,k);if(Ox(Ie,ze,qe,Pe,Px(Ne[0],S[0],A[0]),Px(Ne[1],S[1],A[1]))>=Ne[2])return k}continue}let te=0;for(let ee=0;ee<this._siblingOffset.length;ee++){Lx((U<<1)+this._siblingOffset[ee][0],(G<<1)+this._siblingOffset[ee][1],Y+1,e,r,n,a,S,A),S[2]=-100,A[2]=this.maximums[this.childOffsets[D]+ee]*m;const ue=Ix(S,A,c,d);if(ue!=null){const le=ue;v[ee]=le;let pe=!1;for(let be=0;be<te&&!pe;be++)le>=v[w[be]]&&(w.splice(be,0,ee),pe=!0);pe||(w[te]=ee),te++}}for(let ee=0;ee<te;ee++){const ue=w[ee];R.push({idx:this.childOffsets[D]+ue,t:v[ue],nodex:(U<<1)+this._siblingOffset[ue][0],nodey:(G<<1)+this._siblingOffset[ue][1],depth:Y+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,a,c){if(e[a].isLeaf(r,n)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=a-1,m=e[d];let y=0,v=0;for(let w=0;w<this._siblingOffset.length;w++){const S=2*r+this._siblingOffset[w][0],A=2*n+this._siblingOffset[w][1],R=m.getElevation(S,A),D=m.isLeaf(S,A),k=this._addNode(R.min,R.max,D);D&&(y|=1<<w),v||(v=k)}for(let w=0;w<this._siblingOffset.length;w++)y&1<<w||this._construct(e,2*r+this._siblingOffset[w][0],2*n+this._siblingOffset[w][1],d,v+w)}}function Ox(t,e,r,n,a,c){return Zr(Zr(t,r,c),Zr(e,n,c),a)}function gc(t,e,r){const n=r.dim,a=Zt(t*n-.5,0,n-1),c=Zt(e*n-.5,0,n-1),d=Math.floor(a),m=Math.floor(c),y=Math.min(d+1,n-1),v=Math.min(m+1,n-1);return Ox(r.get(d,m),r.get(y,m),r.get(d,v),r.get(y,v),a-d,c-m)}const pA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mA(t,e,r){return(256*t*256+256*e+r)/10-1e4}function _A(t,e,r){return 256*t+e+r/256-32768}class lm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,a=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return ve(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2,d=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let y=0;y<c;y++)d[this._idx(-1,y)]=d[this._idx(0,y)],d[this._idx(c,y)]=d[this._idx(c-1,y)],d[this._idx(y,-1)]=d[this._idx(y,0)],d[this._idx(y,c)]=d[this._idx(y,c-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(c,-1)]=d[this._idx(c-1,0)],d[this._idx(-1,c)]=d[this._idx(0,c-1)],d[this._idx(c,c)]=d[this._idx(c-1,c-1)]}const m=n==="terrarium"?_A:mA;for(let y=0;y<d.length;++y){const v=4*y;this.floatView[y]=m(this.pixels[v],this.pixels[v+1],this.pixels[v+2])}this._timestamp=nt.now()}_buildQuadTree(){this._tree=new Rx(this)}get(e,r,n=!1){n&&(e=Zt(e,-1,this.dim),r=Zt(r,-1,this.dim));const a=this._idx(e,r);return this.floatView[a]}set(e,r,n){const a=this._idx(e,r),c=this.floatView[a];return this.floatView[a]=n,n-c}static getUnpackVector(e){return pA[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const n=[0,0,0,0],a=lm.getUnpackVector(r);let c=Math.floor((e+a[3])/a[2]);return n[2]=c%256,c=Math.floor(c/256),n[1]=c%256,c=Math.floor(c/256),n[0]=c,n}getPixels(){return new px({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,c=r*this.dim+this.dim,d=n*this.dim,m=n*this.dim+this.dim;switch(r){case-1:a=c-1;break;case 1:c=a+1}switch(n){case-1:d=m-1;break;case 1:m=d+1}const y=-r*this.dim,v=-n*this.dim;for(let w=d;w<m;w++)for(let S=a;S<c;S++){const A=4*this._idx(S,w),R=4*this._idx(S+y,w+v);this.pixels[A+0]=e.pixels[R+0],this.pixels[A+1]=e.pixels[R+1],this.pixels[A+2]=e.pixels[R+2],this.pixels[A+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Gt(lm,"DEMData"),Gt(Rx,"DemMinMaxQuadTree",{omit:["dem"]});class Sh{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const a=n||e.findDEMTileFor(r);if(!a||!a.dem)return;const c=a.dem,d=a.tileID,m=1<<r.canonical.z-d.canonical.z;return new Sh(a,c.dim/Mt/m,[(r.canonical.x/m-d.canonical.x)*c.dim,(r.canonical.y/m-d.canonical.y)*c.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(n);return new dt(a,c)}getElevationAt(e,r,n,a){const c=e*this._scale+this._offset[0],d=r*this._scale+this._offset[1],m=Math.floor(c),y=Math.floor(d),v=this._dem;return a=!!a,n?Zr(Zr(v.get(m,y,a),v.get(m,y+1,a),d-y),Zr(v.get(m+1,y,a),v.get(m+1,y+1,a),d-y),c-m):v.get(m,y,a)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Or(1,e)*this._dem.stride}}const gA=om.types,yA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],vA=["fill-extrusion-flood-light-ground-radius"],xA=Math.pow(2,13),bA=Math.pow(2,15)-1,Dx=new dt(0,1),yc=2147483648;function sf(t,e,r,n,a,c,d,m){t.emplaceBack((e<<1)+d,(r<<1)+c,(Math.floor(n*xA)<<1)+a,Math.round(m))}function cm(t,e,r,n,a,c){t.emplaceBack(e.x,e.y,(r.x<<1)+n,(r.y<<1)+a,c)}function af(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class zx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class kx{constructor(){this.centroidXY=new dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Fx{constructor(){this.acc=new dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,n){this.accCount++,this.acc._add(r);let a=!!this.borders;r.x<e.min.x?(e.min.x=r.x,a=!0):r.x>e.max.x&&(e.max.x=r.x,a=!0),r.y<e.min.y?(e.min.y=r.y,a=!0):r.y>e.max.y&&(e.max.y=r.y,a=!0),((r.x===0||r.x===Mt)&&r.x===n.x)!=((r.y===0||r.y===Mt)&&r.y===n.y)&&this.processBorderOverlap(r,n),a&&this.checkBorderIntersection(r,n)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Zr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Mt!=e.x>Mt&&this.addBorderIntersection(1,Zr(r.y,e.y,(Mt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Zr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Mt!=e.y>Mt&&this.addBorderIntersection(3,Zr(r.x,e.x,(Mt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){return this.accCount===0?new dt(0,0):new dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function Bx(t,e){const r=t.add(e)._unit(),n=Zt(t.x*r.x+t.y*r.y,-1,1);var a,c,d;return a=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(a)))/4*bA*((c=t).x*(d=e).y-c.y*d.x<0?-1:1)}const wA=[t=>t.x<0,t=>t.x>Mt,t=>t.y<0,t=>t.y>Mt];function TA(t,e,r,n){const a=[4];if(n===0)return a;r._mult(n);const c=t.sub(r),d=e.sub(r),m=[t,e,c,d];for(let y=0;y<4;y++)for(const v of m)if(wA[y](v)){a.push(y);break}return a}class Nx{constructor(e){this.vertexArray=new Bd,this.indexArray=new Hn,this.programConfigurations=new q(e.layers,e.zoom,r=>vA.includes(r)),this._segments=new vn,this.hiddenByLandmarkVertexArray=new Hd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new vn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,n,a=!1){const c=e.length;if(c>2){let d=Math.max(0,this._segments.get().length-1);const m=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let y;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const v=e[0],w=e[1];y=Bx(v.sub(e[c-1])._perp()._unit(),w.sub(v)._perp()._unit())}for(let v=0;v<c;v++){const w=v===c-1?0:v+1,S=e[v],A=e[w],R=e[w===c-1?0:w+1],D=A.sub(S)._perp()._unit(),k=Bx(D,R.sub(A)._perp()._unit()),U=y,G=k;if(Rg(S,A,r)||a&&Vx(S,r)&&Vx(A,r)){y=k;continue}const Y=m.vertexLength;cm(this.vertexArray,S,A,1,1,U),cm(this.vertexArray,S,A,1,0,U),cm(this.vertexArray,S,A,0,1,G),cm(this.vertexArray,S,A,0,0,G),m.vertexLength+=4;const te=TA(S,A,D,n);for(const ee of te)this._segmentToGroundQuads[d].push({id:Y,region:ee}),this._segmentToRegionTriCounts[d][ee]+=2,m.primitiveLength+=2;y=k}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let n=0;n<r;n++)this._segmentToGroundQuads[n].sort((a,c)=>a.region-c.region);for(let n=0;n<r;n++){const a=this._segmentToGroundQuads[n],c=e[n],d=this._segmentToRegionTriCounts[n];d.reduce((y,v)=>y+v,0);let m=0;for(let y=0;y<=4;y++){const v=d[y];if(v!==0){let w=this.regionSegments[y];w||(w=this.regionSegments[y]=new vn);const S={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+m,vertexLength:c.vertexLength,primitiveLength:v};w.get().push(S)}m+=v}for(let y=0;y<a.length;y++){const v=a[y].id;this.indexArray.emplaceBack(v,v+1,v+3),this.indexArray.emplaceBack(v,v+3,v+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,n,a,c,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,n,a,c,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,tA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,n,a,c,d){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,n,a,c,d)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const n=e.flags&yc?1:0;for(let a=e.groundVertexArrayOffset;a<r;++a)this.hiddenByLandmarkVertexArray.emplace(a,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,iA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class um{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Hn,this.footprintVertices=new Ns,this.footprintSegments=[],this.layoutVertexArray=new va,this.centroidVertexArray=new bu,this.indexArray=new Hn,this.programConfigurations=new q(e.layers,e.zoom,r=>yA.includes(r)),this.segments=new vn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new Nx(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,r,n,a){this.features=[],this.hasPattern=Ig("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Xr(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:d,index:m,sourceLayerIndex:y}of e){const v=this.layers[0]._featureFilter.needGeometry,w=Un(c,v);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),w,n))continue;const S={id:d,sourceLayerIndex:y,index:m,geometry:v?w.geometry:Xn(c,n,a),properties:c.properties,type:c.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(Cg("fill-extrusion",this.layers,S,this.zoom,r)):this.addFeature(S,S.geometry,m,n,{},r.availableImages,a,r.brightness),r.featureIndex.insert(c,S.geometry,m,y,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,n,a,c,d){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,r,n,a,c,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,n,a,c){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const m=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,m,n,a,c),this.groundEffect.update(e,r,m,n,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,nA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a,c,d,m,y){const v=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,w=[new dt(0,0),new dt(Mt,Mt)],S=m.projection,A=S.name==="globe",R=gA[e.type]==="Polygon",D=new Fx;D.centroidDataIndex=this.centroidData.length;const k=new kx,U=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,G=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);k.height=G,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ph);const Y=Ag(r,500);for(let be=Y.length-1;be>=0;be--){const Ie=Y[be];(Ie.length===0||(te=Ie[0]).every(ze=>ze.x<=0)||te.every(ze=>ze.x>=Mt)||te.every(ze=>ze.y<=0)||te.every(ze=>ze.y>=Mt))&&Y.splice(be,1)}var te;let ee;if(A)ee=Zx(Y,w,a);else{ee=[];for(const be of Y)ee.push({polygon:be,bounds:w})}const ue=R?this.edgeRadius:0,le=ue>0&&this.zoom<17,pe=(be,Ie)=>{if(be.length===0)return!1;const ze=be[be.length-1];return Ie.x===ze.x&&Ie.y===ze.y};for(const{polygon:be,bounds:Ie}of ee){let ze=0,Pe=0;for(const Je of be)R&&!Je[0].equals(Je[Je.length-1])&&Je.push(Je[0]),Pe+=R?Je.length-1:Je.length;const qe=this.segments.prepareSegment((R?5:4)*Pe,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);const Qe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ve=new zx;if(Ve.vertexOffset=this.footprintVertices.length,Ve.indexOffset=3*this.footprintIndices.length,Ve.ringIndices=[],R){const Je=[],Ne=[];ze=qe.vertexLength;for(let Et=0;Et<be.length;Et++){const tt=be[Et];tt.length&&Et!==0&&Ne.push(Je.length/2);const Xt=[];let Bt,st;Bt=tt[1].sub(tt[0])._perp()._unit(),Ve.ringIndices.push(tt.length-1);for(let xr=1;xr<tt.length;xr++){const or=tt[xr],Wt=tt[xr===tt.length-1?1:xr+1],at=or.clone();if(ue){st=Wt.sub(or)._perp()._unit();const mr=Bt.add(st)._unit(),jr=ue*Math.min(4,1/(Bt.x*mr.x+Bt.y*mr.y));at.x+=jr*mr.x,at.y+=jr*mr.y,at.x=Math.round(at.x),at.y=Math.round(at.y),Bt=st}!U||ue!==0&&!le||pe(Xt,at)||Xt.push(at),sf(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),qe.vertexLength++,this.footprintVertices.emplaceBack(or.x,or.y),Je.push(or.x,or.y),A&&af(this.layoutVertexExtArray,S.projectTilePoint(at.x,at.y,a),S.upVector(a,at.x,at.y))}U&&(ue===0||le)&&(Xt.length!==0&&pe(Xt,Xt[0])&&Xt.pop(),this.groundEffect.addData(Xt,Ie,v))}const Ke=im(Je,Ne);for(let Et=0;Et<Ke.length;Et+=3)this.footprintIndices.emplaceBack(Ve.vertexOffset+Ke[Et+0],Ve.vertexOffset+Ke[Et+1],Ve.vertexOffset+Ke[Et+2]),this.indexArray.emplaceBack(ze+Ke[Et],ze+Ke[Et+2],ze+Ke[Et+1]),qe.primitiveLength++;Ve.indexCount+=Ke.length,Ve.vertexCount+=this.footprintVertices.length-Ve.vertexOffset}for(let Je=0;Je<be.length;Je++){const Ne=be[Je];D.startRing(k,Ne[0]);let Ke=Ne.length>4&&Gx(Ne[Ne.length-2],Ne[0],Ne[1]),Et=ue?EA(Ne[Ne.length-2],Ne[0],Ne[1],ue):0;const tt=[];let Xt,Bt,st;Bt=Ne[1].sub(Ne[0])._perp()._unit();let xr=!0;for(let or=1,Wt=0;or<Ne.length;or++){let at=Ne[or-1],mr=Ne[or];const jr=Ne[or===Ne.length-1?1:or+1];if(D.appendEdge(k,mr,at),Rg(mr,at,Ie)){ue&&(Bt=jr.sub(mr)._perp()._unit(),xr=!xr);continue}const wr=mr.sub(at)._perp(),Vr=wr.x/(Math.abs(wr.x)+Math.abs(wr.y)),Pr=wr.y>0?1:0,ei=at.dist(mr);if(Wt+ei>32768&&(Wt=0),ue){st=jr.sub(mr)._perp()._unit();let hi=jx(at,mr,jr,Ux(Bt,st),ue);isNaN(hi)&&(hi=0);const _i=mr.sub(at)._unit();at=at.add(_i.mult(Et))._round(),mr=mr.add(_i.mult(-hi))._round(),Et=hi,Bt=st,U&&this.zoom>=17&&(pe(tt,at)||tt.push(at),pe(tt,mr)||tt.push(mr))}const Dr=qe.vertexLength,Oi=Ne.length>4&&Gx(at,mr,jr);let ci=$x(Wt,Ke,xr);if(sf(this.layoutVertexArray,at.x,at.y,Vr,Pr,0,0,ci),sf(this.layoutVertexArray,at.x,at.y,Vr,Pr,0,1,ci),Wt+=ei,ci=$x(Wt,Oi,!xr),Ke=Oi,sf(this.layoutVertexArray,mr.x,mr.y,Vr,Pr,0,0,ci),sf(this.layoutVertexArray,mr.x,mr.y,Vr,Pr,0,1,ci),qe.vertexLength+=4,this.indexArray.emplaceBack(Dr+0,Dr+1,Dr+2),this.indexArray.emplaceBack(Dr+1,Dr+3,Dr+2),qe.primitiveLength+=2,ue){const hi=ze+(or===1?Ne.length-2:or-2),_i=or===1?ze:hi+1;if(this.indexArray.emplaceBack(Dr+1,hi,Dr+3),this.indexArray.emplaceBack(hi,_i,Dr+3),qe.primitiveLength+=2,Xt===void 0&&(Xt=Dr),!Rg(jr,Ne[or],Ie)){const ui=or===Ne.length-1?Xt:qe.vertexLength;this.indexArray.emplaceBack(Dr+2,Dr+3,ui),this.indexArray.emplaceBack(Dr+3,ui+1,ui),this.indexArray.emplaceBack(Dr+3,_i,ui+1),qe.primitiveLength+=3}xr=!xr}if(A){const hi=this.layoutVertexExtArray,_i=S.projectTilePoint(at.x,at.y,a),ui=S.projectTilePoint(mr.x,mr.y,a),tn=S.upVector(a,at.x,at.y),Mi=S.upVector(a,mr.x,mr.y);af(hi,_i,tn),af(hi,_i,tn),af(hi,ui,Mi),af(hi,ui,Mi)}}R&&(ze+=Ne.length-1),U&&ue&&this.zoom>=17&&(tt.length!==0&&pe(tt,tt[0])&&tt.pop(),this.groundEffect.addData(tt,Ie,v,ue>0))}this.footprintSegments.push(Ve),Qe.triangleCount=this.indexArray.length-Qe.triangleArrayOffset,this.polygonSegments.push(Qe),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=D.borders?Dx:this.encodeCentroid(D,k),this.centroidData.push(k),D.borders){this.featuresOnBorder.push(D);const be=this.featuresOnBorder.length-1;for(let Ie=0;Ie<D.borders.length;Ie++)D.borders[Ie][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ie].push(be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,a,y),this.groundEffect.addPaintPropertiesData(e,n,c,d,a,y),this.maxHeight=Math.max(this.maxHeight,G)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let m=0;m<this.centroidData.length;m++){const y=this.centroidData[m],v=+(y.min.y+y.max.y>Mt),w=2*v+(+(y.min.x+y.max.x>Mt)^v);for(let S=0;S<y.polygonSegLen;S++){const A=y.polygonSegIdx+S;e.push({centroidIdx:m,subtile:w,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const r=new Hn;e.sort((m,y)=>m.triangleSegmentIdx===y.triangleSegmentIdx?m.subtile-y.subtile:m.triangleSegmentIdx-y.triangleSegmentIdx);let n=0,a=0,c=0;for(const m of e){if(m.triangleSegmentIdx!==n)break;c++}const d=e.length;for(;a!==e.length;){n=e[a].triangleSegmentIdx;let m=0,y=a,v=a;for(let w=y;w<c&&e[w].subtile===m;w++)v++;for(;y!==c;){const w=e[y];m=w.subtile;const S=this.centroidData[w.centroidIdx].min.clone(),A=this.centroidData[w.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=y;D<v;D++){const k=e[D],U=this.polygonSegments[k.polygonSegmentIdx],G=this.centroidData[k.centroidIdx].min,Y=this.centroidData[k.centroidIdx].max,te=this.indexArray.uint16;for(let ee=U.triangleArrayOffset;ee<U.triangleArrayOffset+U.triangleCount;ee++)r.emplaceBack(te[3*ee],te[3*ee+1],te[3*ee+2]);R.primitiveLength+=U.triangleCount,S.x=Math.min(S.x,G.x),S.y=Math.min(S.y,G.y),A.x=Math.max(A.x,Y.x),A.y=Math.max(A.y,Y.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:S,max:A}),y=v;for(let D=y;D<c&&e[D].subtile===e[y].subtile;D++)v++}a=c;for(let w=a;w<d&&e[w].triangleSegmentIdx===e[a].triangleSegmentIdx;w++)c++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,n){let a=0,c=0;const d=1<<e.canonical.z;if(r){const k=r.getMinMaxForTile(e);k&&(a=k.min,c=k.max)}c+=this.maxHeight;const m=e.toUnwrapped();let y;const v=[m.canonical.x/d+m.wrap,m.canonical.y/d],w=[(m.canonical.x+1)/d+m.wrap,(m.canonical.y+1)/d],S=new vn,A=(k,U,G)=>[k[0]*(1-G[0])+U[0]*G[0],k[1]*(1-G[1])+U[1]*G[1]],R=[],D=[];for(const k of this.triangleSubSegments){R[0]=k.min.x/Mt,R[1]=k.min.y/Mt,D[0]=k.max.x/Mt,D[1]=k.max.y/Mt;const U=A(v,w,R),G=A(v,w,D);if(new pn([U[0],U[1],a],[G[0],G[1],c]).intersectsPrecise(n)===0){y&&(S.segments.push(y),y=void 0);continue}const Y=k.segment;y&&y.vertexOffset!==Y.vertexOffset&&(S.segments.push(y),y=void 0),y?(y.vertexLength+=Y.vertexLength,y.primitiveLength+=Y.primitiveLength):y={vertexOffset:Y.vertexOffset,primitiveLength:Y.primitiveLength,vertexLength:Y.vertexLength,primitiveOffset:Y.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&S.segments.push(y),S}encodeCentroid(e,r){const n=e.centroid(),a=r.span(),c=Math.min(7,Math.round(a.x*this.tileToMeter/10)),d=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new dt(Zt(n.x,1,Mt-1)<<3|c,Zt(n.y,1,Mt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new dt(0,0);const r=e.borders,n=Number.MAX_VALUE;if(r[0][0]!==n||r[1][0]!==n){const a=r[0][0]!==n?0:1;return new dt(6|(r[0][0]!==n?0:65528),(r[a][0]+r[a][1])/2<<3|6)}{const a=r[2][0]!==n?2:3;return new dt((r[a][0]+r[a][1])/2<<3|6,6|(r[2][0]!==n?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=yc,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,a=e.flags&yc?Dx:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==a.y||c!==a.x){for(let d=r;d<n;++d)this.centroidVertexArray.emplace(d,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const n=r.getReplacementRegionsForTile(e.toUnwrapped());if(function(c,d){if(c.length!==d.length)return!1;for(let m=0;m<c.length;m++)if(c[m].sourceId!==d[m].sourceId||!wx(c[m],d[m]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const c of this.centroidData)c.flags&=2147483647;const a=[];for(const c of this.activeReplacements){const d=Math.pow(2,c.footprintTileId.canonical.z-e.canonical.z);for(const m of this.centroidData)if(!(m.flags&yc||c.min.x>m.max.x||m.min.x>c.max.x||c.min.y>m.max.y||m.min.y>c.max.y))for(let y=0;y<m.footprintSegLen;y++){const v=this.footprintSegments[m.footprintSegIdx+y];if(a.length=0,SA(this.footprintVertices,v.vertexOffset,v.vertexCount,c.footprintTileId.canonical,e.canonical,a),Sx(c.footprint,a,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-d)){m.flags|=yc;break}}}for(const c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,n){let a=!1;for(let c=0;c<n.footprintSegLen;c++){const d=this.footprintSegments[n.footprintSegIdx+c];let m=0;for(const y of d.ringIndices){for(let v=m,w=y+m-1;v<y+m;w=v++){const S=this.footprintVertices.int16[2*(v+d.vertexOffset)+0],A=this.footprintVertices.int16[2*(v+d.vertexOffset)+1],R=this.footprintVertices.int16[2*(w+d.vertexOffset)+1];A>r!=R>r&&e<(this.footprintVertices.int16[2*(w+d.vertexOffset)+0]-S)*(r-A)/(R-A)+S&&(a=!a)}m=y}}return a}getHeightAtTileCoord(e,r){let n=Number.NEGATIVE_INFINITY,a=!0;const c=4*(e+Mt)*Mt+(r+Mt);if(this.partLookup.hasOwnProperty(c)){const d=this.partLookup[c];return d?{height:d.height,hidden:!!(d.flags&yc)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||r>d.max.y||d.min.y>r||this.footprintContainsPoint(e,r,d)&&d&&d.height>n&&(n=d.height,this.partLookup[c]=d,a=!!(d.flags&yc));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:a};this.partLookup[c]=void 0}}function Ux(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function EA(t,e,r,n){const a=e.sub(t)._perp()._unit(),c=r.sub(e)._perp()._unit();return jx(t,e,r,Ux(a,c),n)}function jx(t,e,r,n,a){const c=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(r)/3,a*c/n)}function Rg(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function Vx(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function Gx(t,e,r){if(t.x<0||t.x>=Mt||e.x<0||e.x>=Mt||r.x<0||r.x>=Mt)return!1;const n=r.sub(e),a=n.perp(),c=t.sub(e);return(n.x*c.x+n.y*c.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function $x(t,e,r){const n=e?2|t:-3&t;return r?1|n:-2&n}function qx(){const t=Math.PI/32,e=Math.tan(t),r=je;return r*Math.sqrt(1+2*e*e)-r}function Zx(t,e,r){const n=1<<r.z,a=Lr(r.x/n),c=Lr((r.x+1)/n),d=ri(r.y/n),m=ri((r.y+1)/n);return function(y,v,w,S,A=0,R){const D=[];if(!y.length||!w||!S)return D;const k=(le,pe)=>{for(const be of le)D.push({polygon:be,bounds:pe})},U=Math.ceil(Math.log2(w)),G=Math.ceil(Math.log2(S)),Y=U-G,te=[];for(let le=0;le<Math.abs(Y);le++)te.push(Y>0?0:1);for(let le=0;le<Math.min(U,G);le++)te.push(0),te.push(1);let ee=y;if(ee=sm(ee,v[0].y-A,v[1].y+A,1),ee=sm(ee,v[0].x-A,v[1].x+A,0),!ee.length)return D;const ue=[];for(te.length?ue.push({polygons:ee,bounds:v,depth:0}):k(ee,v);ue.length;){const le=ue.pop(),pe=le.depth,be=te[pe],Ie=le.bounds[0],ze=le.bounds[1],Pe=be===0?Ie.x:Ie.y,qe=be===0?ze.x:ze.y,Qe=R?R(be,Pe,qe):.5*(Pe+qe),Ve=sm(le.polygons,Pe-A,Qe+A,be),Je=sm(le.polygons,Qe-A,qe+A,be);if(Ve.length){const Ne=[Ie,new dt(be===0?Qe:ze.x,be===1?Qe:ze.y)];te.length>pe+1?ue.push({polygons:Ve,bounds:Ne,depth:pe+1}):k(Ve,Ne)}if(Je.length){const Ne=[new dt(be===0?Qe:Ie.x,be===1?Qe:Ie.y),ze];te.length>pe+1?ue.push({polygons:Je,bounds:Ne,depth:pe+1}):k(Je,Ne)}}return D}(t,e,Math.ceil((c-a)/11.25),Math.ceil((d-m)/11.25),1,(y,v,w)=>{if(y===0)return .5*(v+w);{const S=ri((r.y+v/Mt)/n);return(Mr(.5*(ri((r.y+w/Mt)/n)+S))*n-r.y)*Mt}})}function SA(t,e,r,n,a,c){const d=Math.pow(2,n.z-a.z);for(let m=0;m<r;m++){let y=t.int16[2*(m+e)+0],v=t.int16[2*(m+e)+1];y=(y+a.x*Mt)*d-n.x*Mt,v=(v+a.y*Mt)*d-n.y*Mt,c.push(new dt(y,v))}}Gt(um,"FillExtrusionBucket",{omit:["layers","features"]}),Gt(kx,"PartData"),Gt(zx,"FootprintSegment"),Gt(Fx,"BorderCentroidData"),Gt(Nx,"GroundEffect");const MA=new an({visibility:new xt(Re["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new xt(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var AA={paint:new an({"fill-extrusion-opacity":new xt(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fr(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fr(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fr(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fr(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new xt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new xt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new xt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new xt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new xt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new xt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new xt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new fr(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new fr(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new xt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new xt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new xt(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new xt(Re["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new xt(Re["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:MA};class Mh extends dt{constructor(e,r,n){super(e,r),this.z=n}}function lf(t,e){return t.x*e.x+t.y*e.y}function Hx(t,e){if(t.length===1){let r=0;const n=e[r++];let a;for(;!a||n.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){const c=e[r],d=t[0],m=a.sub(n),y=c.sub(n),v=d.sub(n),w=lf(m,m),S=lf(m,y),A=lf(y,y),R=lf(v,m),D=lf(v,y),k=w*A-S*S,U=(A*R-S*D)/k,G=(w*D-S*R)/k,Y=n.z*(1-U-G)+a.z*U+c.z*G;if(isFinite(Y))return Y}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function Wx(t,e,r,n,a,c,d,m){const y=d*a.getElevationAt(t,e,!0,!0),v=c[0]!==0,w=v?c[1]===0?d*(c[0]/7-450):d*function(S,A,R){const D=Math.floor(A[0]/8),k=Math.floor(A[1]/8),U=10*(A[0]-8*D),G=10*(A[1]-8*k),Y=S.getElevationAt(D,k,!0,!0),te=S.getMeterToDEM(R),ee=Math.floor(.5*(U*te-1)),ue=Math.floor(.5*(G*te-1)),le=S.tileCoordToPixel(D,k),pe=2*ee+1,be=2*ue+1,Ie=function(Je,Ne,Ke,Et,tt){return[Je.getElevationAtPixel(Ne,Ke,!0),Je.getElevationAtPixel(Ne+tt,Ke,!0),Je.getElevationAtPixel(Ne,Ke+tt,!0),Je.getElevationAtPixel(Ne+Et,Ke+tt,!0)]}(S,le.x-ee,le.y-ue,pe,be),ze=Math.abs(Ie[0]-Ie[1]),Pe=Math.abs(Ie[2]-Ie[3]),qe=Math.abs(Ie[0]-Ie[2])+Math.abs(Ie[1]-Ie[3]),Qe=Math.min(.25,.5*te*(ze+Pe)/pe),Ve=Math.min(.25,.5*te*qe/be);return Y+Math.max(Qe*U,Ve*G)}(a,c,m):y;return{base:y+(r===0)?-1:r,top:v?Math.max(w+n,y+r+2):y+n}}const IA=xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:CA}=IA,PA=xi([{name:"a_packed",components:4,type:"Float32"}]),{members:LA}=PA;class Xx{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new _c({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=gr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const a=[];let c=e.length%2==1?-e[e.length-1]*n:0,d=e[0]*n,m=!0;a.push({left:c,right:d,isDash:m,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){m=!m;const w=e[v];c=y*n,y+=w,d=y*n,a.push({left:c,right:d,isDash:m,zeroLength:w===0})}return a}addRoundDash(e,r,n){const a=r/2;for(let c=-n;c<=n;c++){const d=this.width*(this.nextRow+n+c);let m=0,y=e[m];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++m]);const w=Math.abs(v-y.left),S=Math.abs(v-y.right),A=Math.min(w,S);let R;const D=c/n*(a+1);if(y.isDash){const k=a-Math.abs(D);R=Math.sqrt(A*A+k*k)}else R=a-Math.sqrt(A*A+D*D);this.image.data[d+v]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,r){for(let y=e.length-1;y>=0;--y){const v=e[y],w=e[y+1];v.zeroLength?e.splice(y,1):w&&w.isDash===v.isDash&&(w.left=v.left,e.splice(y,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const c=this.width*this.nextRow;let d=0,m=e[d];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++d]);const v=Math.abs(y-m.left),w=Math.abs(y-m.right),S=Math.min(v,w);this.image.data[c+y]=Math.max(0,Math.min(255,(m.isDash?S:-S)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const a=r==="round",c=a?7:0,d=2*c+1;if(this.nextRow+d>this.height)return ve("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let w=0;w<e.length;w++)e[w]<0&&(ve("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),m+=e[w];if(m!==0){const w=this.width/m,S=this.getDashRanges(e,this.width,w);a?this.addRoundDash(S,w,c):this.addRegularDash(S,r==="square"?.5*w:0)}const y=this.nextRow+c;this.nextRow+=d;const v={tl:[y,c],br:[m,0]};return this.positions[n]=v,v}}Gt(Xx,"LineAtlas");const RA=om.types,OA=Math.cos(Math.PI/180*37.5);class Og{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Nd,this.layoutVertexArray2=new Wa,this.indexArray=new Hn,this.programConfigurations=new q(e.layers,e.zoom),this.segments=new vn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){this.hasPattern=Ig("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:w,id:S,index:A,sourceLayerIndex:R}of e){const D=this.layers[0]._featureFilter.needGeometry,k=Un(w,D);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),k,n))continue;const U=c?c.evaluate(k,{},n):void 0,G={id:S,properties:w.properties,type:w.type,sourceLayerIndex:R,index:A,geometry:D?k.geometry:Xn(w,n,a),patterns:{},sortKey:U};d.push(G)}c&&d.sort((w,S)=>w.sortKey-S.sortKey);const{lineAtlas:m,featureIndex:y}=r,v=this.addConstantDashes(m);for(const w of d){const{geometry:S,index:A,sourceLayerIndex:R}=w;if(v&&this.addFeatureDashes(w,m),this.hasPattern){const D=Cg("line",this.layers,w,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(w,S,A,n,m.positions,r.availableImages,r.brightness);y.insert(e[A].feature,S,A,R,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,c=n.layout.get("line-cap").value;if(a.kind!=="constant"||c.kind!=="constant")r=!0;else{const d=c.value,m=a.value;if(!m)continue;e.addDash(m,d)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind==="constant"&&d.kind==="constant")continue;let m,y;if(c.kind==="constant"){if(m=c.value,!m)continue}else m=c.evaluate({zoom:n},e);y=d.kind==="constant"?d.value:d.evaluate({zoom:n},e),r.addDash(m,y),e.patterns[a.id]=r.getKey(m,y)}}update(e,r,n,a,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,d?this.stateDependentLayers:this.layers,n,a,c)}addFeatures(e,r,n,a,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,n,a,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,LA)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,CA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,a,c,d,m){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),S=y.get("line-miter-limit"),A=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of r)this.addLine(R,e,v,w,S,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,a,m)}addLine(e,r,n,a,c,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<e.length-1;G++)this.totalDistance+=e[G].dist(e[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=RA[r.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let v=0;for(;v<y-1&&e[v].equals(e[v+1]);)v++;if(y<(m?3:2))return;n==="bevel"&&(c=1.05);const w=this.overscaling<=16?15*Mt/(512*this.overscaling):0,S=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let A,R,D,k,U;this.e1=this.e2=-1,m&&(A=e[y-2],U=e[v].sub(A)._unit()._perp());for(let G=v;G<y;G++){if(D=G===y-1?m?e[v+1]:void 0:e[G+1],D&&e[G].equals(D))continue;U&&(k=U),A&&(R=A),A=e[G],U=D?D.sub(A)._unit()._perp():k,k=k||U;let Y=k.add(U);Y.x===0&&Y.y===0||Y._unit();const te=k.x*U.x+k.y*U.y,ee=Y.x*U.x+Y.y*U.y,ue=ee!==0?1/ee:1/0,le=2*Math.sqrt(2-2*ee),pe=ee<OA&&R&&D,be=k.x*U.y-k.y*U.x>0;if(pe&&G>v){const Pe=A.dist(R);if(Pe>2*w){const qe=A.sub(A.sub(R)._mult(w/Pe)._round());this.updateDistance(R,qe),this.addCurrentVertex(qe,k,0,0,S),R=qe}}const Ie=R&&D;let ze=Ie?n:m?"butt":a;if(Ie&&ze==="round"&&(ue<d?ze="miter":ue<=2&&(ze="fakeround")),ze==="miter"&&ue>c&&(ze="bevel"),ze==="bevel"&&(ue>2&&(ze="flipbevel"),ue<c&&(ze="miter")),R&&this.updateDistance(R,A),ze==="miter")Y._mult(ue),this.addCurrentVertex(A,Y,0,0,S);else if(ze==="flipbevel"){if(ue>100)Y=U.mult(-1);else{const Pe=ue*k.add(U).mag()/k.sub(U).mag();Y._perp()._mult(Pe*(be?-1:1))}this.addCurrentVertex(A,Y,0,0,S),this.addCurrentVertex(A,Y.mult(-1),0,0,S)}else if(ze==="bevel"||ze==="fakeround"){const Pe=-Math.sqrt(ue*ue-1),qe=be?Pe:0,Qe=be?0:Pe;if(R&&this.addCurrentVertex(A,k,qe,Qe,S),ze==="fakeround"){const Ve=Math.round(180*le/Math.PI/20);for(let Je=1;Je<Ve;Je++){let Ne=Je/Ve;if(Ne!==.5){const Et=Ne-.5;Ne+=Ne*Et*(Ne-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*Et*Et+(.848013+te*(.215638*te-1.06021)))}const Ke=U.sub(k)._mult(Ne)._add(k)._unit()._mult(be?-1:1);this.addHalfVertex(A,Ke.x,Ke.y,!1,be,0,S)}}D&&this.addCurrentVertex(A,U,-qe,-Qe,S)}else if(ze==="butt")this.addCurrentVertex(A,Y,0,0,S);else if(ze==="square"){const Pe=R?1:-1;R||this.addCurrentVertex(A,Y,Pe,Pe,S),this.addCurrentVertex(A,Y,0,0,S),R&&this.addCurrentVertex(A,Y,Pe,Pe,S)}else ze==="round"&&(R&&(this.addCurrentVertex(A,k,0,0,S),this.addCurrentVertex(A,k,1,1,S,!0)),D&&(this.addCurrentVertex(A,U,-1,-1,S,!0),this.addCurrentVertex(A,U,0,0,S)));if(pe&&G<y-1){const Pe=A.dist(D);if(Pe>2*w){const qe=A.add(D.sub(A)._mult(w/Pe)._round());this.updateDistance(A,qe),this.addCurrentVertex(qe,U,0,0,S),A=qe}}}}addCurrentVertex(e,r,n,a,c,d=!1){const m=r.y*a-r.x,y=-r.y-r.x*a;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,d,!1,n,c),this.addHalfVertex(e,m,y,d,!0,-a,c)}addHalfVertex({x:e,y:r},n,a,c,d,m,y){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(r<<1)+(d?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),y.primitiveLength++),d?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Gt(Og,"LineBucket",{omit:["layers","patternFeatures"]});const DA=new an({"line-cap":new fr(Re.layout_line["line-cap"]),"line-join":new fr(Re.layout_line["line-join"]),"line-miter-limit":new xt(Re.layout_line["line-miter-limit"]),"line-round-limit":new xt(Re.layout_line["line-round-limit"]),"line-sort-key":new fr(Re.layout_line["line-sort-key"]),visibility:new xt(Re.layout_line.visibility)});var Yx={paint:new an({"line-opacity":new fr(Re.paint_line["line-opacity"]),"line-color":new fr(Re.paint_line["line-color"]),"line-translate":new xt(Re.paint_line["line-translate"]),"line-translate-anchor":new xt(Re.paint_line["line-translate-anchor"]),"line-width":new fr(Re.paint_line["line-width"]),"line-gap-width":new fr(Re.paint_line["line-gap-width"]),"line-offset":new fr(Re.paint_line["line-offset"]),"line-blur":new fr(Re.paint_line["line-blur"]),"line-dasharray":new fr(Re.paint_line["line-dasharray"]),"line-pattern":new fr(Re.paint_line["line-pattern"]),"line-gradient":new Cl(Re.paint_line["line-gradient"]),"line-trim-offset":new xt(Re.paint_line["line-trim-offset"]),"line-emissive-strength":new xt(Re.paint_line["line-emissive-strength"]),"line-border-width":new fr(Re.paint_line["line-border-width"]),"line-border-color":new fr(Re.paint_line["line-border-color"])}),layout:DA};function Kx(t,e,r){return e*(Mt/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function Jx(t,e){return 1/Kx(t,1,e.tileZoom)}function Qx(t,e,r,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const eb=t=>{const e=[];tb(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");return r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function tb(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const rb=new class extends fr{possiblyEvaluate(t,e){return e=new sn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=_r({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}(Yx.paint.properties["line-width"].specification);function ib(t,e){return e>0?e+2*t:t}rb.useIntegerZoom=!0;const zA=xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kA=xi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),FA=xi([{name:"a_projected_pos",components:4,type:"Float32"}],4);xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const BA=xi([{name:"a_z_offset",components:1,type:"Float32"}],4),NA=xi([{name:"a_texb",components:2,type:"Uint16"}]),UA=xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jA=xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nb=xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),VA=xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xi([{name:"triangle",components:3,type:"Uint16"}]),xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),xi([{type:"Float32",name:"offsetX"}]),xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var wo=24;const Ea=128;function Dg(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new sn(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=r;let c=0;for(;c<n.length&&n[c]<=t;)c++;c=Math.max(0,c-1);let d=c;for(;d<n.length&&n[d]<t+1;)d++;d=Math.min(n.length-1,d);const m=n[c],y=n[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:a}:{kind:"camera",minZoom:m,maxZoom:y,minSize:r.evaluate(new sn(m)),maxSize:r.evaluate(new sn(y)),interpolationType:a}}}function hm(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:a}){return t.kind==="source"?n/Ea:t.kind==="composite"?Zr(n/Ea,a/Ea,r):e}function Ah(t,e){let r=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:c,maxZoom:d}=t,m=a?Zt(Ao.interpolationFactor(a,e,c,d),0,1):0;t.kind==="camera"?n=Zr(t.minSize,t.maxSize,m):r=m}return{uSizeT:r,uSize:n}}var GA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ea,evaluateSizeForFeature:hm,evaluateSizeForZoom:Ah,getSizeData:Dg});function $A(t,e,r){return t.sections.forEach(n=>{n.text=function(a,c,d){const m=c.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?a=a.toLocaleUpperCase():m==="lowercase"&&(a=a.toLocaleLowerCase()),rs.applyArabicShaping&&(a=rs.applyArabicShaping(a)),a}(n.text,e,r)}),t}const cf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function qA(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function ZA(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var HA={read:function(t,e,r,n,a){var c,d,m=8*a-n-1,y=(1<<m)-1,v=y>>1,w=-7,S=r?a-1:0,A=r?-1:1,R=t[e+S];for(S+=A,c=R&(1<<-w)-1,R>>=-w,w+=m;w>0;c=256*c+t[e+S],S+=A,w-=8);for(d=c&(1<<-w)-1,c>>=-w,w+=n;w>0;d=256*d+t[e+S],S+=A,w-=8);if(c===0)c=1-v;else{if(c===y)return d?NaN:1/0*(R?-1:1);d+=Math.pow(2,n),c-=v}return(R?-1:1)*d*Math.pow(2,c-n)},write:function(t,e,r,n,a,c){var d,m,y,v=8*c-a-1,w=(1<<v)-1,S=w>>1,A=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=n?0:c-1,D=n?1:-1,k=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=w):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+S>=1?A/y:A*Math.pow(2,1-S))*y>=2&&(d++,y/=2),d+S>=w?(m=0,d=w):d+S>=1?(m=(e*y-1)*Math.pow(2,a),d+=S):(m=e*Math.pow(2,S-1)*Math.pow(2,a),d=0));a>=8;t[r+R]=255&m,R+=D,m/=256,a-=8);for(d=d<<a|m,v+=a;v>0;t[r+R]=255&d,R+=D,d/=256,v-=8);t[r+R-D]|=128*k}},ob=en,dm=HA;function en(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}en.Varint=0,en.Fixed64=1,en.Bytes=2,en.Fixed32=5;var zg=4294967296,sb=1/zg,ab=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Fl(t){return t.type===en.Bytes?t.readVarint()+t.pos:t.pos+1}function Ih(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function lb(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=t;a--)r.buf[a+n]=r.buf[a]}function WA(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function XA(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function YA(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function KA(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function JA(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function QA(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function eI(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function tI(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function rI(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function fm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ch(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function cb(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}en.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,c=this.pos;this.type=7&n,t(a,e,this),this.pos===c&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=fm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=cb(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=fm(this.buf,this.pos)+fm(this.buf,this.pos+4)*zg;return this.pos+=8,t},readSFixed64:function(){var t=fm(this.buf,this.pos)+cb(this.buf,this.pos+4)*zg;return this.pos+=8,t},readFloat:function(){var t=dm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=dm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(a,c,d){var m,y,v=d.buf;if(m=(112&(y=v[d.pos++]))>>4,y<128||(m|=(127&(y=v[d.pos++]))<<3,y<128)||(m|=(127&(y=v[d.pos++]))<<10,y<128)||(m|=(127&(y=v[d.pos++]))<<17,y<128)||(m|=(127&(y=v[d.pos++]))<<24,y<128)||(m|=(1&(y=v[d.pos++]))<<31,y<128))return Ih(a,m,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&ab?function(r,n,a){return ab.decode(r.subarray(n,a))}(this.buf,e,t):function(r,n,a){for(var c="",d=n;d<a;){var m,y,v,w=r[d],S=null,A=w>239?4:w>223?3:w>191?2:1;if(d+A>a)break;A===1?w<128&&(S=w):A===2?(192&(m=r[d+1]))==128&&(S=(31&w)<<6|63&m)<=127&&(S=null):A===3?(y=r[d+2],(192&(m=r[d+1]))==128&&(192&y)==128&&((S=(15&w)<<12|(63&m)<<6|63&y)<=2047||S>=55296&&S<=57343)&&(S=null)):A===4&&(y=r[d+2],v=r[d+3],(192&(m=r[d+1]))==128&&(192&y)==128&&(192&v)==128&&((S=(15&w)<<18|(63&m)<<12|(63&y)<<6|63&v)<=65535||S>=1114112)&&(S=null)),S===null?(S=65533,A=1):S>65535&&(S-=65536,c+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),c+=String.fromCharCode(S),d+=A}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==en.Bytes)return t.push(this.readVarint(e));var r=Fl(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==en.Bytes)return t.push(this.readSVarint());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==en.Bytes)return t.push(this.readBoolean());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==en.Bytes)return t.push(this.readFloat());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==en.Bytes)return t.push(this.readDouble());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==en.Bytes)return t.push(this.readFixed32());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==en.Bytes)return t.push(this.readSFixed32());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==en.Bytes)return t.push(this.readFixed64());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==en.Bytes)return t.push(this.readSFixed64());var e=Fl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===en.Varint)for(;this.buf[this.pos++]>127;);else if(e===en.Bytes)this.pos=this.readVarint()+this.pos;else if(e===en.Fixed32)this.pos+=4;else{if(e!==en.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ch(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ch(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ch(this.buf,-1&t,this.pos),Ch(this.buf,Math.floor(t*sb),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ch(this.buf,-1&t,this.pos),Ch(this.buf,Math.floor(t*sb),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(c,d,m){m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,m.buf[m.pos]=127&(c>>>=7)}(n,0,r),function(c,d){var m=(7&c)<<4;d.buf[d.pos++]|=m|((c>>>=3)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c)))))}(a,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,a,c){for(var d,m,y=0;y<a.length;y++){if((d=a.charCodeAt(y))>55295&&d<57344){if(!m){d>56319||y+1===a.length?(n[c++]=239,n[c++]=191,n[c++]=189):m=d;continue}if(d<56320){n[c++]=239,n[c++]=191,n[c++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(n[c++]=239,n[c++]=191,n[c++]=189,m=null);d<128?n[c++]=d:(d<2048?n[c++]=d>>6|192:(d<65536?n[c++]=d>>12|224:(n[c++]=d>>18|240,n[c++]=d>>12&63|128),n[c++]=d>>6&63|128),n[c++]=63&d|128)}return c}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&lb(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),dm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),dm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&lb(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,en.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,WA,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,XA,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,JA,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,YA,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,KA,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,QA,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,eI,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,tI,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,rI,e)},writeBytesField:function(t,e){this.writeTag(t,en.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,en.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,en.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,en.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,en.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,en.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,en.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,en.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,en.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,en.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Ph=It(ob);const kg=3;function iI(t,e,r){e.glyphs=[],t===1&&r.readMessage(nI,e)}function nI(t,e,r){if(t===3){const{id:n,bitmap:a,width:c,height:d,left:m,top:y,advance:v}=r.readMessage(oI,{});e.glyphs.push({id:n,bitmap:new _c({width:c+2*kg,height:d+2*kg},a),metrics:{width:c,height:d,left:m,top:y,advance:v}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function oI(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const ub=kg,Gs={horizontal:1,vertical:2,horizontalOnly:3};class uf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new uf;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new uf;return r.imageName=e,r}}class Lh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new Lh;for(let a=0;a<e.sections.length;a++){const c=e.sections[a];c.image?n.addImageSection(c):n.addTextSection(c,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,n){let a="";for(let c=0;c<r.length;c++){const d=r.charCodeAt(c+1)||null,m=r.charCodeAt(c-1)||null;a+=!n&&(d&&xp(d)&&!cf[r[c+1]]||m&&xp(m)&&!cf[r[c-1]])||!cf[r[c]]?r[c]:cf[r[c]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&pm[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&pm[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new Lh;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(uf.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.namePrimary:"";if(r.length===0)return void ve("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(uf.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ve("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fg(t,e,r,n,a,c,d,m,y,v,w,S,A,R,D){const k=Lh.fromFeature(t,a);S===Gs.vertical&&k.verticalizePunctuation(A);let U=[];const G=function(le,pe,be,Ie,ze,Pe){if(!le)return[];const qe=[],Qe=function(Ke,Et,tt,Xt,Bt,st){let xr=0;for(let or=0;or<Ke.length();or++){const Wt=Ke.getSection(or);xr+=hb(Ke.getCodePoint(or),Wt,Xt,Bt,Et,st)}return xr/Math.max(1,Math.ceil(xr/tt))}(le,pe,be,Ie,ze,Pe),Ve=le.text.indexOf("​")>=0;let Je=0;for(let Ke=0;Ke<le.length();Ke++){const Et=le.getSection(Ke),tt=le.getCodePoint(Ke);if(pm[tt]||(Je+=hb(tt,Et,Ie,ze,pe,Pe)),Ke<le.length()-1){const Xt=!((Ne=tt)<11904||!(Jt["Bopomofo Extended"](Ne)||Jt.Bopomofo(Ne)||Jt["CJK Compatibility Forms"](Ne)||Jt["CJK Compatibility Ideographs"](Ne)||Jt["CJK Compatibility"](Ne)||Jt["CJK Radicals Supplement"](Ne)||Jt["CJK Strokes"](Ne)||Jt["CJK Symbols and Punctuation"](Ne)||Jt["CJK Unified Ideographs Extension A"](Ne)||Jt["CJK Unified Ideographs"](Ne)||Jt["Enclosed CJK Letters and Months"](Ne)||Jt["Halfwidth and Fullwidth Forms"](Ne)||Jt.Hiragana(Ne)||Jt["Ideographic Description Characters"](Ne)||Jt["Kangxi Radicals"](Ne)||Jt["Katakana Phonetic Extensions"](Ne)||Jt.Katakana(Ne)||Jt["Vertical Forms"](Ne)||Jt["Yi Radicals"](Ne)||Jt["Yi Syllables"](Ne)));(sI[tt]||Xt||Et.imageName)&&qe.push(fb(Ke+1,Je,Qe,qe,aI(tt,le.getCodePoint(Ke+1),Xt&&Ve),!1))}}var Ne;return pb(fb(le.length(),Je,Qe,qe,0,!0))}(k,v,c,e,n,R),{processBidirectionalText:Y,processStyledBidirectionalText:te}=rs;if(Y&&k.sections.length===1){const le=Y(k.toString(),G);for(const pe of le){const be=new Lh;be.text=pe,be.sections=k.sections;for(let Ie=0;Ie<pe.length;Ie++)be.sectionIndex.push(0);U.push(be)}}else if(te){const le=te(k.text,k.sectionIndex,G);for(const pe of le){const be=new Lh;be.text=pe[0],be.sectionIndex=pe[1],be.sections=k.sections,U.push(be)}}else U=function(le,pe){const be=[],Ie=le.text;let ze=0;for(const Pe of pe)be.push(le.substring(ze,Pe)),ze=Pe;return ze<Ie.length&&be.push(le.substring(ze,Ie.length)),be}(k,G);const ee=[],ue={positionedLines:ee,text:k.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,pe,be,Ie,ze,Pe,qe,Qe,Ve,Je,Ne,Ke){let Et=0,tt=0,Xt=0;const Bt=Qe==="right"?1:Qe==="left"?0:.5;let st=!1;for(const jr of ze){const wr=jr.getSections();for(const Vr of wr){if(Vr.imageName)continue;const Pr=pe[Vr.fontStack];if(Pr&&(st=Pr.ascender!==void 0&&Pr.descender!==void 0,!st))break}if(!st)break}let xr=0;for(const jr of ze){jr.trim();const wr=jr.getMaxScale(),Vr=(wr-1)*wo,Pr={positionedGlyphs:[],lineOffset:0};le.positionedLines[xr]=Pr;const ei=Pr.positionedGlyphs;let Dr=0;if(!jr.length()){tt+=Pe,++xr;continue}let Oi=0,ci=0;for(let _i=0;_i<jr.length();_i++){const ui=jr.getSection(_i),tn=jr.getSectionIndex(_i),Mi=jr.getCodePoint(_i);let xn=ui.scale,Gn=null,fo=null,Yi=null,un=wo,io=0;const no=!(Ve===Gs.horizontal||!Ne&&!Td(Mi)||Ne&&(pm[Mi]||(or=Mi,Jt.Arabic(or)||Jt["Arabic Supplement"](or)||Jt["Arabic Extended-A"](or)||Jt["Arabic Presentation Forms-A"](or)||Jt["Arabic Presentation Forms-B"](or))));if(ui.imageName){const oo=Ie[ui.imageName];if(!oo)continue;Yi=ui.imageName,le.iconsInText=le.iconsInText||!0,fo=oo.paddedRect;const Zi=oo.displaySize;xn=xn*wo/Ke,Gn={width:Zi[0],height:Zi[1],left:0,top:-ub,advance:no?Zi[1]:Zi[0],localGlyph:!1},io=st?-Gn.height*xn:wr*wo-17-Zi[1]*xn,un=Gn.advance;const _s=(no?Zi[0]:Zi[1])*xn-wo*wr;_s>0&&_s>Dr&&(Dr=_s)}else{const oo=be[ui.fontStack];if(!oo)continue;oo[Mi]&&(fo=oo[Mi]);const Zi=pe[ui.fontStack];if(!Zi)continue;const _s=Zi.glyphs[Mi];if(!_s)continue;if(Gn=_s.metrics,un=Mi!==8203?wo:0,st){const Sc=Zi.ascender!==void 0?Math.abs(Zi.ascender):0,Wo=Zi.descender!==void 0?Math.abs(Zi.descender):0,gs=(Sc+Wo)*xn;Oi<gs&&(Oi=gs,ci=(Sc-Wo)/2*xn),io=-Sc*xn}else io=(wr-xn)*wo-17}no?(le.verticalizable=!0,ei.push({glyph:Mi,imageName:Yi,x:Et,y:tt+io,vertical:no,scale:xn,localGlyph:Gn.localGlyph,fontStack:ui.fontStack,sectionIndex:tn,metrics:Gn,rect:fo}),Et+=un*xn+Je):(ei.push({glyph:Mi,imageName:Yi,x:Et,y:tt+io,vertical:no,scale:xn,localGlyph:Gn.localGlyph,fontStack:ui.fontStack,sectionIndex:tn,metrics:Gn,rect:fo}),Et+=Gn.advance*xn+Je)}ei.length!==0&&(Xt=Math.max(Et-Je,Xt),st?mb(ei,Bt,Dr,ci,Pe*wr/2):mb(ei,Bt,Dr,0,Pe/2)),Et=0;const hi=Pe*wr+Dr;Pr.lineOffset=Math.max(Dr,Vr),tt+=hi,++xr}var or;const Wt=tt,{horizontalAlign:at,verticalAlign:mr}=Bg(qe);(function(jr,wr,Vr,Pr,ei,Dr){const Oi=(wr-Vr)*ei,ci=-Dr*Pr;for(const hi of jr)for(const _i of hi.positionedGlyphs)_i.x+=Oi,_i.y+=ci})(le.positionedLines,Bt,at,mr,Xt,Wt),le.top+=-mr*Wt,le.bottom=le.top+Wt,le.left+=-at*Xt,le.right=le.left+Xt,le.hasBaseline=st}(ue,e,r,n,U,d,m,y,S,v,A,D),!function(le){for(const pe of le)if(pe.positionedGlyphs.length!==0)return!1;return!0}(ee)&&ue}const pm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hb(t,e,r,n,a,c){if(e.imageName){const d=n[e.imageName];return d?d.displaySize[0]*e.scale*wo/c+a:0}{const d=r[e.fontStack],m=d&&d.glyphs[t];return m?m.metrics.advance*e.scale+a:0}}function db(t,e,r,n){const a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(r)*r}function aI(t,e,r){let n=0;return t===10&&(n-=1e4),r&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function fb(t,e,r,n,a,c){let d=null,m=db(e,r,a,c);for(const y of n){const v=db(e-y.x,r,a,c)+y.badness;v<=m&&(d=y,m=v)}return{index:t,x:e,priorBreak:d,badness:m}}function pb(t){return t?pb(t.priorBreak).concat(t.index):[]}function Bg(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function mb(t,e,r,n,a){if(!(e||r||n||a))return;const c=t.length-1,d=t[c],m=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=c;y++)t[y].x-=m,t[y].y+=r+n+a}function lI(t,e,r,n){const{horizontalAlign:a,verticalAlign:c}=Bg(n),d=r[0]-t.displaySize[0]*a,m=r[1]-t.displaySize[1]*c;return{imagePrimary:t,imageSecondary:e,top:m,bottom:m+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function _b(t,e,r,n,a,c){const d=t.imagePrimary;let m;if(d.content){const U=d.content,G=d.pixelRatio||1;m=[U[0]/G,U[1]/G,d.displaySize[0]-U[2]/G,d.displaySize[1]-U[3]/G]}const y=e.left*c,v=e.right*c;let w,S,A,R;r==="width"||r==="both"?(R=a[0]+y-n[3],S=a[0]+v+n[1]):(R=a[0]+(y+v-d.displaySize[0])/2,S=R+d.displaySize[0]);const D=e.top*c,k=e.bottom*c;return r==="height"||r==="both"?(w=a[1]+D-n[0],A=a[1]+k+n[2]):(w=a[1]+(D+k-d.displaySize[1])/2,A=w+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:w,right:S,bottom:A,left:R,collisionPadding:m}}class Bl extends dt{constructor(e,r,n,a,c){super(e,r),this.angle=a,this.z=n,c!==void 0&&(this.segment=c)}clone(){return new Bl(this.x,this.y,this.z,this.angle,this.segment)}}function gb(t,e,r,n,a){if(e.segment===void 0)return!0;let c=e,d=e.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=t[d].dist(c),c=t[d]}m+=t[d].dist(t[d+1]),d++;const y=[];let v=0;for(;m<r/2;){const w=t[d],S=t[d+1];if(!S)return!1;let A=t[d-1].angleTo(w)-w.angleTo(S);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:A}),v+=A;m-y[0].distance>n;)v-=y.shift().angleDelta;if(v>a)return!1;d++,m+=w.dist(S)}return!0}function yb(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function vb(t,e,r){return t?.6*e*r:0}function xb(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function cI(t,e,r,n,a,c){const d=vb(r,a,c),m=xb(r,n)*c;let y=0;const v=yb(t)/2;for(let w=0;w<t.length-1;w++){const S=t[w],A=t[w+1],R=S.dist(A);if(y+R>v){const D=(v-y)/R,k=Zr(S.x,A.x,D),U=Zr(S.y,A.y,D),G=new Bl(k,U,0,A.angleTo(S),w);return!d||gb(t,G,m,d,e)?G:void 0}y+=R}}function uI(t,e,r,n,a,c,d,m,y){const v=vb(n,c,d),w=xb(n,a),S=w*d,A=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-S<e/4&&(e=S+e/4),bb(t,A?e/2*m%e:(w/2+2*c)*d*m%e,e,v,r,S,A,!1,y)}function bb(t,e,r,n,a,c,d,m,y){const v=c/2,w=yb(t);let S=0,A=e-r,R=[];for(let D=0;D<t.length-1;D++){const k=t[D],U=t[D+1],G=k.dist(U),Y=U.angleTo(k);for(;A+r<S+G;){A+=r;const te=(A-S)/G,ee=Zr(k.x,U.x,te),ue=Zr(k.y,U.y,te);if(ee>=0&&ee<y&&ue>=0&&ue<y&&A-v>=0&&A+v<=w){const le=new Bl(ee,ue,0,Y,D);n&&!gb(t,le,c,n,a)||R.push(le)}}S+=G}return m||R.length||d||(R=bb(t,S/2,r,n,a,c,d,!0,y)),R}function wb(t,e,r,n,a){const c=[];for(let d=0;d<t.length;d++){const m=t[d];let y;for(let v=0;v<m.length-1;v++){let w=m[v],S=m[v+1];w.x<e&&S.x<e||(w.x<e?w=new dt(e,w.y+(e-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x<e&&(S=new dt(e,w.y+(e-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y<r&&S.y<r||(w.y<r?w=new dt(w.x+(r-w.y)/(S.y-w.y)*(S.x-w.x),r)._round():S.y<r&&(S=new dt(w.x+(r-w.y)/(S.y-w.y)*(S.x-w.x),r)._round()),w.x>=n&&S.x>=n||(w.x>=n?w=new dt(n,w.y+(n-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x>=n&&(S=new dt(n,w.y+(n-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y>=a&&S.y>=a||(w.y>=a?w=new dt(w.x+(a-w.y)/(S.y-w.y)*(S.x-w.x),a)._round():S.y>=a&&(S=new dt(w.x+(a-w.y)/(S.y-w.y)*(S.x-w.x),a)._round()),y&&w.equals(y[y.length-1])||(y=[w],c.push(y)),y.push(S)))))}}return c}function Tb(t){let e=0,r=0;for(const d of t)e+=d.w*d.h,r=Math.max(r,d.w);t.sort((d,m)=>m.h-d.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let a=0,c=0;for(const d of t)for(let m=n.length-1;m>=0;m--){const y=n[m];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,c=Math.max(c,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===y.w&&d.h===y.h){const v=n.pop();m<n.length&&(n[m]=v)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(n.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:a,h:c,fill:e/(a*c)||0}}Gt(Bl,"Anchor");const ms=1;class Ng{constructor(e,{pixelRatio:r,version:n,stretchX:a,stretchY:c,content:d}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=a,this.stretchY=c,this.content=d,this.version=n}get tl(){return[this.paddedRect.x+ms,this.paddedRect.y+ms]}get br(){return[this.paddedRect.x+this.paddedRect.w-ms,this.paddedRect.y+this.paddedRect.h-ms]}get displaySize(){return[(this.paddedRect.w-2*ms)/this.pixelRatio,(this.paddedRect.h-2*ms)/this.pixelRatio]}}class Eb{constructor(e,r){const n={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,n,c),this.addImages(r,a,c);const{w:d,h:m}=Tb(c),y=new Vs({width:d||1,height:m||1});for(const v in e){const w=e[v],S=n[v].paddedRect;Vs.copy(w.data,y,{x:0,y:0},{x:S.x+ms,y:S.y+ms},w.data,w.sdf)}for(const v in r){const w=r[v],S=a[v].paddedRect,A=S.x+ms,R=S.y+ms,D=w.data.width,k=w.data.height;Vs.copy(w.data,y,{x:0,y:0},{x:A,y:R},w.data),Vs.copy(w.data,y,{x:0,y:k-1},{x:A,y:R-1},{width:D,height:1}),Vs.copy(w.data,y,{x:0,y:0},{x:A,y:R+k},{width:D,height:1}),Vs.copy(w.data,y,{x:D-1,y:0},{x:A-1,y:R},{width:1,height:k}),Vs.copy(w.data,y,{x:0,y:0},{x:A+D,y:R},{width:1,height:k})}this.image=y,this.iconPositions=n,this.patternPositions=a}addImages(e,r,n){for(const a in e){const c=e[a],d={x:0,y:0,w:c.data.width+2*ms,h:c.data.height+2*ms};n.push(d),r[a]=new Ng(d,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,r,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const a in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,n),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[a,c]=e.tl,d=!!Object.keys(this.patternPositions).length;n.update(r.data,{useMipmap:d},{x:a,y:c})}}Gt(Ng,"ImagePosition"),Gt(Eb,"ImageAtlas");const hf=1e20;function Sb(t,e,r,n,a,c,d,m,y){for(let v=e;v<e+n;v++)Mb(t,r*c+v,c,a,d,m,y);for(let v=r;v<r+a;v++)Mb(t,v*c+e,1,n,d,m,y)}function Mb(t,e,r,n,a,c,d){c[0]=0,d[0]=-hf,d[1]=hf,a[0]=t[e];for(let m=1,y=0,v=0;m<n;m++){a[m]=t[e+m*r];const w=m*m;do{const S=c[y];v=(a[m]-a[S]+w-S*S)/(m-S)/2}while(v<=d[y]&&--y>-1);y++,c[y]=m,d[y]=v,d[y+1]=hf}for(let m=0,y=0;m<n;m++){for(;d[y+1]<m;)y++;const v=c[y],w=m-v;t[e+m*r]=a[v]+w*w}}const Sa=2,Ug={none:0,ideographs:1,all:2};class Rh{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,n){const a=[],c=this.urls[r]||re.GLYPHS_URL;for(const d in e)for(const m of e[d])a.push({stack:d,id:m});nn(a,({stack:d,id:m},y)=>{let v=this.entries[d];v||(v=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[m];if(w!==void 0)return void y(null,{stack:d,id:m,glyph:w});if(w=this._tinySDF(v,d,m),w)return v.glyphs[m]=w,void y(null,{stack:d,id:m,glyph:w});const S=Math.floor(m/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(v.ranges[S])return void y(null,{stack:d,id:m,glyph:w});let A=v.requests[S];A||(A=v.requests[S]=[],Rh.loadGlyphRange(d,S,c,this.requestManager,(R,D)=>{if(D){v.ascender=D.ascender,v.descender=D.descender;for(const k in D.glyphs)this._doesCharSupportLocalGlyph(+k)||(v.glyphs[+k]=D.glyphs[+k]);v.ranges[S]=!0}for(const k of A)k(R,D);delete v.requests[S]})),A.push((R,D)=>{R?y(R):D&&y(null,{stack:d,id:m,glyph:D.glyphs[m]||null})})},(d,m)=>{if(d)n(d);else if(m){const y={};for(const{stack:v,id:w,glyph:S}of m)y[v]===void 0&&(y[v]={}),y[v].glyphs===void 0&&(y[v].glyphs={}),y[v].glyphs[w]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},y[v].ascender=this.entries[v].ascender,y[v].descender=this.entries[v].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ug.none&&(this.localGlyphMode===Ug.all?!!this.localFontFamily:!!this.localFontFamily&&(Jt["CJK Unified Ideographs"](e)||Jt["Hangul Syllables"](e)||Jt.Hiragana(e)||Jt.Katakana(e)||Jt["CJK Symbols and Punctuation"](e)||Jt["CJK Unified Ideographs Extension A"](e)||Jt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let c=e.tinySDF;if(!c){let k="400";/bold/i.test(r)?k="900":/medium/i.test(r)?k="500":/light/i.test(r)&&(k="200"),c=e.tinySDF=new Rh.TinySDF({fontFamily:a,fontWeight:k,fontSize:24*Sa,buffer:3*Sa,radius:8*Sa}),c.fontWeight=k}if(this.localGlyphs[c.fontWeight][n])return this.localGlyphs[c.fontWeight][n];const d=String.fromCodePoint(n),{data:m,width:y,height:v,glyphWidth:w,glyphHeight:S,glyphLeft:A,glyphTop:R,glyphAdvance:D}=c.draw(d);return this.localGlyphs[c.fontWeight][n]={id:n,bitmap:new _c({width:y,height:v},m),metrics:{width:w/Sa,height:S/Sa,left:A/Sa,top:R/Sa-27,advance:D/Sa,localGlyph:!0}}}}Rh.loadGlyphRange=function(t,e,r,n,a){const c=256*e,d=c+255,m=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${c}-${d}`),So.Glyphs);Xe(m,(y,v)=>{if(y)a(y);else if(v){const w={},S=function(A){return new Ph(A).readFields(iI,{})}(v);for(const A of S.glyphs)w[A.id]=A;a(null,{glyphs:w,ascender:S.ascender,descender:S.descender})}})},Rh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=r;const m=this.size=t+4*e,y=this._createCanvas(m),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${d} ${c} ${t}px ${a}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(t),d=Math.ceil(r),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),y=Math.min(this.size-this.buffer,d+Math.ceil(n)),v=m+2*this.buffer,w=y+2*this.buffer,S=Math.max(v*w,0),A=new Uint8ClampedArray(S),R={data:A,width:v,height:w,glyphWidth:m,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(m===0||y===0)return R;const{ctx:D,buffer:k,gridInner:U,gridOuter:G}=this;D.clearRect(k,k,m,y),D.fillText(t,k,k+d);const Y=D.getImageData(k,k,m,y);G.fill(hf,0,S),U.fill(0,0,S);for(let te=0;te<y;te++)for(let ee=0;ee<m;ee++){const ue=Y.data[4*(te*m+ee)+3]/255;if(ue===0)continue;const le=(te+k)*v+ee+k;if(ue===1)G[le]=0,U[le]=hf;else{const pe=.5-ue;G[le]=pe>0?pe*pe:0,U[le]=pe<0?pe*pe:0}}Sb(G,0,0,v,w,v,this.f,this.v,this.z),Sb(U,k,k,m,y,v,this.f,this.v,this.z);for(let te=0;te<S;te++){const ee=Math.sqrt(G[te])-Math.sqrt(U[te]);A[te]=Math.round(255-255*(ee/this.radius+this.cutoff))}return R}};const vc=ms;function Ab(t,e,r,n){const a=[],c=t.imagePrimary,d=c.pixelRatio,m=c.paddedRect.w-2*vc,y=c.paddedRect.h-2*vc,v=t.right-t.left,w=t.bottom-t.top,S=c.stretchX||[[0,m]],A=c.stretchY||[[0,y]],R=(Pe,qe)=>Pe+qe[1]-qe[0],D=S.reduce(R,0),k=A.reduce(R,0),U=m-D,G=y-k;let Y=0,te=D,ee=0,ue=k,le=0,pe=U,be=0,Ie=G;if(c.content&&n){const Pe=c.content;Y=mm(S,0,Pe[0]),ee=mm(A,0,Pe[1]),te=mm(S,Pe[0],Pe[2]),ue=mm(A,Pe[1],Pe[3]),le=Pe[0]-Y,be=Pe[1]-ee,pe=Pe[2]-Pe[0]-te,Ie=Pe[3]-Pe[1]-ue}const ze=(Pe,qe,Qe,Ve)=>{const Je=_m(Pe.stretch-Y,te,v,t.left),Ne=gm(Pe.fixed-le,pe,Pe.stretch,D),Ke=_m(qe.stretch-ee,ue,w,t.top),Et=gm(qe.fixed-be,Ie,qe.stretch,k),tt=_m(Qe.stretch-Y,te,v,t.left),Xt=gm(Qe.fixed-le,pe,Qe.stretch,D),Bt=_m(Ve.stretch-ee,ue,w,t.top),st=gm(Ve.fixed-be,Ie,Ve.stretch,k),xr=new dt(Je,Ke),or=new dt(tt,Ke),Wt=new dt(tt,Bt),at=new dt(Je,Bt),mr=new dt(Ne/d,Et/d),jr=new dt(Xt/d,st/d),wr=e*Math.PI/180;if(wr){const ci=Math.sin(wr),hi=Math.cos(wr),_i=[hi,-ci,ci,hi];xr._matMult(_i),or._matMult(_i),at._matMult(_i),Wt._matMult(_i)}const Vr=Pe.stretch+Pe.fixed,Pr=Qe.stretch+Qe.fixed,ei=qe.stretch+qe.fixed,Dr=Ve.stretch+Ve.fixed,Oi=t.imageSecondary;return{tl:xr,tr:or,bl:at,br:Wt,texPrimary:{x:c.paddedRect.x+vc+Vr,y:c.paddedRect.y+vc+ei,w:Pr-Vr,h:Dr-ei},texSecondary:Oi?{x:Oi.paddedRect.x+vc+Vr,y:Oi.paddedRect.y+vc+ei,w:Pr-Vr,h:Dr-ei}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mr,pixelOffsetBR:jr,minFontScaleX:pe/d/v,minFontScaleY:Ie/d/w,isSDF:r}};if(n&&(c.stretchX||c.stretchY)){const Pe=Ib(S,U,D),qe=Ib(A,G,k);for(let Qe=0;Qe<Pe.length-1;Qe++){const Ve=Pe[Qe],Je=Pe[Qe+1];for(let Ne=0;Ne<qe.length-1;Ne++)a.push(ze(Ve,qe[Ne],Je,qe[Ne+1]))}}else a.push(ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return a}function mm(t,e,r){let n=0;for(const a of t)n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return n}function Ib(t,e,r){const n=[{fixed:-vc,stretch:0}];for(const[a,c]of t){const d=n[n.length-1];n.push({fixed:a-d.stretch,stretch:d.stretch}),n.push({fixed:a-d.stretch,stretch:d.stretch+(c-a)})}return n.push({fixed:e+vc,stretch:r}),n}function _m(t,e,r,n){return t/e*r+n}function gm(t,e,r,n){return t-e*r/n}function hI(t,e,r,n){const a=e+t.positionedLines[n].lineOffset;return n===0?r+a/2:r+(a+(e+t.positionedLines[n-1].lineOffset))/2}function dI(t,e=1,r=!1){let n=1/0,a=1/0,c=-1/0,d=-1/0;const m=t[0];for(let R=0;R<m.length;R++){const D=m[R];(!R||D.x<n)&&(n=D.x),(!R||D.y<a)&&(a=D.y),(!R||D.x>c)&&(c=D.x),(!R||D.y>d)&&(d=D.y)}const y=Math.min(c-n,d-a);let v=y/2;const w=new Zn([],fI);if(y===0)return new dt(n,a);for(let R=n;R<c;R+=y)for(let D=a;D<d;D+=y)w.push(new Oh(R+v,D+v,v,t));let S=function(R){let D=0,k=0,U=0;const G=R[0];for(let Y=0,te=G.length,ee=te-1;Y<te;ee=Y++){const ue=G[Y],le=G[ee],pe=ue.x*le.y-le.x*ue.y;k+=(ue.x+le.x)*pe,U+=(ue.y+le.y)*pe,D+=3*pe}return new Oh(k/D,U/D,0,R)}(t),A=w.length;for(;w.length;){const R=w.pop();(R.d>S.d||!S.d)&&(S=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-S.d<=e||(v=R.h/2,w.push(new Oh(R.p.x-v,R.p.y-v,v,t)),w.push(new Oh(R.p.x+v,R.p.y-v,v,t)),w.push(new Oh(R.p.x-v,R.p.y+v,v,t)),w.push(new Oh(R.p.x+v,R.p.y+v,v,t)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${S.d}`)),S.p}function fI(t,e){return e.max-t.max}class Oh{constructor(e,r,n,a){this.p=new dt(e,r),this.h=n,this.d=function(c,d){let m=!1,y=1/0;for(let v=0;v<d.length;v++){const w=d[v];for(let S=0,A=w.length,R=A-1;S<A;R=S++){const D=w[S],k=w[R];D.y>c.y!=k.y>c.y&&c.x<(k.x-D.x)*(c.y-D.y)/(k.y-D.y)+D.x&&(m=!m),y=Math.min(y,fc(c,D,k))}}return(m?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const jg=Number.POSITIVE_INFINITY,pI=Math.sqrt(2);function Cb(t,[e,r]){let n=0,a=0;if(r===jg){e<0&&(e=0);const c=e/pI;switch(t){case"top-right":case"top-left":a=c-7;break;case"bottom-right":case"bottom-left":a=7-c;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":n=-c;break;case"top-left":case"bottom-left":n=c;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-r}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,a]}function Vg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mI(t,e,r,n,a,c,d,m,y,v,w,S,A,R,D){let k=c.textMaxSize.evaluate(e,{},S);k===void 0&&(k=d);const U=t.layers[0].layout,G=U.get("icon-offset").evaluate(e,{},S),Y=Lb(r.horizontal)||r.vertical,te=A.name==="globe",ee=wo,ue=d/ee,le=t.tilePixelRatio*k/ee,pe=(Je=t.overscaling,t.zoom>18&&Je>2&&(Je>>=1),Math.max(Mt/(512*Je),1)*U.get("symbol-spacing")),be=U.get("text-padding")*t.tilePixelRatio,Ie=U.get("icon-padding")*t.tilePixelRatio,ze=br(U.get("text-max-angle")),Pe=U.get("text-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",qe=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Qe=U.get("symbol-placement"),Ve=pe/2;var Je;const Ne=U.get("icon-text-fit").evaluate(e,{},S),Ke=U.get("icon-text-fit-padding").evaluate(e,{},S),Et=Ne!=="none";let tt;t.hasAnyIconTextFit===!1&&Et&&(t.hasAnyIconTextFit=!0),n&&Et&&(t.allowVerticalPlacement&&r.vertical&&(tt=_b(n,r.vertical,Ne,Ke,G,ue)),Y&&(n=_b(n,Y,Ne,Ke,G,ue)));const Xt=(Bt,st,xr)=>{if(st.x<0||st.x>=Mt||st.y<0||st.y>=Mt)return;let or=null;if(te){const{x:Wt,y:at,z:mr}=A.projectTilePoint(st.x,st.y,xr);or={anchor:new Bl(Wt,at,mr,0,void 0),up:A.upVector(xr,st.x,st.y)}}(function(Wt,at,mr,jr,wr,Vr,Pr,ei,Dr,Oi,ci,hi,_i,ui,tn,Mi,xn,Gn,fo,Yi,un,io,no,oo,Zi,_s,Sc){const Wo=Wt.addToLineVertexArray(at,jr);let gs,qs,If,Bm,R1,O1,D1,z1=0,k1=0,F1=0,B1=0,hy=-1,dy=-1;const rl={};let N1=Yd("");const Ou=mr?mr.anchor:at,fy=Dr.layout.get("icon-text-fit").evaluate(un,{},Zi)!=="none";let py=0,my=0;if(Dr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[py,my]=Dr.layout.get("text-offset").evaluate(un,{},Zi).map(ys=>ys*wo):(py=Dr.layout.get("text-radial-offset").evaluate(un,{},Zi)*wo,my=jg),Wt.allowVerticalPlacement&&wr.vertical){const ys=wr.vertical;if(tn)O1=Gg(ys),ei&&(D1=Gg(ei));else{const vs=Dr.layout.get("text-rotate").evaluate(un,{},Zi)+90;If=ym(Oi,Ou,at,ci,hi,_i,ys,ui,vs,Mi),ei&&(Bm=ym(Oi,Ou,at,ci,hi,_i,ei,Gn,vs))}}if(Vr){const ys=Dr.layout.get("icon-rotate").evaluate(un,{},Zi),vs=Ab(Vr,ys,no,fy),Uh=ei?Ab(ei,ys,no,fy):void 0;qs=ym(Oi,Ou,at,ci,hi,_i,Vr,Gn,ys),z1=4*vs.length;const U1=Wt.iconSizeData;let Du=null;U1.kind==="source"?(Du=[Ea*Dr.layout.get("icon-size").evaluate(un,{},Zi)],Du[0]>xc&&ve(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${df}. Reduce your "icon-size".`)):U1.kind==="composite"&&(Du=[Ea*io.compositeIconSizes[0].evaluate(un,{},Zi),Ea*io.compositeIconSizes[1].evaluate(un,{},Zi)],(Du[0]>xc||Du[1]>xc)&&ve(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${df}. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,vs,Du,Yi,fo,un,!1,mr,at,Wo.lineStartIndex,Wo.lineLength,-1,oo,Zi,_s,Sc),hy=Wt.icon.placedSymbolArray.length-1,Uh&&(k1=4*Uh.length,Wt.addSymbols(Wt.icon,Uh,Du,Yi,fo,un,Gs.vertical,mr,at,Wo.lineStartIndex,Wo.lineLength,-1,oo,Zi,_s,Sc),dy=Wt.icon.placedSymbolArray.length-1)}for(const ys in wr.horizontal){const vs=wr.horizontal[ys];gs||(N1=Yd(vs.text),tn?R1=Gg(vs):gs=ym(Oi,Ou,at,ci,hi,_i,vs,ui,Dr.layout.get("text-rotate").evaluate(un,{},Zi),Mi));const Uh=vs.positionedLines.length===1;if(F1+=Pb(Wt,mr,at,vs,Pr,Dr,tn,un,Mi,Wo,wr.vertical?Gs.horizontal:Gs.horizontalOnly,Uh?Object.keys(wr.horizontal):[ys],rl,hy,io,oo,Zi,_s),Uh)break}wr.vertical&&(B1+=Pb(Wt,mr,at,wr.vertical,Pr,Dr,tn,un,Mi,Wo,Gs.vertical,["vertical"],rl,dy,io,oo,Zi,_s));let Mc=-1;const _y=(ys,vs)=>ys?Math.max(ys,vs):vs;Mc=_y(R1,Mc),Mc=_y(O1,Mc),Mc=_y(D1,Mc);const OC=Mc>-1?1:0;Wt.glyphOffsetArray.length>=65535&&ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),un.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,un.sortKey),Wt.symbolInstances.emplaceBack(at.x,at.y,Ou.x,Ou.y,Ou.z,rl.right>=0?rl.right:-1,rl.center>=0?rl.center:-1,rl.left>=0?rl.left:-1,rl.vertical>=0?rl.vertical:-1,hy,dy,N1,gs!==void 0?gs:Wt.collisionBoxArray.length,gs!==void 0?gs+1:Wt.collisionBoxArray.length,If!==void 0?If:Wt.collisionBoxArray.length,If!==void 0?If+1:Wt.collisionBoxArray.length,qs!==void 0?qs:Wt.collisionBoxArray.length,qs!==void 0?qs+1:Wt.collisionBoxArray.length,Bm||Wt.collisionBoxArray.length,Bm?Bm+1:Wt.collisionBoxArray.length,ci,F1,B1,z1,k1,OC,0,py,my,Mc,0,fy?1:0)})(t,st,or,Bt,r,n,a,tt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,be,Pe,y,0,Ie,qe,G,e,c,v,w,S,R,D)};if(Qe==="line")for(const Bt of wb(e.geometry,0,0,Mt,Mt)){const st=uI(Bt,pe,ze,r.vertical||Y,n,ee,le,t.overscaling,Mt);for(const xr of st)Y&&_I(t,Y.text,Ve,xr)||Xt(Bt,xr,S)}else if(Qe==="line-center"){for(const Bt of e.geometry)if(Bt.length>1){const st=cI(Bt,ze,r.vertical||Y,n,ee,le);st&&Xt(Bt,st,S)}}else if(e.type==="Polygon")for(const Bt of Ag(e.geometry,0)){const st=dI(Bt,16);Xt(Bt[0],new Bl(st.x,st.y,0,0,void 0),S)}else if(e.type==="LineString")for(const Bt of e.geometry)Xt(Bt,new Bl(Bt[0].x,Bt[0].y,0,0,void 0),S);else if(e.type==="Point")for(const Bt of e.geometry)for(const st of Bt)Xt([st],new Bl(st.x,st.y,0,0,void 0),S)}const df=255,xc=df*Ea;function Pb(t,e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U,G){const Y=function(ue,le,pe,be,Ie,ze,Pe,qe){const Qe=[];if(le.positionedLines.length===0)return Qe;const Ve=be.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,Je=function(Xt){const Bt=Xt[0],st=Xt[1],xr=Bt*st;return xr>0?[Bt,-st]:xr<0?[-Bt,st]:Bt===0?[st,Bt]:[st,-Bt]}(pe);let Ne=Math.abs(le.top-le.bottom);for(const Xt of le.positionedLines)Ne-=Xt.lineOffset;const Ke=le.positionedLines.length,Et=Ne/Ke;let tt=le.top-pe[1];for(let Xt=0;Xt<Ke;++Xt){const Bt=le.positionedLines[Xt];tt=hI(le,Et,tt,Xt);for(const st of Bt.positionedGlyphs){if(!st.rect)continue;const xr=st.rect||{};let or=ub+1,Wt=!0,at=1,mr=0;if(st.imageName){const Yi=Pe[st.imageName];if(!Yi)continue;if(Yi.sdf){ve("SDF images are not supported in formatted text and will be ignored.");continue}Wt=!1,at=Yi.pixelRatio,or=ms/at}const jr=(Ie||qe)&&st.vertical,wr=st.metrics.advance*st.scale/2,Vr=st.metrics,Pr=st.rect;if(Pr===null)continue;qe&&le.verticalizable&&(mr=st.imageName?wr-st.metrics.width*st.scale/2:0);const ei=Ie?[st.x+wr,st.y]:[0,0];let Dr=[0,0],Oi=[0,0],ci=!1;Ie||(jr?(Oi=[st.x+wr+Je[0],st.y+Je[1]-mr],ci=!0):Dr=[st.x+wr+pe[0],st.y+pe[1]-mr]);const hi=Pr.w*st.scale/(at*(st.localGlyph?Sa:1)),_i=Pr.h*st.scale/(at*(st.localGlyph?Sa:1));let ui,tn,Mi,xn;if(jr){const Yi=st.y-tt,un=new dt(-wr,wr-Yi),io=-Math.PI/2,no=new dt(...Oi);ui=new dt(-wr+Dr[0],Dr[1]),ui._rotateAround(io,un)._add(no),ui.x+=-Yi+wr,ui.y-=(Vr.left-or)*st.scale;const oo=st.imageName?Vr.advance*st.scale:wo*st.scale,Zi=String.fromCodePoint(st.glyph);qA(Zi)?ui.x+=(1-or)*st.scale:ZA(Zi)?ui.x+=oo-Vr.height*st.scale+(-or-1)*st.scale:ui.x+=st.imageName||Vr.width+2*or===Pr.w&&Vr.height+2*or===Pr.h?(oo-_i)/2:(oo-(Vr.height+2*or)*st.scale)/2,tn=new dt(ui.x,ui.y-hi),Mi=new dt(ui.x+_i,ui.y),xn=new dt(ui.x+_i,ui.y-hi)}else{const Yi=(Vr.left-or)*st.scale-wr+Dr[0],un=(-Vr.top-or)*st.scale+Dr[1],io=Yi+hi,no=un+_i;ui=new dt(Yi,un),tn=new dt(io,un),Mi=new dt(Yi,no),xn=new dt(io,no)}if(Ve){let Yi;Yi=Ie?new dt(0,0):ci?new dt(Je[0],Je[1]):new dt(pe[0],pe[1]),ui._rotateAround(Ve,Yi),tn._rotateAround(Ve,Yi),Mi._rotateAround(Ve,Yi),xn._rotateAround(Ve,Yi)}const Gn=new dt(0,0),fo=new dt(0,0);Qe.push({tl:ui,tr:tn,bl:Mi,br:xn,texPrimary:xr,texSecondary:void 0,writingMode:le.writingMode,glyphOffset:ei,sectionIndex:st.sectionIndex,isSDF:Wt,pixelOffsetTL:Gn,pixelOffsetBR:fo,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,n,y,c,d,m,a,t.allowVerticalPlacement),te=t.textSizeData;let ee=null;te.kind==="source"?(ee=[Ea*c.layout.get("text-size").evaluate(m,{},U)],ee[0]>xc&&ve(`${t.layerIds[0]}: Value for "text-size" is >= ${df}. Reduce your "text-size".`)):te.kind==="composite"&&(ee=[Ea*D.compositeTextSizes[0].evaluate(m,{},U),Ea*D.compositeTextSizes[1].evaluate(m,{},U)],(ee[0]>xc||ee[1]>xc)&&ve(`${t.layerIds[0]}: Value for "text-size" is >= ${df}. Reduce your "text-size".`)),t.addSymbols(t.text,Y,ee,y,d,m,w,e,r,v.lineStartIndex,v.lineLength,R,k,U,G,!1);for(const ue of S)A[ue]=t.text.placedSymbolArray.length-1;return 4*Y.length}function Lb(t){for(const e in t)return t[e];return null}function ym(t,e,r,n,a,c,d,m,y,v){let w=d.top,S=d.bottom,A=d.left,R=d.right;const D=d.collisionPadding;if(D&&(A-=D[0],w-=D[1],R+=D[2],S+=D[3]),y){const k=new dt(A,w),U=new dt(R,w),G=new dt(A,S),Y=new dt(R,S),te=br(y);let ee=new dt(0,0);v&&(ee=new dt(v[0],v[1])),k._rotateAround(te,ee),U._rotateAround(te,ee),G._rotateAround(te,ee),Y._rotateAround(te,ee),A=Math.min(k.x,U.x,G.x,Y.x),R=Math.max(k.x,U.x,G.x,Y.x),w=Math.min(k.y,U.y,G.y,Y.y),S=Math.max(k.y,U.y,G.y,Y.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,A,w,R,S,m,n,a,c),t.length-1}function Gg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function _I(t,e,r,n){const a=t.compareText;if(e in a){const c=a[e];for(let d=c.length-1;d>=0;d--)if(n.dist(c[d])<r)return!0}else a[e]=[];return a[e].push(n),!1}function Rb(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),c=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),d=Math.sin(t._pitch)*c+a;return Math.min(1.01*d,a*(1/t._horizonShift))}function ff(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,a=(t.x+1)*r,c=t.y*r,d=(t.y+1)*r,m=Lr(n),y=Lr(a),v=ri(c),w=ri(d),S=e.project(m,v),A=e.project(y,v),R=e.project(y,w),D=e.project(m,w);let k=Math.min(S.x,A.x,R.x,D.x),U=Math.min(S.y,A.y,R.y,D.y),G=Math.max(S.x,A.x,R.x,D.x),Y=Math.max(S.y,A.y,R.y,D.y);const te=r/16;function ee(le,pe,be,Ie,ze,Pe){const qe=(be+ze)/2,Qe=(Ie+Pe)/2,Ve=e.project(Lr(qe),ri(Qe)),Je=Math.max(0,k-Ve.x,U-Ve.y,Ve.x-G,Ve.y-Y);k=Math.min(k,Ve.x),G=Math.max(G,Ve.x),U=Math.min(U,Ve.y),Y=Math.max(Y,Ve.y),Je>te&&(ee(le,Ve,be,Ie,qe,Qe),ee(Ve,pe,qe,Qe,ze,Pe))}ee(S,A,n,c,a,c),ee(A,R,a,c,a,d),ee(R,D,a,d,n,d),ee(D,S,n,d,n,c),k-=te,U-=te,G+=te,Y+=te;const ue=1/Math.max(G-k,Y-U);return{scale:ue,x:k*ue,y:U*ue,x2:G*ue,y2:Y*ue,projection:e}}function Ob(t,{x:e,y:r},n=0){return new dt(((e-n)*t.scale-t.x)*Mt,(r*t.scale-t.y)*Mt)}const gI=s.a6.identity(new Float32Array(16));class bc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Ae(0,0)}projectTilePoint(e,r,n){return{x:e,y:r,z:0}}locationPoint(e,r,n=!0){return e._coordinatePoint(e.locationCoordinate(r),n)}pixelsPerMeter(e,r){return Or(1,e)*r}pixelSpaceConversion(e,r,n){return 1}farthestPixelDistance(e){return Rb(e,e.pixelsPerMeter)}pointCoordinate(e,r,n,a){const c=e.horizonLineFromTop(!1),d=new dt(r,Math.max(c,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,r,n){const a=new dt(r,n);if(e.elevation)return e.elevation.pointCoordinate(a);{const c=this.pointCoordinate(e,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const n=e.horizonLineFromTop();return r.y<n}createInversionMatrix(e,r){return gI}createTileMatrix(e,r,n){let a,c,d;const m=n.canonical,y=s.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=ff(m,this);a=1,c=v.x+n.wrap*v.scale,d=v.y,s.a6.scale(y,y,[a/v.scale,a/v.scale,e.pixelsPerMeter/r])}else a=r/e.zoomScale(m.z),c=(m.x+Math.pow(2,m.z)*n.wrap)*a,d=m.y*a;return s.a6.translate(y,y,[c,d,0]),s.a6.scale(y,y,[a/Mt,a/Mt,1]),y}upVector(e,r,n){return[0,0,1]}upVectorScale(e,r,n){return{metersToTile:1}}}class yI extends bc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(br(r));this.n=(a+Math.sin(br(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n,c:a,r0:c}=this,d=br(e-this.center[0]),m=br(r),y=Math.sqrt(a-2*n*Math.sin(m))/n;return{x:y*Math.sin(d*n),y:y*Math.cos(d*n)-c,z:0}}unproject(e,r){const{n,c:a,r0:c}=this,d=c+r;let m=Math.atan2(e,Math.abs(d))*Math.sign(d);d*n<0&&(m-=Math.PI*Math.sign(e)*Math.sign(d));const y=br(this.center[0])*n;m=kn(m,-Math.PI-y,Math.PI-y);const v=Zt(zi(m/n)+this.center[0],-180,180),w=Math.asin(Zt((a-(e*e+d*d)*n*n)/(2*n),-1,1)),S=Zt(zi(w),-Hr,Hr);return new Ae(v,S)}}const pf=1.340264,mf=-.081106,_f=893e-6,gf=.003796,vm=Math.sqrt(3)/2;class vI extends bc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(vm*Math.sin(r)),a=n*n,c=a*a*a;return{x:.5*(e*Math.cos(n)/(vm*(pf+3*mf*a+c*(7*_f+9*gf*a)))/Math.PI+.5),y:1-.5*(n*(pf+mf*a+c*(_f+gf*a))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,a=n*n,c=a*a*a;for(let w,S,A,R=0;R<12&&(S=n*(pf+mf*a+c*(_f+gf*a))-r,A=pf+3*mf*a+c*(7*_f+9*gf*a),w=S/A,n=Zt(n-w,-Math.PI/3,Math.PI/3),a=n*n,c=a*a*a,!(Math.abs(w)<1e-12));++R);const d=vm*e*(pf+3*mf*a+c*(7*_f+9*gf*a))/Math.cos(n),m=Math.asin(Math.sin(n)/vm),y=Zt(180*d/Math.PI,-180,180),v=Zt(180*m/Math.PI,-Hr,Hr);return new Ae(y,v)}}class xI extends bc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const n=360*(e-.5),a=Zt(360*(.5-r),-Hr,Hr);return new Ae(n,a)}}const Dh=Math.PI/2;function xm(t){return Math.tan((Dh+t)/2)}class bI extends bc{constructor(e){super(e),this.center=e.center||[0,30];const[r,n]=this.parallels=e.parallels||[30,30];let a=br(r),c=br(n);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const d=Math.cos(a),m=xm(a);this.n=a===c?Math.sin(a):Math.log(d/Math.cos(c))/Math.log(xm(c)/m),this.f=d*Math.pow(xm(a),this.n)/this.n}project(e,r){r=br(r),this.southernCenter&&(r=-r),e=br(e-this.center[0]);const n=1e-6,{n:a,f:c}=this;c>0?r<-Dh+n&&(r=-Dh+n):r>Dh-n&&(r=Dh-n);const d=c/Math.pow(xm(r),a);let m=d*Math.sin(a*e),y=c-d*Math.cos(a*e);return m=.5*(m/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:m,y:this.southernCenter?y:1-y,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n,f:a}=this,c=a-r,d=Math.sign(c),m=Math.sign(n)*Math.sqrt(e*e+c*c);let y=Math.atan2(e,Math.abs(c))*d;c*n<0&&(y-=Math.PI*Math.sign(e)*d);const v=Zt(zi(y/n)+this.center[0],-180,180),w=Zt(zi(2*Math.atan(Math.pow(a/m,1/n))-Dh),-Hr,Hr);return new Ae(v,this.southernCenter?-w:w)}}class Db extends bc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Br(e),y:Mr(r),z:0}}unproject(e,r){const n=Lr(e),a=ri(r);return new Ae(n,a)}}const zb=br(Hr);class wI extends bc{project(e,r){const n=(r=br(r))*r,a=n*n;return{x:.5*((e=br(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,a=25,c=0,d=n*n;do{d=n*n;const v=d*d;c=(n*(1.007226+d*(.015085+v*(.028874*d-.044475-.005916*v)))-r)/(1.007226+d*(.045255+v*(.259866*d-.311325-.005916*11*v))),n=Zt(n-c,-zb,zb)}while(Math.abs(c)>1e-6&&--a>0);d=n*n;const m=Zt(zi(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=zi(n);return new Ae(m,y)}}const kb=br(Hr);class TI extends bc{project(e,r){r=br(r),e=br(e);const n=Math.cos(r),a=2/Math.PI,c=Math.acos(n*Math.cos(e/2)),d=Math.sin(c)/c,m=.5*(e*a+2*n*Math.sin(e/2)/d)||0,y=.5*(r+Math.sin(r)/d)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,r){let n=e=(2*e-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,c=25;const d=1e-6;let m=0,y=0;do{const v=Math.cos(a),w=Math.sin(a),S=2*w*v,A=w*w,R=v*v,D=Math.cos(n/2),k=Math.sin(n/2),U=2*D*k,G=k*k,Y=1-R*D*D,te=Y?1/Y:0,ee=Y?Math.acos(v*D)*Math.sqrt(1/Y):0,ue=.5*(2*ee*v*k+2*n/Math.PI)-e,le=.5*(ee*w+a)-r,pe=.5*te*(R*G+ee*v*D*A)+1/Math.PI,be=te*(U*S/4-ee*w*k),Ie=.125*te*(S*k-ee*w*R*U),ze=.5*te*(A*D+ee*G*v)+.5,Pe=be*Ie-ze*pe;m=(le*be-ue*ze)/Pe,y=(ue*Ie-le*pe)/Pe,n=Zt(n-m,-Math.PI,Math.PI),a=Zt(a-y,-kb,kb)}while((Math.abs(m)>d||Math.abs(y)>d)&&--c>0);return new Ae(zi(n),zi(a))}}class Fb extends bc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(br(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:n,cosPhi:a}=this;return{x:br(e)*a*n+.5,y:-Math.sin(br(r))/a*n+.5,z:0}}unproject(e,r){const{scale:n,cosPhi:a}=this,c=-(r-.5)/n,d=Zt(zi((e-.5)/n)/a,-180,180),m=Math.asin(Zt(c*a,-1,1)),y=Zt(zi(m),-Hr,Hr);return new Ae(d,y)}}class EI extends Db{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,n){const a=ef(e,r,n),c=Jp(tl(n));return s.N.transformMat4(a,a,c),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,r){const n=$e(r.lat,r.lng),a=s.N.normalize([],n),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,d=Or(1,0)*Mt*c;s.N.scaleAndAdd(n,n,a,d);const m=s.a6.identity(new Float64Array(16));return s.a6.multiply(m,e.pixelMatrix,e.globeMatrix),s.N.transformMat4(n,n,m),new dt(n[0],n[1])}pixelsPerMeter(e,r){return Or(1,0)*r}pixelSpaceConversion(e,r,n){const a=Or(1,e)*r,c=Zr(Or(1,45)*r,a,n);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,n){const a=vg(tl(n.canonical));return s.a6.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,r){const{center:n}=e,a=Jp(tl(r));return s.a6.rotateY(a,a,br(n.lng)),s.a6.rotateX(a,a,br(n.lat)),s.a6.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,r,n,a){return ex(e,r,n,!0)||new si(0,0)}pointCoordinate3D(e,r,n){const a=this.pointCoordinate(e,r,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,r){return!ex(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(a,c){const d=a.cameraToCenterDistance,m=a._centerAltitude*c,y=a._camera,v=a._camera.forward(),w=s.N.add([],s.N.scale([],v,-d),[0,0,m]),S=a.worldSize/(2*Math.PI),A=[0,0,-S],R=a.width/a.height,D=Math.tan(a.fovAboveCenter),k=s.N.scale([],y.up(),D),U=s.N.scale([],y.right(),D*R),G=s.N.normalize([],s.N.add([],s.N.add([],v,k),U)),Y=[];let te;if(new pg(w,G).closestPointOnSphere(A,S,Y)){const ee=s.N.add([],Y,A),ue=s.N.sub([],ee,w);te=Math.cos(a.fovAboveCenter)*s.N.length(ue)}else{const ee=s.N.sub([],w,A),ue=s.N.sub([],A,w);s.N.normalize(ue,ue);const le=s.N.length(ee)-S;te=Math.sqrt(le*(le+2*S));const pe=Math.acos(te/(S+le))-Math.acos(s.N.dot(v,ue));te*=Math.cos(pe)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=mc(e.zoom);if(n>0){const a=Rb(e,Or(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Zr(r,a+c*(1-Math.cos(d)),Math.pow(n,10))}return r}upVector(e,r,n){return ef(r,n,e,1)}upVectorScale(e){return{metersToTile:Xp(Kp(tl(e)))}}}function Bb(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Db(t);case"equirectangular":return new xI(t);case"naturalEarth":return new wI(t);case"equalEarth":return new vI(t);case"winkelTripel":return new TI(t);case"albers":return r?new Fb(t):new yI(t);case"lambertConformalConic":return r?new Fb(t):new bI(t);case"globe":return new EI(t)}throw new Error(`Invalid projection name: ${t.name}`)}const SI=om.types,MI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bm(t,e,r,n,a,c,d,m,y,v,w,S,A){const R=m?Math.min(xc,Math.round(m[0])):0,D=m?Math.min(xc,Math.round(m[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*a),c,d,(R<<1)+(y?1:0),D,16*v,16*w,256*S,256*A)}function wm(t,e,r){t.emplaceBack(e,r)}function Tm(t,e,r,n,a,c,d){t.emplaceBack(e,r,n,a,c,d)}function Em(t,e,r,n,a){t.emplaceBack(e,r,n,a),t.emplaceBack(e,r,n,a),t.emplaceBack(e,r,n,a),t.emplaceBack(e,r,n,a)}function AI(t){for(const e of t.sections)if(Ed(e.text))return!0;return!1}class $g{constructor(e){this.layoutVertexArray=new pu,this.indexArray=new Hn,this.programConfigurations=e,this.segments=new vn,this.dynamicLayoutVertexArray=new Wa,this.opacityVertexArray=new jd,this.placedSymbolArray=new Pp,this.iconTransitioningVertexArray=new ta,this.globeExtVertexArray=new Ud,this.zOffsetVertexArray=new _u}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,n,a,c){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,FA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,MI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,NA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,BA.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Gt($g,"SymbolBuffers");class qg{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new vn,this.collisionVertexArray=new Gd,this.collisionVertexArrayExt=new Wa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,UA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,jA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Gt(qg,"CollisionBuffers");class Sm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.a6.identity([]),this.placementViewportMatrix=s.a6.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Dg(this.zoom,r["text-size"]),this.iconSizeData=Dg(this.zoom,r["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),c=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(d=>Gs[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new $g(new q(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new $g(new q(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Op,this.lineVertexArray=new xu,this.symbolInstances=new Rp}calculateGlyphDependencies(e,r,n,a,c){for(let d=0;d<e.length;d++){const m=e.codePointAt(d);if(m===void 0)break;if(r[m]=!0,a&&c&&m<=65535){const y=cf[e.charAt(d)];y&&(r[y.charCodeAt(0)]=!0)}}}populate(e,r,n,a){const c=this.layers[0],d=c.layout,m=this.projection.name==="globe",y=d.get("text-font"),v=d.get("text-field"),w=d.get("icon-image"),S=(v.value.kind!=="constant"||v.value.value instanceof Bn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),A=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,R=d.get("symbol-sort-key");if(this.features=[],!S&&!A)return;const D=r.iconDependencies,k=r.glyphDependencies,U=r.availableImages,G=new sn(this.zoom);for(const{feature:Y,id:te,index:ee,sourceLayerIndex:ue}of e){const le=c._featureFilter.needGeometry,pe=Un(Y,le);if(!c._featureFilter.filter(G,pe,n))continue;if(le||(pe.geometry=Xn(Y,n,a)),m&&Y.type!==1&&n.z<=5){const Pe=pe.geometry,qe=.98078528056,Qe=(Ve,Je)=>{const Ne=ef(Ve.x,Ve.y,n,1),Ke=ef(Je.x,Je.y,n,1);return s.N.dot(Ne,Ke)<qe};for(let Ve=0;Ve<Pe.length;Ve++)Pe[Ve]=ho(Pe[Ve],Qe)}let be,Ie;if(S){const Pe=c.getValueAndResolveTokens("text-field",pe,n,U),qe=Bn.factory(Pe);AI(qe)&&(this.hasRTLText=!0),(!this.hasRTLText||Ha()==="unavailable"||this.hasRTLText&&rs.isParsed())&&(be=$A(qe,c,pe))}if(A){const Pe=c.getValueAndResolveTokens("icon-image",pe,n,U);Ie=Pe instanceof dr?Pe:dr.fromString(Pe)}if(!be&&!Ie)continue;const ze=this.sortFeaturesByKey?R.evaluate(pe,{},n):void 0;if(this.features.push({id:te,text:be,icon:Ie,index:ee,sourceLayerIndex:ue,geometry:pe.geometry,properties:Y.properties,type:SI[Y.type],sortKey:ze}),Ie&&(D[Ie.namePrimary]=!0,Ie.nameSecondary&&(D[Ie.nameSecondary]=!0)),be){const Pe=y.evaluate(pe,{},n).join(","),qe=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gs.vertical)>=0;for(const Qe of be.sections)if(Qe.image)D[Qe.image.namePrimary]=!0;else{const Ve=qa(be.toString()),Je=Qe.fontStack||Pe,Ne=k[Je]=k[Je]||{};this.calculateGlyphDependencies(Qe.text,Ne,qe,this.allowVerticalPlacement,Ve)}}}d.get("symbol-placement")==="line"&&(this.features=function(Y){const te={},ee={},ue=[];let le=0;function pe(Pe){ue.push(Y[Pe]),le++}function be(Pe,qe,Qe){const Ve=ee[Pe];return delete ee[Pe],ee[qe]=Ve,ue[Ve].geometry[0].pop(),ue[Ve].geometry[0]=ue[Ve].geometry[0].concat(Qe[0]),Ve}function Ie(Pe,qe,Qe){const Ve=te[qe];return delete te[qe],te[Pe]=Ve,ue[Ve].geometry[0].shift(),ue[Ve].geometry[0]=Qe[0].concat(ue[Ve].geometry[0]),Ve}function ze(Pe,qe,Qe){const Ve=Qe?qe[0][qe[0].length-1]:qe[0][0];return`${Pe}:${Ve.x}:${Ve.y}`}for(let Pe=0;Pe<Y.length;Pe++){const qe=Y[Pe],Qe=qe.geometry,Ve=qe.text?qe.text.toString():null;if(!Ve){pe(Pe);continue}const Je=ze(Ve,Qe),Ne=ze(Ve,Qe,!0);if(Je in ee&&Ne in te&&ee[Je]!==te[Ne]){const Ke=Ie(Je,Ne,Qe),Et=be(Je,Ne,ue[Ke].geometry);delete te[Je],delete ee[Ne],ee[ze(Ve,ue[Et].geometry,!0)]=Et,ue[Ke].geometry=null}else Je in ee?be(Je,Ne,Qe):Ne in te?Ie(Je,Ne,Qe):(pe(Pe),te[Je]=le-1,ee[Ne]=le-1)}return ue.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,te)=>Y.sortKey-te.sortKey)}update(e,r,n,a,c){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const m=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,m,n,a,c),this.icon.programConfigurations.updatePaintArrays(e,r,m,n,a,c)}updateZOffset(){const e=(c,d,m)=>{n+=d,n>c.length&&c.resize(n);for(let y=-d;y<0;y++)c.emplace(y+n,m)},r=(c,d,m)=>{a+=d,a>c.length&&c.resize(a);for(let y=-d;y<0;y++)c.emplace(y+a,m)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,a=0;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c),{numHorizontalGlyphVertices:m,numVerticalGlyphVertices:y,numIconVertices:v}=d,w=d.zOffset,S=v>0;if((m>0||y>0)&&(e(this.text.zOffsetVertexArray,m,w),e(this.text.zOffsetVertexArray,y,w)),S){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:R}=d;A>=0&&r(this.icon.zOffsetVertexArray,v,w),R>=0&&r(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Bb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:c}of r)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,a,c,d,m,y,v,w,S,A,R,D,k,U){const G=e.indexArray,Y=e.layoutVertexArray,te=e.globeExtVertexArray,ee=e.segments.prepareSegment(4*r.length,Y,G,this.canOverlap?d.sortKey:void 0),ue=this.glyphOffsetArray.length,le=ee.vertexLength,pe=this.allowVerticalPlacement&&m===Gs.vertical?Math.PI/2:0,be=d.text&&d.text.sections;for(let ze=0;ze<r.length;ze++){const{tl:Pe,tr:qe,bl:Qe,br:Ve,texPrimary:Je,texSecondary:Ne,pixelOffsetTL:Ke,pixelOffsetBR:Et,minFontScaleX:tt,minFontScaleY:Xt,glyphOffset:Bt,isSDF:st,sectionIndex:xr}=r[ze],or=ee.vertexLength,Wt=Bt[1];if(bm(Y,v.x,v.y,Pe.x,Wt+Pe.y,Je.x,Je.y,n,st,Ke.x,Ke.y,tt,Xt),bm(Y,v.x,v.y,qe.x,Wt+qe.y,Je.x+Je.w,Je.y,n,st,Et.x,Ke.y,tt,Xt),bm(Y,v.x,v.y,Qe.x,Wt+Qe.y,Je.x,Je.y+Je.h,n,st,Ke.x,Et.y,tt,Xt),bm(Y,v.x,v.y,Ve.x,Wt+Ve.y,Je.x+Je.w,Je.y+Je.h,n,st,Et.x,Et.y,tt,Xt),y){const{x:at,y:mr,z:jr}=y.anchor,[wr,Vr,Pr]=y.up;Tm(te,at,mr,jr,wr,Vr,Pr),Tm(te,at,mr,jr,wr,Vr,Pr),Tm(te,at,mr,jr,wr,Vr,Pr),Tm(te,at,mr,jr,wr,Vr,Pr),Em(e.dynamicLayoutVertexArray,at,mr,jr,pe)}else Em(e.dynamicLayoutVertexArray,v.x,v.y,v.z,pe);if(U){const at=Ne||Je;wm(e.iconTransitioningVertexArray,at.x,at.y),wm(e.iconTransitioningVertexArray,at.x+at.w,at.y),wm(e.iconTransitioningVertexArray,at.x,at.y+at.h),wm(e.iconTransitioningVertexArray,at.x+at.w,at.y+at.h)}G.emplaceBack(or,or+1,or+2),G.emplaceBack(or+1,or+2,or+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bt[0]),ze!==r.length-1&&xr===r[ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,d,d.index,{},R,D,k,be&&be[xr])}const Ie=y?y.anchor:v;e.placedSymbolArray.emplaceBack(Ie.x,Ie.y,Ie.z,v.x,v.y,ue,this.glyphOffsetArray.length-ue,le,w,S,v.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],m,0,!1,0,A,0)}_commitLayoutVertex(e,r,n,a,c,d,m){e.emplaceBack(r,n,a,c,d,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,r,n,a,c,d,m){const y=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),v=y.vertexLength,w=m.tileAnchorX,S=m.tileAnchorY;for(let R=0;R<4;R++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,r,e.padding,m.zOffset),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,S,new dt(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,S,new dt(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,S,new dt(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,S,new dt(e.x1,e.y2)),y.vertexLength+=4;const A=n.indexArray;A.emplaceBack(v,v+1),A.emplaceBack(v+1,v+2),A.emplaceBack(v+2,v+3),A.emplaceBack(v+3,v),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,a,c,d){for(let m=a;m<c;m++){const y=n.get(m),v=this.getSymbolInstanceTextSize(e,d,r,m);this._addCollisionDebugVertices(y,v,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,r,n,a,c,d){for(let m=a;m<c;m++){const y=n.get(m),v=this.getSymbolInstanceIconSize(e,r,d.placedIconSymbolIndex);this._addCollisionDebugVertices(y,v,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qg(mu,nb.members,ta),this.iconCollisionBox=new qg(mu,nb.members,ta);const n=Ah(this.iconSizeData,e),a=Ah(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,e,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(a,e,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,r,n,a){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),d=hm(this.textSizeData,e,c)/wo;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,r,n){const a=this.icon.placedSymbolArray.get(n),c=hm(this.iconSizeData,e,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,r,n,a){e.emplaceBack(r,-n,-n,a),e.emplaceBack(r,n,-n,a),e.emplaceBack(r,n,n,a),e.emplaceBack(r,-n,n,a)}_updateTextDebugCollisionBoxes(e,r,n,a,c,d){for(let m=a;m<c;m++){const y=n.get(m),v=this.getSymbolInstanceTextSize(e,d,r,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,y.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,r,n,a,c,d){for(let m=a;m<c;m++){const y=n.get(m),v=this.getSymbolInstanceIconSize(e,r,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,y.padding,d.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Ah(this.iconSizeData,e),a=Ah(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,e,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(a,e,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(n,e,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._updateIconDebugCollisionBoxes(n,e,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,a,c,d,m,y,v){const w={};if(r<n){const{x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee,featureIndex:ue}=e.get(r);w.textBox={x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee},w.textFeatureIndex=ue}if(a<c){const{x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee,featureIndex:ue}=e.get(a);w.verticalTextBox={x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee},w.verticalTextFeatureIndex=ue}if(d<m){const{x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee,featureIndex:ue}=e.get(d);w.iconBox={x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee},w.iconFeatureIndex=ue}if(y<v){const{x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee,featureIndex:ue}=e.get(y);w.verticalIconBox={x1:S,y1:A,x2:R,y2:D,padding:k,projectedAnchorX:U,projectedAnchorY:G,projectedAnchorZ:Y,tileAnchorX:te,tileAnchorY:ee},w.verticalIconFeatureIndex=ue}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),a=n.vertexStartIndex+4*n.numGlyphs;for(let c=n.vertexStartIndex;c<a;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),a=[],c=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const y=this.symbolInstances.get(m);a.push(0|Math.round(r*y.tileAnchorX+n*y.tileAnchorY)),c.push(y.featureIndex)}return d.sort((m,y)=>a[m]-a[y]||c[y]-c[m]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:v}=n;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==a&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Gt(Sm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Sm.addDynamicAttributes=Em;const II=new an({"symbol-placement":new xt(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fr(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(Re.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new xt(Re.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new xt(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xt(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new fr(Re.layout_symbol["icon-size"]),"icon-text-fit":new fr(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new fr(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new fr(Re.layout_symbol["icon-image"]),"icon-rotate":new fr(Re.layout_symbol["icon-rotate"]),"icon-padding":new xt(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new fr(Re.layout_symbol["icon-offset"]),"icon-anchor":new fr(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(Re.layout_symbol["text-rotation-alignment"]),"text-field":new fr(Re.layout_symbol["text-field"]),"text-font":new fr(Re.layout_symbol["text-font"]),"text-size":new fr(Re.layout_symbol["text-size"]),"text-max-width":new fr(Re.layout_symbol["text-max-width"]),"text-line-height":new fr(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new fr(Re.layout_symbol["text-letter-spacing"]),"text-justify":new fr(Re.layout_symbol["text-justify"]),"text-radial-offset":new fr(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new fr(Re.layout_symbol["text-anchor"]),"text-max-angle":new xt(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(Re.layout_symbol["text-writing-mode"]),"text-rotate":new fr(Re.layout_symbol["text-rotate"]),"text-padding":new xt(Re.layout_symbol["text-padding"]),"text-keep-upright":new xt(Re.layout_symbol["text-keep-upright"]),"text-transform":new fr(Re.layout_symbol["text-transform"]),"text-offset":new fr(Re.layout_symbol["text-offset"]),"text-allow-overlap":new xt(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xt(Re.layout_symbol["text-ignore-placement"]),"text-optional":new xt(Re.layout_symbol["text-optional"]),visibility:new xt(Re.layout_symbol.visibility)});var Zg={paint:new an({"icon-opacity":new fr(Re.paint_symbol["icon-opacity"]),"icon-emissive-strength":new fr(Re.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new fr(Re.paint_symbol["text-emissive-strength"]),"icon-color":new fr(Re.paint_symbol["icon-color"]),"icon-halo-color":new fr(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new fr(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fr(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(Re.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new fr(Re.paint_symbol["icon-image-cross-fade"]),"text-opacity":new fr(Re.paint_symbol["text-opacity"]),"text-color":new fr(Re.paint_symbol["text-color"],{runtimeType:wt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new fr(Re.paint_symbol["text-halo-color"]),"text-halo-width":new fr(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new fr(Re.paint_symbol["text-halo-blur"]),"text-translate":new xt(Re.paint_symbol["text-translate"]),"text-translate-anchor":new xt(Re.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new xt(Re.paint_symbol["icon-color-saturation"])}),layout:II};class Nb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:me,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Gt(Nb,"FormatSectionOverride",{omit:["defaultValue"]});class Mm extends $o{constructor(e,r,n){super(e,Zg,r,n)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const c of n)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,a){const c=this.layout.get(e).evaluate(r,{},n,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||tu(d.value)||!c?c:function(m,y){return y.replace(/{([^{}]+)}/g,(v,w)=>w in m?String(m[w]):"")}(r.properties,c)}createBucket(e){return new Sm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Zg.paint.overridableProperties){if(!Mm.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new Nb(r),a=new ah(n,r.property.specification,this.scope,this.options);let c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new wd("source",a):new ru("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new cc(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Mm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),a=Zg.paint.properties[r];let c=!1;const d=m=>{for(const y of m)if(a.overrides&&a.overrides.hasOverride(y))return void(c=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Bn)d(n.value.value.sections);else if(n.value.kind==="source"){const m=v=>{c||(v instanceof ls&&Ln(v.value)===qt?d(v.value.sections):v instanceof za?d(v.sections):v.eachChild(m))},y=n.value;y._styleExpression&&m(y._styleExpression.expression)}return c}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,n=[];return e&&n.push("symbolIcon"),r&&n.push("symbolSDF"),n}getDefaultProgramParams(e,r){return{config:new N(this,r),overrideFog:!1}}}const CI=new an({visibility:new xt(Re.layout_background.visibility)});var PI={paint:new an({"background-color":new xt(Re.paint_background["background-color"]),"background-pattern":new xt(Re.paint_background["background-pattern"]),"background-opacity":new xt(Re.paint_background["background-opacity"]),"background-emissive-strength":new xt(Re.paint_background["background-emissive-strength"])}),layout:CI};const LI=new an({visibility:new xt(Re.layout_raster.visibility)});var RI={paint:new an({"raster-opacity":new xt(Re.paint_raster["raster-opacity"]),"raster-color":new Cl(Re.paint_raster["raster-color"]),"raster-color-mix":new xt(Re.paint_raster["raster-color-mix"]),"raster-color-range":new xt(Re.paint_raster["raster-color-range"]),"raster-hue-rotate":new xt(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(Re.paint_raster["raster-saturation"]),"raster-contrast":new xt(Re.paint_raster["raster-contrast"]),"raster-resampling":new xt(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(Re.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new xt(Re.paint_raster["raster-emissive-strength"]),"raster-array-band":new xt(Re.paint_raster["raster-array-band"]),"raster-elevation":new xt(Re.paint_raster["raster-elevation"])}),layout:LI},Hg=xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wg{constructor(e,r,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,a)}update(e,r,n){const{width:a,height:c}=e,{context:d}=this,{gl:m}=d;if(m.bindTexture(m.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===c){const{x:y,y:v}=n||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)m.texSubImage2D(m.TEXTURE_2D,0,y,v,m.RGBA,m.UNSIGNED_BYTE,e);else{let w=this.format,S=m.UNSIGNED_BYTE;this.format===m.R32F&&(w=m.RED,S=m.FLOAT),m.texSubImage2D(m.TEXTURE_2D,0,y,v,a,c,w,S,e.data)}}else if(this.size=[a,c],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===m.R8&&(y=m.RED),m.texImage2D(m.TEXTURE_2D,0,this.format,y,m.UNSIGNED_BYTE,e)}else{let y=this.format,v=this.format,w=m.UNSIGNED_BYTE;this.format===m.DEPTH_COMPONENT&&(y=m.DEPTH_COMPONENT16,w=m.UNSIGNED_SHORT),this.format===m.R8&&(v=m.RED),this.format===m.R32F&&(w=m.FLOAT,v=m.RED),m.texImage2D(m.TEXTURE_2D,0,y,a,c,0,v,w,e.data)}this.useMipmap=!!(r&&r.useMipmap),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,r,n=!1){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,n,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),this.wrapS=n),a!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Am{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}}function Im(t,e,r,n,a,c,d,m){const y=[t,e,1,r,n,1,a,c,1],v=[d,m,1],w=s.co.adjoint([],y),[S,A,R]=s.N.transformMat3(v,v,w);return s.co.multiply(y,y,[S,0,0,0,A,0,0,0,R])}function Ub(t,e,r,n,a,c,d,m){const y=function(v,w,S,A,R,D,k,U){const G=Im(0,0,1,0,1,1,0,1),Y=Im(v,w,S,A,R,D,k,U),te=s.co.adjoint([],G);return s.co.multiply(Y,Y,te)}(t,e,r,n,a,c,d,m);return[y[2]/y[8]/Mt,y[5]/y[8]/Mt]}function Cm(t){return[t[0],Math.min(Math.max(t[1],-Hr),Hr)]}class jb extends No{constructor(e,r,n,a){super(),this.id=e,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new as("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Pt(this.map._requestManager.transformRequest(this.url,So.Image),(n,a)=>{this._imageRequest=null,this._loaded=!0,n?this.fire(new Ss(n)):a&&(this.image=a instanceof HTMLImageElement?nt.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Am(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new as("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Am||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],n=e[0][1];for(const c of e)c[1]>n&&(n=c[1]),c[1]<r&&(r=c[1]);const a=(n+r)/2;if(a>Hr?this.onNorthPole=!0:a<-Hr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(si.fromLngLat);this.tileID=function(d){let m=1/0,y=1/0,v=-1/0,w=-1/0;for(const k of d)m=Math.min(m,k.x),y=Math.min(y,k.y),v=Math.max(v,k.x),w=Math.max(w,k.y);const S=Math.max(v-m,w-y),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),R=Math.pow(2,A);let D=Math.floor((m+v)/2*R);return D>1&&(D-=1),new ot(A,D,Math.floor((y+w)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new as("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const G in this.tiles){const Y=this.tiles[G];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=ff(new ot(0,0,0),this.map.transform.projection),n=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(G){const Y=G[1].x-G[0].x,te=G[1].y-G[0].y,ee=G[2].x-G[1].x,ue=G[2].y-G[1].y,le=G[3].x-G[2].x,pe=G[3].y-G[2].y,be=G[0].x-G[3].x,Ie=G[0].y-G[3].y,ze=Y*ue-ee*te,Pe=ee*pe-le*ue,qe=le*Ie-be*pe,Qe=be*te-Y*Ie;return ze>0&&Pe>0&&qe>0&&Qe>0||ze<0&&Pe<0&&qe<0&&Qe<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=ff(this.tileID,this.map.transform.projection),[c,d,m,y]=this.coordinates.map(G=>{const Y=a.projection.project(G[0],G[1]);return Ob(a,Y)._round()});this.perspectiveTransform=Ub(c.x,c.y,d.x,d.y,m.x,m.y,y.x,y.y);const v=this._boundsArray=new va;v.emplaceBack(c.x,c.y,0,0),v.emplaceBack(d.x,d.y,Mt,0),v.emplaceBack(y.x,y.y,0,Mt),v.emplaceBack(m.x,m.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(v,Hg.members),this.boundsSegments=vn.simpleSegment(0,0,4,2);const w=[],S=[Cm((A=this.coordinates)[0]),Cm(A[1]),Cm(A[2]),Cm(A[3])];var A;const[R,D,k,U]=function(G){let Y=G[0][0],te=Y,ee=G[0][1],ue=ee;for(let le=1;le<G.length;le++)G[le][0]<Y?Y=G[le][0]:G[le][0]>te&&(te=G[le][0]),G[le][1]<ee?ee=G[le][1]:G[le][1]>ue&&(ue=G[le][1]);return[Y,ee,te-Y,ue-ee]}(S);{const G=new va,[Y,te,ee,ue]=function(Ke){let Et=Ke[0].x,tt=Et,Xt=Ke[0].y,Bt=Xt;for(let st=1;st<Ke.length;st++)Ke[st].x<Et?Et=Ke[st].x:Ke[st].x>tt&&(tt=Ke[st].x),Ke[st].y<Xt?Xt=Ke[st].y:Ke[st].y>Bt&&(Bt=Ke[st].y);return[Et,Xt,tt-Et,Bt-Xt]}(n),le=Ke=>[(Ke.x-Y)/ee,(Ke.y-te)/ue],[pe,be,Ie,ze]=n.map(le),Pe=function(Ke,Et,tt,Xt,Bt,st,xr,or){const Wt=Im(0,0,1,0,1,1,0,1),at=Im(Ke,Et,tt,Xt,Bt,st,xr,or),mr=s.co.adjoint([],at);return s.co.multiply(Wt,Wt,mr)}(pe[0],pe[1],be[0],be[1],Ie[0],Ie[1],ze[0],ze[1]);this.elevatedGlobePerspectiveTransform=Ub(pe[0],pe[1],be[0],be[1],Ie[0],Ie[1],ze[0],ze[1]);const qe=(Ke,Et)=>{w.push(Ke.lng);const tt=Math.round((Ke.lng-R)/k*Mt),Xt=Math.round((Ke.lat-D)/U*Mt),Bt=le(Et),st=s.N.transformMat3([],[Bt[0],Bt[1],1],Pe),xr=Math.round(st[0]/st[2]*Mt),or=Math.round(st[1]/st[2]*Mt);G.emplaceBack(tt,Xt,xr,or)},Qe=n[3].x-n[0].x,Ve=n[3].y-n[0].y,Je=n[2].x-n[1].x,Ne=n[2].y-n[1].y;for(let Ke=0;Ke<65;Ke++){const Et=Ke/64,tt=[n[0].x+Et*Qe,n[0].y+Et*Ve],Xt=[n[1].x+Et*Je,n[1].y+Et*Ne],Bt=Xt[0]-tt[0],st=Xt[1]-tt[1];for(let xr=0;xr<65;xr++){const or=xr/64,Wt={x:tt[0]+Bt*or,y:tt[1]+st*or,z:0};qe(r.projection.unproject(Wt.x,Wt.y),Wt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(G,Hg.members)}{this.maxLongitudeTriangleSize=0;let G=[],Y=new Hn;const te=(ee,ue,le)=>{Y.emplaceBack(ee,ue,le);const pe=w[ee],be=w[ue],Ie=w[le],ze=Math.min(Math.min(pe,be),Ie),Pe=Math.max(Math.max(pe,be),Ie)-ze;Pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Pe),G.push(ze+Pe/2)};for(let ee=0;ee<64;ee++)for(let ue=0;ue<64;ue++){const le=65*ee+ue,pe=le+1,be=le+65,Ie=be+1;te(le,be,pe),te(pe,be,Ie)}[G,Y]=function(ee,ue){const le=Array.from({length:ee.length},(Ie,ze)=>ze);le.sort((Ie,ze)=>ee[Ie]-ee[ze]);const pe=[],be=new Hn;for(let Ie=0;Ie<le.length;Ie++){const ze=le[Ie];pe.push(ee[ze]);const Pe=3*ze,qe=Pe+1;be.emplaceBack(ue.uint16[Pe],ue.uint16[qe],ue.uint16[qe+1])}return[pe,be]}(G,Y),this.elevatedGlobeTrianglesCenterLongitudes=G,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Y)}this.elevatedGlobeSegments=vn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/Mt,0,U/Mt,0,0,D,R,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,n=r.gl;!this._dirty||this.texture instanceof Am||(this.texture?this.texture.update(this.image):(this.texture=new Wg(r,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let a=((w,S)=>w+360*Math.round((S-w)/360))(e+180,n[0]);const c=new vn,d=(w,S)=>{c.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:r.segments[0].vertexLength,primitiveLength:S,sortKey:void 0,vaos:{}})},m=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-a)<=m){const w=Fe(n,0,n.length,a+m);return w===n.length||d(w,de(n,w+1,n.length,a+360-m)-w),c}a<n[0]&&(a+=360);const y=de(n,0,n.length,a-m);if(y===n.length)return d(0,n.length),c;d(0,y-0);const v=Fe(n,y+1,n.length,a+m);return v!==n.length&&d(v,n.length-v),c}}const OI=(Math.pow(256,2)-1)/16907520;class Vb extends $o{constructor(e,r,n){super(e,RI,r,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof jb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[n,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(a)||n===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=tf({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,a])}}const DI=new an({visibility:new xt(Re["layout_raster-particle"].visibility)});var zI={paint:new an({"raster-particle-array-band":new xt(Re["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new xt(Re["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Cl(Re["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new xt(Re["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new xt(Re["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new xt(Re["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new xt(Re["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:DI};class Gb extends $o{constructor(e,r,n){super(e,zI,r,n),this._updateColorRamp(),this.onRemove=a=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&a.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=nt.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=tf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=nt.now()}}class kI extends $o{constructor(e,r){super(e,{},r),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const FI=new an({visibility:new xt(Re.layout_sky.visibility)});var BI={paint:new an({"sky-type":new xt(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new xt(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xt(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xt(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xt(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new Cl(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xt(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xt(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xt(Re.paint_sky["sky-opacity"])}),layout:FI};function Xg(t,e,r){const n=[0,0,1],a=s.bi.identity([]);return s.bi.rotateY(a,a,r?-br(t)+Math.PI:br(t)),s.bi.rotateX(a,a,-br(e)),s.N.transformQuat(n,n,a),s.N.normalize(n,n)}var NI={paint:new an({})};function $b(t,e){const r=Pm(t.projection,t.zoom,t.width,t.height),n=function(c,d,m,y,v){const w=new Ae(m.lng-180*wc,m.lat),S=new Ae(m.lng+180*wc,m.lat),A=c.project(w.lng,w.lat),R=c.project(S.lng,S.lat),D=-Math.atan2(R.y-A.y,R.x-A.x),k=si.fromLngLat(m);k.y=Zt(k.y,-1+wc,1-wc);const U=k.toLngLat(),G=c.project(U.lng,U.lat),Y=si.fromLngLat(U);Y.x+=wc;const te=Y.toLngLat(),ee=c.project(te.lng,te.lat),ue=Hb(ee.x-G.x,ee.y-G.y,D),le=si.fromLngLat(U);le.y+=wc;const pe=le.toLngLat(),be=c.project(pe.lng,pe.lat),Ie=Hb(be.x-G.x,be.y-G.y,D),ze=Math.abs(ue.x)/Math.abs(Ie.y),Pe=s.a6.identity([]);s.a6.rotateZ(Pe,Pe,-D*(1-(v?0:y)));const qe=s.a6.identity([]);return s.a6.scale(qe,qe,[1,1-(1-ze)*y,1]),qe[4]=-Ie.x/Ie.y*y,s.a6.rotateZ(qe,qe,D),s.a6.multiply(qe,Pe,qe),qe}(t.projection,0,t.center,r,e),a=qb(t);return s.a6.scale(n,n,[a,a,1]),n}function qb(t){const e=t.projection,r=Pm(t.projection,t.zoom,t.width,t.height),n=Zb(e,t.center),a=Zb(e,Ae.convert(e.center));return Math.pow(2,n*r+(1-r)*a)}function Pm(t,e,r,n,a=1/0){const c=t.range;if(!c)return 0;const d=Math.min(a,Math.max(r,n)),m=Math.log(d/1024)/Math.LN2;return Pn(c[0]+m,c[1]+m,e)}const wc=1/4e4;function Zb(t,e){const r=Zt(e.lat,-Hr,Hr),n=new Ae(e.lng-180*wc,r),a=new Ae(e.lng+180*wc,r),c=t.project(n.lng,r),d=t.project(a.lng,r),m=si.fromLngLat(n),y=si.fromLngLat(a),v=d.x-c.x,w=d.y-c.y,S=y.x-m.x,A=y.y-m.y,R=Math.sqrt((S*S+A*A)/(v*v+w*w));return Math.log(R)/Math.LN2}function Hb(t,e,r){const n=Math.cos(r),a=Math.sin(r);return{x:t*n-e*a,y:t*a+e*n}}function Wb(t,e,r){s.a6.identity(t),s.a6.rotateZ(t,t,br(e[2])),s.a6.rotateX(t,t,br(e[0])),s.a6.rotateY(t,t,br(e[1])),s.a6.scale(t,t,r),s.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Lm(t,e,r,n,a,c,d,m){const y=[r[0]-e[0],r[1]-e[1],0],v=[n[0]-e[0],n[1]-e[1],0];if(s.N.length(y)<1e-12||s.N.length(v)<1e-12)return s.bi.identity(t);const w=s.N.cross([],y,v);s.N.normalize(w,w),s.N.subtract(v,n,e),y[2]=(c-a)*m,v[2]=(d-a)*m;const S=y;return s.N.cross(S,y,v),s.N.normalize(S,S),s.bi.rotationTo(t,w,S)}function Yg(t,e,r=!1){const n=mc(e.zoom),a=function(c,d,m){const y=d.worldSize,v=[c[12],c[13],c[14]],w=ri(v[1]/y),S=Lr(v[0]/y),A=s.a6.identity([]),R=Or(1,w)*y,D=Or(1,0)*y*Wr(w,d.zoom),k=1/xg(y);let U=D*k;if(m){const ee=Pm(d.projection,d.zoom,d.width,d.height,1024);U=k*d.projection.pixelSpaceConversion(d.center.lat,y,ee)}const G=$e(w,S);s.N.add(G,G,s.N.scale([],s.N.normalize([],G),R*U*v[2]));const Y=function(ee){const ue=[ee[0],ee[1],ee[2]];let le=[0,1,0];const pe=s.N.cross([],le,ue);return s.N.cross(le,ue,pe),s.N.squaredLength(le)===0&&(le=[0,1,0],s.N.cross(pe,ue,le)),s.N.normalize(pe,pe),s.N.normalize(le,le),s.N.normalize(ue,ue),[pe[0],pe[1],pe[2],0,le[0],le[1],le[2],0,ue[0],ue[1],ue[2],0,ee[0],ee[1],ee[2],1]}(G);s.a6.scale(A,A,[U,U,U*R]),s.a6.translate(A,A,[-v[0],-v[1],-v[2]]);const te=s.a6.multiply([],d.globeMatrix,Y);return s.a6.multiply(te,te,A),s.a6.multiply(te,te,c),te}(t,e,r);if(n>0){const c=function(d,m){const y=m.worldSize,v=Or(1,0)*y*Wr(m.center.lat,m.zoom)/xg(y),w=Or(1,m.center.lat)*y,S=s.a6.identity([]);return s.a6.rotateY(S,S,br(m.center.lng)),s.a6.rotateX(S,S,br(m.center.lat)),s.a6.translate(S,S,[0,0,J]),s.a6.scale(S,S,[v,v,v*w]),s.a6.translate(S,S,[m.point.x-.5*y,m.point.y-.5*y,0]),s.a6.multiply(S,S,d),s.a6.multiply(S,m.globeMatrix,S)}(t,e);return function(d,m,y){const v=(D,k,U)=>{const G=s.N.length(D),Y=s.N.length(k),te=kl(D,k,U);return s.N.scale(te,te,1/s.N.length(te)*Zr(G,Y,U))},w=v([d[0],d[1],d[2]],[m[0],m[1],m[2]],y),S=v([d[4],d[5],d[6]],[m[4],m[5],m[6]],y),A=v([d[8],d[9],d[10]],[m[8],m[9],m[10]],y),R=kl([d[12],d[13],d[14]],[m[12],m[13],m[14]],y);return[w[0],w[1],w[2],0,S[0],S[1],S[2],0,A[0],A[1],A[2],0,R[0],R[1],R[2],1]}(a,c,n)}return a}function Xb(t,e,r,n){const a=pn.projectAabbCorners(n,r);let c=Number.MAX_VALUE,d=-1;for(let v=0;v<a.length;++v){const w=a[v];w[0]=(.5*w[0]+.5)*e.width,w[1]=(.5-.5*w[1])*e.height,w[2]<c&&(d=v,c=w[2])}const m=v=>new dt(a[v][0],a[v][1]);let y;switch(d){case 0:case 6:y=[m(1),m(5),m(4),m(7),m(3),m(2),m(1)];break;case 1:case 7:y=[m(0),m(4),m(5),m(6),m(2),m(3),m(0)];break;case 3:case 5:y=[m(1),m(0),m(4),m(7),m(6),m(2),m(1)];break;default:y=[m(1),m(5),m(6),m(7),m(3),m(0),m(1)]}if(ia(t,y))return c}const UI=xi([{name:"a_pos_3f",components:3,type:"Float32"}]),jI=xi([{name:"a_color_3f",components:3,type:"Float32"}]),VI=xi([{name:"a_color_4f",components:4,type:"Float32"}]),GI=xi([{name:"a_uv_2f",components:2,type:"Float32"}]),$I=xi([{name:"a_normal_3f",components:3,type:"Float32"}]),qI=xi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ZI=xi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Yb{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Kb{constructor(){this.instancedDataArray=new Zd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Kg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,r,n,a){this.tileToMeter=Xr(n);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:m,index:y,sourceLayerIndex:v}of e){const w=Un(d,c);if(!this.layers[0]._featureFilter.filter(new sn(this.zoom),w,n))continue;const S={id:m,sourceLayerIndex:v,index:y,geometry:c?w.geometry:Xn(d,n,a),properties:d.properties,type:d.type,patterns:{}},A=this.addFeature(S,S.geometry,w);A&&r.featureIndex.insert(d,S.geometry,y,v,this.index,this.instancesPerModel[A].instancedDataArray.length,Mt/32)}this.lookup=null}update(e,r,n,a){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const m in e)d.idToFeaturesIndex.hasOwnProperty(m)&&this.evaluate(d.features[d.idToFeaturesIndex[m]],e[m],d,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const n=this.instancesPerModel[r];for(const a of n.features){const c=this.layers[0],d=a.feature,m=this.canonical,y=c.paint.get("model-rotation").evaluate(d,{},m),v=c.paint.get("model-scale").evaluate(d,{},m),w=c.paint.get("model-translation").evaluate(d,{},m);s.N.exactEquals(a.rotation,y)&&s.N.exactEquals(a.scale,v)&&s.N.exactEquals(a.translation,w)||(this.evaluate(a,a.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const n=this.instancesPerModel[r];n.instancedDataArray.length<0||n.instancedDataArray.length===0||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,qI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const r=this.instancesPerModel[e];r.instancedDataArray.length!==0&&r.instancedDataBuffer&&r.instancedDataBuffer.destroy()}}addFeature(e,r,n){const a=this.layers[0],c=a.layout.get("model-id").evaluate(n,{},this.canonical);if(!c)return ve(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),c;this.instancesPerModel[c]||(this.instancesPerModel[c]=new Kb);const d=this.instancesPerModel[c],m=d.instancedDataArray,y=new Yb(n,m.length);for(const v of r)for(const w of v){if(w.x<0||w.x>=Mt||w.y<0||w.y>=Mt)continue;const S=(this.lookupDim-1)/Mt,A=this.lookupDim*(w.y*S|0)+w.x*S|0;if(this.lookup){if(this.lookup[A]!==0)continue;this.lookup[A]=1}this.instanceCount++;const R=m.length;m.resize(R+1),d.instancesEvaluatedElevation.push(0),m.float32[16*R]=w.x,m.float32[16*R+1]=w.y}return y.instancedDataCount=d.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(y),this.evaluate(y,{},d,!1)),c}evaluate(e,r,n,a){const c=this.layers[0],d=e.feature,m=this.canonical,y=e.rotation=c.paint.get("model-rotation").evaluate(d,r,m),v=e.scale=c.paint.get("model-scale").evaluate(d,r,m),w=e.translation=c.paint.get("model-translation").evaluate(d,r,m),S=c.paint.get("model-color").evaluate(d,r,m);S.a=c.paint.get("model-color-mix-intensity").evaluate(d,r,m);const A=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,v[0]),Math.max(v[1],v[2])),Wb(A,y,v);const R=Math.round(100*S.a)+S.b/1.05;for(let D=0;D<e.instancedDataCount;++D){const k=e.instancedDataOffset+D,U=16*k,G=n.instancedDataArray.float32;let Y=0;a&&(Y=G[U+6]-n.instancesEvaluatedElevation[k]);const te=0|G[U+1];G[U]=(0|G[U])+S.r/1.05,G[U+1]=te+S.g/1.05,G[U+2]=R,G[U+3]=1/(m.z>10?this.tileToMeter:Xr(m,te)),G[U+4]=w[0],G[U+5]=w[1],G[U+6]=w[2]+Y,G[U+7]=A[0],G[U+8]=A[1],G[U+9]=A[2],G[U+10]=A[4],G[U+11]=A[5],G[U+12]=A[6],G[U+13]=A[8],G[U+14]=A[9],G[U+15]=A[10],n.instancesEvaluatedElevation[k]=w[2]}}}Gt(Kg,"ModelBucket",{omit:["layers"]}),Gt(Kb,"PerModelAttributes"),Gt(Yb,"ModelFeature");const HI=new an({visibility:new xt(Re.layout_model.visibility),"model-id":new fr(Re.layout_model["model-id"])});var WI={paint:new an({"model-opacity":new xt(Re.paint_model["model-opacity"]),"model-rotation":new fr(Re.paint_model["model-rotation"]),"model-scale":new fr(Re.paint_model["model-scale"]),"model-translation":new fr(Re.paint_model["model-translation"]),"model-color":new fr(Re.paint_model["model-color"]),"model-color-mix-intensity":new fr(Re.paint_model["model-color-mix-intensity"]),"model-type":new xt(Re.paint_model["model-type"]),"model-cast-shadows":new xt(Re.paint_model["model-cast-shadows"]),"model-receive-shadows":new xt(Re.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new xt(Re.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new fr(Re.paint_model["model-emissive-strength"]),"model-roughness":new fr(Re.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new fr(Re.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new xt(Re.paint_model["model-cutoff-fade-range"])}),layout:HI};const Pu=64,zh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Jb(t,e,r,n,a,c,d,m,y,v=!1){const w=r.zoom,S=r.project(n),A=Wr(n.lat,w),R=1/A;s.a6.identity(t),s.a6.translate(t,t,[S.x+d[0]*R,S.y+d[1]*R,d[2]]);let D=1,k=1;const U=r.worldSize;if(v){if(r.projection.name==="mercator"){let ee=0;r.elevation&&(ee=r.elevation.getAtPointOrZero(new si(S.x/U,S.y/U),0));const ue=s.a7.transformMat4([],[S.x,S.y,ee,1],r.projMatrix)[3]/r.cameraToCenterDistance;D=ue,k=ue*Wr(r.center.lat,w)}else if(r.projection.name==="globe"){const ee=Yg(t,r),ue=s.a6.multiply([],r.projMatrix,ee),le=[0,0,0,1];s.a7.transformMat4(le,le,ue);const pe=le[3]/r.cameraToCenterDistance,be=mc(w),Ie=r.projection.pixelsPerMeter(n.lat,U)*Wr(n.lat,w),ze=r.projection.pixelsPerMeter(r.center.lat,U)*Wr(r.center.lat,w);D=pe/Zr(Ie,ln(r.center.lat),be),k=pe*A/Ie,D*=ze,k*=ze}}else D=R;s.a6.scale(t,t,[D,D,k]);const G=[...t],Y=e.orientation,te=[];if(Wb(te,[Y[0]+a[0],Y[1]+a[1],Y[2]+a[2]],c),s.a6.multiply(t,G,te),m&&r.elevation){let ee=0;const ue=[];if(y&&r.elevation){ee=function(be,Ie,ze,Pe,qe){const Qe=Ie.elevation;if(!Qe)return 0;const Ve=pn.projectAabbCorners(ze,Pe),Je=Or(1,qe.lat)*Ie.worldSize,Ne=function(mr,jr){const wr=[0,0,1],Vr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Pr of Vr){const ei=mr[Pr.corners[0]],Dr=mr[Pr.corners[1]],Oi=mr[Pr.corners[2]],ci=[Dr[0]-ei[0],Dr[1]-ei[1],jr*(Dr[2]-ei[2])],hi=s.N.cross(ci,ci,[Oi[0]-ei[0],Oi[1]-ei[1],jr*(Oi[2]-ei[2])]);s.N.normalize(hi,hi),Pr.dotProductWithUp=s.N.dot(hi,wr)}return Vr.sort((Pr,ei)=>Pr.dotProductWithUp-ei.dotProductWithUp),Vr[0].corners}(Ve,Je),Ke=Ve[Ne[0]],Et=Ve[Ne[1]],tt=Ve[Ne[2]],Xt=Ve[Ne[3]],Bt=Qe.getAtPointOrZero(new si(Ke[0]/Ie.worldSize,Ke[1]/Ie.worldSize),0),st=Qe.getAtPointOrZero(new si(Et[0]/Ie.worldSize,Et[1]/Ie.worldSize),0),xr=Qe.getAtPointOrZero(new si(tt[0]/Ie.worldSize,tt[1]/Ie.worldSize),0),or=Qe.getAtPointOrZero(new si(Xt[0]/Ie.worldSize,Xt[1]/Ie.worldSize),0),Wt=(Bt+or)/2,at=(st+xr)/2;return Wt>at?st<xr?Lm(be,Et,Xt,Ke,st,or,Bt,Je):Lm(be,tt,Ke,Xt,xr,Bt,or,Je):Bt<or?Lm(be,Ke,Et,tt,Bt,st,xr,Je):Lm(be,Xt,tt,Et,or,xr,st,Je),Math.max(Wt,at)}(ue,r,e.aabb,t,n);const le=s.a6.fromQuat([],ue),pe=s.a6.multiply([],le,te);s.a6.multiply(t,G,pe)}else ee=r.elevation.getAtPointOrZero(new si(S.x/U,S.y/U),0);ee!==0&&(t[14]+=ee)}}function yf(t,e,r=!1){t.uploaded||(t.gfxTexture=new Wg(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function XI(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,UI.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,$I.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,GI.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?jI:VI).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,ZI.members,!0)),t.segments=vn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&yf(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&yf(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&yf(n.normalTexture,e),n.occlusionTexture&&yf(n.occlusionTexture,e,r),n.emissionTexture&&yf(n.emissionTexture,e)}function Jg(t,e,r){if(t.meshes)for(const n of t.meshes)XI(n,e,r);if(t.children)for(const n of t.children)Jg(n,e,r)}function Rm(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Rm(e)}function Qg(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const r of t.children)Qg(r)}class YI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class KI{constructor(){this.tasks={},this.taskQueue=[],Yt(["process"],this),this.invoker=new YI(this.process),this.nextId=0}add(e,r){const n=this.nextId++,a=function({type:c,isSymbolTile:d,zoom:m}){return m=m||0,c==="message"?0:c!=="maybePrepare"||d?c!=="parseTile"||d?c==="parseTile"&&d?300-m:c==="maybePrepare"&&d?400-m:500:200-m:100-m}(r);if(a===0){Vt();try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:r,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Vt();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<r&&(r=c.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class Qb{constructor(e,r,n){this.target=e,this.parent=r,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new KI}send(e,r,n,a,c=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=d,this.callbacks[m]=n);const y=new Set;return this.target.postMessage({id:m,type:e,hasCallback:!!n,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:$a(r,y)},y),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const r=e.data,n=r.id;if(n&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(r.mustQueue||Vt()){const a=this.callbacks[n],c=this.scheduler.add(()=>this.processTask(n,r),a&&a.metadata||{type:"message"});c&&(this.cancelCallbacks[n]=c)}else this.processTask(n,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const n=this.callbacks[e];delete this.callbacks[e],n&&(r.error?n(Al(r.error)):n(null,Al(r.data)))}else{const n=new Set,a=r.hasCallback?(d,m)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?$a(d):null,data:$a(m,n)},n)}:d=>{},c=Al(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,a);else if(this.parent.getWorkerSource){const d=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,d[0],c.source,c.scope)[d[1]](c,a)}else a(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class kh{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=pr();const n=this.workerPool.acquire(this.id);for(let a=0;a<n.length;a++){const c=new kh.Actor(n[a],r,this.id);c.name=`Worker ${a}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,n){nn(this.actors,(a,c)=>{a.send(e,r,c)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}kh.Actor=Qb;var vf={workerUrl:"",workerClass:null,workerParams:void 0};function JI(){return vf.workerClass!=null?new vf.workerClass:new self.Worker(vf.workerUrl,vf.workerParams)}const ey="mapboxgl_preloaded_worker_pool";class xf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<xf.workerCount;)this.workers.push(new JI);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ey]}numActive(){return Object.keys(this.active).length}}let bf;function Om(){return bf||(bf=new xf),bf}xf.workerCount=2;let Dm,ty,Ma,Fh,ry,Bh=null;function e1(){return Vt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:ty||re.DRACO_URL}function t1(){if(Vt()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Fh)return Fh;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Fh=WebAssembly.validate(t)?re.MESHOPT_SIMD_URL:re.MESHOPT_URL,Fh}const zm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},QI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},wf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function r1(t,e,r){const n=r.json.bufferViews.length,a=r.buffers.length;e.bufferView=n,r.json.bufferViews[n]={buffer:a,byteLength:t.byteLength},r.buffers[a]=t}const iy="KHR_draco_mesh_compression";function eC(t,e){const r=t.extensions&&t.extensions[iy];if(!r)return;const n=new Ma.Decoder,a=s1(e,r.bufferView),c=new Ma.Mesh;if(!n.DecodeArrayToMesh(a,a.byteLength,c))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[t.indices],m=zm[d.componentType],y=d.count*m.BYTES_PER_ELEMENT,v=Ma._malloc(y);m===Uint16Array?n.GetTrianglesUInt16Array(c,y,v):n.GetTrianglesUInt32Array(c,y,v),r1(Ma.memory.buffer.slice(v,v+y),d,e),Ma._free(v);for(const w of Object.keys(r.attributes)){const S=n.GetAttributeByUniqueId(c,r.attributes[w]),A=e.json.accessors[t.attributes[w]],R=QI[A.componentType],D=A.count*wf[A.type]*zm[A.componentType].BYTES_PER_ELEMENT,k=Ma._malloc(D);n.GetAttributeDataArrayForAllPoints(c,S,Ma[R],D,k),r1(Ma.memory.buffer.slice(k,k+D),A,e),Ma._free(k)}n.destroy(),c.destroy(),delete t.extensions[iy]}const km="EXT_meshopt_compression";function tC(t,e){if(!t.extensions||!t.extensions[km])return;const r=t.extensions[km],n=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),a=new Uint8Array(r.count*r.byteStride);ry.decodeGltfBuffer(a,r.count,r.byteStride,n,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=a.buffer,delete t.extensions[km]}const i1=1179937895,n1=new TextDecoder("utf8");function o1(t,e){return new URL(t,e).href}function rC(t,e,r,n){return fetch(o1(t.uri,n)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[r]=a})}function s1(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function iC(t,e,r,n){if(t.uri){const a=o1(t.uri,n);return fetch(a).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[r]=c})}if(t.bufferView!==void 0){const a=s1(e,t.bufferView),c=new Blob([a],{type:t.mimeType});return createImageBitmap(c).then(d=>{e.images[r]=d})}}function a1(t,e=0,r){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===i1){const w=new Uint32Array(t,e);let S=2;const A=(w[S++]>>2)-3,R=w[S++]>>2;if(S++,n.json=JSON.parse(n1.decode(w.subarray(S,S+R))),S+=R,S<A){const D=w[S++];S++;const k=e+(S<<2);n.buffers[0]=t.slice(k,k+D)}}else n.json=JSON.parse(n1.decode(new Uint8Array(t,e)));const{buffers:a,images:c,meshes:d,extensionsUsed:m,bufferViews:y}=n.json;let v=Promise.resolve();if(a){const w=[];for(let S=0;S<a.length;S++){const A=a[S];A.uri?w.push(rC(A,n,S,r)):n.buffers[S]||(n.buffers[S]=null)}v=Promise.all(w)}return v.then(()=>{const w=[],S=m&&m.includes(iy),A=m&&m.includes(km);if(S&&w.push(function(){if(!Ma)return Dm||(Dm=function(R){let D,k=null;function U(){D=new Uint8Array(k.buffer)}function G(){throw new Error("Unexpected Draco error.")}const Y={a:{a:G,d:function(te,ee,ue){return D.copyWithin(te,ee,ee+ue)},c:function(te){const ee=D.length,ue=Math.max(te>>>0,Math.ceil(1.2*ee)),le=Math.ceil((ue-ee)/65536);try{return k.grow(le),U(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,Y):R.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,Y))).then(te=>{const{Rb:ee,Qb:ue,P:le,T:pe,X:be,Ja:Ie,La:ze,Qa:Pe,Va:qe,Wa:Qe,eb:Ve,jb:Je,f:Ne,e:Ke,yb:Et,zb:tt,Ab:Xt,Bb:Bt,Db:st,Gb:xr}=te.instance.exports;k=Ke;const or=(()=>{let Wt=0,at=0,mr=0,jr=0;return wr=>{mr&&(ee(jr),ee(Wt),at+=mr,mr=Wt=0),Wt||(at+=128,Wt=ue(at));const Vr=wr.length+7&-8;let Pr=Wt;Vr>=at&&(mr=Vr,Pr=jr=ue(Vr));for(let ei=0;ei<wr.length;ei++)D[Pr+ei]=wr[ei];return Pr}})();return U(),Ne(),{memory:Ke,_free:ee,_malloc:ue,Mesh:class{constructor(){this.ptr=le()}destroy(){pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ie()}destroy(){Je(this.ptr)}DecodeArrayToMesh(Wt,at,mr){const jr=or(Wt),wr=ze(this.ptr,jr,at,mr.ptr);return!!be(wr)}GetAttributeByUniqueId(Wt,at){return{ptr:Pe(this.ptr,Wt.ptr,at)}}GetTrianglesUInt16Array(Wt,at,mr){qe(this.ptr,Wt.ptr,at,mr)}GetTrianglesUInt32Array(Wt,at,mr){Qe(this.ptr,Wt.ptr,at,mr)}GetAttributeDataArrayForAllPoints(Wt,at,mr,jr,wr){Ve(this.ptr,Wt.ptr,at.ptr,mr,jr,wr)}},DT_INT8:Et(),DT_UINT8:tt(),DT_INT16:Xt(),DT_UINT16:Bt(),DT_UINT32:st(),DT_FLOAT32:xr()}})}(fetch(e1())),Dm.then(R=>{Ma=R,Dm=void 0}))}()),A&&w.push(function(){if(ry)return;const R=function(D){let k;const U=WebAssembly.instantiateStreaming(D,{}).then(te=>{k=te.instance,k.exports.__wasm_call_ctors()}),G={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Y={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:U,supported:!0,decodeGltfBuffer(te,ee,ue,le,pe,be){(function(Ie,ze,Pe,qe,Qe,Ve,Je){const Ne=Ie.exports.sbrk,Ke=qe+3&-4,Et=Ne(Ke*Qe),tt=Ne(Ve.length),Xt=new Uint8Array(Ie.exports.memory.buffer);Xt.set(Ve,tt);const Bt=ze(Et,qe,Qe,tt,Ve.length);if(Bt===0&&Je&&Je(Et,Ke,Qe),Pe.set(Xt.subarray(Et,Et+qe*Qe)),Ne(Et-Ne(0)),Bt!==0)throw new Error(`Malformed buffer data: ${Bt}`)})(k,k.exports[Y[pe]],te,ee,ue,le,k.exports[G[be]])}}}(fetch(t1()));return R.ready.then(()=>{ry=R})}()),c)for(let R=0;R<c.length;R++)w.push(iC(c[R],n,R,r));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(S&&d)for(const{primitives:R}of d)for(const D of R)eC(D,n);if(A&&d&&y)for(const R of y)tC(R,n);return n})})}class l1{constructor(e,r,n){if(this.triangleCount=r.length/3,this.min=new dt(0,0),this.max=new dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||n===0)return;const a=e.map(w=>w.x),c=e.map(w=>w.y);this.min=new dt(Math.min(...a),Math.min(...c)),this.max=new dt(Math.max(...a),Math.max(...c));const d=this.max.sub(this.min);d.x=Math.max(d.x,1),d.y=Math.max(d.y,1);const m=Math.max(d.x,d.y)/n;this.cellsX=Math.max(1,Math.ceil(d.x/m)),this.cellsY=Math.max(1,Math.ceil(d.y/m)),this.xScale=1/m,this.yScale=1/m;const y=[];for(let w=0;w<this.triangleCount;w++){const S=e[r[3*w+0]].sub(this.min),A=e[r[3*w+1]].sub(this.min),R=e[r[3*w+2]].sub(this.min),D=Tc(Math.floor(Math.min(S.x,A.x,R.x)),this.xScale,this.cellsX),k=Tc(Math.floor(Math.max(S.x,A.x,R.x)),this.xScale,this.cellsX),U=Tc(Math.floor(Math.min(S.y,A.y,R.y)),this.yScale,this.cellsY),G=Tc(Math.floor(Math.max(S.y,A.y,R.y)),this.yScale,this.cellsY),Y=new dt(0,0),te=new dt(0,0),ee=new dt(0,0),ue=new dt(0,0);for(let le=U;le<=G;++le){Y.y=te.y=le*m,ee.y=ue.y=(le+1)*m;for(let pe=D;pe<=k;++pe)Y.x=ee.x=pe*m,te.x=ue.x=(pe+1)*m,(J_(S,A,R,Y,te,ue)||J_(S,A,R,Y,ue,ee))&&y.push({cellIdx:le*this.cellsX+pe,triIdx:w})}}if(y.length===0)return;y.sort((w,S)=>w.cellIdx-S.cellIdx||w.triIdx-S.triIdx);let v=0;for(;v<y.length;){const w=y[v].cellIdx,S={start:this.payload.length,len:0};for(;v<y.length&&y[v].cellIdx===w;)++S.len,this.payload.push(y[v++].triIdx);this.cells[w]=S}}query(e,r,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;const a=Tc(e.x-this.min.x,this.xScale,this.cellsX),c=Tc(r.x-this.min.x,this.xScale,this.cellsX),d=Tc(e.y-this.min.y,this.yScale,this.cellsY),m=Tc(r.y-this.min.y,this.yScale,this.cellsY);for(let y=d;y<=m;y++)for(let v=a;v<=c;v++){const w=this.cells[y*this.cellsX+v];if(w)for(let S=0;S<w.len;S++){const A=this.payload[w.start+S],R=Math.floor(A/8),D=1<<A%8;if(!(this.lookup[R]&D)&&(this.lookup[R]|=D,n.push(A),n.length===this.triangleCount))return}}}}function Tc(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}function Lu(t,e){const r=t.json.bufferViews[e.bufferView],n=zm[e.componentType];return new n(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==wf[e.type]*n.BYTES_PER_ELEMENT?r.byteStride/n.BYTES_PER_ELEMENT:wf[e.type]))}function ny(t,e,r,n){const a=zm[e.componentType],c=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),d=t.json.bufferViews[e.bufferView],m=d.byteStride?d.byteStride/a.BYTES_PER_ELEMENT:wf[e.type],y=r.float32,v=y.length/r.capacity;for(let w=0,S=0;w<e.count*m;w+=m,S+=v)for(let A=0;A<v;A++)y[S+A]=n[w+A]*c;r._trim()}function nC(t,e,r){const n=t.indices,a=t.attributes,c={};c.indexArray=new Hn;const d=e.json.accessors[n],m=d.count/3;c.indexArray.reserve(m);const y=Lu(e,d);for(let A=0;A<m;A++)c.indexArray.emplaceBack(y[3*A],y[3*A+1],y[3*A+2]);c.indexArray._trim(),c.vertexArray=new Pl;const v=e.json.accessors[a.POSITION];c.vertexArray.reserve(v.count);const w=Lu(e,v);for(let A=0;A<v.count;A++)c.vertexArray.emplaceBack(w[3*A],w[3*A+1],w[3*A+2]);if(c.vertexArray._trim(),c.aabb=new pn(v.min,v.max),c.centroid=function(A,R){const D=[0,0,0],k=A.length;if(k>0){for(let U=0;U<k;U++){const G=3*A[U];D[0]+=R[G],D[1]+=R[G+1],D[2]+=R[G+2]}D[0]/=k,D[1]/=k,D[2]/=k}return D}(y,w),a.COLOR_0!==void 0){const A=e.json.accessors[a.COLOR_0],R=wf[A.type],D=Lu(e,A);c.colorArray=R===3?new Pl:new Wa,c.colorArray.resize(A.count),ny(e,A,c.colorArray,D)}if(a.NORMAL!==void 0){c.normalArray=new Pl;const A=e.json.accessors[a.NORMAL];c.normalArray.resize(A.count);const R=Lu(e,A);ny(e,A,c.normalArray,R)}if(a.TEXCOORD_0!==void 0&&r.length>0){c.texcoordArray=new yu;const A=e.json.accessors[a.TEXCOORD_0];c.texcoordArray.resize(A.count);const R=Lu(e,A);ny(e,A,c.texcoordArray,R)}if(a._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=Lu(e,A))}a._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(Lu(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const S=t.material;return c.material=function(A,R){const{emissiveFactor:D=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:U=.5,normalTexture:G,occlusionTexture:Y,emissiveTexture:te,doubleSided:ee}=A,{baseColorFactor:ue=[1,1,1,1],metallicFactor:le=1,roughnessFactor:pe=1,baseColorTexture:be,metallicRoughnessTexture:Ie}=A.pbrMetallicRoughness||{},ze=Y?R[Y.index]:void 0;if(Y&&Y.extensions&&Y.extensions.KHR_texture_transform&&ze){const Pe=Y.extensions.KHR_texture_transform;ze.offsetScale=[Pe.offset[0],Pe.offset[1],Pe.scale[0],Pe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new yn(...ue),metallicFactor:le,roughnessFactor:pe,baseColorTexture:be?R[be.index]:void 0,metallicRoughnessTexture:Ie?R[Ie.index]:void 0},doubleSided:ee,emissiveFactor:D,alphaMode:k,alphaCutoff:U,normalTexture:G?R[G.index]:void 0,occlusionTexture:ze,emissionTexture:te?R[te.index]:void 0,defined:A.defined===void 0}}(S!==void 0?e.json.materials[S]:{defined:!1},r),c}function c1(t,e,r){const{matrix:n,rotation:a,translation:c,scale:d,mesh:m,extras:y,children:v}=t,w={};if(w.matrix=n||s.a6.fromRotationTranslationScale([],a||[0,0,0,1],c||[0,0,0],d||[1,1,1]),m!==void 0){w.meshes=r[m];const S=w.anchor=[0,0];for(const A of w.meshes){const{min:R,max:D}=A.aabb;S[0]+=R[0]+D[0],S[1]+=R[1]+D[1]}S[0]=Math.floor(S[0]/w.meshes.length/2),S[1]=Math.floor(S[1]/w.meshes.length/2)}if(y&&(y.id&&(w.id=y.id),y.lights&&(w.lights=function(S){if(!S.length)return[];const A=function(G){const Y=atob(G),te=new Uint8Array(Y.length);for(let ee=0;ee<Y.length;ee++)te[ee]=Y.codePointAt(ee);return te}(S),R=[],D=A.length/24,k=new Uint16Array(A.buffer),U=new Float32Array(A.buffer);for(let G=0;G<D;G++){const Y=k[2*G*6]/30,te=k[2*G*6+1]/30,ee=k[2*G*6+10]/100,ue=U[6*G+1],le=U[6*G+2],pe=U[6*G+3],be=U[6*G+4],Ie=pe-ue,ze=be-le,Pe=Math.hypot(Ie,ze);R.push({pos:[ue+.5*Ie,le+.5*ze,te],normal:[ze/Pe,-Ie/Pe,0],width:Pe,height:Y,depth:ee,points:[ue,le,pe,be]})}return R}(y.lights))),v){const S=[];for(const A of v)S.push(c1(e.json.nodes[A],e,r));w.children=S}return w}function oC(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,r]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let d=1;d<t.vertices.length;++d){const m=t.vertices[d];e.x=Math.min(e.x,m.x),e.y=Math.min(e.y,m.y),r.x=Math.max(r.x,m.x),r.y=Math.max(r.y,m.y)}const n=Math.ceil(Math.max(r.x-e.x,r.y-e.y)/256),a=Math.max(8,n),c=new l1(t.vertices,t.indices,a);return{vertices:t.vertices,indices:t.indices,grid:c,min:e,max:r}}function sC(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const n=[];for(const d of r){if(!Array.isArray(d)||d.length!==2)continue;const m=d[0],y=d[1];typeof m=="number"&&typeof y=="number"&&n.push(new dt(m,y))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let a=0;for(let d=0;d<n.length;d++){const m=n[d],y=n[(d+1)%n.length],v=n[(d+2)%n.length];a+=(m.x-y.x)*(v.y-y.y)-(v.x-y.x)*(m.y-y.y)}a>0&&n.reverse();const c=im(n.flatMap(d=>[d.x,d.y]),[]);return c.length===0?null:{vertices:n,indices:c}}function aC(t){const e=[],r=[];let n=0;for(const a of t){n=e.length;const c=a.vertexArray.float32,d=a.indexArray.uint16;for(let m=0;m<a.vertexArray.length;m++)e.push(new dt(c[3*m+0],c[3*m+1]));for(let m=0;m<3*a.indexArray.length;m++)r.push(d[m]+n)}if(r.length%3!=0)return null;for(let a=0;a<r.length;a+=3){const c=e[r[a+0]],d=e[r[a+1]],m=e[r[a+2]];(c.x-d.x)*(m.y-d.y)-(m.x-d.x)*(c.y-d.y)>0&&([r[a+1],r[a+2]]=[r[a+2],r[a+1]])}return{vertices:e,indices:r}}function u1(t){const e=function(y,v){const w=[],S=WebGL2RenderingContext;if(y.json.textures)for(const A of y.json.textures){const R={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};A.sampler!==void 0&&Object.assign(R,y.json.samplers[A.sampler]),w.push({image:v[A.source],sampler:R,uploaded:!1})}return w}(t,t.images),r=function(y,v){const w=[];for(const S of y.json.meshes){const A=[];for(const R of S.primitives)A.push(nC(R,y,v));w.push(A)}return w}(t,e),{scenes:n,scene:a,nodes:c}=t.json,d=n?n[a||0].nodes:c,m=[];for(const y of d)m.push(c1(c[y],t,r));return function(y,v,w){const S={},A=new Set;for(let R=0;R<y.length;R++){const D=w[v[R]];if(!D.extras)continue;const k=D.extras["mapbox:footprint:version"],U=D.extras["mapbox:footprint:id"];(k||U)&&A.add(R),k==="1.0.0"&&U&&(S[U]=R)}for(let R=0;R<y.length;R++){if(A.has(R))continue;const D=y[R],k=w[v[R]];if(!k.extras)continue;let U=null;D.id in S&&(U=aC(y[S[D.id]].meshes)),U||(U=sC(k)),U&&(D.footprint=oC(U))}if(A.size>0){const R=Array.from(A.values()).sort((D,k)=>D-k);for(let D=R.length-1;D>=0;D--)y.splice(R[D],1)}}(m,d,t.json.nodes),m}function lC(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,n=t.aabb.min[1]-1,a=Pu/(t.aabb.max[0]-r+2),c=Pu/(t.aabb.max[1]-n+2);for(let d=0;d<e.length;d+=3){const m=e[d+2],y=(e[d+0]-r)*a|0,v=(e[d+1]-n)*c|0;m>t.heightmap[v*Pu+y]&&(t.heightmap[v*Pu+y]=m)}}function cC(t,e){const r={};r.indexArray=new Hn,r.indexArray.reserve(4*t.length),r.vertexArray=new Pl,r.vertexArray.reserve(10*t.length),r.colorArray=new Wa,r.vertexArray.reserve(10*t.length);let n=0;for(const d of t){const m=Math.min(10,Math.max(4,1.3*d.height))*e,y=[-d.normal[1],d.normal[0],0],v=Math.min(.29,.1*d.width/d.depth),w=d.width-2*d.depth*e*(v+.01),S=s.N.scaleAndAdd([],d.pos,y,w/2),A=s.N.scaleAndAdd([],d.pos,y,-w/2),R=[S[0],S[1],S[2]+d.height],D=[A[0],A[1],A[2]+d.height],k=s.N.scaleAndAdd([],d.normal,y,v);s.N.scale(k,k,m);const U=s.N.scaleAndAdd([],d.normal,y,-v);s.N.scale(U,U,m),s.N.add(k,S,k),s.N.add(U,A,U),S[2]+=.1,A[2]+=.1,r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(U[0],U[1],U[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(S[0],S[1],S[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(U[0],U[1],U[2]);const G=w/m/2;r.colorArray.emplaceBack(-G-v,-1,G,.8),r.colorArray.emplaceBack(G+v,-1,G,.8),r.colorArray.emplaceBack(-G,0,G,1.3),r.colorArray.emplaceBack(G,0,G,1.3),r.colorArray.emplaceBack(G+v,-.8,G,.7),r.colorArray.emplaceBack(G+v,-.8,G,.7),r.colorArray.emplaceBack(0,0,G,1.3),r.colorArray.emplaceBack(0,0,G,1.3),r.colorArray.emplaceBack(G+v,-1.2,G,.8),r.colorArray.emplaceBack(G+v,-1.2,G,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const a={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=yn.white,a.pbrMetallicRoughness=c,r.material=a,r.aabb=new pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}Gt(l1,"TriangleGridIndex");class h1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const uC=["tile","layer","source","sourceLayer","state"];class d1{constructor(e,r,n,a,c){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=n,this._y=a,this.properties=e.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of uC)this[r]!==void 0&&(e[r]=this[r]);return e}}class f1{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ga(Mt,16,0),this.featureIndexArray=new zp,this.promoteId=r,this.is3DTile=!1}insert(e,r,n,a,c,d=0,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,c,d);const v=this.grid;for(let w=0;w<r.length;w++){const S=r[w],A=[1/0,1/0,-1/0,-1/0];for(let R=0;R<S.length;R++){const D=S[R];A[0]=Math.min(A[0],D.x),A[1]=Math.min(A[1],D.y),A[2]=Math.max(A[2],D.x),A[3]=Math.max(A[3],D.y)}m!==0&&(A[0]-=m,A[1]-=m,A[2]+=m,A[3]+=m),A[0]<Mt&&A[1]<Mt&&A[2]>=0&&A[3]>=0&&v.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Lg(new Ph(this.rawTileData)).layers,this.sourceLayerCoder=new h1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,a){this.loadVTLayers();const c=e.params||{},d=is(c.filter),m=e.tileResult,y=e.transform,v=m.bufferedTilespaceBounds,w=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(D,k,U,G)=>D0(m.bufferedTilespaceGeometry,D,k,U,G));w.sort(hC);let S=null;y.elevation&&w.length>0&&(S=Sh.create(y.elevation,this.tileID));const A={};let R;for(let D=0;D<w.length;D++){const k=w[D];if(k===R)continue;R=k;const U=this.featureIndexArray.get(k);let G=null;if(this.is3DTile){const Y=this.bucketLayerIDs[0][0],te=r[Y];if(te.type!=="model")continue;const{queryFeature:ee,intersectionZ:ue}=te.queryIntersectsMatchingFeature(m,U.featureIndex,d,y);ee&&this.appendToResult(A,Y,U.featureIndex,ee,ue)}else this.loadMatchingFeature(A,U,d,c.layers,c.availableImages,r,n,a,(Y,te,ee,ue=0)=>(G||(G=Xn(Y,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(m,Y,ee,G,this.z,e.transform,e.pixelPosMatrix,S,ue)))}return A}loadMatchingFeature(e,r,n,a,c,d,m,y,v){const{featureIndex:w,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:R}=r,D=this.bucketLayerIDs[S];if(a&&!function(Y,te){for(let ee=0;ee<Y.length;ee++)if(te.indexOf(Y[ee])>=0)return!0;return!1}(a,D))return;const k=this.sourceLayerCoder.decode(A),U=this.vtLayers[k].feature(w);if(n.needGeometry){const Y=Un(U,!0);if(!n.filter(new sn(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!n.filter(new sn(this.tileID.overscaledZ),U))return;const G=this.getId(U,k);for(let Y=0;Y<D.length;Y++){const te=D[Y];if(a&&a.indexOf(te)<0)continue;const ee=d[te];if(!ee)continue;let ue={};G!==void 0&&y&&(ue=y.getState(ee.sourceLayer||"_geojsonTileLayer",G));const le=!v||v(U,ee,ue,R);if(!le)continue;const pe=new d1(U,this.z,this.x,this.y,G),be=_r({},m[te]);be.paint=p1(be.paint,ee.paint,U,ue,c),be.layout=p1(be.layout,ee.layout,U,ue,c),pe.layer=be,this.appendToResult(e,te,w,pe,le)}}appendToResult(e,r,n,a,c){let d=e[r];d===void 0&&(d=e[r]=[]),d.push({featureIndex:n,feature:a,intersectionZ:c})}lookupSymbolFeatures(e,r,n,a,c,d,m,y){const v={};this.loadVTLayers();const w=is(c);for(const S of e)this.loadMatchingFeature(v,{bucketIndex:n,sourceLayerIndex:a,featureIndex:S,layoutVertexArrayOffset:0},w,d,m,y,r);return v}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),c=this.vtFeatures[a];if(c[r])return c[r];const d=this.vtLayers[a].feature(r);return c[r]=d,d}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];a!=null&&(n=e.properties[a]),typeof n=="boolean"&&(n=Number(n))}return n}}function p1(t,e,r,n,a){return St(t,(c,d)=>{const m=e instanceof su?e.get(d):null;return m&&m.evaluate?m.evaluate(r,n,a):m})}function hC(t,e){return e-t}Gt(f1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const oy=new Float32Array(262144),Ru=new Uint8Array(262144);function m1(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,m1(r));return e}function _1(t,e,r){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&r.insert(e,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const n of t.children)_1(n,e,r)}const g1=["","wall","door","roof","window","lamp","logo"];class y1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:m1(e)}}}getLocalBounds(){if(!this.node.meshes)return new pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&r.encapsulate(n.aabb),e++;this.aabb=r}return this.aabb}}class Fm{constructor(e,r,n,a,c,d){this.id=r,this.modelTraits|=zh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=zh.HasMapboxMeshFeatures),a&&(this.modelTraits|=zh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=c,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const m of e)this.nodesInfo.push(new y1(m)),_1(m,d.featureIndexArray.length,d.grid),d.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,d.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const n of r){const a=n.node;this.uploaded?this.updatePbrBuffer(a):Jg(a,e,!0)}for(const n of r)Rm(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),r=!0);return r}needsReEvaluation(e,r,n){const a=e.transform.projectionOptions,c=e.style.getBrightness(),d=this.brightness!==c;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||Tf(n.paint.get("model-color").value,d)||Tf(n.paint.get("model-color-mix-intensity").value,d)||Tf(n.paint.get("model-roughness").value,d)||Tf(n.paint.get("model-emissive-strength").value,d)||Tf(n.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=a,this.brightness=c,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),a=this.id.canonical;for(const c of n){const d=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(d,{},a)}}evaluate(e){const r=this.getNodesInfo();for(const n of r){if(!n.node.meshes)continue;const a=n.feature,c=n.node.meshes&&n.node.meshes[0].featureData,d=n.evaluatedColor[2],m=n.evaluatedRMEA[2],y=this.id.canonical;if(n.hasTranslucentParts=!1,c){for(let v=0;v<g1.length;v++){const w=g1[v];w.length&&(a.properties.part=w);const S=e.paint.get("model-color").evaluate(a,{},y),A=e.paint.get("model-color-mix-intensity").evaluate(a,{},y);n.evaluatedColor[v]=[S.r,S.g,S.b,A],n.evaluatedRMEA[v][0]=e.paint.get("model-roughness").evaluate(a,{},y),n.evaluatedRMEA[v][2]=e.paint.get("model-emissive-strength").evaluate(a,{},y),n.evaluatedRMEA[v][3]=S.a,n.emissionHeightBasedParams[v]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},y),!n.hasTranslucentParts&&S.a<1&&(n.hasTranslucentParts=!0)}delete a.properties.part,fC(n,d!==n.evaluatedColor[2]||m!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,{},y);n.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},y),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,n,a){const c=e.findDEMTileFor(n);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const d=Sh.create(e,n,c);if(!d)return;this.modelTraits&zh.HasMapboxMeshFeatures&&this.updateDEM(e,d,n,a);for(const m of this.getNodesInfo()){const y=m.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const v=y.footprint.vertices;let w=d.getElevationAt(v[0].x,v[0].y,!0,!0);for(let S=1;S<v.length;S++)w=Math.min(w,d.getElevationAt(v[S].x,v[S].y,!0,!0));y.elevation=w}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,n,a){let c=r._dem._modifiedForSources[a];if(c===void 0&&(r._dem._modifiedForSources[a]=[],c=r._dem._modifiedForSources[a]),c.includes(n.canonical))return;const d=r._dem.dim;c.push(n.canonical);let m=!1;for(const y of this.getNodesInfo()){const v=y.node;if(!v.footprint||!v.footprint.grid)continue;const w=v.footprint.grid,S=r.tileCoordToPixel(w.min.x,w.min.y),A=r.tileCoordToPixel(w.max.x,w.max.y),R=Math.min(Math.min(d-A.y,S.x),Math.min(S.y,d-A.x));if(R<0)continue;const D=Zt(R,2,5);let k=Math.max(0,S.x-D),U=Math.max(0,S.y-D),G=Math.min(A.x+D,d-1),Y=Math.min(A.y+D,d-1);for(let le=U;le<=Y;++le)for(let pe=k;pe<=G;++pe)Ru[le*d+pe]=255;let te=0,ee=0;for(let le=0;le<w.cellsY;++le)for(let pe=0;pe<w.cellsX;++pe){if(!w.cells[le*w.cellsX+pe])continue;const be=r.tileCoordToPixel(w.min.x+pe/w.xScale,w.min.y+le/w.yScale),Ie=r.tileCoordToPixel(w.min.x+(pe+1)/w.xScale,w.min.y+(le+1)/w.yScale);for(let ze=be.y;ze<=Math.min(Ie.y+1,d-1);++ze)for(let Pe=be.x;Pe<=Math.min(Ie.x+1,d-1);++Pe)Ru[ze*d+Pe]===255&&(Ru[ze*d+Pe]=0,te+=r.getElevationAtPixel(Pe,ze),ee++)}const ue=te/ee;k=Math.max(1,S.x-D),U=Math.max(1,S.y-D),G=Math.min(A.x+D,d-2),Y=Math.min(A.y+D,d-2),m=!0;for(let le=U;le<=Y;++le)for(let pe=k;pe<=G;++pe)Ru[le*d+pe]===0&&(oy[le*d+pe]=r._dem.set(pe,le,ue));for(let le=1;le<D;++le){k=Math.max(1,S.x-le),U=Math.max(1,S.y-le),G=Math.min(A.x+le,d-2),Y=Math.min(A.y+le,d-2);for(let pe=U;pe<=Y;++pe)for(let be=k;be<=G;++be){const Ie=pe*d+be;if(Ru[Ie]===255){let ze=0,Pe=0,qe=-1,Qe=-1;for(let Ve=-1;Ve<=1;++Ve)for(let Je=-1;Je<=1;++Je){const Ne=(pe+Ve)*d+be+Je;if(Ru[Ne]>=le)continue;const Ke=oy[Ne],Et=Math.abs(Ke);Et>Pe&&(ze=Ke,Pe=Et,qe=Je,Qe=Ve)}if(Pe>.1){const Ve=1-(le+.5*Math.abs(qe*Qe))/D;let Je=r._dem.get(be,pe)+ze*Ve;const Ne=r._dem.get(be+qe,pe+Qe),Ke=r._dem.get(be-qe,pe-Qe,!0);(Je-Ne)*(Je-Ke)>0&&(Je=(Ne+Ke)/2),oy[Ie]=r._dem.set(be,pe,Je),Ru[Ie]=le}}}}}m&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=nt.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)Rm(r.node),Qg(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const n=r.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const d=a[c].node;a[c].hiddenByReplacement=!!d.footprint&&!n.find(m=>m.footprint===d.footprint)}}getHeightAtTileCoord(e,r){const n=this.getNodesInfo(),a=[];for(let c=0;c<this.nodesInfo.length;c++){const d=n[c],m=d.node.meshes[0];if(e<m.aabb.min[0]||r<m.aabb.min[1]||e>m.aabb.max[0]||r>m.aabb.max[1])continue;const y=(e-m.aabb.min[0])/(m.aabb.max[0]-m.aabb.min[0])*Pu|0,v=Math.min(63,(r-m.aabb.min[1])/(m.aabb.max[1]-m.aabb.min[1])*Pu|0)*Pu+Math.min(63,y);if(!(m.heightmap[v]<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:m.heightmap[v],maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new dt(e,r),new dt(e,r),a),a.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function Tf(t,e){return!t.isLightConstant&&e}function dC(t,e,r,n,a,c,d,m){let y=(61440&e|(61440&e)>>4)>>8,v=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;r[3]>0&&(y=Zr(y,255*r[0],r[3]),v=Zr(v,255*r[1],r[3]),w=Zr(w,255*r[2],r[3]));const S=y<<8|v,A=w<<8|Math.floor(255*n[3]),R=function(le){const pe=Zt(le,0,2);return Math.min(Math.round(.5*pe*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],D=Zt(a[0],0,1),k=Zt(a[1],0,1),U=Zt(a[2],0,1),G=Zt(a[3],0,1);let Y,te,ee,ue;if(D!==k&&d!==c&&k!==D){const le=d-c;te=1/(le*(k-D)),ee=-(c+le*D)/(le*(k-D));const pe=Zt(a[4],-1,1);ue=Math.pow(10,pe),Y=255*U<<8|255*G}else Y=65535,te=0,ee=1,ue=1;if(t.emplaceBack(S,A,R,Y,te,ee,ue),m){const le=m.length;m.clear();for(let pe=0;pe<le;pe++)m.emplaceBack(S,A,R,Y,te,ee,ue)}}function fC(t,e,r){const n=t.node;let a=0;const c=r&zh.HasMeshoptCompression;for(const d of n.meshes){if(n.lights&&n.lightMeshIndex===a||!d.featureData)continue;d.featureArray=new vu,d.featureArray.reserve(d.featureData.length);let m=e;for(const y of d.featureData){const v=c?65535&y:y>>16&65535,w=c?y>>16&65535:65535&y,S=(15&w)<8?15&w:0,A=t.evaluatedRMEA[S],R=t.evaluatedColor[S],D=t.emissionHeightBasedParams[S];let k;if(m&&S===2&&n.lights&&(k=new vu,k.resize(10*n.lights.length)),dC(d.featureArray,v,R,A,D,d.aabb.min[2],d.aabb.max[2],k),k&&m){m=!1;const U=n.meshes[n.lightMeshIndex];U.featureArray=k,U.featureArray._trim()}}d.featureArray._trim(),a++}}function v1(t,e,r,n){const a=1<<t.z;e.lat=ri((n/Mt+t.y)/a),e.lng=Lr((r/Mt+t.x)/a)}Gt(Fm,"Tiled3dModelBucket",{omit:["layers"]}),Gt(y1,"Tiled3dModelFeature");const pC={circle:class extends $o{constructor(t,e,r){super(t,sM,e,r)}createBucket(t){return new Ho(t)}queryRadius(t){const e=t;return wh("circle-radius",this,e)+wh("circle-stroke-width",this,e)+$p(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,a,c,d,m){const y=k0(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return cx(t,n,c,d,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,v)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const r=lx(this);return{config:new N(this,e),defines:r,overrideFog:!1}}},heatmap:class extends $o{createBucket(t){return new hx(t)}constructor(t,e,r){super(t,FM,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return wh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,a,c,d,m){const y=this.paint.get("heatmap-radius").evaluate(e,r);return cx(t,n,c,d,m,!0,!0,new dt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new N(this,e),overrideFog:!1}:{}}},hillshade:class extends $o{constructor(t,e,r){super(t,NM,e,r)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends $o{constructor(t,e,r){super(t,QM,e,r)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e){return{config:new N(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Pg(t)}queryRadius(){return $p(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,a,c){return!t.queryGeometry.isAboveHorizon&&Ll(z0(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends $o{constructor(t,e,r){super(t,AA,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new um(t)}queryRadius(){return $p(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,n,a,c,d,m,y){const v=k0(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,r),S=this.paint.get("fill-extrusion-base").evaluate(e,r),A=[0,0],R=m&&c.elevation,D=c.elevation?c.elevation.exaggeration():1,k=t.tile.getBucket(this);if(R&&k instanceof um){const ee=k.centroidVertexArray,ue=y+1;ue<ee.length&&(A[0]=ee.geta_centroid_pos0(ue),A[1]=ee.geta_centroid_pos1(ue))}if(A[0]===0&&A[1]===1)return!1;c.projection.name==="globe"&&(n=Zx([n],[new dt(0,0),new dt(Mt,Mt)],t.tileID.canonical).map(ee=>ee.polygon).flat());const U=R?m:null,[G,Y]=function(ee,ue,le,pe,be,Ie,ze,Pe,qe,Qe,Ve){return ee.projection.name==="globe"?function(Je,Ne,Ke,Et,tt,Xt,Bt,st,xr,or,Wt){const at=[],mr=[],jr=Je.projection.upVectorScale(Wt,Je.center.lat,Je.worldSize).metersToTile,wr=[0,0,0,1],Vr=[0,0,0,1],Pr=(Dr,Oi,ci,hi)=>{Dr[0]=Oi,Dr[1]=ci,Dr[2]=hi,Dr[3]=1},ei=qx();Ke>0&&(Ke+=ei),Et+=ei;for(const Dr of Ne){const Oi=[],ci=[];for(const hi of Dr){const _i=hi.x+tt.x,ui=hi.y+tt.y,tn=Je.projection.projectTilePoint(_i,ui,Wt),Mi=Je.projection.upVector(Wt,hi.x,hi.y);let xn=Ke,Gn=Et;if(Bt){const fo=Wx(_i,ui,Ke,Et,Bt,st,xr,or);xn+=fo.base,Gn+=fo.top}Ke!==0?Pr(wr,tn.x+Mi[0]*jr*xn,tn.y+Mi[1]*jr*xn,tn.z+Mi[2]*jr*xn):Pr(wr,tn.x,tn.y,tn.z),Pr(Vr,tn.x+Mi[0]*jr*Gn,tn.y+Mi[1]*jr*Gn,tn.z+Mi[2]*jr*Gn),s.N.transformMat4(wr,wr,Xt),s.N.transformMat4(Vr,Vr,Xt),Oi.push(new Mh(wr[0],wr[1],wr[2])),ci.push(new Mh(Vr[0],Vr[1],Vr[2]))}at.push(Oi),mr.push(ci)}return[at,mr]}(ee,ue,le,pe,be,Ie,ze,Pe,qe,Qe,Ve):ze?function(Je,Ne,Ke,Et,tt,Xt,Bt,st,xr){const or=[],Wt=[],at=[0,0,0,1];for(const mr of Je){const jr=[],wr=[];for(const Vr of mr){const Pr=Vr.x+Et.x,ei=Vr.y+Et.y,Dr=Wx(Pr,ei,Ne,Ke,Xt,Bt,st,xr);at[0]=Pr,at[1]=ei,at[2]=Dr.base,at[3]=1,s.a7.transformMat4(at,at,tt),at[3]=Math.max(at[3],1e-5);const Oi=new Mh(at[0]/at[3],at[1]/at[3],at[2]/at[3]);at[0]=Pr,at[1]=ei,at[2]=Dr.top,at[3]=1,s.a7.transformMat4(at,at,tt),at[3]=Math.max(at[3],1e-5);const ci=new Mh(at[0]/at[3],at[1]/at[3],at[2]/at[3]);jr.push(Oi),wr.push(ci)}or.push(jr),Wt.push(wr)}return[or,Wt]}(ue,le,pe,be,Ie,ze,Pe,qe,Qe):function(Je,Ne,Ke,Et,tt){const Xt=[],Bt=[],st=tt[8]*Ne,xr=tt[9]*Ne,or=tt[10]*Ne,Wt=tt[11]*Ne,at=tt[8]*Ke,mr=tt[9]*Ke,jr=tt[10]*Ke,wr=tt[11]*Ke;for(const Vr of Je){const Pr=[],ei=[];for(const Dr of Vr){const Oi=Dr.x+Et.x,ci=Dr.y+Et.y,hi=tt[0]*Oi+tt[4]*ci+tt[12],_i=tt[1]*Oi+tt[5]*ci+tt[13],ui=tt[2]*Oi+tt[6]*ci+tt[14],tn=tt[3]*Oi+tt[7]*ci+tt[15],Mi=hi+st,xn=_i+xr,Gn=ui+or,fo=Math.max(tn+Wt,1e-5),Yi=hi+at,un=_i+mr,io=ui+jr,no=Math.max(tn+wr,1e-5);Pr.push(new Mh(Mi/fo,xn/fo,Gn/fo)),ei.push(new Mh(Yi/no,un/no,io/no))}Xt.push(Pr),Bt.push(ei)}return[Xt,Bt]}(ue,le,pe,be,Ie)}(c,n,S,w,v,d,U,A,D,c.center.lat,t.tileID.canonical),te=t.queryGeometry;return function(ee,ue,le){let pe=1/0;Ll(le,ue)&&(pe=Hx(le,ue[0]));for(let be=0;be<ue.length;be++){const Ie=ue[be],ze=ee[be];for(let Pe=0;Pe<Ie.length-1;Pe++){const qe=Ie[Pe],Qe=[qe,Ie[Pe+1],ze[Pe+1],ze[Pe],qe];ia(le,Qe)&&(pe=Math.min(pe,Hx(le,Qe)))}}return pe!==1/0&&pe}(G,Y,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends $o{constructor(t,e,r){super(t,Yx,e,r),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Os,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=rb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Og(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const r=eb(this);return{config:new N(this,e),defines:r,overrideFog:!1}}queryRadius(t){const e=t,r=ib(wh("line-width",this,e),wh("line-gap-width",this,e)),n=wh("line-offset",this,e);return r/2+Math.abs(n)+$p(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,a,c){if(t.queryGeometry.isAboveHorizon)return!1;const d=z0(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),m=t.pixelToTileUnitsFactor/2*ib(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),y=this.paint.get("line-offset").evaluate(e,r);return y&&(n=function(v,w){const S=[],A=new dt(0,0);for(let R=0;R<v.length;R++){const D=v[R],k=[];for(let U=0;U<D.length;U++){const G=D[U],Y=D[U+1],te=U===0?A:G.sub(D[U-1])._unit()._perp(),ee=U===D.length-1?A:Y.sub(G)._unit()._perp(),ue=te._add(ee)._unit();ue._mult(1/(ue.x*ee.x+ue.y*ee.y)),k.push(ue._mult(w)._add(G))}S.push(k)}return S}(n,y*t.pixelToTileUnitsFactor)),function(v,w,S){for(let A=0;A<w.length;A++){const R=w[A];if(v.length>=3){for(let D=0;D<R.length;D++)if(ba(v,R[D]))return!0}if(Eu(v,R,S))return!0}return!1}(d,n,m)}isTileClipped(){return!0}},symbol:Mm,background:class extends $o{constructor(t,e,r){super(t,PI,e,r)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:Vb,"raster-particle":Gb,sky:class extends $o{constructor(t,e,r){super(t,BI,e,r),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=tf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,c=t.style.light,d=c.properties.get("position");return a&&c.properties.get("anchor")==="viewport"&&ve("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Xg(d.azimuthal,90-d.polar,e):Xg(n[0],90-n[1],e)}const r=this.paint.get("sky-gradient-center");return Xg(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends $o{constructor(t,e,r){super(t,NI,e)}},model:class extends $o{constructor(t,e,r){super(t,WI,e,r),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Kg(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Fm?Mt-1:0}queryIntersectsFeature(t,e,r,n,a,c){if(!this.modelManager)return!1;const d=this.modelManager,m=t.tile.getBucket(this);if(!(m&&m instanceof Kg))return!1;const y=m;for(const v in y.instancesPerModel){const w=y.instancesPerModel[v];if(w.idToFeaturesIndex.hasOwnProperty(e.id)){const S=w.features[w.idToFeaturesIndex[e.id]],A=d.getModel(v,this.scope);if(!A)return!1;let R=s.a6.create();const D=new Ae(0,0),k=y.canonical;let U=Number.MAX_VALUE;for(let G=0;G<S.instancedDataCount;++G){const Y=16*(S.instancedDataOffset+G),te=w.instancedDataArray.float32,ee=[te[Y+4],te[Y+5],te[Y+6]];v1(k,D,te[Y],0|te[Y+1]),Jb(R,A,c,D,S.rotation,S.scale,ee,!1,!1,!1),c.projection.name==="globe"&&(R=Yg(R,c));const ue=s.a6.multiply([],c.projMatrix,R),le=t.queryGeometry,pe=Xb(le.isPointQuery()?le.screenBounds:le.screenGeometry,c,ue,A.aabb);pe!=null&&(U=Math.min(pe,U))}return U!==Number.MAX_VALUE&&U}}return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ru}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,r,n){const a=t.tile,c=a.getBucket(this);let d=null,m=Number.MAX_VALUE;if(!(c&&c instanceof Fm))return{queryFeature:d,intersectionZ:m};const y=c.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!r.filter(new sn(a.tileID.overscaledZ),y.feature,a.tileID.canonical))return{queryFeature:d,intersectionZ:m};const v=y.node,w=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),S=y.evaluatedScale;let A=0;n.elevation&&v.elevation&&(A=v.elevation*n.elevation.exaggeration()),s.a6.translate(w,w,[(v.anchor?v.anchor[0]:0)*(S[0]-1),(v.anchor?v.anchor[1]:0)*(S[1]-1),A]),s.a6.scale(w,w,S),s.a6.multiply(w,w,v.matrix);const R=t.queryGeometry,D=R.isPointQuery()?R.screenBounds:R.screenGeometry,k=function(G){const Y=s.a6.multiply([],w,G.matrix),te=s.a6.multiply(Y,n.expandedFarZProjMatrix,Y);for(let ee=0;ee<G.meshes.length;++ee){const ue=G.meshes[ee];if(ee===G.lightMeshIndex)continue;const le=Xb(D,n,te,ue.aabb);le!=null&&(m=Math.min(le,m))}if(G.children)for(const ee of G.children)k(ee)};if(k(v),m===Number.MAX_VALUE)return{queryFeature:d,intersectionZ:m};const U=new Ae(0,0);return v1(a.tileID.canonical,U,y.node.anchor[0],y.node.anchor[1]),d={type:"Feature",geometry:{type:"Point",coordinates:[U.lng,U.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:d,intersectionZ:m}}}},Fr={read:function(t,e){return t.readFields(Fr._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,r){t===1?e.header_length=r.readFixed32():t===2?e.x=r.readVarint():t===3?e.y=r.readVarint():t===4?e.z=r.readVarint():t===5&&e.layers.push(Fr.Layer.read(r,r.readVarint()+r.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Fr.Filter.read=function(t,e){return t.readFields(Fr.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Fr.Filter._readField=function(t,e,r){t===1?(e.delta_filter=Fr.Filter.Delta.read(r,r.readVarint()+r.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Fr.Filter.Zigzag.read(r,r.readVarint()+r.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Fr.Filter.BitShuffle.read(r,r.readVarint()+r.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Fr.Filter.ByteShuffle.read(r,r.readVarint()+r.pos),e.filter="byteshuffle_filter")},Fr.Filter.Delta={},Fr.Filter.Delta.read=function(t,e){return t.readFields(Fr.Filter.Delta._readField,{block_size:0},e)},Fr.Filter.Delta._readField=function(t,e,r){t===1&&(e.block_size=r.readVarint())},Fr.Filter.Zigzag={},Fr.Filter.Zigzag.read=function(t,e){return t.readFields(Fr.Filter.Zigzag._readField,{},e)},Fr.Filter.Zigzag._readField=function(t,e,r){},Fr.Filter.BitShuffle={},Fr.Filter.BitShuffle.read=function(t,e){return t.readFields(Fr.Filter.BitShuffle._readField,{},e)},Fr.Filter.BitShuffle._readField=function(t,e,r){},Fr.Filter.ByteShuffle={},Fr.Filter.ByteShuffle.read=function(t,e){return t.readFields(Fr.Filter.ByteShuffle._readField,{},e)},Fr.Filter.ByteShuffle._readField=function(t,e,r){},Fr.Codec={},Fr.Codec.read=function(t,e){return t.readFields(Fr.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Fr.Codec._readField=function(t,e,r){t===1?(e.gzip_data=Fr.Codec.GzipData.read(r,r.readVarint()+r.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Fr.Codec.JpegImage.read(r,r.readVarint()+r.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Fr.Codec.WebpImage.read(r,r.readVarint()+r.pos),e.codec="webp_image"):t===4&&(e.png_image=Fr.Codec.PngImage.read(r,r.readVarint()+r.pos),e.codec="png_image")},Fr.Codec.GzipData={},Fr.Codec.GzipData.read=function(t,e){return t.readFields(Fr.Codec.GzipData._readField,{},e)},Fr.Codec.GzipData._readField=function(t,e,r){},Fr.Codec.JpegImage={},Fr.Codec.JpegImage.read=function(t,e){return t.readFields(Fr.Codec.JpegImage._readField,{},e)},Fr.Codec.JpegImage._readField=function(t,e,r){},Fr.Codec.WebpImage={},Fr.Codec.WebpImage.read=function(t,e){return t.readFields(Fr.Codec.WebpImage._readField,{},e)},Fr.Codec.WebpImage._readField=function(t,e,r){},Fr.Codec.PngImage={},Fr.Codec.PngImage.read=function(t,e){return t.readFields(Fr.Codec.PngImage._readField,{},e)},Fr.Codec.PngImage._readField=function(t,e,r){},Fr.DataIndexEntry={},Fr.DataIndexEntry.read=function(t,e){return t.readFields(Fr.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Fr.DataIndexEntry._readField=function(t,e,r){t===1?e.first_byte=r.readFixed64():t===2?e.last_byte=r.readFixed64():t===3?e.filters.push(Fr.Filter.read(r,r.readVarint()+r.pos)):t===4?e.codec=Fr.Codec.read(r,r.readVarint()+r.pos):t===5?e.offset=r.readFloat():t===6?e.scale=r.readFloat():t===7&&e.bands.push(r.readString())},Fr.Layer={},Fr.Layer.read=function(t,e){return t.readFields(Fr.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Fr.Layer._readField=function(t,e,r){t===1?e.version=r.readVarint():t===2?e.name=r.readString():t===3?e.units=r.readString():t===4?e.tilesize=r.readVarint():t===5?e.buffer=r.readVarint():t===6?e.pixel_format=r.readVarint():t===7&&e.data_index.push(Fr.DataIndexEntry.read(r,r.readVarint()+r.pos))};const Aa={read:function(t,e){return t.readFields(Aa._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,r){t===2?(e.uint32_values=Aa.Uint32Values.read(r,r.readVarint()+r.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Aa.Fixed32Values.read(r,r.readVarint()+r.pos),e.values="fixed32_values")},Uint32Values:{}};Aa.Uint32Values.read=function(t,e){return t.readFields(Aa.Uint32Values._readField,{values:[]},e)},Aa.Uint32Values._readField=function(t,e,r){t===1&&(e.readValuesInto=function(n){if(n.type!==2)throw new Error(`Unsupported pbf type "${n.type}"`);const a=function(d){return d.type===2?d.readVarint()+d.pos:d.pos+1}(n),c=n.pos;return n.pos=a,function(d){n.pos=c;let m=0;for(;n.pos<a;){const y=n.readVarint();d[m++]=y}return d}}(r))},Aa.Fixed32Values={},Aa.Fixed32Values.read=function(t,e){return t.readFields(Aa.Fixed32Values._readField,{values:[]},e)},Aa.Fixed32Values._readField=function(t,e,r){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */class mC{constructor(e=0,r=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=n,this.size=0,this.ttl=r}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const r=this.items[e];delete this.items[e],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}return this}entries(e=this.keys()){return e.map(r=>[r,this.get(r)])}evict(e=!1){if(e||this.size>0){const r=this.first;delete this.items[r.key],--this.size==0?(this.first=null,this.last=null):(this.first=r.next,this.first.prev=null)}return this}expiresAt(e){let r;return this.has(e)&&(r=this.items[e].expiry),r}get(e){let r;if(this.has(e)){const n=this.items[e];this.ttl>0&&n.expiry<=Date.now()?this.delete(e):(r=n.value,this.set(e,r,!0))}return r}has(e){return e in this.items}keys(){const e=[];let r=this.first;for(;r!==null;)e.push(r.key),r=r.next;return e}set(e,r,n=!1,a=this.resetTtl){let c;if(n||this.has(e)){if(c=this.items[e],c.value=r,n===!1&&a&&(c.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==c){const d=this.last,m=c.next,y=c.prev;this.first===c&&(this.first=c.next),c.next=null,c.prev=this.last,d.next=c,y!==null&&(y.next=m),m!==null&&(m.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),c=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:r},++this.size==1?this.first=c:this.last.next=c;return this.last=c,this}values(e=this.keys()){return e.map(r=>this.get(r))}}function _C(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let n=2;n>=1;n--){const a=n===1?1:0,c=n===2?1:0;for(let d=0;d<e[0];d++){const m=e[1]*d;for(let y=a;y<e[1];y++){const v=e[2]*(y+m);for(let w=c;w<e[2];w++){const S=e[3]*(w+v);for(let A=0;A<e[3];A++){const R=S+A;t[R]+=t[R-r]}}}}r*=e[n]}return t}function gC(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function yC(t,e){switch(e){case"uint32":return t;case"uint16":for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];t[r]=(240&n)>>4|(61440&n)>>8|(240&a)<<4|61440&a,t[r+1]=15&n|(3840&n)>>4|(15&a)<<8|(3840&a)<<4}return t;case"uint8":for(let r=0;r<t.length;r+=4){const n=t[r],a=t[r+1],c=t[r+2],d=t[r+3];t[r+0]=(192&n)>>6|(192&a)>>4|(192&c)>>2|192&d,t[r+1]=(48&n)>>4|(48&a)>>2|48&c|(48&d)<<2,t[r+2]=(12&n)>>2|12&a|(12&c)<<2|(12&d)<<4,t[r+3]=3&n|(3&a)<<2|(3&c)<<4|(3&d)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Ec extends Error{constructor(e){super(e),this.name="MRTError"}}var $s=Uint8Array,Ef=Uint16Array,vC=Int32Array,x1=new $s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),b1=new $s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),xC=new $s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),w1=function(t,e){for(var r=new Ef(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];var a=new vC(r[30]);for(n=1;n<30;++n)for(var c=r[n];c<r[n+1];++c)a[c]=c-r[n]<<5|n;return{b:r,r:a}},T1=w1(x1,2),E1=T1.b,bC=T1.r;E1[28]=258,bC[258]=28;for(var wC=w1(b1,0).b,S1=new Ef(32768),On=0;On<32768;++On){var Nh=(43690&On)>>1|(21845&On)<<1;S1[On]=((65280&(Nh=(61680&(Nh=(52428&Nh)>>2|(13107&Nh)<<2))>>4|(3855&Nh)<<4))>>8|(255&Nh)<<8)>>1}var Sf=function(t,e,r){for(var n=t.length,a=0,c=new Ef(e);a<n;++a)t[a]&&++c[t[a]-1];var d,m=new Ef(e);for(a=1;a<e;++a)m[a]=m[a-1]+c[a-1]<<1;{d=new Ef(1<<e);var y=15-e;for(a=0;a<n;++a)if(t[a])for(var v=a<<4|t[a],w=e-t[a],S=m[t[a]-1]++<<w,A=S|(1<<w)-1;S<=A;++S)d[S1[S]>>y]=v}return d},Mf=new $s(288);for(On=0;On<144;++On)Mf[On]=8;for(On=144;On<256;++On)Mf[On]=9;for(On=256;On<280;++On)Mf[On]=7;for(On=280;On<288;++On)Mf[On]=8;var M1=new $s(32);for(On=0;On<32;++On)M1[On]=5;var TC=Sf(Mf,9),EC=Sf(M1,5),sy=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Ia=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&r},ay=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},SC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ca=function(t,e,r){var n=new Error(e||SC[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Ca),!r)throw n;return n},MC=new $s(0),AC=typeof TextDecoder<"u"&&new TextDecoder;try{AC.decode(MC,{stream:!0})}catch{}const IC={gzip_data:"gzip"},CC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},PC={uint32:1,uint16:2,uint8:4},LC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class A1{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const r=new Uint8Array(e),n=new DataView(e);if(r[0]!==13)throw new Ec("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),n=this.getHeaderLength(e);if(r.length<n)throw new Ec(`Expected header with length >= ${n} but got buffer of length ${r.length}`);const a=new Ph(r.subarray(0,n)),c=Fr.read(a);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new Ec(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const d of c.layers)this.layers[d.name]=new RC(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],n=this.getLayer(e.layerName);for(let a=0;a<n.dataIndex.length;a++){const c=n.dataIndex[a],d=c.first_byte-e.firstByte,m=c.last_byte+1-e.firstByte;if(a<e.firstBlock||a>e.lastBlock||n._blocksInProgress.has(a))continue;const y={layerName:n.name,firstByte:d,lastByte:m,pixelFormat:n.pixelFormat,blockIndex:a,blockShape:[c.bands.length].concat(n.bandShape),buffer:n.buffer,codec:c.codec.codec,filters:c.filters.map(v=>v.filter)};n._blocksInProgress.add(a),r.push(y)}return new I1(r,()=>{r.forEach(a=>n._blocksInProgress.delete(a.blockIndex))},(a,c)=>{if(r.forEach(d=>n._blocksInProgress.delete(d.blockIndex)),a)throw a;c.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class RC{constructor({version:e,name:r,units:n,tilesize:a,pixel_format:c,buffer:d,data_index:m},y){if(this.version=e,this.version!==1)throw new Ec(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=n,this.tileSize=a,this.buffer=d,this.pixelFormat=CC[c],this.dataIndex=m,this.bandShape=[a+2*d,a+2*d,PC[this.pixelFormat]],this._decodedBlocks=function(v=1e3,w=0,S=!1){if(isNaN(v)||v<0)throw new TypeError("Invalid max value");if(isNaN(w)||w<0)throw new TypeError("Invalid ttl value");if(typeof S!="boolean")throw new TypeError("Invalid resetTtl value");return new mC(v,w,S)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.set(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[n,a]of this.dataIndex.entries()){for(const[c,d]of a.bands.entries())if(d===e)return{bandIndex:r+c,blockIndex:n,blockBandIndex:c};r+=a.bands.length}break;case"number":for(const[n,a]of this.dataIndex.entries()){if(e>=r&&e<r+a.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-r};r+=a.bands.length}break;default:throw new Ec(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Ec(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,n=-1/0,a=1/0,c=-1/0;for(const d of e){const{blockIndex:m}=this.getBlockForBand(d);if(m<0)throw new Ec(`Invalid band: ${JSON.stringify(d)}`);const y=this.dataIndex[m];a=Math.min(a,m),c=Math.max(c,m),r=Math.min(r,y.first_byte),n=Math.max(n,y.last_byte)}return{layerName:this.name,firstByte:r,lastByte:n,firstBlock:a,lastBlock:c}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:n}=this.getBlockForBand(e),a=this._decodedBlocks.get(r.toString());if(!a)throw new Ec(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[r],d=this.bandShape.reduce((v,w)=>v*w,1),m=n*d,y=a.subarray(m,m+d);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:c.offset,scale:c.scale}}}class I1{constructor(e,r,n){this.tasks=e,this._onCancel=r,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}A1.performDecoding=function(t,e){return Promise.all(e.tasks.map(r=>{const{layerName:n,firstByte:a,lastByte:c,pixelFormat:d,blockShape:m,blockIndex:y,filters:v,codec:w}=r,S=new Uint8Array(t).subarray(a,c+1),A=new Uint32Array(m[0]*m[1]*m[2]);let R;if(w!=="gzip_data")throw new Error(`Unhandled codec: ${w}`);return R=function(D,k){if(!globalThis.DecompressionStream&&k==="gzip_data")return Promise.resolve(((te=function(le){le[0]==31&&le[1]==139&&le[2]==8||Ca(6,"invalid gzip data");var pe=le[3],be=10;4&pe&&(be+=2+(le[10]|le[11]<<8));for(var Ie=(pe>>3&1)+(pe>>4&1);Ie>0;Ie-=!le[be++]);return be+(2&pe)}(Y=D))+8>Y.length&&Ca(6,"invalid gzip data"),function(le,pe,be,Ie){var ze=le.length;if(!ze||pe.f&&!pe.l)return be||new $s(0);var Pe=!be,qe=Pe||pe.i!=2,Qe=pe.i;Pe&&(be=new $s(3*ze));var Ve=function(Wo){var gs=be.length;if(Wo>gs){var qs=new $s(Math.max(2*gs,Wo));qs.set(be),be=qs}},Je=pe.f||0,Ne=pe.p||0,Ke=pe.b||0,Et=pe.l,tt=pe.d,Xt=pe.m,Bt=pe.n,st=8*ze;do{if(!Et){Je=Ia(le,Ne,1);var xr=Ia(le,Ne+1,3);if(Ne+=3,!xr){var or=le[(ci=4+((Ne+7)/8|0))-4]|le[ci-3]<<8,Wt=ci+or;if(Wt>ze){Qe&&Ca(0);break}qe&&Ve(Ke+or),be.set(le.subarray(ci,Wt),Ke),pe.b=Ke+=or,pe.p=Ne=8*Wt,pe.f=Je;continue}if(xr==1)Et=TC,tt=EC,Xt=9,Bt=5;else if(xr==2){var at=Ia(le,Ne,31)+257,mr=Ia(le,Ne+10,15)+4,jr=at+Ia(le,Ne+5,31)+1;Ne+=14;for(var wr=new $s(jr),Vr=new $s(19),Pr=0;Pr<mr;++Pr)Vr[xC[Pr]]=Ia(le,Ne+3*Pr,7);Ne+=3*mr;var ei=sy(Vr),Dr=(1<<ei)-1,Oi=Sf(Vr,ei);for(Pr=0;Pr<jr;){var ci,hi=Oi[Ia(le,Ne,Dr)];if(Ne+=15&hi,(ci=hi>>4)<16)wr[Pr++]=ci;else{var _i=0,ui=0;for(ci==16?(ui=3+Ia(le,Ne,3),Ne+=2,_i=wr[Pr-1]):ci==17?(ui=3+Ia(le,Ne,7),Ne+=3):ci==18&&(ui=11+Ia(le,Ne,127),Ne+=7);ui--;)wr[Pr++]=_i}}var tn=wr.subarray(0,at),Mi=wr.subarray(at);Xt=sy(tn),Bt=sy(Mi),Et=Sf(tn,Xt),tt=Sf(Mi,Bt)}else Ca(1);if(Ne>st){Qe&&Ca(0);break}}qe&&Ve(Ke+131072);for(var xn=(1<<Xt)-1,Gn=(1<<Bt)-1,fo=Ne;;fo=Ne){var Yi=(_i=Et[ay(le,Ne)&xn])>>4;if((Ne+=15&_i)>st){Qe&&Ca(0);break}if(_i||Ca(2),Yi<256)be[Ke++]=Yi;else{if(Yi==256){fo=Ne,Et=null;break}var un=Yi-254;Yi>264&&(un=Ia(le,Ne,(1<<(oo=x1[Pr=Yi-257]))-1)+E1[Pr],Ne+=oo);var io=tt[ay(le,Ne)&Gn],no=io>>4;if(io||Ca(3),Ne+=15&io,Mi=wC[no],no>3){var oo=b1[no];Mi+=ay(le,Ne)&(1<<oo)-1,Ne+=oo}if(Ne>st){Qe&&Ca(0);break}qe&&Ve(Ke+131072);var Zi=Ke+un;if(Ke<Mi){var _s=0-Mi,Sc=Math.min(Mi,Zi);for(_s+Ke<0&&Ca(3);Ke<Sc;++Ke)be[Ke]=Ie[_s+Ke]}for(;Ke<Zi;++Ke)be[Ke]=be[Ke-Mi]}}pe.l=Et,pe.p=fo,pe.b=Ke,pe.f=Je,Et&&(Je=1,pe.m=Xt,pe.d=tt,pe.n=Bt)}while(!Je);return Ke!=be.length&&Pe?function(Wo,gs,qs){return(qs==null||qs>Wo.length)&&(qs=Wo.length),new $s(Wo.subarray(gs,qs))}(be,0,Ke):be.subarray(0,Ke)}(Y.subarray(te,-8),{i:2},new $s(((U=Y)[(G=U.length)-4]|U[G-3]<<8|U[G-2]<<16|U[G-1]<<24)>>>0),void 0)));var U,G,Y,te;const ee=IC[k];if(!ee)throw new Error(`Unhandled codec: ${k}`);const ue=new globalThis.DecompressionStream(ee);return new Response(new Blob([D]).stream().pipeThrough(ue)).arrayBuffer().then(le=>new Uint8Array(le))}(S,w).then(D=>{const k=Aa.read(new Ph(D));if(k.values==="uint32_values")return k.uint32_values.readValuesInto(A),new LC[d](A.buffer);throw new Error(`Unhandled numeric data "${k.values}"`)}),R.then(D=>{for(let k=v.length-1;k>=0;k--)switch(v[k]){case"delta_filter":_C(D,m);break;case"zigzag_filter":gC(D);break;case"bitshuffle_filter":yC(D,d);break;default:throw new Error(`Unhandled filter "${v[k]}"`)}return{layerName:n,blockIndex:y,data:D}}).catch(D=>{throw D})}))},Gt(I1,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const C1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ly{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,n]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=n>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const c=C1[15&n];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new ly(m,d,c,e)}constructor(e,r=64,n=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=C1.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-m%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${n}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=r,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return cy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:m}=this,y=[0,c.length-1,0],v=[];for(;y.length;){const w=y.pop()||0,S=y.pop()||0,A=y.pop()||0;if(S-A<=m){for(let U=A;U<=S;U++){const G=d[2*U],Y=d[2*U+1];G>=e&&G<=n&&Y>=r&&Y<=a&&v.push(c[U])}continue}const R=A+S>>1,D=d[2*R],k=d[2*R+1];D>=e&&D<=n&&k>=r&&k<=a&&v.push(c[R]),(w===0?e<=D:r<=k)&&(y.push(A),y.push(R-1),y.push(1-w)),(w===0?n>=D:a>=k)&&(y.push(R+1),y.push(S),y.push(1-w))}return v}within(e,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:c,nodeSize:d}=this,m=[0,a.length-1,0],y=[],v=n*n;for(;m.length;){const w=m.pop()||0,S=m.pop()||0,A=m.pop()||0;if(S-A<=d){for(let U=A;U<=S;U++)L1(c[2*U],c[2*U+1],e,r)<=v&&y.push(a[U]);continue}const R=A+S>>1,D=c[2*R],k=c[2*R+1];L1(D,k,e,r)<=v&&y.push(a[R]),(w===0?e-n<=D:r-n<=k)&&(m.push(A),m.push(R-1),m.push(1-w)),(w===0?e+n>=D:r+n>=k)&&(m.push(R+1),m.push(S),m.push(1-w))}return y}}function cy(t,e,r,n,a,c){if(a-n<=r)return;const d=n+a>>1;P1(t,e,d,n,a,c),cy(t,e,r,n,d-1,1-c),cy(t,e,r,d+1,a,1-c)}function P1(t,e,r,n,a,c){for(;a>n;){if(a-n>600){const v=a-n+1,w=r-n+1,S=Math.log(v),A=.5*Math.exp(2*S/3),R=.5*Math.sqrt(S*A*(v-A)/v)*(w-v/2<0?-1:1);P1(t,e,r,Math.max(n,Math.floor(r-w*A/v+R)),Math.min(a,Math.floor(r+(v-w)*A/v+R)),c)}const d=e[2*r+c];let m=n,y=a;for(Af(t,e,n,r),e[2*a+c]>d&&Af(t,e,n,a);m<y;){for(Af(t,e,m,y),m++,y--;e[2*m+c]<d;)m++;for(;e[2*y+c]>d;)y--}e[2*n+c]===d?Af(t,e,n,y):(y++,Af(t,e,y,a)),y<=r&&(n=y+1),r<=y&&(a=y-1)}}function Af(t,e,r,n){uy(t,r,n),uy(e,2*r,2*n),uy(e,2*r+1,2*n+1)}function uy(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function L1(t,e,r,n){const a=t-r,c=e-n;return a*a+c*c}s.$=Ob,s.A=sh,s.B=vd,s.C=Kr,s.D=Re,s.E=No,s.F=an,s.G=xt,s.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ut(t.expression.evaluate(e))}interpolate(t,e,r){return{x:Zr(t.x,e.x,r),y:Zr(t.y,e.y,r),z:Zr(t.z,e.z,r),azimuthal:Zr(t.azimuthal,e.azimuthal,r),polar:Zr(t.polar,e.polar,r)}}},s.I=Ng,s.J=ya,s.K=sn,s.L=si,s.M=class{constructor(t,e,r,n){this.id=t,this.position=e!=null?new Ae(e[0],e[1]):new Ae(0,0),this.orientation=r??[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new pn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(s.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const r of t.meshes){const n=pn.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(n)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=s.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,r,n,a,c,d=!1){Jb(this.matrix,this,t.transform,this.position,e,r,n,a,c,d)}upload(t){if(!this.uploaded){for(const e of this.nodes)Jg(e,t);for(const e of this.nodes)Rm(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Qg(t)}},s.O=Pn,s.P=dt,s.Q=su,s.R=So,s.S=mc,s.T=Wg,s.U=Zr,s.V=Mt,s.W=Wu,s.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([r,n]){const a=ut([1,r,n]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:Zr(t.x,e.x,r),y:Zr(t.y,e.y,r),z:Zr(t.z,e.z,r)}}},s.Y=function(t,e,r=0,n=!0){const a=new dt(r,r),c=t.sub(a),d=e.add(a),m=[c,new dt(d.x,c.y),d,new dt(c.x,d.y)];return n&&m.push(c.clone()),m},s.Z=ru,s._=function(t,e){const r=[];for(let n=0;n<t.length;n++){const a=kn(n-1,-1,t.length-1),c=kn(n+1,-1,t.length-1),d=t[n],m=t[c],y=t[a].sub(d).unit(),v=m.sub(d).unit(),w=v.angleWithSep(y.x,y.y),S=y.add(v).unit().mult(-1*e/Math.sin(w/2));r.push(d.add(S))}return r},s.a=Ss,s.a$=function(t){const e=[];for(const r in t)e.push(t[r]);return e},s.a0=D0,s.a1=function(t,e,r=0){return s.N.fromValues(((e.x-r)*t.scale-t.x)*Mt,(e.y*t.scale-t.y)*Mt,Bi(e.z,e.y))},s.a2=pg,s.a3=Kx,s.a4=function(t){let e=1/0,r=1/0,n=-1/0,a=-1/0;for(const c of t)e=Math.min(e,c.x),r=Math.min(r,c.y),n=Math.max(n,c.x),a=Math.max(a,c.y);return{min:new dt(e,r),max:new dt(n,a)}},s.a5=Br,s.a8=ba,s.a9=pi,s.aA=dp,s.aB=vn,s.aC=pr,s.aD=Ip,s.aE=Sm,s.aF=function(){rs.isLoading()||rs.isLoaded()||Ha()!=="deferred"||Ld()},s.aG=is,s.aH=Un,s.aI=d1,s.aJ=lr,s.aK=Og,s.aL=Pg,s.aM=Xn,s.aN=Ns,s.aO=qd,s.aP=Qv,s.aQ=im,s.aR=Hg,s.aS=function(t,e){const r=mc(e.zoom);if(r===0)return tl(t);const n=Yp(t),a=yg(n),c=Br(n.getWest())*e.worldSize,d=Br(n.getEast())*e.worldSize,m=Mr(n.getNorth())*e.worldSize,y=Mr(n.getSouth())*e.worldSize,v=[c,m,0],w=[d,m,0],S=[c,y,0],A=[d,y,0],R=s.a6.invert([],e.globeMatrix);return s.N.transformMat4(v,v,R),s.N.transformMat4(w,w,R),s.N.transformMat4(S,S,R),s.N.transformMat4(A,A,R),a[0]=kl(a[0],S,r),a[1]=kl(a[1],A,r),a[2]=kl(a[2],w,r),a[3]=kl(a[3],v,r),pn.fromPoints(a)},s.aT=Jp,s.aU=ef,s.aV=kl,s.aW=zo,s.aX=AM,s.aY=Yt,s.aZ=A1,s.a_=Xe,s.aa=Zt,s.ab=J,s.ac=function(t,e){const r={};for(let n=0;n<e.length;n++){const a=e[n];a in t&&(r[a]=t[a])}return r},s.ad=Be,s.ae=Mr,s.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,n){const a=this.entries[t]=this.entries[t]||{callbacks:[]};if(a.result){const[c,d]=a.result;return this.scheduler?this.scheduler.add(()=>{n(c,d)},e):n(c,d),()=>{}}return a.callbacks.push(n),a.cancel||(a.cancel=r((c,d)=>{a.result=[c,d];for(const m of a.callbacks)this.scheduler?this.scheduler.add(()=>{m(c,d)},e):m(c,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(c=>c!==n),a.callbacks.length||(a.cancel(),delete this.entries[t]))}}},s.ag=Fd,s.ah=function(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const c=Xe(t.request,(d,m,y,v)=>{d?a(d):m&&a(null,{vectorTile:r?void 0:new Lg(new Ph(m)),rawData:m,cacheControl:y,expires:v})});return()=>{c.cancel(),a()}},e)},s.ai=function(t){$r++,$r>Ht&&(t.getActor().send("enforceCacheSizeLimit",He),$r=0)},s.aj=gn,s.ak=Ze,s.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.am=_t,s.an=Vb,s.ao=Gb,s.ap=jb,s.aq=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<t.length;n++){const a=document.createElement("source");ct(t[n])||(r.crossOrigin="Anonymous"),a.src=t[n],r.appendChild(a)}return{cancel:()=>{}}},s.ar=Am,s.as=ff,s.at=Lr,s.au=ri,s.av=va,s.aw=Hn,s.ax=yn,s.ay=xi,s.az=Pl,s.b=as,s.b$=Tp,s.b0=function(t,e){const r=[];for(const n in t)n in e||r.push(n);return r},s.b1=nn,s.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.b3=function(t,e){const{x:r,y:n}=t.point,a=ox(r,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return s.a6.multiply(a,a,vg(tl(e)))},s.b5=Ah,s.b6=Gs,s.b7=hm,s.b8=function(t,e,r,n,a){const c=5*e+2;t.float32[c+0]=r,t.float32[c+1]=n,t.float32[c+2]=a},s.b9=Em,s.bA=Pm,s.bB=$b,s.bC=function(t){const e=$b(t,!0);return s.b4.invert([],[e[0],e[1],e[4],e[5]])},s.bD=mg,s.bE=function(t){const{x:e,y:r}=t.point,{lng:n,lat:a}=t._center;return ox(e,r,t.worldSize,n,a)},s.bF=zi,s.bG=oe,s.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return Jn[e]},s.bI=45,s.bJ=ar,s.bK=h,s.bL=Ka,s.bM=Gp,s.bN=Io,s.bO=vh,s.bP=u,s.bQ=function(t,e,r){const n=Math.sqrt(t*t+e*e+r*r),a=n>0?Math.acos(r/n)*Kn:0;let c=t!==0||e!==0?Math.atan2(-e,-t)*Kn+90:0;return c<0&&(c+=360),[n,c,a]},s.bR=Xr,s.bS=pn,s.bT=ut,s.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},s.bV=function(t){return t({pluginStatus:Go,pluginURL:Za}),Pd.on("pluginStateChange",t),t},s.bW=kh,s.bX=Om,s.bY=Rh,s.bZ=Ug,s.b_=En,s.ba=wb,s.bb=ia,s.bc=wo,s.bd=Cb,s.be=Vg,s.bf=Bg,s.bg=ly,s.bh=kn,s.bj=br,s.bk=se,s.bl=Or,s.bm=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},s.bn=Ae,s.bo=Bb,s.bp=vt,s.bq=_g,s.br=qb,s.bs=ot,s.bt=rx,s.bu=function(t,e,r,n,a,c,d,m,y){if(y.name==="globe")return rx(t,e,new ot(r,n,a),!1);const v=ff({z:r,x:n,y:a},y);return new pn([(c+v.x/v.scale)*e,e*(v.y/v.scale),d],[(c+v.x2/v.scale)*e,e*(v.y2/v.scale),m])},s.bv=function(t,e,r){let n=0;for(let a=0;a<2;++a){const c=r?r[a]:0;t[a]>c&&(n+=(t[a]-c)*(t[a]-c)),e[a]<c&&(n+=(c-e[a])*(c-e[a]))}return n},s.bw=Hr,s.bx=H,s.by=function(t){const e=s.a6.identity(new Float64Array(16));s.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const r=[0,ye,0],n=[0,De,0];return s.N.transformMat4(r,r,e),s.N.transformMat4(n,n,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!bg(t,new Ae(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!bg(t,new Ae(t.center.lat,-90))]},s.bz=function(t,e){const{scale:r}=t.tileTransform,n=r*Mt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return s.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[n,n])},s.c=u1,s.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.c0=Ee,s.c1=bi,s.c2=function(t,e,r){return t.type==="custom"?new kI(t,e):new pC[t.type](t,e,r)},s.c3=function(t){const e=t.indexOf(dh);return e>=0?t.slice(0,e):t},s.c4=function(t){return t.indexOf(dh)>=0},s.c5=function(t){const e=t.indexOf(dh);return e>=0?t.slice(e+1):""},s.c6=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.c7=ai,s.c8=Pd,s.c9=Ge,s.cA=eb,s.cB=(t,e,r,n,a,c)=>{const d=t.transform;return{u_matrix:Qx(t,e,r,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:Jx(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:c}},s.cC=(t,e,r,n,a,c,d)=>{const m=t.transform,y=m.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:Qx(t,e,r,n),u_pixels_to_tile_units:y,u_device_pixel_ratio:c,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:tb(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Jx(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_emissive_strength:r.paint.get("line-emissive-strength")}},s.cD=gr,s.cE=tf,s.cF=qx,s.cG=Kt,s.cH=um,s.cI=yc,s.cJ=450,s.cK=7,s.cL=OI,s.cM=256,s.cN=vg,s.cO=Ya,s.cP=$d,s.cQ=function(t,e,r,n,a){return Zt((t-e)/(r-e)*(a-n)+n,n,a)},s.cR=Wr,s.cS=Yg,s.cT=[1,1,1],s.cU=Sh,s.cV=zh,s.cW=ta,s.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=Ex(new dt(0,0),new dt(Mt,Mt),t),r=[];for(const n of this._activeRegions){if(n.hiddenByOverlap||!Tx(e,n))continue;const a=fA(n.min,n.max,t);r.push({min:a.min,max:a.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return r}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const n of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(n).buckets[e.layer];if(a)for(const c of a.getNodesInfo()){const d=c.node;d.footprint&&r.push({footprint:d.footprint,id:n.toUnwrapped()})}}return r}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const r of e){if(!r.footprint)continue;const n=Ex(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||am(e.min,r.min)||am(e.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,r=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[r];t=n.priority!==a.priority||!wx(n,a),++e,++r}}if(t){++this._updateTime;const e=r=>{const n=this._activeRegions;if(r>=n.length)return r;const a=n[r].priority;for(;r<n.length&&n[r].priority===a;)++r;return r};if(this._sourceIds.length>1){let r=0,n=e(r);for(;r!==n;){let a=r;const c=r;for(;a!==n;){const d=this._activeRegions[a];d.hiddenByOverlap=!1;for(let m=0;m<c;m++){const y=this._activeRegions[m];if(!y.hiddenByOverlap&&Tx(d,y)&&(d.hiddenByOverlap=Mx(d.footprint,d.tileId,y.footprint,y.tileId),d.hiddenByOverlap))break}++a}r=n,n=e(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},s.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const r=new Ns,n=new Hn,a=[],c=t+1+2,d=e[0]+1,m=e[0]+1+(1+e.length),y=(v,w,S)=>{let A=v===c-1?v-2:v===0?v:v-1;return A+=S?24575:0,[A,w]};for(let v=0;v<c;++v)r.emplaceBack(...y(v,0,!0));for(let v=0;v<d;++v)for(let w=0;w<c;++w)r.emplaceBack(...y(w,v,(w===0||w===c-1)&&!0));for(let v=0;v<e.length;++v){const w=e[v];for(let S=0;S<c;++S)r.emplaceBack(...y(S,w,!0))}for(let v=0;v<e.length;++v){const w=n.length,S=e[v]+1+2,A=new Hn;for(let k=0;k<S-1;k++){const U=k===S-2,G=U?c*(m-e.length+v-k):c;for(let Y=0;Y<c-1;Y++){const te=k*c+Y;k===0||U||Y===0||Y===c-2?(A.emplaceBack(te+1,te,te+G),A.emplaceBack(te+G,te+G+1,te+1)):(n.emplaceBack(te+1,te,te+G),n.emplaceBack(te+G,te+G+1,te+1))}}const R=vn.simpleSegment(0,w,r.length,n.length-w);for(let k=0;k<A.uint16.length;k+=3)n.emplaceBack(A.uint16[k],A.uint16[k+1],A.uint16[k+2]);const D=vn.simpleSegment(0,w,r.length,n.length-w);a.push({withoutSkirts:R,withSkirts:D})}return{vertices:r,indices:n,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(he,fe);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Qv.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Hn;for(let d=0;d<=he;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new Ya,n=new Ya,a=new Ya,c=new Ya;this._poleSegments=[];for(let d=0,m=0;d<oe;d++){const y=360/(1<<d);r.emplaceBack(0,-J,0,.5,0),n.emplaceBack(0,-J,0,.5,1),a.emplaceBack(0,-J,0,.5,.5),c.emplaceBack(0,-J,0,.5,.5);for(let v=0;v<=he;v++){let w=v/he,S=0;const A=Zr(0,y,w),[R,D,k]=Te(PM,LM,A,J);r.emplaceBack(R,D,k,w,S),n.emplaceBack(R,D,k,w,1-S);const U=br(A);w=.5+.5*Math.sin(U),S=.5+.5*Math.cos(U),a.emplaceBack(R,D,k,w,S),c.emplaceBack(R,D,k,w,1-S)}this._poleSegments.push(vn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,Wp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,Wp,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(a,Wp,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(c,Wp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},s.cZ=function(t){return Es.has(t)},s.c_=Ci,s.ca=i,s.cb=class extends xa{constructor(t){super(t),this.current=p}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let n=0;n<9;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.cc=Ct,s.cd=function(t,e,r){const n=mc(r.zoom),a=t.style.map._antialias,c=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return n===0&&!a&&!c},s.ce=function(t){const e=t.pixelsPerMeter,r=e/Or(1,t.center.lat),n=s.a6.identity(new Float64Array(16));return s.a6.translate(n,n,[t.point.x,t.point.y,0]),s.a6.scale(n,n,[r,r,e]),Float32Array.from(n)},s.cf=Yp,s.cg=function(t){const e=Hr-5;t=Zt(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(br(t))),3);return Math.round(r*(fe.length-1))},s.ch=function(t,e,r,n){const a=e.getNorth(),c=e.getSouth(),d=e.getWest(),m=e.getEast(),y=1<<t.z,v=m-d,w=a-c,S=v/he,A=-w/fe[r],R=[0,S,0,A,0,0,a,d,0];if(t.z>0){const D=180/n;s.co.multiply(R,R,[D/v+1,0,0,0,D/w+1,0,-.5*D/S,.5*D/A,1])}return R[2]=y,R[5]=t.x,R[8]=t.y,R},s.ci=tl,s.cj=function(t,e,r){const n=s.a6.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return s.a6.rotateY(n,r.globeMatrix,a),Float32Array.from(n)},s.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,n=1<<r,a=Math.floor(t.x),c=Math.floor((t.x-a)*n),d=Math.floor(t.y*n),m=this.findDEMTileFor(new _t(r,a,r,c,d));return!(!m||!m.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const a=n.getSource().maxzoom,c=1<<a,d=Math.floor(t.x),m=t.x-d,y=new _t(a,d,a,Math.floor(m*c),Math.floor(t.y*c)),v=this.findDEMTileFor(y);if(!v||!v.dem)return e;const w=v.dem,S=1<<v.tileID.canonical.z,A=(m*S-v.tileID.canonical.x)*w.dim,R=(t.y*S-v.tileID.canonical.y)*w.dim,D=Math.floor(A),k=Math.floor(R);return(r?this.exaggeration():1)*Zr(Zr(w.get(D,k),w.get(D,k+1),R-k),Zr(w.get(D+1,k),w.get(D+1,k+1),R-k),A-D)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new si(t.wrap+(t.canonical.x+e/Mt)/n,(t.canonical.y+r/Mt)/n))}getAtTileOffsetFunc(t,e,r,n){return a=>{const c=this.getAtTileOffset(t,a.x,a.y),d=n.upVector(t.canonical,a.x,a.y),m=n.upVectorScale(t.canonical,e,r).metersToTile;return s.N.scale(d,d,c*m),d}}getForTilePoints(t,e,r,n){if(this.isUsingMockSource())return!1;const a=Sh.create(this,t,n);return!!a&&(e.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,a=1<<t.canonical.z-n.canonical.z;let c=t.canonical.x/a-n.canonical.x,d=t.canonical.y/a-n.canonical.y,m=0;for(let y=0;y<t.canonical.z-n.canonical.z&&!r.leaves[m];y++){c*=2,d*=2;const v=2*Math.floor(d)+Math.floor(c);m=r.childOffsets[m]+v,c%=1,d%=1}return{min:this.exaggeration()*r.minimums[m],max:this.exaggeration()*r.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const a of t){const c=this.getMinMaxForTile(a.tileID);c&&(r=Math.min(r,c.min),n=Math.max(n,c.max),e=!0)}return e?{min:r,max:n}:null}},s.cl=Xp,s.cm=px,s.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},s.cp=nx,s.cq=256,s.cr=function(t,e){const r=[0,0,0],n=Jp(tl(e.canonical));return s.N.transformMat4(r,r,n),s.N.transformMat4(r,r,t),r},s.cs=t=>({u_camera_to_center_distance:new Io(t),u_extrude_scale:new x(t),u_device_pixel_ratio:new Io(t),u_matrix:new h(t),u_inv_rot_matrix:new h(t),u_merc_center:new Ka(t),u_tile_id:new Gp(t),u_zoom_transition:new Io(t),u_up_dir:new Gp(t),u_emissive_strength:new Io(t)}),s.ct=t=>({u_matrix:new h(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new Io(t),u_units_to_pixels:new Ka(t),u_dash_image:new vh(t),u_gradient_image:new vh(t),u_image_height:new Io(t),u_texsize:new Ka(t),u_tile_units_to_pixels:new Io(t),u_alpha_discard_threshold:new Io(t),u_trim_offset:new Ka(t),u_emissive_strength:new Io(t)}),s.cu=t=>({u_matrix:new h(t),u_texsize:new Ka(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new Io(t),u_image:new vh(t),u_units_to_pixels:new Ka(t),u_tile_units_to_pixels:new Io(t),u_alpha_discard_threshold:new Io(t),u_trim_offset:new Ka(t)}),s.cv=mh,s.cw=VA,s.cx=GA,s.cy=lx,s.cz=(t,e,r,n,a,c)=>{const d=t.transform,m=d.projection.name==="globe";let y;if(c.paint.get("circle-pitch-alignment")==="map")if(m){const w=nx(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;y=Float32Array.from([w,0,0,w])}else y=d.calculatePixelsToTileUnitsMatrix(r);else y=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const v={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(d.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:nt.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:RM,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(m){v.u_inv_rot_matrix=n,v.u_merc_center=a,v.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],v.u_zoom_transition=mc(d.zoom);const w=a[0]*Mt,S=a[1]*Mt;v.u_up_dir=d.projection.upVector(new ot(0,0,0),w,S)}return v},s.d=Pt,s.d0=Jr,s.d1=li,s.d2=$e,s.d3=function([t,e,r]){const n=Math.hypot(t,e,r),a=Math.atan2(t,r),c=.5*Math.PI-Math.acos(-e/n);return new Ae(zi(a),zi(c))},s.d4=je,s.d5=re,s.d6=bg,s.d7=sx,s.d8=function(t){const e=[0,0,0],r=s.a6.identity(new Float64Array(16));return s.a6.multiply(r,t.pixelMatrix,t.globeMatrix),s.N.transformMat4(e,e,r),new dt(e[0],e[1])},s.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(r){if(Oe==null){const n=r.navigator?r.navigator.userAgent:null;Oe=!!r.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Oe}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.dA=Sa,s.dB=h1,s.dC=f1,s.dD=Xx,s.dE=St,s.dF=Eb,s.dG=function(t,e,r,n,a,c,d,m,y,v,w){t.createArrays(),t.tilePixelRatio=Mt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const S=t.layers[0].layout,A=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:Y}=t.textSizeData;R.compositeTextSizes=[A["text-size"].possiblyEvaluate(new sn(G),m),A["text-size"].possiblyEvaluate(new sn(Y),m)]}if(t.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:Y}=t.iconSizeData;R.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new sn(G),m),A["icon-size"].possiblyEvaluate(new sn(Y),m)]}R.layoutTextSize=A["text-size"].possiblyEvaluate(new sn(y+1),m),R.layoutIconSize=A["icon-size"].possiblyEvaluate(new sn(y+1),m),R.textMaxSize=A["text-size"].possiblyEvaluate(new sn(18),m);const D=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",k=S.get("text-size");let U=!1;for(const G of t.features)if(G.icon&&G.icon.nameSecondary){U=!0;break}for(const G of t.features){const Y=S.get("text-font").evaluate(G,{},m).join(","),te=k.evaluate(G,{},m),ee=R.layoutTextSize.evaluate(G,{},m),ue=(R.layoutIconSize.evaluate(G,{},m),{horizontal:{},vertical:void 0}),le=G.text;let pe,be=[0,0];if(le){const Pe=le.toString(),qe=S.get("text-letter-spacing").evaluate(G,{},m)*wo,Qe=S.get("text-line-height").evaluate(G,{},m)*wo,Ve=q_(Pe)?qe:0,Je=S.get("text-anchor").evaluate(G,{},m),Ne=S.get("text-variable-anchor");if(!Ne){const Bt=S.get("text-radial-offset").evaluate(G,{},m);be=Bt?Cb(Je,[Bt*wo,jg]):S.get("text-offset").evaluate(G,{},m).map(st=>st*wo)}let Ke=D?"center":S.get("text-justify").evaluate(G,{},m);const Et=S.get("symbol-placement")==="point",tt=Et?S.get("text-max-width").evaluate(G,{},m)*wo:1/0,Xt=Bt=>{t.allowVerticalPlacement&&qa(Pe)&&(ue.vertical=Fg(le,e,r,a,Y,tt,Qe,Je,Bt,Ve,be,Gs.vertical,!0,ee,te))};if(!D&&Ne){const Bt=Ke==="auto"?Ne.map(xr=>Vg(xr)):[Ke];let st=!1;for(let xr=0;xr<Bt.length;xr++){const or=Bt[xr];if(!ue.horizontal[or])if(st)ue.horizontal[or]=ue.horizontal[0];else{const Wt=Fg(le,e,r,a,Y,tt,Qe,"center",or,Ve,be,Gs.horizontal,!1,ee,te);Wt&&(ue.horizontal[or]=Wt,st=Wt.positionedLines.length===1)}}Xt("left")}else{if(Ke==="auto"&&(Ke=Vg(Je)),Et||S.get("text-writing-mode").indexOf("horizontal")>=0||!qa(Pe)){const Bt=Fg(le,e,r,a,Y,tt,Qe,Je,Ke,Ve,be,Gs.horizontal,!1,ee,te);Bt&&(ue.horizontal[Ke]=Bt)}Xt(Et?"left":Ke)}}let Ie=!1;if(G.icon&&G.icon.namePrimary){const Pe=n[G.icon.namePrimary];Pe&&(pe=lI(a[G.icon.namePrimary],G.icon.nameSecondary?a[G.icon.nameSecondary]:void 0,S.get("icon-offset").evaluate(G,{},m),S.get("icon-anchor").evaluate(G,{},m)),Ie=Pe.sdf,t.sdfIcons===void 0?t.sdfIcons=Pe.sdf:t.sdfIcons!==Pe.sdf&&ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==t.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const ze=Lb(ue.horizontal)||ue.vertical;t.iconsInText||(t.iconsInText=!!ze&&ze.iconsInText),(ze||pe)&&mI(t,G,ue,pe,n,R,ee,0,be,Ie,d,m,v,w,U)}c&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},s.dH=Lg,s.dI=Ph,s.dJ=lm,s.dK=It,s.dL=om,s.dM=nm,s.dN=Ai,s.dO=ob,s.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==i1){const r=new Uint32Array(t,0,7),[,,n,a,c,d]=r;e=r.byteLength+a+c+d+c,(n!==t.byteLength||e>=t.byteLength)&&ve("Invalid b3dm header information.")}return a1(t,e)},s.dQ=function(t,e){const r=u1(t);for(const n of r){for(const a of n.meshes)lC(a);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(cC(n.lights,e)))}return r},s.dR=Fm,s.dS=Qb,s.dT=rs,s.dU=function(t){fi(),Tt&&Tt.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n])})})},s.da=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",gt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ee(t))return t;const r=sr(t);return r.params.push(`sdk=js-${K}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ee(t))return t;const r=sr(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Ee(t))return t;const r=sr(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,n){if(!Ee(t))return t;const a=sr(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),r&&a.params.push(`language=${r}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,n){const a=sr(t);return Ee(t)?(a.path=`/styles/v1${a.path}/sprite${e}${r}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${r}`,Yr(a))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ee(t))return t;const n=sr(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${ii.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${re.RASTER_URL_PREFIX}${n.path}`:n.authority==="rasterarrays"?n.path=`/${re.RASTERARRAYS_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${re.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(c){for(const d of c){const m=d.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(n.params)||re.ACCESS_TOKEN;return re.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const r=sr(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${re.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${r.path.replace(`/${re.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${re.TILE_URL_VERSION}/`,"")}`;let a=r.params;return e&&(a=a.filter(c=>!c.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&Ee(e),n=[];for(const a of t.tiles||[])we(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a);return n}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=sr(re.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!re.REQUIRE_ACCESS_TOKEN)return Yr(t);if(e=e||re.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Yr(t)}},s.db=function(t,e){e?Es.add(t):Es.delete(t)},s.dc=ii,s.dd=Ro,s.de=Da,s.df=zt,s.dg=ti,s.dh=function(t){Es.delete(t)},s.di=wi,s.dj=qn,s.dk=K,s.dl=function(t,e){He=t,Ht=e},s.dm=function(t,e,r=!1){if(Go===Sd||Go===Md||Go===Ad)throw new Error("setRTLTextPlugin cannot be called multiple times.");Za=nt.resolveURL(t),Go=Sd,Id=e,Cd(),r||Ld()},s.dn=Ha,s.dp=function(){Om().acquire(ey)},s.dq=function(){const t=bf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(ey),bf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.dr=xf,s.ds=function(t){const e=Rr();if(!e)return;const r=e.delete(Nt);t&&r.catch(t).then(()=>t())},s.dt=vf,s.du=e1,s.dv=function(t){ty=nt.resolveURL(t),Bh||(Bh=new kh(Om(),new No)),Bh.broadcast("setDracoUrl",ty)},s.dw=t1,s.dx=function(t){Fh=nt.resolveURL(t),Bh||(Bh=new kh(Om(),new No)),Bh.broadcast("setMeshoptUrl",Fh)},s.dy=Gt,s.dz=_c,s.e=_r,s.f=nt,s.g=function(t,e){return Ge(_r(t,{type:"json"}),e)},s.h=Vs,s.i=ka,s.j=qc,s.k=oh,s.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>a1(e,0,t))},s.m=mp,s.n=tu,s.o=lu,s.p=Tb,s.q=ch,s.r=lh,s.s=xd,s.t=xo,s.u=au,s.v=Si,s.w=ve,s.x=dn,s.z=Dd}),z(["./shared"],function(s){function K(Oe){const W=Oe?Oe.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function Q(Oe){if(typeof Oe=="number"||typeof Oe=="boolean"||typeof Oe=="string"||Oe==null)return JSON.stringify(Oe);if(Array.isArray(Oe)){let se="[";for(const de of Oe)se+=`${Q(de)},`;return`${se}]`}let W="{";for(const se of Object.keys(Oe).sort())W+=`${se}:${Q(Oe[se])},`;return`${W}}`}function re(Oe){let W="";for(const se of s.b2)W+=`/${Q(Oe[se])}`;return W}class we{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,se){this._layerConfigs={},this._layers={},this.update(W,[],se)}update(W,se,de){this._options=de;for(const Ze of W)this._layerConfigs[Ze.id]=Ze,(this._layers[Ze.id]=s.c2(Ze,this.scope,this._options)).compileFilter(),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id];for(const Ze of se)delete this.keyCache[Ze],delete this._layerConfigs[Ze],delete this._layers[Ze];this.familiesBySource={};const Fe=function(Ze,nt){const Nt={};for(let Ht=0;Ht<Ze.length;Ht++){const Tt=nt&&nt[Ze[Ht].id]||re(Ze[Ht]);nt&&(nt[Ze[Ht].id]=Tt);let Ut=Nt[Tt];Ut||(Ut=Nt[Tt]=[]),Ut.push(Ze[Ht])}const He=[];for(const Ht in Nt)He.push(Nt[Ht]);return He}(s.a$(this._layerConfigs),this.keyCache);for(const Ze of Fe){const nt=Ze.map(Rr=>this._layers[Rr.id]),Nt=nt[0];if(Nt.visibility==="none")continue;const He=Nt.source||"";let Ht=this.familiesBySource[He];Ht||(Ht=this.familiesBySource[He]={});const Tt=Nt.sourceLayer||"_geojsonTileLayer";let Ut=Ht[Tt];Ut||(Ut=Ht[Tt]=[]),Ut.push(nt)}}}const Ee=1*s.dA;class Me{constructor(W){const se={},de=[];for(const Nt in W){const He=W[Nt],Ht=se[Nt]={};for(const Tt in He.glyphs){const Ut=He.glyphs[+Tt];if(!Ut||Ut.bitmap.width===0||Ut.bitmap.height===0)continue;const Rr=Ut.metrics.localGlyph?Ee:1,fi={x:0,y:0,w:Ut.bitmap.width+2*Rr,h:Ut.bitmap.height+2*Rr};de.push(fi),Ht[Tt]=fi}}const{w:Fe,h:Ze}=s.p(de),nt=new s.dz({width:Fe||1,height:Ze||1});for(const Nt in W){const He=W[Nt];for(const Ht in He.glyphs){const Tt=He.glyphs[+Ht];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const Ut=se[Nt][Ht],Rr=Tt.metrics.localGlyph?Ee:1;s.dz.copy(Tt.bitmap,nt,{x:0,y:0},{x:Ut.x+Rr,y:Ut.y+Rr},Tt.bitmap)}}this.image=nt,this.positions=se}}s.dy(Me,"GlyphAtlas");class Ce{constructor(W){this.tileID=new s.am(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=s.as(W.tileID.canonical,W.projection),this.projection=W.projection,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster}parse(W,se,de,Fe,Ze){this.status="parsing",this.data=W,this.collisionBoxArray=new s.aD;const nt=new s.dB(Object.keys(W.layers).sort()),Nt=new s.dC(this.tileID,this.promoteId);Nt.bucketLayerIDs=[];const He={},Ht=new s.dD(256,256),Tt={featureIndex:Nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ht,availableImages:de,brightness:this.brightness},Ut=se.familiesBySource[this.source];for(const yi in Ut){const ki=W.layers[yi];if(!ki)continue;let Fn=!1,ji=!1,_o=!1;for(const Tn of Ut[yi])Tn[0].type==="symbol"?Fn=!0:ji=!0,Tn[0].is3D()&&Tn[0].type!=="model"&&(_o=!0);if(this.extraShadowCaster&&!_o||this.isSymbolTile===!0&&!Fn||this.isSymbolTile===!1&&!ji)continue;ki.version===1&&s.w(`Vector tile source "${this.source}" layer "${yi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const jn=nt.encode(yi),So=[];for(let Tn=0;Tn<ki.length;Tn++){const En=ki.feature(Tn),Ge=Nt.getId(En,yi);So.push({feature:En,id:Ge,index:Tn,sourceLayerIndex:jn})}for(const Tn of Ut[yi]){const En=Tn[0];(!this.extraShadowCaster||En.is3D()&&En.type!=="model")&&(this.isSymbolTile!==void 0&&En.type==="symbol"!==this.isSymbolTile||En.minzoom&&this.zoom<Math.floor(En.minzoom)||En.maxzoom&&this.zoom>=En.maxzoom||En.visibility!=="none"&&(Ue(Tn,this.zoom,Tt.brightness,de),(He[En.id]=En.createBucket({index:Nt.bucketLayerIDs.length,layers:Tn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:jn,sourceID:this.source,projection:this.projection.spec})).populate(So,Tt,this.tileID.canonical,this.tileTransform),Nt.bucketLayerIDs.push(Tn.map(Ge=>Ge.id))))}}let Rr,fi,Ui,gi;Ht.trim();const $r={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ii=()=>{if(Rr)return this.status="done",Ze(Rr);if(this.extraShadowCaster)this.status="done",Ze(null,{buckets:s.a$(He).filter(yi=>!yi.isEmpty()),featureIndex:Nt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(fi&&Ui&&gi){const yi=new Me(fi),ki=new s.dF(Ui,gi);for(const Fn in He){const ji=He[Fn];ji instanceof s.aE?(Ue(ji.layers,this.zoom,Tt.brightness,de),s.dG(ji,fi,yi.positions,Ui,ki.iconPositions,this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):ji.hasPattern&&(ji instanceof s.aK||ji instanceof s.aL||ji instanceof s.cH)&&(Ue(ji.layers,this.zoom,Tt.brightness,de),ji.addFeatures(Tt,this.tileID.canonical,ki.patternPositions,de,this.tileTransform,this.brightness))}this.status="done",Ze(null,{buckets:s.a$(He).filter(Fn=>!Fn.isEmpty()),featureIndex:Nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yi.image,lineAtlas:Ht,imageAtlas:ki,brightness:Tt.brightness})}};if(!this.extraShadowCaster){const yi=s.dE(Tt.glyphDependencies,ji=>Object.keys(ji).map(Number));Object.keys(yi).length?Fe.send("getGlyphs",{uid:this.uid,stacks:yi,scope:this.scope},(ji,_o)=>{Rr||(Rr=ji,fi=_o,ii())},void 0,!1,$r):fi={};const ki=Object.keys(Tt.iconDependencies);ki.length?Fe.send("getImages",{icons:ki,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ji,_o)=>{Rr||(Rr=ji,Ui=_o,ii())},void 0,!1,$r):Ui={};const Fn=Object.keys(Tt.patternDependencies);Fn.length?Fe.send("getImages",{icons:Fn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ji,_o)=>{Rr||(Rr=ji,gi=_o,ii())},void 0,!1,$r):gi={}}ii()}}function Ue(Oe,W,se,de){const Fe=new s.K(W,{brightness:se});for(const Ze of Oe)Ze.recalculate(Fe,de)}class lt extends s.E{constructor(W,se,de,Fe,Ze,nt){super(),this.actor=W,this.layerIndex=se,this.availableImages=de,this.loadVectorData=Ze||s.ah,this.loading={},this.loaded={},this.deduped=new s.af(W.scheduler),this.isSpriteLoaded=Fe,this.scheduler=W.scheduler,this.brightness=nt}loadTile(W,se){const de=W.uid,Fe=W&&W.request,Ze=Fe&&Fe.collectResourceTiming,nt=this.loading[de]=new Ce(W);nt.abort=this.loadVectorData(W,(Nt,He)=>{const Ht=!this.loading[de];if(delete this.loading[de],Ht||Nt||!He)return nt.status="done",Ht||(this.loaded[de]=nt),se(Nt);const Tt=He.rawData,Ut={};He.expires&&(Ut.expires=He.expires),He.cacheControl&&(Ut.cacheControl=He.cacheControl),nt.vectorTile=He.vectorTile||new s.dH(new s.dI(Tt));const Rr=()=>{nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(fi,Ui)=>{if(fi||!Ui)return se(fi);const gi={};if(Ze){const $r=K(Fe);$r.length>0&&(gi.resourceTiming=JSON.parse(JSON.stringify($r)))}se(null,s.e({rawTileData:Tt.slice(0)},Ui,Ut,gi))})};this.isSpriteLoaded?Rr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Rr,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):Rr()}),this.loaded=this.loaded||{},this.loaded[de]=nt})}reloadTile(W,se){const de=this.loaded,Fe=W.uid,Ze=this;if(de&&de[Fe]){const nt=de[Fe];nt.showCollisionBoxes=W.showCollisionBoxes,nt.projection=W.projection,nt.brightness=W.brightness,nt.tileTransform=s.as(W.tileID.canonical,W.projection),nt.extraShadowCaster=W.extraShadowCaster;const Nt=(He,Ht)=>{const Tt=nt.reloadCallback;Tt&&(delete nt.reloadCallback,nt.parse(nt.vectorTile,Ze.layerIndex,this.availableImages,Ze.actor,Tt)),se(He,Ht)};nt.status==="parsing"?nt.reloadCallback=Nt:nt.status==="done"&&(nt.vectorTile?nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,Nt):Nt())}else se(null,void 0)}abortTile(W,se){const de=W.uid,Fe=this.loading[de];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[de]),se()}removeTile(W,se){const de=this.loaded,Fe=W.uid;de&&de[Fe]&&delete de[Fe],se()}}class $t{loadTile(W,se){const{uid:de,encoding:Fe,rawImageData:Ze,padding:nt}=W,Nt=ImageBitmap&&Ze instanceof ImageBitmap?this.getImageData(Ze,nt):Ze;se(null,new s.dJ(de,Nt,Fe,nt<1))}getImageData(W,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const de=this.offscreenCanvasContext.getImageData(-se,-se,W.width+2*se,W.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}class It{decodeRasterArray({task:W,buffer:se},de){s.aZ.performDecoding(se,W).then(Fe=>{de(null,Fe)},Fe=>{de(Fe)})}}function yr(Oe,W){if(Oe.length!==0){zr(Oe[0],W);for(var se=1;se<Oe.length;se++)zr(Oe[se],!W)}}function zr(Oe,W){for(var se=0,de=0,Fe=0,Ze=Oe.length,nt=Ze-1;Fe<Ze;nt=Fe++){var Nt=(Oe[Fe][0]-Oe[nt][0])*(Oe[nt][1]+Oe[Fe][1]),He=se+Nt;de+=Math.abs(se)>=Math.abs(Nt)?se-He+Nt:Nt-He+se,se=He}se+de>=0!=!!W&&Oe.reverse()}var hr=s.dK(function Oe(W,se){var de,Fe=W&&W.type;if(Fe==="FeatureCollection")for(de=0;de<W.features.length;de++)Oe(W.features[de],se);else if(Fe==="GeometryCollection")for(de=0;de<W.geometries.length;de++)Oe(W.geometries[de],se);else if(Fe==="Feature")Oe(W.geometry,se);else if(Fe==="Polygon")yr(W.coordinates,se);else if(Fe==="MultiPolygon")for(de=0;de<W.coordinates.length;de++)yr(W.coordinates[de],se);return W});const Ai=s.dL.prototype.toGeoJSON;let Ii=class{constructor(Oe){this._feature=Oe,this.extent=s.V,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){const Oe=[];for(const W of this._feature.geometry)Oe.push([new s.P(W[0],W[1])]);return Oe}{const Oe=[];for(const W of this._feature.geometry){const se=[];for(const de of W)se.push(new s.P(de[0],de[1]));Oe.push(se)}return Oe}}toGeoJSON(Oe,W,se){return Ai.call(this,Oe,W,se)}},dt=class{constructor(Oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.V,this.length=Oe.length,this._features=Oe}feature(Oe){return new Ii(this._features[Oe])}};var Cn={exports:{}},Kn=s.dN,br=s.dM.VectorTileFeature,zi=Jn;function Jn(Oe,W){this.options=W||{},this.features=Oe,this.length=Oe.length}function Ct(Oe,W){this.id=typeof Oe.id=="number"?Oe.id:void 0,this.type=Oe.type,this.rawGeometry=Oe.type===1?[Oe.geometry]:Oe.geometry,this.properties=Oe.tags,this.extent=W||4096}Jn.prototype.feature=function(Oe){return new Ct(this.features[Oe],this.options.extent)},Ct.prototype.loadGeometry=function(){var Oe=this.rawGeometry;this.geometry=[];for(var W=0;W<Oe.length;W++){for(var se=Oe[W],de=[],Fe=0;Fe<se.length;Fe++)de.push(new Kn(se[Fe][0],se[Fe][1]));this.geometry.push(de)}return this.geometry},Ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Oe=this.geometry,W=1/0,se=-1/0,de=1/0,Fe=-1/0,Ze=0;Ze<Oe.length;Ze++)for(var nt=Oe[Ze],Nt=0;Nt<nt.length;Nt++){var He=nt[Nt];W=Math.min(W,He.x),se=Math.max(se,He.x),de=Math.min(de,He.y),Fe=Math.max(Fe,He.y)}return[W,de,se,Fe]},Ct.prototype.toGeoJSON=br.prototype.toGeoJSON;var Ci=s.dO,Jr=zi;function Zt(Oe){var W=new Ci;return function(se,de){for(var Fe in se.layers)de.writeMessage(3,Pn,se.layers[Fe])}(Oe,W),W.finish()}function Pn(Oe,W){var se;W.writeVarintField(15,Oe.version||1),W.writeStringField(1,Oe.name||""),W.writeVarintField(5,Oe.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<Oe.length;se++)de.feature=Oe.feature(se),W.writeMessage(2,kn,de);var Fe=de.keys;for(se=0;se<Fe.length;se++)W.writeStringField(3,Fe[se]);var Ze=de.values;for(se=0;se<Ze.length;se++)W.writeMessage(4,Ir,Ze[se])}function kn(Oe,W){var se=Oe.feature;se.id!==void 0&&W.writeVarintField(1,se.id),W.writeMessage(2,nn,Oe),W.writeVarintField(3,se.type),W.writeMessage(4,pr,se)}function nn(Oe,W){var se=Oe.feature,de=Oe.keys,Fe=Oe.values,Ze=Oe.keycache,nt=Oe.valuecache;for(var Nt in se.properties){var He=se.properties[Nt],Ht=Ze[Nt];if(He!==null){Ht===void 0&&(de.push(Nt),Ze[Nt]=Ht=de.length-1),W.writeVarint(Ht);var Tt=typeof He;Tt!=="string"&&Tt!=="boolean"&&Tt!=="number"&&(He=JSON.stringify(He));var Ut=Tt+":"+He,Rr=nt[Ut];Rr===void 0&&(Fe.push(He),nt[Ut]=Rr=Fe.length-1),W.writeVarint(Rr)}}}function _r(Oe,W){return(W<<3)+(7&Oe)}function rr(Oe){return Oe<<1^Oe>>31}function pr(Oe,W){for(var se=Oe.loadGeometry(),de=Oe.type,Fe=0,Ze=0,nt=se.length,Nt=0;Nt<nt;Nt++){var He=se[Nt],Ht=1;de===1&&(Ht=He.length),W.writeVarint(_r(1,Ht));for(var Tt=de===3?He.length-1:He.length,Ut=0;Ut<Tt;Ut++){Ut===1&&de!==1&&W.writeVarint(_r(2,Tt-1));var Rr=He[Ut].x-Fe,fi=He[Ut].y-Ze;W.writeVarint(rr(Rr)),W.writeVarint(rr(fi)),Fe+=Rr,Ze+=fi}de===3&&W.writeVarint(_r(7,1))}}function Ir(Oe,W){var se=typeof Oe;se==="string"?W.writeStringField(1,Oe):se==="boolean"?W.writeBooleanField(7,Oe):se==="number"&&(Oe%1!=0?W.writeDoubleField(3,Oe):Oe<0?W.writeSVarintField(6,Oe):W.writeVarintField(5,Oe))}Cn.exports=Zt,Cn.exports.fromVectorTileJs=Zt,Cn.exports.fromGeojsonVt=function(Oe,W){W=W||{};var se={};for(var de in Oe)se[de]=new Jr(Oe[de].features,W),se[de].name=de,se[de].version=W.version,se[de].extent=W.extent;return Zt({layers:se})},Cn.exports.GeoJSONWrapper=Jr;var gr=s.dK(Cn.exports);const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},Yt=Math.fround||(kt=new Float32Array(1),Oe=>(kt[0]=+Oe,kt[0]));var kt;const St=3,ai=5,bi=6;class ge{constructor(W){this.options=Object.assign(Object.create(Ye),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:se,minZoom:de,maxZoom:Fe}=this.options;se&&console.time("total time");const Ze=`prepare ${W.length} points`;se&&console.time(Ze),this.points=W;const nt=[];for(let He=0;He<W.length;He++){const Ht=W[He];if(!Ht.geometry)continue;const[Tt,Ut]=Ht.geometry.coordinates,Rr=Yt(rt(Tt)),fi=Yt(ut(Ut));nt.push(Rr,fi,1/0,He,-1,1),this.options.reduce&&nt.push(0)}let Nt=this.trees[Fe+1]=this._createTree(nt);se&&console.timeEnd(Ze);for(let He=Fe;He>=de;He--){const Ht=+Date.now();Nt=this.trees[He]=this._createTree(this._cluster(Nt,He)),se&&console.log("z%d: %d clusters in %dms",He,Nt.numItems,+Date.now()-Ht)}return se&&console.timeEnd("total time"),this}getClusters(W,se){let de=((W[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,W[1]));let Ze=W[2]===180?180:((W[2]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)de=-180,Ze=180;else if(de>Ze){const Ut=this.getClusters([de,Fe,180,nt],se),Rr=this.getClusters([-180,Fe,Ze,nt],se);return Ut.concat(Rr)}const Nt=this.trees[this._limitZoom(se)],He=Nt.range(rt(de),ut(nt),rt(Ze),ut(Fe)),Ht=Nt.data,Tt=[];for(const Ut of He){const Rr=this.stride*Ut;Tt.push(Ht[Rr+ai]>1?ve(Ht,Rr,this.clusterProps):this.points[Ht[Rr+St]])}return Tt}getChildren(W){const se=this._getOriginId(W),de=this._getOriginZoom(W),Fe="No cluster with the specified id.",Ze=this.trees[de];if(!Ze)throw new Error(Fe);const nt=Ze.data;if(se*this.stride>=nt.length)throw new Error(Fe);const Nt=this.options.radius/(this.options.extent*Math.pow(2,de-1)),He=Ze.within(nt[se*this.stride],nt[se*this.stride+1],Nt),Ht=[];for(const Tt of He){const Ut=Tt*this.stride;nt[Ut+4]===W&&Ht.push(nt[Ut+ai]>1?ve(nt,Ut,this.clusterProps):this.points[nt[Ut+St]])}if(Ht.length===0)throw new Error(Fe);return Ht}getLeaves(W,se,de){const Fe=[];return this._appendLeaves(Fe,W,se=se||10,de=de||0,0),Fe}getTile(W,se,de){const Fe=this.trees[this._limitZoom(W)],Ze=Math.pow(2,W),{extent:nt,radius:Nt}=this.options,He=Nt/nt,Ht=(de-He)/Ze,Tt=(de+1+He)/Ze,Ut={features:[]};return this._addTileFeatures(Fe.range((se-He)/Ze,Ht,(se+1+He)/Ze,Tt),Fe.data,se,de,Ze,Ut),se===0&&this._addTileFeatures(Fe.range(1-He/Ze,Ht,1,Tt),Fe.data,Ze,de,Ze,Ut),se===Ze-1&&this._addTileFeatures(Fe.range(0,Ht,He/Ze,Tt),Fe.data,-1,de,Ze,Ut),Ut.features.length?Ut:null}getClusterExpansionZoom(W){let se=this._getOriginZoom(W)-1;for(;se<=this.options.maxZoom;){const de=this.getChildren(W);if(se++,de.length!==1)break;W=de[0].properties.cluster_id}return se}_appendLeaves(W,se,de,Fe,Ze){const nt=this.getChildren(se);for(const Nt of nt){const He=Nt.properties;if(He&&He.cluster?Ze+He.point_count<=Fe?Ze+=He.point_count:Ze=this._appendLeaves(W,He.cluster_id,de,Fe,Ze):Ze<Fe?Ze++:W.push(Nt),W.length===de)break}return Ze}_createTree(W){const se=new s.bg(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<W.length;de+=this.stride)se.add(W[de],W[de+1]);return se.finish(),se.data=W,se}_addTileFeatures(W,se,de,Fe,Ze,nt){for(const Nt of W){const He=Nt*this.stride,Ht=se[He+ai]>1;let Tt,Ut,Rr;if(Ht)Tt=We(se,He,this.clusterProps),Ut=se[He],Rr=se[He+1];else{const gi=this.points[se[He+St]];Tt=gi.properties;const[$r,ii]=gi.geometry.coordinates;Ut=rt($r),Rr=ut(ii)}const fi={type:1,geometry:[[Math.round(this.options.extent*(Ut*Ze-de)),Math.round(this.options.extent*(Rr*Ze-Fe))]],tags:Tt};let Ui;Ui=Ht||this.options.generateId?se[He+St]:this.points[se[He+St]].id,Ui!==void 0&&(fi.id=Ui),nt.features.push(fi)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,se){const{radius:de,extent:Fe,reduce:Ze,minPoints:nt}=this.options,Nt=de/(Fe*Math.pow(2,se)),He=W.data,Ht=[],Tt=this.stride;for(let Ut=0;Ut<He.length;Ut+=Tt){if(He[Ut+2]<=se)continue;He[Ut+2]=se;const Rr=He[Ut],fi=He[Ut+1],Ui=W.within(He[Ut],He[Ut+1],Nt),gi=He[Ut+ai];let $r=gi;for(const ii of Ui){const yi=ii*Tt;He[yi+2]>se&&($r+=He[yi+ai])}if($r>gi&&$r>=nt){let ii,yi=Rr*gi,ki=fi*gi,Fn=-1;const ji=(Ut/Tt<<5)+(se+1)+this.points.length;for(const _o of Ui){const jn=_o*Tt;if(He[jn+2]<=se)continue;He[jn+2]=se;const So=He[jn+ai];yi+=He[jn]*So,ki+=He[jn+1]*So,He[jn+4]=ji,Ze&&(ii||(ii=this._map(He,Ut,!0),Fn=this.clusterProps.length,this.clusterProps.push(ii)),Ze(ii,this._map(He,jn)))}He[Ut+4]=ji,Ht.push(yi/$r,ki/$r,1/0,ji,-1,$r),Ze&&Ht.push(Fn)}else{for(let ii=0;ii<Tt;ii++)Ht.push(He[Ut+ii]);if($r>1)for(const ii of Ui){const yi=ii*Tt;if(!(He[yi+2]<=se)){He[yi+2]=se;for(let ki=0;ki<Tt;ki++)Ht.push(He[yi+ki])}}}}return Ht}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,se,de){if(W[se+ai]>1){const nt=this.clusterProps[W[se+bi]];return de?Object.assign({},nt):nt}const Fe=this.points[W[se+St]].properties,Ze=this.options.map(Fe);return de&&Ze===Fe?Object.assign({},Ze):Ze}}function ve(Oe,W,se){return{type:"Feature",id:Oe[W+St],properties:We(Oe,W,se),geometry:{type:"Point",coordinates:[(de=Oe[W],360*(de-.5)),Vt(Oe[W+1])]}};var de}function We(Oe,W,se){const de=Oe[W+ai],Fe=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ze=Oe[W+bi],nt=Ze===-1?{}:Object.assign({},se[Ze]);return Object.assign(nt,{cluster:!0,cluster_id:Oe[W+St],point_count:de,point_count_abbreviated:Fe})}function rt(Oe){return Oe/360+.5}function ut(Oe){const W=Math.sin(Oe*Math.PI/180),se=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return se<0?0:se>1?1:se}function Vt(Oe){const W=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}var lr={exports:{}};lr.exports=function(){function Oe(Ge,Xe,ct,yt){for(var pt,Lt=yt,Pt=ct-Xe>>1,gt=ct-Xe,zt=Ge[Xe],At=Ge[Xe+1],sr=Ge[ct],Yr=Ge[ct+1],ir=Xe+3;ir<ct;ir+=3){var Pi=W(Ge[ir],Ge[ir+1],zt,At,sr,Yr);if(Pi>Lt)pt=ir,Lt=Pi;else if(Pi===Lt){var $i=Math.abs(ir-Pt);$i<gt&&(pt=ir,gt=$i)}}Lt>yt&&(pt-Xe>3&&Oe(Ge,Xe,pt,yt),Ge[pt+2]=Lt,ct-pt>3&&Oe(Ge,pt,ct,yt))}function W(Ge,Xe,ct,yt,pt,Lt){var Pt=pt-ct,gt=Lt-yt;if(Pt!==0||gt!==0){var zt=((Ge-ct)*Pt+(Xe-yt)*gt)/(Pt*Pt+gt*gt);zt>1?(ct=pt,yt=Lt):zt>0&&(ct+=Pt*zt,yt+=gt*zt)}return(Pt=Ge-ct)*Pt+(gt=Xe-yt)*gt}function se(Ge,Xe,ct,yt){var pt={id:Ge===void 0?null:Ge,type:Xe,geometry:ct,tags:yt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Lt){var Pt=Lt.geometry,gt=Lt.type;if(gt==="Point"||gt==="MultiPoint"||gt==="LineString")de(Lt,Pt);else if(gt==="Polygon"||gt==="MultiLineString")for(var zt=0;zt<Pt.length;zt++)de(Lt,Pt[zt]);else if(gt==="MultiPolygon")for(zt=0;zt<Pt.length;zt++)for(var At=0;At<Pt[zt].length;At++)de(Lt,Pt[zt][At])}(pt),pt}function de(Ge,Xe){for(var ct=0;ct<Xe.length;ct+=3)Ge.minX=Math.min(Ge.minX,Xe[ct]),Ge.minY=Math.min(Ge.minY,Xe[ct+1]),Ge.maxX=Math.max(Ge.maxX,Xe[ct]),Ge.maxY=Math.max(Ge.maxY,Xe[ct+1])}function Fe(Ge,Xe,ct,yt){if(Xe.geometry){var pt=Xe.geometry.coordinates,Lt=Xe.geometry.type,Pt=Math.pow(ct.tolerance/((1<<ct.maxZoom)*ct.extent),2),gt=[],zt=Xe.id;if(ct.promoteId?zt=Xe.properties[ct.promoteId]:ct.generateId&&(zt=yt||0),Lt==="Point")Ze(pt,gt);else if(Lt==="MultiPoint")for(var At=0;At<pt.length;At++)Ze(pt[At],gt);else if(Lt==="LineString")nt(pt,gt,Pt,!1);else if(Lt==="MultiLineString"){if(ct.lineMetrics){for(At=0;At<pt.length;At++)nt(pt[At],gt=[],Pt,!1),Ge.push(se(zt,"LineString",gt,Xe.properties));return}Nt(pt,gt,Pt,!1)}else if(Lt==="Polygon")Nt(pt,gt,Pt,!0);else{if(Lt!=="MultiPolygon"){if(Lt==="GeometryCollection"){for(At=0;At<Xe.geometry.geometries.length;At++)Fe(Ge,{id:zt,geometry:Xe.geometry.geometries[At],properties:Xe.properties},ct,yt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(At=0;At<pt.length;At++){var sr=[];Nt(pt[At],sr,Pt,!0),gt.push(sr)}}Ge.push(se(zt,Lt,gt,Xe.properties))}}function Ze(Ge,Xe){Xe.push(He(Ge[0])),Xe.push(Ht(Ge[1])),Xe.push(0)}function nt(Ge,Xe,ct,yt){for(var pt,Lt,Pt=0,gt=0;gt<Ge.length;gt++){var zt=He(Ge[gt][0]),At=Ht(Ge[gt][1]);Xe.push(zt),Xe.push(At),Xe.push(0),gt>0&&(Pt+=yt?(pt*At-zt*Lt)/2:Math.sqrt(Math.pow(zt-pt,2)+Math.pow(At-Lt,2))),pt=zt,Lt=At}var sr=Xe.length-3;Xe[2]=1,Oe(Xe,0,sr,ct),Xe[sr+2]=1,Xe.size=Math.abs(Pt),Xe.start=0,Xe.end=Xe.size}function Nt(Ge,Xe,ct,yt){for(var pt=0;pt<Ge.length;pt++){var Lt=[];nt(Ge[pt],Lt,ct,yt),Xe.push(Lt)}}function He(Ge){return Ge/360+.5}function Ht(Ge){var Xe=Math.sin(Ge*Math.PI/180),ct=.5-.25*Math.log((1+Xe)/(1-Xe))/Math.PI;return ct<0?0:ct>1?1:ct}function Tt(Ge,Xe,ct,yt,pt,Lt,Pt,gt){if(yt/=Xe,Lt>=(ct/=Xe)&&Pt<yt)return Ge;if(Pt<ct||Lt>=yt)return null;for(var zt=[],At=0;At<Ge.length;At++){var sr=Ge[At],Yr=sr.geometry,ir=sr.type,Pi=pt===0?sr.minX:sr.minY,$i=pt===0?sr.maxX:sr.maxY;if(Pi>=ct&&$i<yt)zt.push(sr);else if(!($i<ct||Pi>=yt)){var Li=[];if(ir==="Point"||ir==="MultiPoint")Ut(Yr,Li,ct,yt,pt);else if(ir==="LineString")Rr(Yr,Li,ct,yt,pt,!1,gt.lineMetrics);else if(ir==="MultiLineString")Ui(Yr,Li,ct,yt,pt,!1);else if(ir==="Polygon")Ui(Yr,Li,ct,yt,pt,!0);else if(ir==="MultiPolygon")for(var gn=0;gn<Yr.length;gn++){var qn=[];Ui(Yr[gn],qn,ct,yt,pt,!0),qn.length&&Li.push(qn)}if(Li.length){if(gt.lineMetrics&&ir==="LineString"){for(gn=0;gn<Li.length;gn++)zt.push(se(sr.id,ir,Li[gn],sr.tags));continue}ir!=="LineString"&&ir!=="MultiLineString"||(Li.length===1?(ir="LineString",Li=Li[0]):ir="MultiLineString"),ir!=="Point"&&ir!=="MultiPoint"||(ir=Li.length===3?"Point":"MultiPoint"),zt.push(se(sr.id,ir,Li,sr.tags))}}}return zt.length?zt:null}function Ut(Ge,Xe,ct,yt,pt){for(var Lt=0;Lt<Ge.length;Lt+=3){var Pt=Ge[Lt+pt];Pt>=ct&&Pt<=yt&&(Xe.push(Ge[Lt]),Xe.push(Ge[Lt+1]),Xe.push(Ge[Lt+2]))}}function Rr(Ge,Xe,ct,yt,pt,Lt,Pt){for(var gt,zt,At=fi(Ge),sr=pt===0?$r:ii,Yr=Ge.start,ir=0;ir<Ge.length-3;ir+=3){var Pi=Ge[ir],$i=Ge[ir+1],Li=Ge[ir+2],gn=Ge[ir+3],qn=Ge[ir+4],ti=pt===0?Pi:$i,go=pt===0?gn:qn,Ro=!1;Pt&&(gt=Math.sqrt(Math.pow(Pi-gn,2)+Math.pow($i-qn,2))),ti<ct?go>ct&&(zt=sr(At,Pi,$i,gn,qn,ct),Pt&&(At.start=Yr+gt*zt)):ti>yt?go<yt&&(zt=sr(At,Pi,$i,gn,qn,yt),Pt&&(At.start=Yr+gt*zt)):gi(At,Pi,$i,Li),go<ct&&ti>=ct&&(zt=sr(At,Pi,$i,gn,qn,ct),Ro=!0),go>yt&&ti<=yt&&(zt=sr(At,Pi,$i,gn,qn,yt),Ro=!0),!Lt&&Ro&&(Pt&&(At.end=Yr+gt*zt),Xe.push(At),At=fi(Ge)),Pt&&(Yr+=gt)}var wi=Ge.length-3;Pi=Ge[wi],$i=Ge[wi+1],Li=Ge[wi+2],(ti=pt===0?Pi:$i)>=ct&&ti<=yt&&gi(At,Pi,$i,Li),wi=At.length-3,Lt&&wi>=3&&(At[wi]!==At[0]||At[wi+1]!==At[1])&&gi(At,At[0],At[1],At[2]),At.length&&Xe.push(At)}function fi(Ge){var Xe=[];return Xe.size=Ge.size,Xe.start=Ge.start,Xe.end=Ge.end,Xe}function Ui(Ge,Xe,ct,yt,pt,Lt){for(var Pt=0;Pt<Ge.length;Pt++)Rr(Ge[Pt],Xe,ct,yt,pt,Lt,!1)}function gi(Ge,Xe,ct,yt){Ge.push(Xe),Ge.push(ct),Ge.push(yt)}function $r(Ge,Xe,ct,yt,pt,Lt){var Pt=(Lt-Xe)/(yt-Xe);return Ge.push(Lt),Ge.push(ct+(pt-ct)*Pt),Ge.push(1),Pt}function ii(Ge,Xe,ct,yt,pt,Lt){var Pt=(Lt-ct)/(pt-ct);return Ge.push(Xe+(yt-Xe)*Pt),Ge.push(Lt),Ge.push(1),Pt}function yi(Ge,Xe){for(var ct=[],yt=0;yt<Ge.length;yt++){var pt,Lt=Ge[yt],Pt=Lt.type;if(Pt==="Point"||Pt==="MultiPoint"||Pt==="LineString")pt=ki(Lt.geometry,Xe);else if(Pt==="MultiLineString"||Pt==="Polygon"){pt=[];for(var gt=0;gt<Lt.geometry.length;gt++)pt.push(ki(Lt.geometry[gt],Xe))}else if(Pt==="MultiPolygon")for(pt=[],gt=0;gt<Lt.geometry.length;gt++){for(var zt=[],At=0;At<Lt.geometry[gt].length;At++)zt.push(ki(Lt.geometry[gt][At],Xe));pt.push(zt)}ct.push(se(Lt.id,Pt,pt,Lt.tags))}return ct}function ki(Ge,Xe){var ct=[];ct.size=Ge.size,Ge.start!==void 0&&(ct.start=Ge.start,ct.end=Ge.end);for(var yt=0;yt<Ge.length;yt+=3)ct.push(Ge[yt]+Xe,Ge[yt+1],Ge[yt+2]);return ct}function Fn(Ge,Xe){if(Ge.transformed)return Ge;var ct,yt,pt,Lt=1<<Ge.z,Pt=Ge.x,gt=Ge.y;for(ct=0;ct<Ge.features.length;ct++){var zt=Ge.features[ct],At=zt.geometry,sr=zt.type;if(zt.geometry=[],sr===1)for(yt=0;yt<At.length;yt+=2)zt.geometry.push(ji(At[yt],At[yt+1],Xe,Lt,Pt,gt));else for(yt=0;yt<At.length;yt++){var Yr=[];for(pt=0;pt<At[yt].length;pt+=2)Yr.push(ji(At[yt][pt],At[yt][pt+1],Xe,Lt,Pt,gt));zt.geometry.push(Yr)}}return Ge.transformed=!0,Ge}function ji(Ge,Xe,ct,yt,pt,Lt){return[Math.round(ct*(Ge*yt-pt)),Math.round(ct*(Xe*yt-Lt))]}function _o(Ge,Xe,ct,yt,pt){for(var Lt=Xe===pt.maxZoom?0:pt.tolerance/((1<<Xe)*pt.extent),Pt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ct,y:yt,z:Xe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},gt=0;gt<Ge.length;gt++){Pt.numFeatures++,jn(Pt,Ge[gt],Lt,pt);var zt=Ge[gt].minX,At=Ge[gt].minY,sr=Ge[gt].maxX,Yr=Ge[gt].maxY;zt<Pt.minX&&(Pt.minX=zt),At<Pt.minY&&(Pt.minY=At),sr>Pt.maxX&&(Pt.maxX=sr),Yr>Pt.maxY&&(Pt.maxY=Yr)}return Pt}function jn(Ge,Xe,ct,yt){var pt=Xe.geometry,Lt=Xe.type,Pt=[];if(Lt==="Point"||Lt==="MultiPoint")for(var gt=0;gt<pt.length;gt+=3)Pt.push(pt[gt]),Pt.push(pt[gt+1]),Ge.numPoints++,Ge.numSimplified++;else if(Lt==="LineString")So(Pt,pt,Ge,ct,!1,!1);else if(Lt==="MultiLineString"||Lt==="Polygon")for(gt=0;gt<pt.length;gt++)So(Pt,pt[gt],Ge,ct,Lt==="Polygon",gt===0);else if(Lt==="MultiPolygon")for(var zt=0;zt<pt.length;zt++){var At=pt[zt];for(gt=0;gt<At.length;gt++)So(Pt,At[gt],Ge,ct,!0,gt===0)}if(Pt.length){var sr=Xe.tags||null;if(Lt==="LineString"&&yt.lineMetrics){for(var Yr in sr={},Xe.tags)sr[Yr]=Xe.tags[Yr];sr.mapbox_clip_start=pt.start/pt.size,sr.mapbox_clip_end=pt.end/pt.size}var ir={geometry:Pt,type:Lt==="Polygon"||Lt==="MultiPolygon"?3:Lt==="LineString"||Lt==="MultiLineString"?2:1,tags:sr};Xe.id!==null&&(ir.id=Xe.id),Ge.features.push(ir)}}function So(Ge,Xe,ct,yt,pt,Lt){var Pt=yt*yt;if(yt>0&&Xe.size<(pt?Pt:yt))ct.numPoints+=Xe.length/3;else{for(var gt=[],zt=0;zt<Xe.length;zt+=3)(yt===0||Xe[zt+2]>Pt)&&(ct.numSimplified++,gt.push(Xe[zt]),gt.push(Xe[zt+1])),ct.numPoints++;pt&&function(At,sr){for(var Yr=0,ir=0,Pi=At.length,$i=Pi-2;ir<Pi;$i=ir,ir+=2)Yr+=(At[ir]-At[$i])*(At[ir+1]+At[$i+1]);if(Yr>0===sr)for(ir=0,Pi=At.length;ir<Pi/2;ir+=2){var Li=At[ir],gn=At[ir+1];At[ir]=At[Pi-2-ir],At[ir+1]=At[Pi-1-ir],At[Pi-2-ir]=Li,At[Pi-1-ir]=gn}}(gt,Lt),Ge.push(gt)}}function Tn(Ge,Xe){var ct=(Xe=this.options=function(pt,Lt){for(var Pt in Lt)pt[Pt]=Lt[Pt];return pt}(Object.create(this.options),Xe)).debug;if(ct&&console.time("preprocess data"),Xe.maxZoom<0||Xe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Xe.promoteId&&Xe.generateId)throw new Error("promoteId and generateId cannot be used together.");var yt=function(pt,Lt){var Pt=[];if(pt.type==="FeatureCollection")for(var gt=0;gt<pt.features.length;gt++)Fe(Pt,pt.features[gt],Lt,gt);else Fe(Pt,pt.type==="Feature"?pt:{geometry:pt},Lt);return Pt}(Ge,Xe);this.tiles={},this.tileCoords=[],ct&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Xe.indexMaxZoom,Xe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(yt=function(pt,Lt){var Pt=Lt.buffer/Lt.extent,gt=pt,zt=Tt(pt,1,-1-Pt,Pt,0,-1,2,Lt),At=Tt(pt,1,1-Pt,2+Pt,0,-1,2,Lt);return(zt||At)&&(gt=Tt(pt,1,-Pt,1+Pt,0,-1,2,Lt)||[],zt&&(gt=yi(zt,1).concat(gt)),At&&(gt=gt.concat(yi(At,-1)))),gt}(yt,Xe)).length&&this.splitTile(yt,0,0,0),ct&&(yt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function En(Ge,Xe,ct){return 32*((1<<Ge)*ct+Xe)+Ge}return Tn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Tn.prototype.splitTile=function(Ge,Xe,ct,yt,pt,Lt,Pt){for(var gt=[Ge,Xe,ct,yt],zt=this.options,At=zt.debug;gt.length;){yt=gt.pop(),ct=gt.pop(),Xe=gt.pop(),Ge=gt.pop();var sr=1<<Xe,Yr=En(Xe,ct,yt),ir=this.tiles[Yr];if(!ir&&(At>1&&console.time("creation"),ir=this.tiles[Yr]=_o(Ge,Xe,ct,yt,zt),this.tileCoords.push({z:Xe,x:ct,y:yt}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Xe,ct,yt,ir.numFeatures,ir.numPoints,ir.numSimplified),console.timeEnd("creation"));var Pi="z"+Xe;this.stats[Pi]=(this.stats[Pi]||0)+1,this.total++}if(ir.source=Ge,pt){if(Xe===zt.maxZoom||Xe===pt)continue;var $i=1<<pt-Xe;if(ct!==Math.floor(Lt/$i)||yt!==Math.floor(Pt/$i))continue}else if(Xe===zt.indexMaxZoom||ir.numPoints<=zt.indexMaxPoints)continue;if(ir.source=null,Ge.length!==0){At>1&&console.time("clipping");var Li,gn,qn,ti,go,Ro,wi=.5*zt.buffer/zt.extent,Da=.5-wi,Es=.5+wi,Oo=1+wi;Li=gn=qn=ti=null,go=Tt(Ge,sr,ct-wi,ct+Es,0,ir.minX,ir.maxX,zt),Ro=Tt(Ge,sr,ct+Da,ct+Oo,0,ir.minX,ir.maxX,zt),Ge=null,go&&(Li=Tt(go,sr,yt-wi,yt+Es,1,ir.minY,ir.maxY,zt),gn=Tt(go,sr,yt+Da,yt+Oo,1,ir.minY,ir.maxY,zt),go=null),Ro&&(qn=Tt(Ro,sr,yt-wi,yt+Es,1,ir.minY,ir.maxY,zt),ti=Tt(Ro,sr,yt+Da,yt+Oo,1,ir.minY,ir.maxY,zt),Ro=null),At>1&&console.timeEnd("clipping"),gt.push(Li||[],Xe+1,2*ct,2*yt),gt.push(gn||[],Xe+1,2*ct,2*yt+1),gt.push(qn||[],Xe+1,2*ct+1,2*yt),gt.push(ti||[],Xe+1,2*ct+1,2*yt+1)}}},Tn.prototype.getTile=function(Ge,Xe,ct){var yt=this.options,pt=yt.extent,Lt=yt.debug;if(Ge<0||Ge>24)return null;var Pt=1<<Ge,gt=En(Ge,Xe=(Xe%Pt+Pt)%Pt,ct);if(this.tiles[gt])return Fn(this.tiles[gt],pt);Lt>1&&console.log("drilling down to z%d-%d-%d",Ge,Xe,ct);for(var zt,At=Ge,sr=Xe,Yr=ct;!zt&&At>0;)At--,sr=Math.floor(sr/2),Yr=Math.floor(Yr/2),zt=this.tiles[En(At,sr,Yr)];return zt&&zt.source?(Lt>1&&console.log("found parent tile z%d-%d-%d",At,sr,Yr),Lt>1&&console.time("drilling down"),this.splitTile(zt.source,At,sr,Yr,Ge,Xe,ct),Lt>1&&console.timeEnd("drilling down"),this.tiles[gt]?Fn(this.tiles[gt],pt):null):null},function(Ge,Xe){return new Tn(Ge,Xe)}}();var bt=s.dK(lr.exports);function Qt(Oe,W){const se=Oe.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const de=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!de)return W(null,null);const Fe=new dt(de.features);let Ze=gr(Fe);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),W(null,{vectorTile:Fe,rawData:Ze.buffer})}class Dt extends lt{constructor(W,se,de,Fe,Ze,nt){super(W,se,de,Fe,Qt,nt),Ze&&(this.loadGeoJSON=Ze)}loadData(W,se){const de=W&&W.request,Fe=de&&de.collectResourceTiming;this.loadGeoJSON(W,(Ze,nt)=>{if(Ze||!nt)return se(Ze);if(typeof nt!="object")return se(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{hr(nt,!0);try{if(W.filter){const He=s.r(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(He.result==="error")throw new Error(He.value.map(Tt=>`${Tt.key}: ${Tt.message}`).join(", "));nt={type:"FeatureCollection",features:nt.features.filter(Tt=>He.value.evaluate({zoom:0},Tt))}}this._geoJSONIndex=W.cluster?new ge(function({superclusterOptions:He,clusterProperties:Ht}){if(!Ht||!He)return He;const Tt={},Ut={},Rr={accumulated:null,zoom:0},fi={properties:null},Ui=Object.keys(Ht);for(const gi of Ui){const[$r,ii]=Ht[gi],yi=s.r(ii),ki=s.r(typeof $r=="string"?[$r,["accumulated"],["get",gi]]:$r);Tt[gi]=yi.value,Ut[gi]=ki.value}return He.map=gi=>{fi.properties=gi;const $r={};for(const ii of Ui)$r[ii]=Tt[ii].evaluate(Rr,fi);return $r},He.reduce=(gi,$r)=>{fi.properties=$r;for(const ii of Ui)Rr.accumulated=gi[ii],gi[ii]=Ut[ii].evaluate(Rr,fi)},He}(W)).load(nt.features):bt(nt,W.geojsonVtOptions)}catch(He){return se(He)}this.loaded={};const Nt={};if(Fe){const He=K(de);He&&(Nt.resourceTiming={},Nt.resourceTiming[W.source]=JSON.parse(JSON.stringify(He)))}se(null,Nt)}})}reloadTile(W,se){const de=this.loaded;return de&&de[W.uid]?super.reloadTile(W,se):this.loadTile(W,se)}loadGeoJSON(W,se){if(W.request)s.g(W.request,se);else{if(typeof W.data!="string")return se(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return se(null,JSON.parse(W.data))}catch{return se(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(de){se(de)}}getClusterChildren(W,se){try{se(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(de){se(de)}}getClusterLeaves(W,se){try{se(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(de){se(de)}}}class cr{constructor(W,se){this.tileID=new s.am(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=se}parse(W,se,de,Fe){this.status="parsing";const Ze=new s.am(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),nt={},Nt=se.familiesBySource[de.source],He=new s.dC(Ze,de.promoteId);return He.bucketLayerIDs=[],He.is3DTile=!0,s.dP(W).then(Ht=>{if(!Ht)return Fe(new Error("Could not parse tile"));const Tt=s.dQ(Ht,1/s.bR(de.tileID.canonical)),Ut=Ht.json.extensionsUsed&&Ht.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ht.json.asset.extras&&Ht.json.asset.extras.MAPBOX_mesh_features,Rr=Ht.json.extensionsUsed&&Ht.json.extensionsUsed.includes("EXT_meshopt_compression"),fi=new s.K(this.zoom,{brightness:this.brightness});for(const Ui in Nt)for(const gi of Nt[Ui]){const $r=gi[0];He.bucketLayerIDs.push(gi.map(yi=>yi.id)),$r.recalculate(fi,[]);const ii=new s.dR(Tt,Ze,Ut,Rr,this.brightness,He);Ut||(ii.needsUpload=!0),nt[$r.fqid]=ii,ii.evaluate($r)}this.status="done",Fe(null,{buckets:nt,featureIndex:He})}).catch(Ht=>Fe(new Error(Ht.message)))}}class Er{constructor(W,se,de,Fe,Ze,nt){this.actor=W,this.layerIndex=se,this.brightness=nt,this.loading={},this.loaded={}}loadTile(W,se){const de=W.uid,Fe=this.loading[de]=new cr(W,this.brightness);s.a_(W.request,(Ze,nt)=>{const Nt=!this.loading[de];return delete this.loading[de],Nt||Ze?(Fe.status="done",Nt||(this.loaded[de]=Fe),se(Ze)):nt&&nt.byteLength!==0?void Fe.parse(nt,this.layerIndex,W,(He,Ht)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[de]=Fe,He||!Ht?se(He):se(null,Ht)}):(Fe.status="done",this.loaded[de]=Fe,se())})}reloadTile(W,se){const de=this.loaded,Fe=W.uid;if(de&&de[Fe]){const Ze=de[Fe];Ze.projection=W.projection,Ze.brightness=W.brightness;const nt=(Nt,He)=>{Ze.reloadCallback&&(delete Ze.reloadCallback,this.loadTile(W,se)),se(Nt,He)};Ze.status==="parsing"?Ze.reloadCallback=nt:Ze.status==="done"&&this.loadTile(W,se)}}abortTile(W,se){const de=W.uid;this.loading[de]&&delete this.loading[de],se()}removeTile(W,se){const de=this.loaded,Fe=W.uid;de&&de[Fe]&&delete de[Fe],se()}}class Sr{constructor(W){this.self=W,this.actor=new s.dS(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.bo({name:"mercator"}),this.workerSourceTypes={vector:lt,geojson:Dt,"batched-model":Er},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(se,de)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=de},this.self.registerRTLTextPlugin=se=>{if(s.dT.isParsed())throw new Error("RTL text plugin already registered.");s.dT.applyArabicShaping=se.applyArabicShaping,s.dT.processBidirectionalText=se.processBidirectionalText,s.dT.processStyledBidirectionalText=se.processStyledBidirectionalText}}clearCaches(W,se,de){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],delete this.rasterArrayWorkerSource,de()}checkIfReady(W,se,de){de()}setReferrer(W,se){this.referrer=se}spriteLoaded(W,{scope:se,isLoaded:de}){if(this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),this.isSpriteLoaded[W][se]=de,this.workerSources[W]&&this.workerSources[W][se])for(const Fe in this.workerSources[W][se]){const Ze=this.workerSources[W][se][Fe];for(const nt in Ze)Ze[nt]instanceof lt&&(Ze[nt].isSpriteLoaded=de,Ze[nt].fire(new s.b("isSpriteLoaded")))}}setImages(W,{scope:se,images:de},Fe){if(this.availableImages[W]||(this.availableImages[W]={}),this.availableImages[W][se]=de,this.workerSources[W]&&this.workerSources[W][se]){for(const Ze in this.workerSources[W][se]){const nt=this.workerSources[W][se][Ze];for(const Nt in nt)nt[Nt].availableImages=de}Fe()}else Fe()}setProjection(W,se){this.projections[W]=s.bo(se)}setBrightness(W,se,de){this.brightness=se,de()}setLayers(W,se,de){this.getLayerIndex(W,se.scope).replace(se.layers,se.options),de()}updateLayers(W,se,de){this.getLayerIndex(W,se.scope).update(se.layers,se.removedIds,se.options),de()}loadTile(W,se,de){se.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,se.type,se.source,se.scope).loadTile(se,de)}loadDEMTile(W,se,de){this.getDEMWorkerSource(W,se.source,se.scope).loadTile(se,de)}decodeRasterArray(W,se,de){this.getRasterArrayWorkerSource().decodeRasterArray(se,de)}reloadTile(W,se,de){se.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,se.type,se.source,se.scope).reloadTile(se,de)}abortTile(W,se,de){this.getWorkerSource(W,se.type,se.source,se.scope).abortTile(se,de)}removeTile(W,se,de){this.getWorkerSource(W,se.type,se.source,se.scope).removeTile(se,de)}removeSource(W,se,de){if(!(this.workerSources[W]&&this.workerSources[W][se.scope]&&this.workerSources[W][se.scope][se.type]&&this.workerSources[W][se.scope][se.type][se.source]))return;const Fe=this.workerSources[W][se.scope][se.type][se.source];delete this.workerSources[W][se.scope][se.type][se.source],Fe.removeSource!==void 0?Fe.removeSource(se,de):de()}loadWorkerSource(W,se,de){try{this.self.importScripts(se.url),de()}catch(Fe){de(Fe.toString())}}syncRTLPluginState(W,se,de){try{s.dT.setState(se);const Fe=s.dT.getPluginURL();if(s.dT.isLoaded()&&!s.dT.isParsed()&&Fe!=null){this.self.importScripts(Fe);const Ze=s.dT.isParsed();de(Ze?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Fe}`),Ze)}}catch(Fe){de(Fe.toString())}}setDracoUrl(W,se){this.dracoUrl=se}getAvailableImages(W,se){this.availableImages[W]||(this.availableImages[W]={});let de=this.availableImages[W][se];return de||(de=[]),de}getLayerIndex(W,se){this.layerIndexes[W]||(this.layerIndexes[W]={});let de=this.layerIndexes[W][se];return de||(de=this.layerIndexes[W][se]=new we,de.scope=se),de}getWorkerSource(W,se,de,Fe){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Fe]||(this.workerSources[W][Fe]={}),this.workerSources[W][Fe][se]||(this.workerSources[W][Fe][se]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),!this.workerSources[W][Fe][se][de]){const Ze={send:(nt,Nt,He,Ht,Tt,Ut)=>{this.actor.send(nt,Nt,He,W,Tt,Ut)},scheduler:this.actor.scheduler};this.workerSources[W][Fe][se][de]=new this.workerSourceTypes[se](Ze,this.getLayerIndex(W,Fe),this.getAvailableImages(W,Fe),this.isSpriteLoaded[W][Fe],void 0,this.brightness)}return this.workerSources[W][Fe][se][de]}getDEMWorkerSource(W,se,de){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][de]||(this.demWorkerSources[W][de]={}),this.demWorkerSources[W][de][se]||(this.demWorkerSources[W][de][se]=new $t),this.demWorkerSources[W][de][se]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new It),this.rasterArrayWorkerSource}enforceCacheSizeLimit(W,se){s.dU(se)}getWorkerPerformanceMetrics(W,se,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Sr(self)),Sr}),z(["./shared"],function(s){function K(u,i){if(Array.isArray(u)){if(!Array.isArray(i)||u.length!==i.length)return!1;for(let o=0;o<u.length;o++)if(!K(u[o],i[o]))return!1;return!0}if(typeof u=="object"&&u!==null&&i!==null){if(typeof i!="object"||Object.keys(u).length!==Object.keys(i).length)return!1;for(const o in u)if(!K(u[o],i[o]))return!1;return!0}return u===i}var Q=re;function re(u){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,p,_=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(_);try{p=new Worker(x),h=!0}catch{h=!1}return p&&p.terminate(),URL.revokeObjectURL(x),h}()?function(){var h=document.createElement("canvas");h.width=h.height=1;var p=h.getContext("2d");if(!p)return!1;var _=p.getImageData(0,0,1,1);return _&&_.width===h.width}()?(we[o=i&&i.failIfMajorPerformanceCaveat]===void 0&&(we[o]=function(h){var p,_=function(x){var T=document.createElement("canvas"),M=Object.create(re.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=x,T.getContext("webgl2",M)}(h);if(!_)return!1;try{p=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!p||_.isContextLost())&&(_.shaderSource(p,"void main() {}"),_.compileShader(p),_.getShaderParameter(p,_.COMPILE_STATUS)===!0)}(o)),we[o]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var o}(u)}var we={};function Ee(u,i,o){const h=document.createElement(u);return i!=null&&(h.className=i),o&&o.appendChild(h),h}function Me(u,i,o){const h=document.createElementNS("http://www.w3.org/2000/svg",u);for(const p of Object.keys(i))h.setAttributeNS(null,p,String(i[p]));return o&&o.appendChild(h),h}re.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ce=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ue=Ce&&Ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let lt;function $t(){Ce&&Ue&&(lt=Ce[Ue],Ce[Ue]="none")}function It(){Ce&&Ue&&(Ce[Ue]=lt)}function yr(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",yr,!0)}function zr(){window.addEventListener("click",yr,!0),window.setTimeout(()=>{window.removeEventListener("click",yr,!0)},0)}function hr(u,i){const o=u.getBoundingClientRect();return dt(u,o,i)}function Ai(u,i){const o=u.getBoundingClientRect(),h=[];for(let p=0;p<i.length;p++)h.push(dt(u,o,i[p]));return h}function Ii(u){return window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function dt(u,i,o){const h=u.offsetWidth===i.width?1:u.offsetWidth/i.width;return new s.P((o.clientX-i.left)*h,(o.clientY-i.top)*h)}class Cn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,o){this._updatedSourceCaches[i]=o,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const o=i.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(i.id),this.setDirty()}removeLayer(i){const o=i.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][i.id]=i,this._updatedLayers[o].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const o in this._updatedLayers)i[o]=i[o]||{},i[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)i[o]=i[o]||{},i[o].removedIds=Object.keys(this._removedLayers[o]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Kn extends s.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,o){return s.l(this.requestManager.transformRequest(o,s.R.Model).url).then(h=>{if(!h)return;const p=s.c(h),_=new s.M(i,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(h=>{this.fire(new s.a(new Error(`Could not load model ${i} from ${o}: ${h.message}`)))})}load(i,o){this.models[o]||(this.models[o]={});const h=Object.keys(i);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+h.length;const p=[];for(const _ of h)p.push(this.loadModel(_,i[_]));Promise.allSettled(p).then(_=>{for(let x=0;x<_.length;x++){const{status:T,value:M}=_[x];T==="fulfilled"&&M&&(this.models[o][h[x]]=M)}this.numModelsLoading[o]-=h.length,this.fire(new s.b("data",{dataType:"style"}))}).catch(_=>{this.fire(new s.a(new Error(`Could not load models: ${_.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,o){return!!this.getModel(i,o)}getModel(i,o){return this.models[o]||(this.models[o]={}),this.models[o][i]}addModel(i,o,h){this.models[h]||(this.models[h]={}),this.hasModel(i,h)&&this.removeModel(i,h),this.load({[i]:this.requestManager.normalizeModelURL(o)},h)}addModels(i,o){const h={};for(const p in i)h[p]=this.requestManager.normalizeModelURL(i[p]);this.load(h,o)}removeModel(i,o){this.models[o]||(this.models[o]={});const h=this.models[o][i];delete this.models[o][i],h.destroy()}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,o){this.models[o]||(this.models[o]={});for(const h in this.models[o])this.models[o][h].upload(i.context)}}class br{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,o,h){const p=String(o);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][p]=this.stateChanges[i][p]||{},s.e(this.stateChanges[i][p],h),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==p&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][p]===null){this.deletedStates[i][p]={};for(const _ in this.state[i][p])h[_]||(this.deletedStates[i][p][_]=null)}else for(const _ in h)this.deletedStates[i]&&this.deletedStates[i][p]&&this.deletedStates[i][p][_]===null&&delete this.deletedStates[i][p][_]}removeFeatureState(i,o,h){if(this.deletedStates[i]===null)return;const p=String(o);if(this.deletedStates[i]=this.deletedStates[i]||{},h&&o!==void 0)this.deletedStates[i][p]!==null&&(this.deletedStates[i][p]=this.deletedStates[i][p]||{},this.deletedStates[i][p][h]=null);else if(o!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][p])for(h in this.deletedStates[i][p]={},this.stateChanges[i][p])this.deletedStates[i][p][h]=null;else this.deletedStates[i][p]=null;else this.deletedStates[i]=null}getState(i,o){const h=String(o),p=s.e({},(this.state[i]||{})[h],(this.stateChanges[i]||{})[h]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][o];if(_===null)return{};for(const x in _)delete p[x]}return p}initializeTileState(i,o){i.setFeatureState(this.state,o)}coalesceChanges(i,o){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.e(this.state[p][x],this.stateChanges[p][x]),_[x]=this.state[p][x];h[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const x in this.state[p])_[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else if(this.state[p][x])for(const T of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][T];_[x]=this.state[p][x]}h[p]=h[p]||{},s.e(h[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in i)i[p].setFeatureState(h,o)}}function zi(u){const{userImage:i}=u;return!!(i&&i.render&&i.render())&&(u.data.replace(new Uint8Array(i.data.buffer)),!0)}class Jn extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new s.h({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,o){if(this.loaded[o]!==i&&(this.loaded[o]=i,i)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,o,p);this.requestors=[]}}hasImage(i,o){return!!this.getImage(i,o)}getImage(i,o){return this.images[o][i]}addImage(i,o,h){this._validate(i,h)&&(this.images[o][i]=h)}_validate(i,o){let h=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new s.a(new Error(`Image "${i}" has invalid "content" value`))),h=!1),h}_validateStretch(i,o){if(!i)return!0;let h=0;for(const p of i){if(p[0]<h||p[1]<p[0]||o<p[1])return!1;h=p[1]}return!0}_validateContent(i,o){return!(i&&(i.length!==4||i[0]<0||o.data.width<i[0]||i[1]<0||o.data.height<i[1]||i[2]<0||o.data.width<i[2]||i[3]<0||o.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,o,h){h.version=this.images[o][i].version+1,this.images[o][i]=h,this.updatedImages[o][i]=!0}removeImage(i,o){const h=this.images[o][i];delete this.images[o][i],delete this.patterns[o][i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,o,h){let p=!0;const _=!!this.loaded[o];if(!_)for(const x of i)this.images[o][x]||(p=!1);_||p?this._notify(i,o,h):this.requestors.push({ids:i,scope:o,callback:h})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,o,h){const p={};for(const _ of i){this.images[o][_]||this.fire(new s.b("styleimagemissing",{id:_}));const x=this.images[o][_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(i){const{width:o,height:h}=this.atlasImage[i];return{width:o,height:h}}getPattern(i,o){const h=this.patterns[o][i],p=this.getImage(i,o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new s.I(_,p);this.patterns[o][i]={bin:_,position:x}}return this._updatePatternAtlas(o),this.patterns[o][i].position}bind(i,o){const h=i.gl;let p=this.atlasTexture[o];p?this.dirty&&(p.update(this.atlasImage[o]),this.dirty=!1):(p=new s.T(i,this.atlasImage[o],h.RGBA),this.atlasTexture[o]=p),p.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(i){const o=[];for(const x in this.patterns[i])o.push(this.patterns[i][x].bin);const{w:h,h:p}=s.p(o),_=this.atlasImage[i];_.resize({width:h||1,height:p||1});for(const x in this.patterns[i]){const{bin:T}=this.patterns[i][x],M=T.x+1,I=T.y+1,L=this.images[i][x].data,O=L.width,F=L.height;s.h.copy(L,_,{x:0,y:0},{x:M,y:I},{width:O,height:F}),s.h.copy(L,_,{x:0,y:F-1},{x:M,y:I-1},{width:O,height:1}),s.h.copy(L,_,{x:0,y:0},{x:M,y:I+F},{width:O,height:1}),s.h.copy(L,_,{x:O-1,y:0},{x:M-1,y:I},{width:1,height:F}),s.h.copy(L,_,{x:0,y:0},{x:M+O,y:I},{width:1,height:F})}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,o){for(const h of i){if(this.callbackDispatchedThisFrame[o][h])continue;this.callbackDispatchedThisFrame[o][h]=!0;const p=this.images[o][h];zi(p)&&this.updateImage(h,o,p)}}}class Ct{constructor(i,o,h,p){this.message=(i?`${i}: `:"")+h,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}class Ci extends Ct{}function Jr(u){const i=u.key,o=u.value,h=u.valueSpec||{},p=u.objectElementValidators||{},_=u.style,x=u.styleSpec;let T=[];const M=s.i(o);if(M!=="object")return[new Ct(i,o,`object expected, ${M} found`)];for(const I in o){const L=I.split(".")[0];let O;p[L]?O=p[L]:h[L]?O=bt:p["*"]?O=p["*"]:h["*"]&&(O=bt),O?T=T.concat(O({key:(i&&`${i}.`)+I,value:o[I],valueSpec:h[L]||h["*"],style:_,styleSpec:x,object:o,objectKey:I},o)):T.push(new Ci(i,o[I],`unknown property "${I}"`))}for(const I in h)p[I]||h[I].required&&h[I].default===void 0&&o[I]===void 0&&T.push(new Ct(i,o,`missing required property "${I}"`));return T}function Zt(u){const i=u.value,o=u.valueSpec,h=u.style,p=u.styleSpec,_=u.key,x=u.arrayElementValidator||bt;if(s.i(i)!=="array")return[new Ct(_,i,`array expected, ${s.i(i)} found`)];if(o.length&&i.length!==o.length)return[new Ct(_,i,`array length ${o.length} expected, length ${i.length} found`)];if(o["min-length"]&&i.length<o["min-length"])return[new Ct(_,i,`array length at least ${o["min-length"]} expected, length ${i.length} found`)];let T={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};p.$version<7&&(T.function=o.function),s.i(o.value)==="object"&&(T=o.value);let M=[];for(let I=0;I<i.length;I++)M=M.concat(x({array:i,arrayIndex:I,value:i[I],valueSpec:T,style:h,styleSpec:p,key:`${_}[${I}]`},!0));return M}function Pn(u){const i=u.key,o=u.value,h=u.valueSpec;let p=s.i(o);if(p==="number"&&o!=o&&(p="NaN"),p!=="number")return[new Ct(i,o,`number expected, ${p} found`)];if("minimum"in h){let _=h.minimum;if(s.i(h.minimum)==="array"&&(_=h.minimum[u.arrayIndex]),o<_)return[new Ct(i,o,`${o} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if(s.i(h.maximum)==="array"&&(_=h.maximum[u.arrayIndex]),o>_)return[new Ct(i,o,`${o} is greater than the maximum value ${_}`)]}return[]}function kn(u){const i=u.valueSpec,o=s.u(u.value.type);let h,p,_,x={};const T=o!=="categorical"&&u.value.property===void 0,M=!T,I=s.i(u.value.stops)==="array"&&s.i(u.value.stops[0])==="array"&&s.i(u.value.stops[0][0])==="object",L=Jr({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(N){if(o==="identity")return[new Ct(N.key,N.value,'identity function may not have a "stops" property')];let q=[];const $=N.value;return q=q.concat(Zt({key:N.key,value:$,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:O})),s.i($)==="array"&&$.length===0&&q.push(new Ct(N.key,$,"array must have at least one stop")),q},default:function(N){return bt({key:N.key,value:N.value,valueSpec:i,style:N.style,styleSpec:N.styleSpec})}}});return o==="identity"&&T&&L.push(new Ct(u.key,u.value,'missing required property "property"')),o==="identity"||u.value.stops||L.push(new Ct(u.key,u.value,'missing required property "stops"')),o==="exponential"&&u.valueSpec.expression&&!s.s(u.valueSpec)&&L.push(new Ct(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(M&&!s.k(u.valueSpec)?L.push(new Ct(u.key,u.value,"property functions not supported")):T&&!s.m(u.valueSpec)&&L.push(new Ct(u.key,u.value,"zoom functions not supported"))),o!=="categorical"&&!I||u.value.property!==void 0||L.push(new Ct(u.key,u.value,'"property" property is required')),L;function O(N){let q=[];const $=N.value,Z=N.key;if(s.i($)!=="array")return[new Ct(Z,$,`array expected, ${s.i($)} found`)];if($.length!==2)return[new Ct(Z,$,`array length 2 expected, length ${$.length} found`)];if(I){if(s.i($[0])!=="object")return[new Ct(Z,$,`object expected, ${s.i($[0])} found`)];if($[0].zoom===void 0)return[new Ct(Z,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Ct(Z,$,"object stop key must have value")];const V=s.u($[0].zoom);if(typeof V!="number")return[new Ct(Z,$[0].zoom,"stop zoom values must be numbers")];if(_&&_>V)return[new Ct(Z,$[0].zoom,"stop zoom values must appear in ascending order")];V!==_&&(_=V,p=void 0,x={}),q=q.concat(Jr({key:`${Z}[0]`,value:$[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:Pn,value:F}}))}else q=q.concat(F({key:`${Z}[0]`,value:$[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},$));return s.n(s.o($[1]))?q.concat([new Ct(`${Z}[1]`,$[1],"expressions are not allowed in function stops.")]):q.concat(bt({key:`${Z}[1]`,value:$[1],valueSpec:i,style:N.style,styleSpec:N.styleSpec}))}function F(N,q){const $=s.i(N.value),Z=s.u(N.value),V=N.value!==null?N.value:q;if(h){if($!==h)return[new Ct(N.key,V,`${$} stop domain type must match previous stop domain type ${h}`)]}else h=$;if($!=="number"&&$!=="string"&&$!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new Ct(N.key,V,"stop domain value must be a number, string, or boolean")];if($!=="number"&&o!=="categorical"){let X=`number expected, ${$} found`;return s.k(i)&&o===void 0&&(X+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ct(N.key,V,X)]}return o!=="categorical"||$!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?o!=="categorical"&&$==="number"&&typeof Z=="number"&&typeof p=="number"&&p!==void 0&&Z<p?[new Ct(N.key,V,"stop domain values must appear in ascending order")]:(p=Z,o==="categorical"&&Z in x?[new Ct(N.key,V,"stop domain values must be unique")]:(x[Z]=!0,[])):[new Ct(N.key,V,`integer expected, found ${String(Z)}`)]}}function nn(u){const i=(u.expressionContext==="property"?s.q:s.r)(s.o(u.value),u.valueSpec);if(i.result==="error")return i.value.map(h=>new Ct(`${u.key}${h.key}`,u.value,h.message));const o=i.value.expression||i.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!o.outputDefined())return[new Ct(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!s.t(o))return[new Ct(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return _r(o,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!s.v(o,["zoom","feature-state"]))return[new Ct(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!s.x(o))return[new Ct(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _r(u,i){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const p of i.valueSpec.expression.parameters)o.delete(p);if(o.size===0)return[];const h=[];return u instanceof s.C&&o.has(u.name)?[new Ct(i.key,i.value,`["${u.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(u.eachChild(p=>{h.push(..._r(p,i))}),h)}function rr(u){const i=u.key,o=u.value,h=u.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(s.u(o))===-1&&p.push(new Ct(i,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(s.u(o))===-1&&p.push(new Ct(i,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function pr(u){return s.z(s.o(u.value))?nn(s.j({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):Ir(u)}function Ir(u){const i=u.value,o=u.key;if(s.i(i)!=="array")return[new Ct(o,i,`array expected, ${s.i(i)} found`)];const h=u.styleSpec;let p,_=[];if(i.length<1)return[new Ct(o,i,"filter array must have at least 1 element")];switch(_=_.concat(rr({key:`${o}[0]`,value:i[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),s.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&s.u(i[1])==="$type"&&_.push(new Ct(o,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&_.push(new Ct(o,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=s.i(i[1]),p!=="string"&&_.push(new Ct(`${o}[1]`,i[1],`string expected, ${p} found`)));for(let x=2;x<i.length;x++)p=s.i(i[x]),s.u(i[1])==="$type"?_=_.concat(rr({key:`${o}[${x}]`,value:i[x],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Ct(`${o}[${x}]`,i[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)_=_.concat(Ir({key:`${o}[${x}]`,value:i[x],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":p=s.i(i[1]),i.length!==2?_.push(new Ct(o,i,`filter array for "${i[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Ct(`${o}[1]`,i[1],`string expected, ${p} found`))}return _}function gr(u,i){const o=u.key,h=u.style,p=u.layer,_=u.styleSpec,x=u.value,T=u.objectKey,M=_[`${i}_${u.layerType}`];if(!M)return[];const I=T.match(/^(.*)-transition$/);if(i==="paint"&&I&&M[I[1]]&&M[I[1]].transition)return bt({key:o,value:x,valueSpec:_.transition,style:h,styleSpec:_});const L=u.valueSpec||M[T];if(!L)return[new Ci(o,x,`unknown property "${T}"`)];let O;if(s.i(x)==="string"&&s.k(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(x))){const N=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new Ct(o,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${N}.`)]}const F=[];if(u.layerType==="symbol")T!=="text-field"||!h||h.glyphs||h.imports||F.push(new Ct(o,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&s.A(s.o(x))&&s.u(x.type)==="identity"&&F.push(new Ct(o,x,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&i==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&s.k(L)&&(s.B(L)||s.m(L))){const N=s.q(s.o(x),L),q=N.value.expression||N.value._styleExpression.expression;q&&!s.v(q,["measure-light"])&&(T==="model-emissive-strength"&&s.x(q)&&s.t(q)||F.push(new Ct(o,x,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(bt({key:u.key,value:x,valueSpec:L,style:h,styleSpec:_,expressionContext:"property",propertyType:i,propertyKey:T}))}function Ye(u){return gr(u,"paint")}function Yt(u){return gr(u,"layout")}function kt(u){let i=[];const o=u.value,h=u.key,p=u.style,_=u.styleSpec;o.type||o.ref||i.push(new Ct(h,o,'either "type" or "ref" is required'));let x=s.u(o.type);const T=s.u(o.ref);if(o.id){const M=s.u(o.id);for(let I=0;I<u.arrayIndex;I++){const L=p.layers[I];s.u(L.id)===M&&i.push(new Ct(h,o.id,`duplicate layer id "${o.id}", previously used at line ${L.id.__line__}`))}}if("ref"in o){let M;["type","source","source-layer","filter","layout"].forEach(I=>{I in o&&i.push(new Ct(h,o[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{s.u(I.id)===T&&(M=I)}),M?M.ref?i.push(new Ct(h,o.ref,"ref cannot reference another ref layer")):x=s.u(M.type):typeof T=="string"&&i.push(new Ct(h,o.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(o.source){const M=p.sources&&p.sources[o.source],I=M&&s.u(M.type);M?I==="vector"&&x==="raster"?i.push(new Ct(h,o.source,`layer "${o.id}" requires a raster source`)):I==="raster"&&x!=="raster"?i.push(new Ct(h,o.source,`layer "${o.id}" requires a vector source`)):I!=="vector"||o["source-layer"]?I==="raster-dem"&&x!=="hillshade"?i.push(new Ct(h,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||I==="geojson"&&M.lineMetrics?x==="raster-particle"&&I!=="raster-array"&&i.push(new Ct(h,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):i.push(new Ct(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ct(h,o.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new Ct(h,o,`layer "${o.id}" must specify a "source-layer"`)):i.push(new Ct(h,o.source,`source "${o.source}" not found`))}else i.push(new Ct(h,o,'missing required property "source"'));return i=i.concat(Jr({key:h,value:o,valueSpec:_.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bt({key:`${h}.type`,value:o.type,valueSpec:_.layer.type,style:u.style,styleSpec:u.styleSpec,object:o,objectKey:"type"}),filter:M=>pr(s.j({layerType:x},M)),layout:M=>Jr({layer:o,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":I=>Yt(s.j({layerType:x},I))}}),paint:M=>Jr({layer:o,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":I=>Ye(s.j({layerType:x,layer:o},I))}})}})),i}function St(u){const i=u.value,o=u.key,h=s.i(i);return h!=="string"?[new Ct(o,i,`string expected, ${h} found`)]:[]}const ai={promoteId:function({key:u,value:i}){if(s.i(i)==="string")return St({key:u,value:i});{const o=[];for(const h in i)o.push(...St({key:`${u}.${h}`,value:i[h]}));return o}}};function bi(u){const i=u.value,o=u.key,h=u.styleSpec,p=u.style;if(!i.type)return[new Ct(o,i,'"type" is required')];const _=s.u(i.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(i.url||i.tiles||x.push(new Ci(o,i,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Jr({key:o,value:i,valueSpec:h[`source_${_.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:ai})),x;case"geojson":if(x=Jr({key:o,value:i,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:ai}),i.cluster)for(const T in i.clusterProperties){const[M,I]=i.clusterProperties[T],L=typeof M=="string"?[M,["accumulated"],["get",T]]:M;x.push(...nn({key:`${o}.${T}.map`,value:I,expressionContext:"cluster-map"})),x.push(...nn({key:`${o}.${T}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return Jr({key:o,value:i,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Jr({key:o,value:i,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new Ct(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rr({key:`${o}.type`,value:i.type,valueSpec:{values:ge(h)},style:p,styleSpec:h})}}function ge(u){return u.source.reduce((i,o)=>{const h=u[o];return h.type.type==="enum"&&(i=i.concat(Object.keys(h.type.values))),i},[])}function ve(u){const i=u.value;let o=[];if(!i)return o;const h=s.i(i);return h!=="string"?(o=o.concat([new Ct(u.key,i,`string expected, "${h}" found`)]),o):(function(p){const _=p.indexOf("://")===-1;try{return new URL(p,_?"http://example.com":void 0),!0}catch{return!1}}(i)||(o=o.concat([new Ct(u.key,i,`invalid url "${i}"`)])),o)}function We(u){const i=u.value,o=u.styleSpec,h=o.light,p=u.style;let _=[];const x=s.i(i);if(i===void 0)return _;if(x!=="object")return _=_.concat([new Ct("light",i,`object expected, ${x} found`)]),_;for(const T in i){const M=T.match(/^(.*)-transition$/);_=_.concat(M&&h[M[1]]&&h[M[1]].transition?bt({key:T,value:i[T],valueSpec:o.transition,style:p,styleSpec:o}):h[T]?bt({key:T,value:i[T],valueSpec:h[T],style:p,styleSpec:o}):[new Ct(T,i[T],`unknown property "${T}"`)])}return _}function rt(u){const i=u.value;let o=[];if(!i)return o;const h=s.i(i);if(h!=="object")return o=o.concat([new Ct("light-3d",i,`object expected, ${h} found`)]),o;const p=u.styleSpec,_=p["light-3d"],x=u.key,T=u.style,M=u.style.lights;for(const O of["type","id"])if(!(O in i))return o=o.concat([new Ct("light-3d",i,`missing property ${O} on light`)]),o;if(i.type&&M)for(let O=0;O<u.arrayIndex;O++){const F=s.u(i.type),N=M[O];s.u(N.type)===F&&o.push(new Ct(x,i.id,`duplicate light type "${i.type}", previously defined at line ${N.id.__line__}`))}const I=`properties_light_${i.type}`;if(!(I in p))return o=o.concat([new Ct("light-3d",i,`Invalid light type ${i.type}`)]),o;const L=p[I];for(const O in i)if(O==="properties"){const F=i[O],N=s.i(F);if(N!=="object")return o=o.concat([new Ct("properties",F,`object expected, ${N} found`)]),o;for(const q in F)o=o.concat(L[q]?bt({key:q,value:F[q],valueSpec:L[q],style:T,styleSpec:p}):[new Ci(u.key,F[q],`unknown property "${q}"`)])}else{const F=O.match(/^(.*)-transition$/);o=o.concat(F&&_[F[1]]&&_[F[1]].transition?bt({key:O,value:i[O],valueSpec:p.transition,style:T,styleSpec:p}):_[O]?bt({key:O,value:i[O],valueSpec:_[O],style:T,styleSpec:p}):[new Ci(O,i[O],`unknown property "${O}"`)])}return o}function ut(u){const i=u.value,o=u.key,h=u.style,p=u.styleSpec,_=p.terrain;let x=[];const T=s.i(i);if(i===void 0||T==="null")return x;if(T!=="object")return x=x.concat([new Ct("terrain",i,`object expected, ${T} found`)]),x;for(const M in i){const I=M.match(/^(.*)-transition$/);x=x.concat(I&&_[I[1]]&&_[I[1]].transition?bt({key:M,value:i[M],valueSpec:p.transition,style:h,styleSpec:p}):_[M]?bt({key:M,value:i[M],valueSpec:_[M],style:h,styleSpec:p}):[new Ci(M,i[M],`unknown property "${M}"`)])}if(i.source){const M=h.sources&&h.sources[i.source],I=M&&s.u(M.type);M?I!=="raster-dem"&&x.push(new Ct(o,i.source,`terrain cannot be used with a source of type ${String(I)}, it only be used with a "raster-dem" source type`)):x.push(new Ct(o,i.source,`source "${i.source}" not found`))}else x.push(new Ct(o,i,'terrain is missing required property "source"'));return x}function Vt(u){const i=u.value,o=u.style,h=u.styleSpec,p=h.fog;let _=[];const x=s.i(i);if(i===void 0)return _;if(x!=="object")return _=_.concat([new Ct("fog",i,`object expected, ${x} found`)]),_;for(const T in i){const M=T.match(/^(.*)-transition$/);_=_.concat(M&&p[M[1]]&&p[M[1]].transition?bt({key:T,value:i[T],valueSpec:h.transition,style:o,styleSpec:h}):p[T]?bt({key:T,value:i[T],valueSpec:p[T],style:o,styleSpec:h}):[new Ci(T,i[T],`unknown property "${T}"`)])}return _}const lr={"*":()=>[],array:Zt,boolean:function(u){const i=u.value,o=u.key,h=s.i(i);return h!=="boolean"?[new Ct(o,i,`boolean expected, ${h} found`)]:[]},number:Pn,color:function(u){const i=u.key,o=u.value,h=s.i(o);return h!=="string"?[new Ct(i,o,`color expected, ${h} found`)]:s.y(o)===null?[new Ct(i,o,`color expected, "${o}" found`)]:[]},enum:rr,filter:pr,function:kn,layer:kt,object:Jr,source:bi,model:ve,light:We,"light-3d":rt,terrain:ut,fog:Vt,string:St,formatted:function(u){return St(u).length===0?[]:nn(u)},resolvedImage:function(u){return St(u).length===0?[]:nn(u)},projection:function(u){const i=u.value,o=u.styleSpec,h=o.projection,p=u.style;let _=[];const x=s.i(i);if(x==="object")for(const T in i)_=_.concat(bt({key:T,value:i[T],valueSpec:h[T],style:p,styleSpec:o}));else x!=="string"&&(_=_.concat([new Ct("projection",i,`object or string expected, ${x} found`)]));return _},import:function(u){const{value:i,styleSpec:o}=u,{data:h,...p}=i;Object.defineProperty(p,"__line__",{value:i.__line__,enumerable:!1});let _=Jr(s.j({},u,{value:p,valueSpec:o.import}));return s.u(p.id)===""&&_.push(new Ct(`${u.key}.id`,p,"import id can't be an empty string")),h&&(_=_.concat(Dt(h,o,{key:`${u.key}.data`}))),_}};function bt(u,i=!1){const o=u.value,h=u.valueSpec,p=u.styleSpec;if(h.expression&&s.A(s.u(o)))return kn(u);if(h.expression&&s.n(s.o(o)))return nn(u);if(h.type&&lr[h.type]){const _=lr[h.type](u);return i===!0&&_.length>0&&s.i(u.value)==="array"?nn(u):_}return Jr(s.j({},u,{valueSpec:h.type?p[h.type]:h}))}function Qt(u){const i=u.value,o=u.key,h=St(u);return h.length||(i.indexOf("{fontstack}")===-1&&h.push(new Ct(o,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&h.push(new Ct(o,i,'"glyphs" url must include a "{range}" token'))),h}function Dt(u,i=s.D,o={}){return bt({key:o.key||"",value:u,valueSpec:i.$root,styleSpec:i,style:u,objectElementValidators:{glyphs:Qt,"*":()=>[]}})}function cr(u,i=s.D){return He(Dt(u,i))}const Er=u=>He(bi(u)),Sr=u=>He(We(u)),Oe=u=>He(rt(u)),W=u=>He(ut(u)),se=u=>He(Vt(u)),de=u=>He(kt(u)),Fe=u=>He(pr(u)),Ze=u=>He(Ye(u)),nt=u=>He(Yt(u)),Nt=u=>He(ve(u));function He(u){return u.slice().sort((i,o)=>i.line&&o.line?i.line-o.line:0)}function Ht(u,i){let o=!1;if(i&&i.length)for(const h of i)h instanceof Ci?s.w(h.message):(u.fire(new s.a(new Error(h.message))),o=!0);return o}const Tt=new s.F({anchor:new s.G(s.D.light.anchor),position:new s.H(s.D.light.position),color:new s.G(s.D.light.color),intensity:new s.G(s.D.light.intensity)});class Ut extends s.E{constructor(i,o="flat"){super(),this._transitionable=new s.J(Tt),this.setLight(i,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,o,h={}){this._validate(Sr,i,h)||(this._transitionable.setTransitionOrValue(i),this.id=o)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,h){return(!h||h.validate!==!1)&&Ht(this,i.call(cr,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.D})))}}const Rr=new s.F({source:new s.G(s.D.terrain.source),exaggeration:new s.G(s.D.terrain.exaggeration)});let fi=class extends s.E{constructor(u,i,o,h){super(),this.scope=o,this._transitionable=new s.J(Rr,o,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(u,i){this._transitionable.setTransitionOrValue(u,i)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new s.K(u)).get("exaggeration")}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof s.Z}};const Ui=45,gi=65,$r=.05;function ii(u,i,o,h){const p=s.O(Ui,gi,o),[_,x]=yi(u,h);let T=1-Math.min(1,Math.exp((i-_)/(x-_)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*p*u.alpha}function yi(u,i){const o=.5/Math.tan(.5*i);return[u.range[0]+o,u.range[1]+o]}function ki(u,i,o,h,p){const _=s.N.transformMat4([],[i,o,h],p.mercatorFogMatrix);return ii(u,s.N.length(_),p.pitch,p._fov)}function Fn(u,i,o,h,p,_,x){const T=[[o,h,0],[p,h,0],[p,_,0],[o,_,0]];let M=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(const L of T){const O=s.N.transformMat4([],L,i),F=s.N.length(O);M=Math.min(M,F),I=Math.max(I,F)}return[ii(u,M,x.pitch,x._fov),ii(u,I,x.pitch,x._fov)]}const ji=new s.F({range:new s.G(s.D.fog.range),color:new s.G(s.D.fog.color),"high-color":new s.G(s.D.fog["high-color"]),"space-color":new s.G(s.D.fog["space-color"]),"horizon-blend":new s.G(s.D.fog["horizon-blend"]),"star-intensity":new s.G(s.D.fog["star-intensity"]),"vertical-range":new s.G(s.D.fog["vertical-range"])});class _o extends s.E{constructor(i,o,h,p){super(),this._transitionable=new s.J(ji,h,new Map(p)),this.set(i,p),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.Q(ji)}get state(){const i=this._transform,o=i.projection.name==="globe",h=s.S(i.zoom),p=this.properties.get("range"),_=[.5,3];return{range:o?[s.U(_[0],p[0],h),s.U(_[1],p[1],h)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,o,h={}){if(this._validate(se,i,h))return;const p=s.e({},i);for(const _ of Object.keys(s.D.fog))p[_]===void 0&&(p[_]=s.D.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.O(Ui,gi,i))*o.a}getOpacityAtLatLng(i,o){return this._transform.projection.supportsFog?function(h,p,_){const x=s.L.fromLngLat(p),T=_.elevation?_.elevation.getAtPointOrZero(x):0;return ki(h,x.x,x.y,T,_)}(this.state,i,o):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Fn(this.state,o,0,0,s.V,s.V,this._transform)}getOpacityForBounds(i,o,h,p,_){return this._transform.projection.supportsFog?Fn(this.state,i,o,h,p,_,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?yi(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const h of o){const p=i.points[h];let _;if(p[2]>=0)_=p;else{const x=i.points[h-4];_=s.W(x,p,x[2]/(x[2]-p[2]))}if(ki(this.state,_[0],_[1],0,this._transform)>=$r)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,o,h){return(!h||h.validate!==!1)&&Ht(this,i.call(cr,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.D})))}}class jn extends s.E{constructor(i,o,h,p){super(),this.scope=h,this._options=i,this.properties=new s.Q(o),this._transitionable=new s.J(o,h,new Map(p)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,o){this._options=i,this._transitionable.setTransitionOrValue(i.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const So=new s.F({color:new s.G(s.D.properties_light_ambient.color),intensity:new s.G(s.D.properties_light_ambient.intensity)}),Tn=new s.F({direction:new s.X(s.D.properties_light_directional.direction),color:new s.G(s.D.properties_light_directional.color),intensity:new s.G(s.D.properties_light_directional.intensity),"cast-shadows":new s.G(s.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.G(s.D.properties_light_directional["shadow-intensity"])});class En{constructor(i,o,h,p){this.screenBounds=i,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(i,o){let h,p;if(i instanceof s.P||typeof i[0]=="number"){const _=s.P.convert(i);h=[_],p=o.isPointAboveHorizon(_)}else{const _=s.P.convert(i[0]),x=s.P.convert(i[1]);h=[_,x],p=s.Y(_,x).every(T=>o.isPointAboveHorizon(T))}return new En(h,o.getCameraPoint(),p,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return s.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const o=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.Y(o,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<h.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?p[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(p[3]=this.cameraPoint)),s._(p,i)}bufferedCameraGeometryGlobe(i){const o=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.Y(o,h,i),_=this.cameraPoint.clone();switch(3*((_.y>o.y)+(_.y>h.y))+((_.x>o.x)+(_.x>h.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(i,o,h,p=0){const _=i.queryPadding/o._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(_,o):this._bufferedScreenMercator(_,o);let T=i.tileID.wrap+(x.unwrapped?p:0);const M=x.polygon.map(Z=>s.$(i.tileTransform,Z,T));if(!s.a0(M,0,0,s.V,s.V))return;T=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const I=this.screenGeometryMercator.polygon.map(Z=>s.a1(i.tileTransform,Z,T)),L=I.map(Z=>new s.P(Z[0],Z[1])),O=o.getFreeCameraOptions().position||new s.L(0,0,0),F=s.a1(i.tileTransform,O,T),N=I.map(Z=>{const V=s.N.sub(Z,Z,F);return s.N.normalize(V,V),new s.a2(F,V)}),q=s.a3(i,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:N,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:($=s.a4(M),$.min.x=s.aa($.min.x,0,s.V),$.min.y=s.aa($.min.y,0,s.V),$.max.x=s.aa($.max.x,0,s.V),$.max.y=s.aa($.max.y,0,s.V),$),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:q};var $}_bufferedScreenMercator(i,o){const h=ct(i);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let p;return p=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),o):{polygon:this.bufferedScreenGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=p,p}}_bufferedCameraMercator(i,o){const h=ct(i);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let p;return p=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),o):{polygon:this.bufferedCameraGeometry(i).map(_=>o.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=p,p}}_projectAndResample(i,o){const h=function(_,x){const T=s.a6.multiply([],x.pixelMatrix,x.globeMatrix),M=[0,-s.ab,0,1],I=[0,s.ab,0,1],L=[0,0,0,1];s.a7.transformMat4(M,M,T),s.a7.transformMat4(I,I,T),s.a7.transformMat4(L,L,T);const O=new s.P(M[0]/M[3],M[1]/M[3]),F=new s.P(I[0]/I[3],I[1]/I[3]),N=s.a8(_,O)&&M[3]<L[3],q=s.a8(_,F)&&I[3]<L[3];if(!N&&!q)return null;const $=function(ae,he,fe){for(let ye=1;ye<ae.length;ye++){const De=Xe(he.pointCoordinate3D(ae[ye-1]).x),Te=Xe(he.pointCoordinate3D(ae[ye]).x);if(fe<0){if(De<Te)return{idx:ye,t:-De/(Te-1-De)}}else if(Te<De)return{idx:ye,t:(1-De)/(Te+1-De)}}return null}(_,x,N?-1:1);if(!$)return null;const{idx:Z,t:V}=$;let X=Z>1?Ge(_.slice(0,Z),x):[],ne=Z<_.length?Ge(_.slice(Z),x):[];X=X.map(ae=>new s.P(Xe(ae.x),ae.y)),ne=ne.map(ae=>new s.P(Xe(ae.x),ae.y));const J=[...X];J.length===0&&J.push(ne[ne.length-1]);const oe=s.U(J[J.length-1].y,(ne.length===0?X[0]:ne[0]).y,V);let H;return H=N?[new s.P(0,oe),new s.P(0,0),new s.P(1,0),new s.P(1,oe)]:[new s.P(1,oe),new s.P(1,1),new s.P(0,1),new s.P(0,oe)],J.push(...H),ne.length===0?J.push(X[0]):J.push(...ne),{polygon:J.map(ae=>new s.L(ae.x,ae.y)),unwrapped:!1}}(i,o);if(h)return h;const p=function(_,x){let T=!1,M=-1/0,I=0;for(let O=0;O<_.length-1;O++)_[O].x>M&&(M=_[O].x,I=O);for(let O=0;O<_.length-1;O++){const F=(I+O)%(_.length-1),N=_[F],q=_[F+1];Math.abs(N.x-q.x)>.5&&(N.x<q.x?(N.x+=1,F===0&&(_[_.length-1].x+=1)):(q.x+=1,F+1===_.length-1&&(_[0].x+=1)),T=!0)}const L=s.a5(x.center.lng);return T&&L<Math.abs(L-1)&&_.forEach(O=>{O.x-=1}),{polygon:_,unwrapped:T}}(Ge(i,o).map(_=>new s.P(Xe(_.x),_.y)),o);return{polygon:p.polygon.map(_=>new s.L(_.x,_.y)),unwrapped:p.unwrapped}}}function Ge(u,i){return s.a9(u,o=>{const h=i.pointCoordinate3D(o);o.x=h.x,o.y=h.y},1/256)}function Xe(u){return u<0?1+u%1:u%1}function ct(u){return 100*u|0}function yt(u,i,o,h,p){const _=function(x,T){if(x)return p(x);if(T){u.url&&T.tiles&&u.tiles&&delete u.tiles;const M=s.ac(s.e(T,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(M.vectorLayers=T.vector_layers,M.vectorLayerIds=M.vectorLayers.map(I=>I.id)),T.raster_layers&&(M.rasterLayers=T.raster_layers,M.rasterLayerIds=M.rasterLayers.map(I=>I.id)),M.tiles=i.canonicalizeTileset(M,u.url),p(null,M)}};return u.url?s.g(i.transformRequest(i.normalizeSourceURL(u.url,null,o,h),s.R.Source),_):s.f.frame(()=>_(null,u))}class pt{constructor(i,o,h){this.bounds=s.ad.convert(this.validateBounds(i)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const o=Math.pow(2,i.z),h=Math.floor(s.a5(this.bounds.getWest())*o),p=Math.floor(s.ae(this.bounds.getNorth())*o),_=Math.ceil(s.a5(this.bounds.getEast())*o),x=Math.ceil(s.ae(this.bounds.getSouth())*o);return i.x>=h&&i.x<_&&i.y>=p&&i.y<x}}class Lt extends s.E{constructor(i,o,h,p){if(super(),this.id=i,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.ac(o,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new s.af}load(i){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=yt(this._options,this.map._requestManager,o,h,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new s.a(p))):_&&(s.e(this,_),_.bounds&&(this.tileBounds=new pt(_.bounds,this.minzoom,this.maxzoom)),s.aj(_.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(p)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}loadTile(i,o){const h=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(h,s.R.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster};if(p.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=o:i.request=i.actor.send("reloadTile",p,_.bind(this));else if(i.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const x=s.ah.call({deduped:this._deduped},p,(T,M)=>{T||!M?_.call(this,T):(p.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},i.actor&&i.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);i.request={cancel:x}}function _(x,T){return delete i.request,i.aborted?o(null):x&&x.status!==404?o(x):(T&&T.resourceTiming&&(i.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&i.setExpiryData(T),i.loadVectorData(T,this.map.painter),s.ai(this.dispatcher),o(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Pt extends s.E{constructor(i,o,h,p){super(),this.id=i,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},o),s.e(this,s.ac(o,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._tileJSONRequest=yt(this._options,this.map._requestManager,null,null,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new s.a(o)):h&&(s.e(this,h),h.bounds&&(this.tileBounds=new pt(h.bounds,this.minzoom,this.maxzoom)),s.aj(h.tiles),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),i&&i(o)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=s.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,o){const h=s.f.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);i.request=s.d(this.map._requestManager.transformRequest(p,s.R.Tile),(_,x,T,M)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):_?(i.state="errored",o(_)):x?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:T,expires:M}),i.setTexture(x,this.map.painter),i.state="loaded",s.ai(this.dispatcher),void o(null)):o(null)))}abortTile(i,o){i.request&&(i.request.cancel(),delete i.request),o()}unloadTile(i,o){i.texture&&i.texture instanceof s.T?(i.destroy(!0),i.texture&&i.texture instanceof s.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gt extends Pt{constructor(i,o,h,p){super(i,o,h,p),this.type="raster-array",this.maxzoom=22,this._options=s.e({type:"raster-array"},o)}triggerRepaint(i){const o=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);o&&o.enabled&&h&&o._clearRenderCacheForTile(h.id,i.tileID),this.map.triggerRepaint()}loadTile(i,o){const h=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(h,s.R.Tile);i.requestParams=p,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(_,x,T,M)=>{if(delete i.request,i.aborted)return i.state="unloaded",o(null);if(_)return _.code===20?void 0:(i.state="errored",o(_));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:T,expires:M}),i.state="empty",o(null)})}unloadTile(i){const o=i.texture;o&&o instanceof s.T?(i.destroy(!0),this.map.painter.saveTileTexture(o)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,o,h){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(o,h,(p,_)=>{if(p)return i.state="errored",this.fire(new s.a(p)),void this.triggerRepaint(i);_&&(i.setTexture(_,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:_})=>_===i),h=o&&o.fields,p=h&&h.bands&&h.bands;return p?p[0]:0}getTextureDescriptor(i,o,h){if(!i)return;const p=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;o instanceof s.an?_=o.paint.get("raster-array-band"):o instanceof s.ao&&(_=o.paint.get("raster-particle-array-band"));const x=_||this.getInitialBand(p);if(x!=null)if(i.textureDescriptor){if(!i.updateNeeded(p,x)||h)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,p,x)}}const zt=32,At=33,sr=new Uint16Array(8184);for(let u=0;u<2046;u++){let i=u+2,o=0,h=0,p=0,_=0,x=0,T=0;for(1&i?p=_=x=zt:o=h=T=zt;(i>>=1)>1;){const I=o+p>>1,L=h+_>>1;1&i?(p=o,_=h,o=x,h=T):(o=p,h=_,p=x,_=T),x=I,T=L}const M=4*u;sr[M+0]=o,sr[M+1]=h,sr[M+2]=p,sr[M+3]=_}const Yr=new Uint16Array(2178),ir=new Uint8Array(1089),Pi=new Uint16Array(1089);function $i(u){return u===0?-.03125:u===32?.03125:0}class Li{constructor(i,o,h,p){this.id=Li.uniqueIdxCounter,Li.uniqueIdxCounter++,this.context=i;const _=i.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Li.uniqueIdxCounter,Li.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Li.uniqueIdxCounter=0;const gn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qn{constructor(i,o,h,p,_,x){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=p,this.instanceCount=x,this.context=i;const T=i.gl;this.buffer=T.createBuffer(),i.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,o){for(let h=0;h<this.attributes.length;h++){const p=o.attributes[this.attributes[h].name];p!==void 0&&i.enableVertexAttribArray(p)}}setVertexAttribPointers(i,o,h){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],x=o.attributes[_.name];x!==void 0&&i.vertexAttribPointer(x,_.components,i[gn[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(i,o,h){for(let p=0;p<this.attributes.length;p++){const _=o.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(_,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ti{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class go extends ti{getDefault(){return s.ax.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Ro extends ti{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class wi extends ti{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Da extends ti{getDefault(){return[!0,!0,!0,!0]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Es extends ti{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Oo extends ti{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Bo extends ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const o=this.current;(i.func!==o.func||i.ref!==o.ref||i.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class as extends ti{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ss extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=i,this.dirty=!1}}class No extends ti{getDefault(){return[0,1]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Gc extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=i,this.dirty=!1}}class $l extends ti{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class $c extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.BLEND):o.disable(o.BLEND),this.current=i,this.dirty=!1}}class ql extends ti{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Zl extends ti{getDefault(){return s.ax.transparent}set(i){const o=this.current;(i.r!==o.r||i.g!==o.g||i.b!==o.b||i.a!==o.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class co extends ti{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class yn extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;i?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=i,this.dirty=!1}}class Zr extends ti{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Wu extends ti{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Hl=class extends ti{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class qc extends ti{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Wl extends ti{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const o=this.current;(i[0]!==o[0]||i[1]!==o[1]||i[2]!==o[2]||i[3]!==o[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class C extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class B extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ie extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class me extends ti{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ce extends ti{getDefault(){return null}set(i){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class xe extends ti{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class Se extends ti{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class wt extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ft extends ti{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ft extends ti{constructor(i,o){super(i),this.context=i,this.parent=o}getDefault(){return null}}class nr extends ft{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class qt extends ft{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Gr extends ft{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ti extends qt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Tr{constructor(i,o,h,p,_){this.context=i,this.width=o,this.height=h;const x=this.framebuffer=i.gl.createFramebuffer();p&&(this.colorAttachment=new nr(i,x)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new qt(i,x):new Gr(i,x))}destroy(){const i=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&i.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&i.deleteTexture(o)}i.deleteFramebuffer(this.framebuffer)}}class jt{constructor(i,o,h){this.func=i,this.mask=o,this.range=h}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const mt=7680;class ht{constructor(i,o,h,p,_,x){this.test=i,this.ref=o,this.mask=h,this.fail=p,this.depthFail=_,this.pass=x}}ht.disabled=new ht({func:519,mask:0},0,0,mt,mt,mt);const Ei=771;class vr{constructor(i,o,h,p){this.blendFunction=i,this.blendColor=o,this.mask=h,this.blendEquation=p}}vr.Replace=[1,0,1,0],vr.disabled=new vr(vr.Replace,s.ax.transparent,[!1,!1,!1,!1]),vr.unblended=new vr(vr.Replace,s.ax.transparent,[!0,!0,!0,!0]),vr.alphaBlended=new vr([1,Ei,1,Ei],s.ax.transparent,[!0,!0,!0,!0]),vr.multiply=new vr([774,0,774,0],s.ax.transparent,[!0,!0,!0,!0]);const hn=1029,Bn=2305;class dr{constructor(i,o,h){this.enable=i,this.mode=o,this.frontFace=h}}dr.disabled=new dr(!1,hn,Bn),dr.backCCW=new dr(!0,hn,Bn),dr.backCW=new dr(!0,hn,2304),dr.frontCW=new dr(!0,1028,2304),dr.frontCCW=new dr(!0,1028,Bn);class on{constructor(i,o){this.gl=i,this.clearColor=new go(this),this.clearDepth=new Ro(this),this.clearStencil=new wi(this),this.colorMask=new Da(this),this.depthMask=new Es(this),this.stencilMask=new Oo(this),this.stencilFunc=new Bo(this),this.stencilOp=new as(this),this.stencilTest=new Ss(this),this.depthRange=new No(this),this.depthTest=new Gc(this),this.depthFunc=new $l(this),this.blend=new $c(this),this.blendFunc=new ql(this),this.blendColor=new Zl(this),this.blendEquation=new co(this),this.cullFace=new yn(this),this.cullFaceSide=new Zr(this),this.frontFace=new Wu(this),this.program=new Hl(this),this.activeTexture=new qc(this),this.viewport=new Wl(this),this.bindFramebuffer=new C(this),this.bindRenderbuffer=new B(this),this.bindTexture=new ie(this),this.bindVertexBuffer=new me(this),this.bindElementBuffer=new ce(this),this.bindVertexArrayOES=new xe(this),this.pixelStoreUnpack=new Se(this),this.pixelStoreUnpackPremultiplyAlpha=new wt(this),this.pixelStoreUnpackFlipY=new Ft(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,o,h){return new Li(this,i,o,h)}createVertexBuffer(i,o,h,p,_){return new qn(this,i,o,h,p,_)}createRenderbuffer(i,o,h){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,i,o,h),this.bindRenderbuffer.set(null),_}createFramebuffer(i,o,h,p){return new Tr(this,i,o,h,p)}clear({color:i,depth:o,stencil:h,colorMask:p}){const _=this.gl;let x=0;i&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(p||[!0,!0,!0,!0])),o!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),_.clear(x)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){K(i.blendFunction,vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Zs=s.ay([{name:"a_pos",type:"Float32",components:3}]);class Ln{constructor(i,o,h,p){const _={width:h[0],height:h[1],data:null},x=i.gl;this.targetColorTexture=new s.T(i,_,x.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new s.T(i,_,x.RGBA,{useMipmap:!1}),this.context=i,this.setNumParticles(o,p),this.lastInvalidatedAt=0}setNumParticles(i,o){if(this.numParticles===o)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const h=new s.az;h.reserve(Math.round(o));const p=s.aA(i.key);for(let _=0;_<o;_++)h.emplaceBack(p(),p(),p());this.particleVertices0=this.context.createVertexBuffer(h,Zs.members,!0),this.particleVertices1=this.context.createVertexBuffer(h,Zs.members,!0),this.particleSegment=s.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=o}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=s.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const Nn={type:2,extent:s.V,loadGeometry:()=>[[new s.P(0,0),new s.P(s.V+1,0),new s.P(s.V+1,s.V+1),new s.P(0,s.V+1),new s.P(0,0)]]};class Ms{constructor(i,o,h,p,_){this.tileID=i,this.uid=s.aC(),this.uses=0,this.tileSize=o,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(i){const o=i+this.timeAdded;o<s.f.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,o,h){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(p,_){const x={};if(!_)return x;for(const T of p){const M=T.layerIds.map(I=>_.getLayer(I)).filter(Boolean);if(M.length!==0){T.layers=M,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(I=>M.filter(L=>L.id===I)[0]));for(const I of M)x[I.fqid]=T}}return x}(i.buckets,o.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof s.aE){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof s.aE&&_.hasRTLText){this.hasRTLText=!0,s.aF();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],x=o.style.getOwnLayer(p);if(!x)continue;const T=x.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,T)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new s.aD}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(i)}const o=i.gl,h=this.imageAtlas;if(h&&!h.uploaded){const p=!!Object.keys(h.patternPositions).length;this.imageAtlasTexture=new s.T(i,h.image,o.RGBA,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(i,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(i,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(i,o,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,h),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=o.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this._lastUpdatedBrightness=p,this.updateBuckets(void 0,o)))}queryRenderedFeatures(i,o,h,p,_,x,T,M){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:T,transform:x,params:_,tileTransform:this.tileTransform},i,o,h):{}}querySourceFeatures(i,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),_=o?o.sourceLayer:"",x=p._geojsonTileLayer||p[_];if(!x)return;const T=s.aG(o&&o.filter),{z:M,x:I,y:L}=this.tileID.canonical,O={z:M,x:I,y:L};for(let F=0;F<x.length;F++){const N=x.feature(F);if(T.needGeometry){const Z=s.aH(N,!0);if(!T.filter(new s.K(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!T.filter(new s.K(this.tileID.overscaledZ),N))continue;const q=h.getId(N,_),$=new s.aI(N,M,I,L,q);$.tile=O,i.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const i in this.buckets)if(this.buckets[i].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const o=this.expirationTime;if(i.cacheControl){const h=s.aJ(i.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(o)if(this.expirationTime<o)p=!0;else{const _=this.expirationTime-o;_?this.expirationTime=h+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0&&o&&this.updateBuckets(i,o)}updateBuckets(i,o){if(!this.latestFeatureIndex)return;const h=this.latestFeatureIndex.loadVTLayers(),p=o.style.listImages(),_=o.style.getBrightness();for(const x in this.buckets){if(!o.style.hasLayer(x))continue;const T=this.buckets[x],M=T.layers[0].sourceLayer||"_geojsonTileLayer",I=h[M];let L={};if(i&&(L=i[M],!I||!L||Object.keys(L).length===0))continue;if(T.update(L,I,p,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),T instanceof s.aK||T instanceof s.aL){const F=o.style.getOwnSourceCache(T.layers[0].source);o._terrain&&o._terrain.enabled&&F&&T.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(F.id,this.tileID)}const O=o&&o.style&&o.style.getOwnLayer(x);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=s.f.now()+i}setTexture(i,o){const h=o.context,p=h.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{useMipmap:!0}):(this.texture=new s.T(h,i,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(i,o){const h={};for(const p of o)h[p]=!0;this.dependencies[i]=h}hasDependency(i,o){for(const h of i){const p=this.dependencies[h];if(p){for(const _ of o)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const h=s.aM(Nn,this.tileID.canonical,this.tileTransform)[0],p=new s.aN,_=new s.aO;for(let x=0;x<h.length;x++){const{x:T,y:M}=h[x];p.emplaceBack(T,M),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(_),this._tileDebugBuffer=i.createVertexBuffer(p,s.aP.members),this._tileDebugSegments=s.aB.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(i,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const h=s.aM(Nn,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const x=function(T,M){const I=s.as(T,M),L=Math.pow(2,T.z);for(let Z=0;Z<At;Z++)for(let V=0;V<At;V++){const X=s.at((T.x+(V+$i(V))/zt)/L),ne=s.au((T.y+(Z+$i(Z))/zt)/L),J=M.project(X,ne),oe=Z*At+V;Yr[2*oe+0]=Math.round((J.x*I.scale-I.x)*s.V),Yr[2*oe+1]=Math.round((J.y*I.scale-I.y)*s.V)}ir.fill(0),Pi.fill(0);for(let Z=2045;Z>=0;Z--){const V=4*Z,X=sr[V+0],ne=sr[V+1],J=sr[V+2],oe=sr[V+3],H=X+J>>1,ae=ne+oe>>1,he=H+ae-ne,fe=ae+X-H,ye=ne*At+X,De=oe*At+J,Te=ae*At+H,$e=Math.hypot((Yr[2*ye+0]+Yr[2*De+0])/2-Yr[2*Te+0],(Yr[2*ye+1]+Yr[2*De+1])/2-Yr[2*Te+1])>=16;ir[Te]=ir[Te]||($e?1:0),Z<1022&&(ir[Te]=ir[Te]||ir[(ne+fe>>1)*At+(X+he>>1)]||ir[(oe+fe>>1)*At+(J+he>>1)])}const O=new s.av,F=new s.aw;let N=0;function q(Z,V){const X=V*At+Z;return Pi[X]===0&&(O.emplaceBack(Yr[2*X+0],Yr[2*X+1],Z*s.V/zt,V*s.V/zt),Pi[X]=++N),Pi[X]-1}function $(Z,V,X,ne,J,oe){const H=Z+X>>1,ae=V+ne>>1;if(Math.abs(Z-J)+Math.abs(V-oe)>1&&ir[ae*At+H])$(J,oe,Z,V,H,ae),$(X,ne,J,oe,H,ae);else{const he=q(Z,V),fe=q(X,ne),ye=q(J,oe);F.emplaceBack(he,fe,ye)}}return $(0,0,zt,zt,zt,0),$(zt,zt,0,0,0,zt),{vertices:O,indices:F}}(this.tileID.canonical,o);p=x.vertices,_=x.indices}else{p=new s.av,_=new s.aw;for(const{x:T,y:M}of h)p.emplaceBack(T,M,0,0);const x=s.aQ(p.int16,void 0,4);for(let T=0;T<x.length;T+=3)_.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=i.createVertexBuffer(p,s.aR.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(_),this._tileBoundsSegments=s.aB.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(i,o){const h=o.projection;if(!h||h.name!=="globe"||o.freezeTileCoverage)return;const p=this.tileID.canonical,_=s.aS(p,o),x=s.aT(_),T=s.S(o.zoom);let M;T>0&&(M=s.a6.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,p,o,x,M,T),this._makeGlobeTileDebugTextBuffer(i,p,o,x,M,T)}_globePoint(i,o,h,p,_,x,T){let M=s.aU(i,o,h);if(x){const I=1<<h.z,L=s.a5(p.center.lng),O=s.ae(p.center.lat),F=(h.x+.5)/I-L;let N=0;F>.5?N=-1:F<-.5&&(N=1);let q=(i/s.V+h.x)/I+N,$=(o/s.V+h.y)/I;q=(q-L)*p._pixelsPerMercatorPixel+L,$=($-O)*p._pixelsPerMercatorPixel+O;const Z=[q*p.worldSize,$*p.worldSize,0];s.N.transformMat4(Z,Z,x),M=s.aV(M,Z,T)}return s.N.transformMat4(M,M,_)}_makeGlobeTileDebugBorderBuffer(i,o,h,p,_,x){const T=new s.aN,M=new s.aO,I=new s.aW,L=(F,N,q,$,Z)=>{const V=(q-F)/(Z-1),X=($-N)/(Z-1),ne=T.length;for(let J=0;J<Z;J++){const oe=F+J*V,H=N+J*X;T.emplaceBack(oe,H);const ae=this._globePoint(oe,H,o,h,p,_,x);I.emplaceBack(ae[0],ae[1],ae[2]),M.emplaceBack(ne+J)}},O=s.V;L(0,0,O,0,16),L(O,0,O,O,16),L(O,O,0,O,16),L(0,O,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(M),this._tileDebugBuffer=i.createVertexBuffer(T,s.aP.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(I,s.aX.members),this._tileDebugSegments=s.aB.simpleSegment(0,0,T.length,M.length)}_makeGlobeTileDebugTextBuffer(i,o,h,p,_,x){const T=s.V/4,M=new s.aN,I=new s.aw,L=new s.aW,O=25;I.reserve(32),M.reserve(O),L.reserve(O);const F=(N,q)=>O*N+q;for(let N=0;N<O;N++){const q=N*T;for(let $=0;$<O;$++){const Z=$*T;M.emplaceBack(Z,q);const V=this._globePoint(Z,q,o,h,p,_,x);L.emplaceBack(V[0],V[1],V[2])}}for(let N=0;N<4;N++)for(let q=0;q<4;q++){const $=F(N,q),Z=F(N,q+1),V=F(N+1,q),X=F(N+1,q+1);I.emplaceBack($,Z,V),I.emplaceBack(V,Z,X)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(I),this._tileDebugTextBuffer=i.createVertexBuffer(M,s.aP.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(L,s.aX.members),this._tileDebugTextSegments=s.aB.simpleSegment(0,0,O,32)}destroy(i=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const ls={vector:Lt,raster:Pt,"raster-dem":class extends Pt{constructor(u,i,o,h){super(u,i,o,h),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(u,i){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(p,_){p&&(u.state="errored",i(p)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",i(null))}u.request=s.d(this.map._requestManager.transformRequest(o,s.R.Tile),(function(p,_,x,T){if(delete u.request,u.aborted)u.state="unloaded",i(null);else if(p)u.state="errored",i(p);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:x,expires:T});const M=ImageBitmap&&_ instanceof ImageBitmap&&s.ak(),I=1-(_.width-s.al(_.width))/2;I<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const L=M?_:s.f.getImageData(_,I),O={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:I};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",O,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const i=u.canonical,o=Math.pow(2,i.z),h=(i.x-1+o)%o,p=i.x===0?u.wrap-1:u.wrap,_=(i.x+1+o)%o,x=i.x+1===o?u.wrap+1:u.wrap,T={};return T[new s.am(u.overscaledZ,p,i.z,h,i.y).key]={backfilled:!1},T[new s.am(u.overscaledZ,x,i.z,_,i.y).key]={backfilled:!1},i.y>0&&(T[new s.am(u.overscaledZ,p,i.z,h,i.y-1).key]={backfilled:!1},T[new s.am(u.overscaledZ,u.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},T[new s.am(u.overscaledZ,x,i.z,_,i.y-1).key]={backfilled:!1}),i.y+1<o&&(T[new s.am(u.overscaledZ,p,i.z,h,i.y+1).key]={backfilled:!1},T[new s.am(u.overscaledZ,u.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},T[new s.am(u.overscaledZ,x,i.z,_,i.y+1).key]={backfilled:!1}),T}},"raster-array":gt,geojson:class extends s.E{constructor(u,i,o,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(h),this._data=i.data,this._options=s.e({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const p=s.V/this.tileSize;this.workerOptions=s.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*p,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*p,extent:s.V,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:s.V,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*p,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},i),this}getClusterChildren(u,i){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},i),this}getClusterLeaves(u,i,o,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:i,offset:o},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.b("dataloading",{dataType:"source"})),this._loaded=!1;const u=s.e({},this.workerOptions);u.scope=this.scope;const i=this._data;typeof i=="string"?(u.request=this.map._requestManager.transformRequest(s.f.resolveURL(i),s.R.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(o,h)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new s.a(o));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(p.resourceTiming=h.resourceTiming[this.id]),this.fire(new s.b("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,i){const o=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const h={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};u.request=this.actor.send(o,h,(p,_)=>(delete u.request,u.destroy(),u.aborted?i(null):p?i(p):(u.loadVectorData(_,this.map.painter,o==="reloadTile"),i(null))),void 0,o==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.ap{constructor(u,i,o,h){super(u,i,o,h),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const i of u.urls)this.urls.push(this.map._requestManager.transformRequest(i,s.R.Source).url);s.aq(this.urls,(i,o)=>{this._loaded=!0,i?this.fire(new s.a(i)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const i=this.video.seekable;u<i.start(0)||u>i.end(0)?this.fire(new s.a(new Ct(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,i=u.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(u,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.ap,model:class extends s.E{constructor(u,i,o,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const u=[];for(const i in this._options.models){const o=this._options.models[i],h=s.l(this.map._requestManager.transformRequest(o.uri,s.R.Model).url).then(p=>{if(!p)return;const _=s.c(p),x=new s.M(i,o.position,o.orientation,_);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(p=>{this.fire(new s.a(new Error(`Could not load model ${i} from ${o.uri}: ${p.message}`)))});u.push(h)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new s.a(new Error(`Could not load models: ${i.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,i){}serialize(){return{type:"model"}}},"batched-model":class extends s.E{constructor(u,i,o,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}load(u){this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=yt(this._options,this.map._requestManager,i,o,(h,p)=>{this._tileJSONRequest=null,this._loaded=!0,h?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.a(h))):p&&(s.e(this,p),p.bounds&&(this.tileBounds=new pt(p.bounds,this.minzoom,this.maxzoom)),s.aj(p.tiles,this.map._requestManager._customAccessToken),this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,i){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=i;else{if(u.buckets){const _=Object.values(u.buckets);for(const x of _)x.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,p.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,p.bind(this),void 0,!0);function p(_,x){return u.aborted?i(null):_&&_.status!==404?i(_):(x&&(x.resourceTiming&&(u.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&u.setExpiryData(x),u.buckets={...u.buckets,...x.buckets},x.featureIndex&&(u.latestFeatureIndex=x.featureIndex)),u.state="loaded",void i(null))}}serialize(){return s.e({},this._options)}},canvas:class extends s.ap{constructor(u,i,o,h){super(u,i,o,h),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new s.a(new Ct(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a(new Ct(`sources.${u}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new s.a(new Ct(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new s.a(new Ct(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a(new Ct(`sources.${u}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof s.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends s.E{constructor(u,i,o,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=i,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new pt(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),s.e(this,s.ac(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new s.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:i,y:o,z:h}=u.canonical;return this._implementation.hasTile({x:i,y:o,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,i){const{x:o,y:h,z:p}=u.tileID.canonical,_=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:o,y:h,z:p},{signal:_.signal})).then((function(x){return delete u.request,u.aborted?(u.state="unloaded",i(null)):x===void 0?(u.state="errored",i(null)):x===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",i(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(x)?(this.loadTileData(u,x),u.state="loaded",void i(null)):(u.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.code!==20&&(u.state="errored",i(x))}),u.request.cancel=()=>_.abort()}loadTileData(u,i){u.setTexture(i,this._map.painter)}unloadTile(u,i){if(u.texture&&u.texture instanceof s.T?(u.destroy(!0),u.texture&&u.texture instanceof s.T&&this._map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:o,y:h,z:p}=u.tileID.canonical;this._implementation.unloadTile({x:o,y:h,z:p})}i()}abortTile(u,i){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=s.ag(this.id,this.scope);this._map.style.clearSource(u)}_update(){this.fire(new s.b("data",{dataType:"source",sourceDataType:"content"}))}}},Sn=function(u,i,o,h){const p=new ls[i.type](u,i,o,h);if(p.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${p.id}`);return s.aY(["load","abort","unload","serialize","prepare"],p),p};function hl(u,i){const o=s.a6.identity([]);return s.a6.scale(o,o,[.5*u.width,.5*-u.height,1]),s.a6.translate(o,o,[1,-1,0]),s.a6.multiply(o,o,u.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(o)}function Xl(u,i,o,h,p,_,x,T=!1){const M=u.tilesIn(h,x,T);M.sort(za);const I=[];for(const O of M)I.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(i,o,u._state,O,p,_,hl(u.transform,O.tile.tileID),T)});const L=function(O){const F={},N={};for(const q of O){const $=q.queryResults,Z=q.wrappedTileID,V=N[Z]=N[Z]||{};for(const X in $){const ne=$[X],J=V[X]=V[X]||{},oe=F[X]=F[X]||[];for(const H of ne)J[H.featureIndex]||(J[H.featureIndex]=!0,oe.push(H))}}return F}(I);for(const O in L)L[O].forEach(F=>{const N=F.feature,q=N.layer;q&&q.type!=="background"&&q.type!=="sky"&&q.type!=="slot"&&(N.source=q.source,q["source-layer"]&&(N.sourceLayer=q["source-layer"]),N.state=N.id!==void 0?u.getFeatureState(q["source-layer"],N.id):{})});return L}function cs(u,i){const o=u.getRenderableIds().map(_=>u.getTileByID(_)),h=[],p={};for(let _=0;_<o.length;_++){const x=o[_],T=x.tileID.canonical.key;p[T]||(p[T]=!0,x.querySourceFeatures(h,i))}return h}function za(u,i){const o=u.tileID,h=i.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}class ua extends Ms{constructor(i,o,h,p,_){super(i,o,h,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,o){const h=o.context,p=h.gl;this.texture=this.texture||o.getTileTexture(i.width),this.texture&&this.texture instanceof s.T?this.texture.update(i,{useMipmap:!1,premultiply:!1}):this.texture=new s.T(h,i,p.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,o){const h=this._mrt=new s.aZ(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=s.a_(p,(_,x,T,M)=>{if(_)o(_);else try{const I=h.getHeaderLength(x);if(I>i)return void(this.request=this.fetchHeader(I,o));h.parseHeader(x),this._isHeaderLoaded=!0;let L=0;for(const O of Object.values(h.layers))L=Math.max(L,O.dataIndex[O.dataIndex.length-1].last_byte);x.byteLength>=L&&(this.entireBuffer=x),o(null,this.entireBuffer||x,T,M)}catch(I){o(I)}}),this.request}fetchBand(i,o,h){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void h(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void h(new Error("Can't fetch tile band without an actor"));let x;const T=(O,F)=>{x.complete(O,F),O?h(O):(this.updateTextureDescriptor(i,o),h(null,this.textureDescriptor&&this.textureDescriptor.img))},M=(O,F)=>{if(O)return h(O);const N=_.send("decodeRasterArray",{buffer:F,task:x},T,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),x.cancel()})},I=p.getLayer(i);if(!I)return void h(new Error(`Unknown sourceLayer "${i}"`));if(I.hasDataForBand(o))return this.updateTextureDescriptor(i,o),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=I.getDataRange([o]);if(x=p.createDecodingTask(L),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)M(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),F=s.a_(O,M);this._fetchQueue.push(()=>{F.cancel(),x.cancel()})}else h(null)}updateNeeded(i,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,o){if(!this._mrt)return;const h=this._mrt.getLayer(i);if(!h||!h.hasBand(o)||!h.hasDataForBand(o))return;const{bytes:p,tileSize:_,buffer:x,offset:T,scale:M}=h.getBandView(o),I=_+2*x,L={data:p,width:I,height:I},O=this.texture;O&&O instanceof s.T&&O.update(L,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:i,band:o,img:L,buffer:x,offset:T,tileSize:_,format:h.pixelFormat,mix:[M,256*M,65536*M,16777216*M]}}}class ka{constructor(i,o){this.max=i,this.onRemove=o,this.reset()}reset(){for(const i in this.data)for(const o of this.data[i])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(i,o,h){const p=i.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:o,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},h)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const o=this.data[i].shift();return o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),o.value}getByKey(i){const o=this.data[i];return o?o[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,o){if(!this.has(i))return this;const h=i.wrapped().key,p=o===void 0?0:this.data[h].indexOf(o),_=this.data[h][p];return this.data[h].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(i){const o=[];for(const h in this.data)for(const p of this.data[h])i(p.value)||o.push(p);for(const h of o)this.remove(h.value.tileID,h)}}class Uo extends s.E{constructor(i,o,h){super(),this.id=i,this._onlySymbols=h,o.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new ka(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new br,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const o=this._tiles[i];if(o.state!=="errored"&&(o.state!=="loaded"||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,o){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,o)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(i),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return s.a$(this._tiles).map(i=>i.tileID).sort(dl).map(i=>i.key)}getRenderableIds(i,o){const h=[];for(const p in this._tiles)this._isIdRenderable(+p,i,o)&&h.push(this._tiles[p]);return i?h.sort((p,_)=>{const x=p.tileID,T=_.tileID,M=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),I=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-T.overscaledZ||I.y-M.y||I.x-M.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(dl).map(p=>p.key)}hasRenderableParent(i){const o=this.findLoadedParent(i,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(i,o,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(o||!this._tiles[i].holdingForFade())&&(h||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,o){const h=this._tiles[i];h&&(h.state!=="loading"&&(h.state=o),this._loadTile(h,this._tileLoaded.bind(this,h,i,o)))}_tileLoaded(i,o,h,p){if(p)if(i.state="errored",p.status!==404)this._source.fire(new s.a(p,{tile:i}));else{if(!(i.tileID.key in this._loadedParentTiles))return void this._source.fire(new s.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=s.f.now(),h==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(o,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new s.b("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const o=this.getRenderableIds();for(let p=0;p<o.length;p++){const _=o[p];if(i.neighboringTiles&&i.neighboringTiles[_]){const x=this.getTileByID(_);h(i,x),h(x,i)}}function h(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-p.tileID.canonical.x;const T=_.tileID.canonical.y-p.tileID.canonical.y,M=Math.pow(2,p.tileID.canonical.z),I=_.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+M)===1?x+=M:Math.abs(x-M)===1&&(x-=M)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,x,T),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,o,h,p){for(const _ in this._tiles){let x=this._tiles[_];if(p[_]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>h)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){const I=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[I.key],x&&x.hasData()&&(T=I)}let M=T;for(;M.overscaledZ>o;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]){p[T.key]=T;break}}}findLoadedParent(i,o){if(i.key in this._loadedParentTiles){const h=this._loadedParentTiles[i.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=i.overscaledZ-1;h>=o;h--){const p=i.scaledTo(h),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(i){const o=this._tiles[i.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,o){o=o||this._source.tileSize;const h=Math.ceil(i.width/o)+1,p=Math.ceil(i.height/o)+1,_=Math.floor(h*p*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(i){const o=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,o){const h={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+o),h[_.tileID.key]=_}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(i,o,h,p){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let _;if(this.updateCacheSize(i,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)_=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new s.am(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y));else if(this.tileCoverLift!==0){const M=i.clone();M.tileCoverLift=this.tileCoverLift,_=M.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&i.projection.name==="globe"&&(_.push(new s.am(1,0,1,0,0)),_.push(new s.am(1,0,1,1,0)),_.push(new s.am(1,0,1,0,1)),_.push(new s.am(1,0,1,1,1)))}else _=i.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(_=_.filter(M=>this._source.hasTile(M)));else _=[];if(_.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!us(this._source.type)){const M=i.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),I=Math.min(M,this._source.maxzoom),L=i.extendTileCoverForShadows(_,p,I);for(const O of L)this._shadowCasterTiles[O.key]=!0,_.push(O)}const x=this._updateRetainedTiles(_);if(us(this._source.type)&&_.length!==0){const M={},I={},L=Object.keys(x);for(const F of L){const N=x[F],q=this._tiles[F];if(!q||q.fadeEndTime&&q.fadeEndTime<=s.f.now())continue;const $=this.findLoadedParent(N,Math.max(N.overscaledZ-Uo.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),M[$.tileID.key]=$.tileID),I[F]=N}const O=_[_.length-1].overscaledZ;for(const F in this._tiles){const N=this._tiles[F];if(x[F]||!N.hasData())continue;let q=N.tileID;for(;q.overscaledZ>O;){q=q.scaledTo(q.overscaledZ-1);const $=this._tiles[q.key];if($&&$.hasData()&&I[q.key]){x[F]=N.tileID;break}}}for(const F in M)x[F]||(this._coveredTiles[F]=!0,x[F]=M[F])}for(const M in x)this._tiles[M].clearFadeHold();const T=s.b0(this._tiles,x);for(const M of T){const I=this._tiles[M];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const o={};if(i.length===0)return o;const h={},p=i.reduce((I,L)=>Math.min(I,L.overscaledZ),1/0),_=i[0].overscaledZ,x=Math.max(_-Uo.maxOverzooming,this._source.minzoom),T=Math.max(_+Uo.maxUnderzooming,this._source.minzoom),M={};for(const I of i){const L=this._addTile(I);o[I.key]=I,L.hasData()||p<this._source.maxzoom&&(M[I.key]=I)}this._retainLoadedChildren(M,p,T,o);for(const I of i){let L=this._tiles[I.key];if(L.hasData())continue;if(I.canonical.z>=this._source.maxzoom){const F=I.children(this._source.maxzoom)[0],N=this.getTile(F);if(N&&N.hasData()){o[F.key]=F;continue}}else{const F=I.children(this._source.maxzoom);if(o[F[0].key]&&o[F[1].key]&&o[F[2].key]&&o[F[3].key])continue}let O=L.wasRequested();for(let F=I.overscaledZ-1;F>=x;--F){const N=I.scaledTo(F);if(h[N.key]||(h[N.key]=!0,L=this.getTile(N),!L&&O&&(L=this._addTile(N)),L&&(o[N.key]=N,O=L.wasRequested(),L.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const o=[];let h,p=this._tiles[i].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}o.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;p=_}for(const _ of o)this._loadedParentTiles[_]=h}}_addTile(i){let o=this._tiles[i.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),o;o=this._cache.getAndRemove(i),o&&(this._setTileReloadTimer(i.key,o),o.tileID=i,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,o)));const h=!!o;if(!h){const p=this.map?this.map.painter:null,_=this._source.tileSize*i.overscaleFactor();o=this._source.type==="raster-array"?new ua(i,_,this.transform.tileZoom,p,this._isRaster):new Ms(i,_,this.transform.tileZoom,p,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,i.key,o.state))}return o?(o.uses++,this._tiles[i.key]=o,h||this._source.fire(new s.b("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(i,o){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const h=o.getExpiryTimeout();h&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},h))}_removeTile(i){const o=this._tiles[i];o&&(o.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,o,h){const p=[],_=this.transform;if(!_)return p;const x=_.projection.name==="globe",T=s.a5(_.center.lng);for(const M in this._tiles){const I=this._tiles[M];if(h&&I.clearQueryDebugViz(),I.holdingForFade())continue;let L;if(x){const O=I.tileID.canonical;if(O.z===0){const F=[Math.abs(s.aa(T,...fl(O,-1))-T),Math.abs(s.aa(T,...fl(O,1))-T)];L=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(s.aa(T,...fl(O,-1))-T),Math.abs(s.aa(T,...fl(O,0))-T),Math.abs(s.aa(T,...fl(O,1))-T)];L=[F.indexOf(Math.min(...F))-1]}}else L=[0];for(const O of L){const F=i.containsTile(I,_,o,O);F&&p.push(F)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,o){const h=this.getRenderableIds(i,o).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of h)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return h}sortCoordinatesByDistance(i){const o=i.slice(),h=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const x of o){const T=1/(1<<x.canonical.z);_[x.key]=((x.canonical.x+.5)*T+x.wrap-h[0])*p[0]+((x.canonical.y+.5)*T-h[1])*p[1]-h[2]*p[2]}return o.sort((x,T)=>_[x.key]-_[T.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(us(this._source.type))for(const i in this._tiles){const o=this._tiles[i];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=s.f.now())return!0}return!1}setFeatureState(i,o,h){this._state.updateState(i=i||"_geojsonTileLayer",o,h)}removeFeatureState(i,o,h){this._state.removeFeatureState(i=i||"_geojsonTileLayer",o,h)}getFeatureState(i,o){return this._state.getState(i=i||"_geojsonTileLayer",o)}setDependencies(i,o,h){const p=this._tiles[i];p&&p.setDependencies(o,h)}reloadTilesForDependencies(i,o){for(const h in this._tiles)this._tiles[h].hasDependency(i,o)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(i,o))}_preloadTiles(i,o){if(!this._sourceLoaded){const M=()=>{this._sourceLoaded&&(this._source.off("data",M),this._preloadTiles(i,o))};return void this._source.on("data",M)}const h=new Map,p=Array.isArray(i)?i:[i],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const M of p){const I=M.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of I)h.set(L.key,L);this.usedForTerrain&&M.updateElevation(!1)}const T=Array.from(h.values());s.b1(T,(M,I)=>{const L=new Ms(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,O=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),I(O,L)})},o)}}function dl(u,i){const o=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*i.wrap)-+(i.wrap<0);return u.overscaledZ-i.overscaledZ||h-o||i.canonical.y-u.canonical.y||i.canonical.x-u.canonical.x}function us(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function fl(u,i){const o=1<<u.z;return[u.x/o+i,(u.x+1)/o+i]}Uo.maxOverzooming=10,Uo.maxUnderzooming=3;class Xu{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,o=!1;for(const h in this.style._mergedLayers){const p=this.style._mergedLayers[h];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:i,visibilityChanged:o});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:i,visibilityChanged:o})}}}onNewFrame(i){this.layersGotHidden=!1;for(const o of this.layers){const h=o.layer;let p=!1;h.type==="fill-extrusion"?p=!h.isHidden(i)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(p=!h.isHidden(i)&&h.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!p&&o.visible,o.visible=p}}updateZOffset(i,o){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,x=this.style.getLayerSourceCache(_);let T=1;_.type==="fill-extrusion"&&(T=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let M=x?x.getTile(o):null;if(!M&&x&&o.canonical.z>x.getSource().minzoom){let I=o.scaledTo(Math.min(x.getSource().maxzoom,o.overscaledZ-1));for(;I.overscaledZ>=x.getSource().minzoom&&(M=x.getTile(I),!M&&I.overscaledZ!==0);)I=I.scaledTo(I.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(_):null,tileID:M?M.tileID:o,verticalScale:T})}i.hasAnyZOffset=!1;let h=!1;for(let p=0;p<i.symbolInstances.length;p++){const _=i.symbolInstances.get(p),x=_.zOffset,T=this._getHeightAtTileOffset(o,_.tileAnchorX,_.tileAnchorY);_.zOffset=T!==Number.NEGATIVE_INFINITY?T:x,h||x===_.zOffset||(h=!0),i.hasAnyZOffset||_.zOffset===0||(i.hasAnyZOffset=!0)}h&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,o,h,p){let _=o,x=h;if(i.canonical.z!==p.canonical.z){const T=p.canonical,M=1/(1<<i.canonical.z-T.z);_=(o+i.canonical.x*s.V)*M-T.x*s.V|0,x=(h+i.canonical.y*s.V)*M-T.y*s.V|0}return{tileX:_,tileY:x}}_getHeightAtTileOffset(i,o,h){let p,_;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:T,tileID:M,verticalScale:I}=this.currentBuildingBuckets[x];if(!T)continue;const{tileX:L,tileY:O}=this._mapCoordToOverlappingTile(i,o,h,M),F=T.getHeightAtTileCoord(L,O);F&&F.height!==void 0&&(F.hidden?p=F.height:_=Math.max(F.height*I,_||0))}if(_!==void 0)return _;for(let x=0;x<this.layers.length;++x){const T=this.layers[x];if(T.layer.type!=="model"||!T.visible)continue;const{bucket:M,tileID:I}=this.currentBuildingBuckets[x];if(!M)continue;const{tileX:L,tileY:O}=this._mapCoordToOverlappingTile(i,o,h,I),F=M.getHeightAtTileCoord(L,O);if(F&&!F.hidden)return F.height===void 0&&p!==void 0?Math.min(F.maxHeight,p)*F.verticalScale:(F.height||0)*F.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function hs(u,i){const o={};for(const h in u)h!=="ref"&&(o[h]=u[h]);return s.b2.forEach(h=>{h in i&&(o[h]=i[h])}),o}function Yl(u){u=u.slice();const i=Object.create(null);for(let o=0;o<u.length;o++)i[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=hs(u[o],i[u[o].ref]));return u}const Kr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Mo(u,i,o){o.push({command:Kr.addSource,args:[u,i[u]]})}function Kl(u,i,o){i.push({command:Kr.removeSource,args:[u]}),o[u]=!0}function Yu(u,i,o,h){Kl(u,o,h),Mo(u,i,o)}function id(u,i,o){let h;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!K(u[o][h],i[o][h]))return!1;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!K(u[o][h],i[o][h]))return!1;return!0}function As(u,i,o,h,p,_){let x;for(x in i=i||{},u=u||{})u.hasOwnProperty(x)&&(K(u[x],i[x])||o.push({command:_,args:[h,x,i[x],p]}));for(x in i)i.hasOwnProperty(x)&&!u.hasOwnProperty(x)&&(K(u[x],i[x])||o.push({command:_,args:[h,x,i[x],p]}))}function Qo(u){return u.id}function pl(u,i){return u[i.id]=i,u}class ha{constructor(i,o){this.reset(i,o)}reset(i,o){this.points=i||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=s.aa(i,0,1);let o=1,h=this._distances[o];const p=i*this.paddedLength+this.padding;for(;h<p&&o<this._distances.length;)h=this._distances[++o];const _=o-1,x=this._distances[_],T=h-x,M=T>0?(p-x)/T:0;return this.points[_].mult(1-M).add(this.points[o].mult(M))}}class Zc{constructor(i,o,h){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(i/h),this.yCellCount=Math.ceil(o/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=o,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,o,h,p,_){this._forEachCell(o,h,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(i,o,h,p){this._forEachCell(o-p,h-p,o+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(o),this.circles.push(h),this.circles.push(p)}_insertBoxCell(i,o,h,p,_,x){this.boxCells[_].push(x)}_insertCircleCell(i,o,h,p,_,x){this.circleCells[_].push(x)}_query(i,o,h,p,_,x){if(h<0||i>this.width||p<0||o>this.height)return!_&&[];const T=[];if(i<=0&&o<=0&&this.width<=h&&this.height<=p){if(_)return!0;for(let M=0;M<this.boxKeys.length;M++)T.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const I=this.circles[3*M],L=this.circles[3*M+1],O=this.circles[3*M+2];T.push({key:this.circleKeys[M],x1:I-O,y1:L-O,x2:I+O,y2:L+O})}return x?T.filter(x):T}return this._forEachCell(i,o,h,p,this._queryCell,T,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?T.length>0:T}_queryCircle(i,o,h,p,_){const x=i-h,T=i+h,M=o-h,I=o+h;if(T<0||x>this.width||I<0||M>this.height)return!p&&[];const L=[];return this._forEachCell(x,M,T,I,this._queryCellCircle,L,{hitTest:p,circle:{x:i,y:o,radius:h},seenUids:{box:{},circle:{}}},_),p?L.length>0:L}query(i,o,h,p,_){return this._query(i,o,h,p,!1,_)}hitTest(i,o,h,p,_){return this._query(i,o,h,p,!0,_)}hitTestCircle(i,o,h,p){return this._queryCircle(i,o,h,!0,p)}_queryCell(i,o,h,p,_,x,T,M){const I=T.seenUids,L=this.boxCells[_];if(L!==null){const F=this.bboxes;for(const N of L)if(!I.box[N]){I.box[N]=!0;const q=4*N;if(i<=F[q+2]&&o<=F[q+3]&&h>=F[q+0]&&p>=F[q+1]&&(!M||M(this.boxKeys[N]))){if(T.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[N],x1:F[q],y1:F[q+1],x2:F[q+2],y2:F[q+3]})}}}const O=this.circleCells[_];if(O!==null){const F=this.circles;for(const N of O)if(!I.circle[N]){I.circle[N]=!0;const q=3*N;if(this._circleAndRectCollide(F[q],F[q+1],F[q+2],i,o,h,p)&&(!M||M(this.circleKeys[N]))){if(T.hitTest)return x.push(!0),!0;{const $=F[q],Z=F[q+1],V=F[q+2];x.push({key:this.circleKeys[N],x1:$-V,y1:Z-V,x2:$+V,y2:Z+V})}}}}}_queryCellCircle(i,o,h,p,_,x,T,M){const I=T.circle,L=T.seenUids,O=this.boxCells[_];if(O!==null){const N=this.bboxes;for(const q of O)if(!L.box[q]){L.box[q]=!0;const $=4*q;if(this._circleAndRectCollide(I.x,I.y,I.radius,N[$+0],N[$+1],N[$+2],N[$+3])&&(!M||M(this.boxKeys[q])))return x.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const N=this.circles;for(const q of F)if(!L.circle[q]){L.circle[q]=!0;const $=3*q;if(this._circlesCollide(N[$],N[$+1],N[$+2],I.x,I.y,I.radius)&&(!M||M(this.circleKeys[q])))return x.push(!0),!0}}}_forEachCell(i,o,h,p,_,x,T,M){const I=this._convertToXCellCoord(i),L=this._convertToYCellCoord(o),O=this._convertToXCellCoord(h),F=this._convertToYCellCoord(p);for(let N=I;N<=O;N++)for(let q=L;q<=F;q++)if(_.call(this,i,o,h,p,this.xCellCount*q+N,x,T,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,o,h,p,_,x){const T=p-i,M=_-o,I=h+x;return I*I>T*T+M*M}_circleAndRectCollide(i,o,h,p,_,x,T){const M=(x-p)/2,I=Math.abs(i-(p+M));if(I>M+h)return!1;const L=(T-_)/2,O=Math.abs(o-(_+L));if(O>L+h)return!1;if(I<=M||O<=L)return!0;const F=I-M,N=O-L;return F*F+N*N<=h*h}}const yo={unknown:0,flipRequired:1,flipNotRequired:2},Is=Math.tan(85*Math.PI/180);function ml(u,i,o,h,p,_,x){const T=s.a6.create();if(o)if(_.name==="globe"){const M=s.b3(p,i);s.a6.multiply(T,T,M)}else{const M=s.b4.invert([],x);T[0]=M[0],T[1]=M[1],T[4]=M[2],T[5]=M[3],h||s.a6.rotateZ(T,T,p.angle)}else s.a6.multiply(T,p.labelPlaneMatrix,u);return T}function Hc(u,i,o,h,p,_,x){const T=ml(u,i,o,h,p,_,x);return _.name==="globe"&&o||(T[2]=T[6]=T[10]=T[14]=0),T}function _l(u,i,o,h,p,_,x){if(o){if(_.name==="globe"){const T=ml(u,i,o,h,p,_,x);return s.a6.invert(T,T),s.a6.multiply(T,u,T),T}{const T=s.a6.clone(u),M=s.a6.identity([]);return M[0]=x[0],M[1]=x[1],M[4]=x[2],M[5]=x[3],s.a6.multiply(T,T,M),h||s.a6.rotateZ(T,T,-p.angle),T}}return p.glCoordMatrix}function uo(u,i,o,h){const p=[u,i,o,1];o?s.a7.transformMat4(p,p,h):xl(p,p,h);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Jl(u,i){return Math.min(.5+u/i*.5,1.5)}function gl(u,i){const o=u[0]/u[3],h=u[1]/u[3];return o>=-i[0]&&o<=i[0]&&h>=-i[1]&&h<=i[1]}function yl(u,i,o,h,p,_,x,T,M,I){const L=o.transform,O=h?u.textSizeData:u.iconSizeData,F=s.b5(O,o.transform.zoom),N=L.projection.name==="globe",q=[256/o.width*2+1,256/o.height*2+1],$=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;$.clear();let Z=null;N&&(Z=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const V=u.lineVertexArray,X=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,ne=o.transform.width/o.transform.height;let J,oe=!1;for(let H=0;H<X.length;H++){const ae=X.get(H),{numGlyphs:he,writingMode:fe}=ae;if(fe!==s.b6.vertical||oe||J===s.b6.horizontal||(oe=!0),J=fe,(ae.hidden||fe===s.b6.vertical)&&!oe){Cs(he,$);continue}oe=!1;const ye=new s.P(ae.tileAnchorX,ae.tileAnchorY);let{x:De,y:Te,z:$e}=L.projection.projectTilePoint(ye.x,ye.y,I.canonical);if(M){const[Ot,Kt,ur]=M(ye);De+=Ot,Te+=Kt,$e+=ur}const je=[De,Te,$e,1];if(s.a7.transformMat4(je,je,i),!gl(je,q)){Cs(he,$);continue}const it=je[3],Ae=Jl(o.transform.getCameraToCenterDistance(L.projection),it),Be=s.b7(O,F,ae),_e=x?Be/Ae:Be*Ae,Le=uo(De,Te,$e,p);if(Le[3]<=0){Cs(he,$);continue}let ot={};const vt=x?null:M,_t=Xc(ae,_e,!1,T,i,p,_,u.glyphOffsetArray,V,$,Z,Le,ye,ot,ne,vt,L.projection,I,x);oe=_t.useVertical,vt&&_t.needsFlipping&&(ot={}),(_t.notEnoughRoom||oe||_t.needsFlipping&&Xc(ae,_e,!0,T,i,p,_,u.glyphOffsetArray,V,$,Z,Le,ye,ot,ne,vt,L.projection,I,x).notEnoughRoom)&&Cs(he,$)}h?(u.text.dynamicLayoutVertexBuffer.updateData($),Z&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(Z)):(u.icon.dynamicLayoutVertexBuffer.updateData($),Z&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(Z))}function da(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$){const{lineStartIndex:Z,glyphStartIndex:V,segment:X}=T,ne=V+T.numGlyphs,J=Z+T.lineLength,oe=i.getoffsetX(V),H=i.getoffsetX(ne-1),ae=vl(u*oe,o,h,p,_,x,X,Z,J,M,I,L,O,F,!0,N,q,$);if(!ae)return null;const he=vl(u*H,o,h,p,_,x,X,Z,J,M,I,L,O,F,!0,N,q,$);return he?{first:ae,last:he}:null}function Wc(u,i,o,h){return u===s.b6.horizontal&&Math.abs(h)>Math.abs(o)?{useVertical:!0}:u===s.b6.vertical?h>0?{needsFlipping:!0}:null:i!==yo.unknown&&function(p,_){return p===0||Math.abs(_/p)>Is}(o,h)?i===yo.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Xc(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V,X){const ne=i/24,J=u.lineOffsetX*ne,oe=u.lineOffsetY*ne,{lineStartIndex:H,glyphStartIndex:ae,numGlyphs:he,segment:fe,writingMode:ye,flipState:De}=u,Te=H+u.lineLength,$e=je=>{if(L){const[_e,Le,ot]=je.up,vt=I.length;s.b8(L,vt+0,_e,Le,ot),s.b8(L,vt+1,_e,Le,ot),s.b8(L,vt+2,_e,Le,ot),s.b8(L,vt+3,_e,Le,ot)}const[it,Ae,Be]=je.point;s.b9(I,it,Ae,Be,je.angle)};if(he>1){const je=da(ne,T,J,oe,o,O,F,u,M,_,N,$,!1,Z,V,X);if(!je)return{notEnoughRoom:!0};if(h&&!o){let[it,Ae,Be]=je.first.point,[_e,Le,ot]=je.last.point;[it,Ae]=uo(it,Ae,Be,x),[_e,Le]=uo(_e,Le,ot,x);const vt=Wc(ye,De,(_e-it)*q,Le-Ae);if(u.flipState=vt&&vt.needsFlipping?yo.flipRequired:yo.flipNotRequired,vt)return vt}$e(je.first);for(let it=ae+1;it<ae+he-1;it++){const Ae=vl(ne*T.getoffsetX(it),J,oe,o,O,F,fe,H,Te,M,_,N,$,!1,!1,Z,V,X);if(!Ae)return I.length-=4*(it-ae),{notEnoughRoom:!0};$e(Ae)}$e(je.last)}else{if(h&&!o){const it=uo(F.x,F.y,0,p),Ae=H+fe+1,Be=new s.P(M.getx(Ae),M.gety(Ae)),_e=uo(Be.x,Be.y,0,p),Le=_e[3]>0?_e:Ql(F,Be,it,1,p,void 0,Z,V.canonical),ot=Wc(ye,De,(Le[0]-it[0])*q,Le[1]-it[1]);if(u.flipState=ot&&ot.needsFlipping?yo.flipRequired:yo.flipNotRequired,ot)return ot}const je=vl(ne*T.getoffsetX(ae),J,oe,o,O,F,fe,H,Te,M,_,N,$,!1,!1,Z,V,X);if(!je)return{notEnoughRoom:!0};$e(je)}return{}}function Fa(u,i,o,h,p){const{x:_,y:x,z:T}=h.projectTilePoint(u.x,u.y,i);if(!p)return uo(_,x,T,o);const[M,I,L]=p(u);return uo(_+M,x+I,T+L,o)}function Ql(u,i,o,h,p,_,x,T){const M=Fa(u.sub(i)._unit()._add(u),T,p,x,_);return s.N.sub(M,o,M),s.N.normalize(M,M),s.N.scaleAndAdd(M,o,M,h)}function vl(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V){const X=h?u-i:u+i;let ne=X>0?1:-1,J=0;h&&(ne*=-1,J=Math.PI),ne<0&&(J+=Math.PI);let oe=T+x+(ne>0?0:1)|0,H=p,ae=p,he=0,fe=0;const ye=Math.abs(X),De=[],Te=[];let $e=_,je=$e;const it=()=>Ql(je,$e,ae,ye-he+1,L,F,$,Z.canonical);for(;he+fe<=ye;){if(oe+=ne,oe<T||oe>=M)return null;if(ae=H,je=$e,De.push(ae),N&&Te.push(je),$e=new s.P(I.getx(oe),I.gety(oe)),H=O[oe],!H){const Kt=Fa($e,Z.canonical,L,$,F);H=Kt[3]>0?O[oe]=Kt:it()}he+=fe,fe=s.N.distance(ae,H)}q&&F&&(O[oe]&&(H=it(),fe=s.N.distance(ae,H)),O[oe]=H);const Ae=(ye-he)/fe,Be=$e.sub(je)._mult(Ae)._add(je),_e=s.N.sub([],H,ae),Le=s.N.scaleAndAdd([],ae,_e,Ae);let ot=[0,0,1],vt=_e[0],_t=_e[1];if(V&&(ot=$.upVector(Z.canonical,Be.x,Be.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const Kt=[ot[2],0,-ot[0]],ur=s.N.cross([],ot,Kt);s.N.normalize(Kt,Kt),s.N.normalize(ur,ur),vt=s.N.dot(_e,Kt),_t=s.N.dot(_e,ur)}if(o){const Kt=s.N.cross([],ot,_e);s.N.normalize(Kt,Kt),s.N.scaleAndAdd(Le,Le,Kt,o*ne)}const Ot=J+Math.atan2(_t,vt);return De.push(Le),N&&Te.push(Be),{point:Le,angle:Ot,path:De,tilePath:Te,up:ot}}function Cs(u,i){const o=i.length,h=o+4*u;i.resize(h),i.float32.fill(-1/0,4*o,4*h)}function xl(u,i,o){const h=i[0],p=i[1];return u[0]=o[0]*h+o[4]*p+o[12],u[1]=o[1]*h+o[5]*p+o[13],u[3]=o[3]*h+o[7]*p+o[15],u}const Zn=100;class Mt{constructor(i,o,h=new Zc(i.width+200,i.height+200,25),p=new Zc(i.width+200,i.height+200,25)){this.transform=i,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Zn,this.screenBottomBoundary=i.height+Zn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=o}placeCollisionBox(i,o,h,p,_,x,T,M){let I=h.projectedAnchorX,L=h.projectedAnchorY,O=h.projectedAnchorZ;const F=h.elevation,N=h.tileID,q=i.getProjection();if(F&&N){const[H,ae,he]=q.upVector(N.canonical,h.tileAnchorX,h.tileAnchorY),fe=q.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;I+=H*F*fe,L+=ae*F*fe,O+=he*F*fe}const $=this.projectAndGetPerspectiveRatio(T,I,L,O,h.tileID,q.name==="globe"||!!F||this.transform.pitch>0,q),Z=x*$.perspectiveRatio,V=(h.x1*o+p.x-h.padding)*Z+$.point.x,X=(h.y1*o+p.y-h.padding)*Z+$.point.y,ne=(h.x2*o+p.x+h.padding)*Z+$.point.x,J=(h.y2*o+p.y+h.padding)*Z+$.point.y,oe=$.perspectiveRatio<=.55||$.occluded;return!this.isInsideGrid(V,X,ne,J)||!_&&this.grid.hitTest(V,X,ne,J,M)||oe?{box:[],offscreen:!1,occluded:$.occluded}:{box:[V,X,ne,J],offscreen:this.isOffscreen(V,X,ne,J),occluded:!1}}placeCollisionCircles(i,o,h,p,_,x,T,M,I,L,O,F,N,q,$){const Z=[],V=this.transform.elevation,X=i.getProjection(),ne=V?V.getAtTileOffsetFunc($,this.transform.center.lat,this.transform.worldSize,X):null,J=new s.P(h.tileAnchorX,h.tileAnchorY);let{x:oe,y:H,z:ae}=X.projectTilePoint(J.x,J.y,$.canonical);if(ne){const[Be,_e,Le]=ne(J);oe+=Be,H+=_e,ae+=Le}const he=X.name==="globe",fe=this.projectAndGetPerspectiveRatio(T,oe,H,ae,$,he||!!V||this.transform.pitch>0,X),{perspectiveRatio:ye}=fe,De=(O?x/ye:x*ye)/s.bc,Te=uo(oe,H,ae,M),$e=fe.signedDistanceFromCamera>0?da(De,_,h.lineOffsetX*De,h.lineOffsetY*De,!1,Te,J,h,p,M,{},V&&!O?ne:null,O&&!!V,X,$,O):null;let je=!1,it=!1,Ae=!0;if($e&&!fe.occluded){const Be=.5*N*ye+q,_e=new s.P(-100,-100),Le=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ot=new ha,{first:vt,last:_t}=$e,Ot=vt.path.length;let Kt=[];for(let ar=Ot-1;ar>=1;ar--)Kt.push(vt.path[ar]);for(let ar=1;ar<_t.path.length;ar++)Kt.push(_t.path[ar]);const ur=2.5*Be;I&&(Kt=Kt.map(([ar,Br,Mr],Or)=>(ne&&!he&&(Mr=ne(Or<Ot-1?vt.tilePath[Ot-1-Or]:_t.tilePath[Or-Ot+2])[2]),uo(ar,Br,Mr,I))),Kt.some(ar=>ar[3]<=0)&&(Kt=[]));let tr=[];if(Kt.length>0){let ar=1/0,Br=-1/0,Mr=1/0,Or=-1/0;for(const Lr of Kt)ar=Math.min(ar,Lr[0]),Mr=Math.min(Mr,Lr[1]),Br=Math.max(Br,Lr[0]),Or=Math.max(Or,Lr[1]);Br>=_e.x&&ar<=Le.x&&Or>=_e.y&&Mr<=Le.y&&(tr=[Kt.map(Lr=>new s.P(Lr[0],Lr[1]))],(ar<_e.x||Br>Le.x||Mr<_e.y||Or>Le.y)&&(tr=s.ba(tr,_e.x,_e.y,Le.x,Le.y)))}for(const ar of tr){ot.reset(ar,.25*Be);let Br=0;Br=ot.length<=.5*Be?1:Math.ceil(ot.paddedLength/ur)+1;for(let Mr=0;Mr<Br;Mr++){const Or=Mr/Math.max(Br-1,1),Lr=ot.lerp(Or),ri=Lr.x+Zn,Bi=Lr.y+Zn;Z.push(ri,Bi,Be,0);const Hr=ri-Be,ln=Bi-Be,Wr=ri+Be,li=Bi+Be;if(Ae=Ae&&this.isOffscreen(Hr,ln,Wr,li),it=it||this.isInsideGrid(Hr,ln,Wr,li),!o&&this.grid.hitTestCircle(ri,Bi,Be,F)&&(je=!0,!L))return{circles:[],offscreen:!1,collisionDetected:je,occluded:!1}}}}return{circles:!L&&je||!it?[]:Z,offscreen:Ae,collisionDetected:je,occluded:fe.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,p=1/0,_=-1/0,x=-1/0;for(const L of i){const O=new s.P(L.x+Zn,L.y+Zn);h=Math.min(h,O.x),p=Math.min(p,O.y),_=Math.max(_,O.x),x=Math.max(x,O.y),o.push(O)}const T=this.grid.query(h,p,_,x).concat(this.ignoredGrid.query(h,p,_,x)),M={},I={};for(const L of T){const O=L.key;if(M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]={}),M[O.bucketInstanceId][O.featureIndex])continue;const F=[new s.P(L.x1,L.y1),new s.P(L.x2,L.y1),new s.P(L.x2,L.y2),new s.P(L.x1,L.y2)];s.bb(o,F)&&(M[O.bucketInstanceId][O.featureIndex]=!0,I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]=[]),I[O.bucketInstanceId].push(O.featureIndex))}return I}insertCollisionBox(i,o,h,p,_){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:p,collisionGroupID:_},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,o,h,p,_){const x=o?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:p,collisionGroupID:_};for(let M=0;M<i.length;M+=4)x.insertCircle(T,i[M],i[M+1],i[M+2])}projectAndGetPerspectiveRatio(i,o,h,p,_,x,T){const M=[o,h,p,1];let I=!1;p||this.transform.pitch>0?(s.a7.transformMat4(M,M,i),this.fogState&&_&&T.name!=="globe"&&(I=function(F,N,q,$,Z,V){const X=V.calculateFogTileMatrix(Z),ne=[N,q,$];return s.N.transformMat4(ne,ne,X),ii(F,s.N.length(ne),V.pitch,V._fov)}(this.fogState,o,h,p,_.toUnwrapped(),this.transform)>.9)):xl(M,M,i);const L=M[3];return{point:new s.P((M[0]/L+1)/2*this.transform.width+Zn,(-M[1]/L+1)/2*this.transform.height+Zn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/L*.5,1.5),signedDistanceFromCamera:L,occluded:x&&M[2]>L||I}}isOffscreen(i,o,h,p){return h<Zn||i>=this.screenRightBoundary||p<Zn||o>this.screenBottomBoundary}isInsideGrid(i,o,h,p){return h>=0&&i<this.gridRightBoundary&&p>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const i=s.a6.identity([]);return s.a6.translate(i,i,[-100,-100,0]),i}}function ds(u,i,o){const h=i.createTileMatrix(u,u.worldSize,o.toUnwrapped());return s.a6.multiply(new Float32Array(16),u.projMatrix,h)}function Ba(u,i,o){if(i.projection.name===o.projection.name)return u.projMatrix;const h=o.clone();return h.setProjection(i.projection),ds(h,i.getProjection(),u)}function jo(u,i,o){return i.name===o.projection.name?u.projMatrix:ds(o,i,u)}class Yc{constructor(i,o,h,p){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?o:-o))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class es{constructor(i,o,h,p,_,x=!1){this.text=new Yc(i?i.text:null,o,h,_),this.icon=new Yc(i?i.icon:null,o,p,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vo{constructor(i,o,h,p=!1){this.text=i,this.icon=o,this.skipFade=h,this.clipped=p}}class ec{constructor(){this.invProjMatrix=s.a6.create(),this.viewportMatrix=s.a6.create(),this.circles=[]}}class Hs{constructor(i,o,h,p,_){this.bucketInstanceId=i,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=_}}class tc{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const o=++this.maxGroupID;this.collisionGroups[i]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[i]}}function fa(u,i,o,h,p){const{horizontalAlign:_,verticalAlign:x}=s.bf(u),T=-(_-.5)*i,M=-(x-.5)*o,I=s.bd(u,h);return new s.P(T+I[0]*p,M+I[1]*p)}function rc(u,i,o,h,p){const _=new s.P(u,i);return o&&_._rotate(h?p:-p),_}class Ku{constructor(i,o,h,p,_,x){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Mt(this.transform,_),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new tc(h),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,o,h,p){const _=h.getBucket(o),x=h.latestFeatureIndex;if(!_||!x||o.fqid!==_.layerIds[0])return;const T=_.layers[0].layout,M=h.collisionBoxArray,I=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),L=h.tileSize/s.V,O=h.tileID.toUnwrapped();this.transform.setProjection(_.projection);const F=(N=h.tileID,q=_.getProjection(),$=this.transform,q.name===this.projection?$.calculateProjMatrix(N.toUnwrapped()):ds($,q,N));var N,q,$;const Z=T.get("text-pitch-alignment")==="map",V=T.get("text-rotation-alignment")==="map";o.compileFilter();const X=o.dynamicFilter(),ne=o.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(h),oe=Hc(F,h.tileID.canonical,Z,V,this.transform,_.getProjection(),J);let H=null;if(Z){const fe=_l(F,h.tileID.canonical,Z,V,this.transform,_.getProjection(),J);H=s.a6.multiply([],this.transform.labelPlaneMatrix,fe)}let ae=null;X&&h.latestFeatureIndex&&(ae={unwrappedTileID:O,dynamicFilter:X,dynamicFilterNeedsFeature:ne,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new Hs(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,h.tileID);const he={bucket:_,layout:T,posMatrix:F,textLabelPlaneMatrix:oe,labelToScreenMatrix:H,clippingData:ae,scale:I,textPixelRatio:L,holdingForFade:h.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.b5(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.b5(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(p)for(const fe of _.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:De,symbolInstanceEnd:Te}=fe;i.push({sortKey:ye,symbolInstanceStart:De,symbolInstanceEnd:Te,parameters:he})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:he})}attemptAnchorPlacement(i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V,X){const{textOffset0:ne,textOffset1:J,crossTileID:oe}=F,H=[ne,J],ae=fa(i,h,p,H,_),he=this.collisionIndex.placeCollisionBox(q,_,o,rc(ae.x,ae.y,x,T,this.transform.angle),O,M,I,L.predicate);if(Z){const fe=q.getSymbolInstanceIconSize(X,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,fe,Z,rc(ae.x,ae.y,x,T,this.transform.angle),O,M,I,L.predicate).box.length===0)return}if(he.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(fe=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:H,width:h,height:p,anchor:i,textScale:_,prevAnchor:fe},this.markUsedJustification(q,i,F,$),q.allowVerticalPlacement&&(this.markUsedOrientation(q,$,F),this.placedOrientations[oe]=$),{shift:ae,placedGlyphBoxes:he}}}placeLayerBucketPart(i,o,h,p){const{bucket:_,layout:x,posMatrix:T,textLabelPlaneMatrix:M,labelToScreenMatrix:I,clippingData:L,textPixelRatio:O,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:$,collisionGroup:Z}=i.parameters,V=x.get("text-optional"),X=x.get("icon-optional"),ne=x.get("text-allow-overlap"),J=x.get("icon-allow-overlap"),oe=x.get("text-rotation-alignment")==="map",H=x.get("text-pitch-alignment")==="map",ae=x.get("symbol-z-order")==="viewport-y",he=x.get("symbol-z-elevate");this.transform.setProjection(_.projection);let fe=ne&&(J||!_.hasIconData()||X),ye=J&&(ne||!_.hasTextData()||V);!_.collisionArrays&&N&&_.deserializeCollisionBoxes(N),h&&p&&_.updateCollisionDebugBuffers(this.transform.zoom,N);const De=(Te,$e,je)=>{const{crossTileID:it,numVerticalGlyphVertices:Ae}=Te;if(L){const Wr={zoom:this.transform.zoom,pitch:this.transform.pitch};let li=null;if(L.dynamicFilterNeedsFeature){const Xr=this.retainedQueryData[_.bucketInstanceId];li=L.featureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:Xr.bucketIndex,sourceLayerIndex:Xr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Wr,li,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new s.P(Te.tileAnchorX,Te.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[it]=new vo(!1,!1,!1,!0),void o.add(it)}if(o.has(it))return;if(F)return void(this.placements[it]=new vo(!1,!1,!1));let Be=!1,_e=!1,Le=!0,ot=!1,vt=!1,_t=null,Ot={box:null,offscreen:null,occluded:null},Kt={box:null,offscreen:null,occluded:null},ur=null,tr=null,ar=null,Br=0,Mr=0,Or=0;je.textFeatureIndex?Br=je.textFeatureIndex:Te.useRuntimeCollisionCircles&&(Br=Te.featureIndex),je.verticalTextFeatureIndex&&(Mr=je.verticalTextFeatureIndex);const Lr=Wr=>{Wr.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const li=this.transform.elevation;Wr.elevation=Te.zOffset+(li?li.getAtTileOffset(Wr.tileID,Wr.tileAnchorX,Wr.tileAnchorY):0)},ri=je.textBox;if(ri){Lr(ri);const Wr=Xr=>{let si=s.b6.horizontal;if(_.allowVerticalPlacement&&!Xr&&this.prevPlacement){const qi=this.prevPlacement.placedOrientations[it];qi&&(this.placedOrientations[it]=qi,si=qi,this.markUsedOrientation(_,si,Te))}return si},li=(Xr,si)=>{if(_.allowVerticalPlacement&&Ae>0&&je.verticalTextBox){for(const qi of _.writingModes)if(qi===s.b6.vertical?(Ot=si(),Kt=Ot):Ot=Xr(),Ot&&Ot.box&&Ot.box.length)break}else Ot=Xr()};if(x.get("text-variable-anchor")){let Xr=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[it]){const pi=this.prevPlacement.variableOffsets[it];Xr.indexOf(pi.anchor)>0&&(Xr=Xr.filter(Wn=>Wn!==pi.anchor),Xr.unshift(pi.anchor))}const si=(pi,Wn,ho)=>{const qo=_.getSymbolInstanceTextSize(q,Te,this.transform.zoom,$e),ra=(pi.x2-pi.x1)*qo+2*pi.padding,Zo=(pi.y2-pi.y1)*qo+2*pi.padding,Xn=Te.hasIconTextFit&&!J?Wn:null;Xn&&Lr(Xn);let Un={box:[],offscreen:!1,occluded:!1};const Co=ne?2*Xr.length:Xr.length;for(let ko=0;ko<Co;++ko){const Ho=this.attemptAnchorPlacement(Xr[ko%Xr.length],pi,ra,Zo,qo,oe,H,O,T,Z,ko>=Xr.length,Te,$e,_,ho,Xn,q,$);if(Ho&&(Un=Ho.placedGlyphBoxes,Un&&Un.box&&Un.box.length)){Be=!0,_t=Ho.shift;break}}return Un};li(()=>si(ri,je.iconBox,s.b6.horizontal),()=>{const pi=je.verticalTextBox;return pi&&Lr(pi),_.allowVerticalPlacement&&!(Ot&&Ot.box&&Ot.box.length)&&Ae>0&&pi?si(pi,je.verticalIconBox,s.b6.vertical):{box:null,offscreen:null,occluded:null}}),Ot&&(Be=Ot.box,Le=Ot.offscreen,ot=Ot.occluded);const qi=Wr(!(!Ot||!Ot.box));if(!Be&&this.prevPlacement){const pi=this.prevPlacement.variableOffsets[it];pi&&(this.variableOffsets[it]=pi,this.markUsedJustification(_,pi.anchor,Te,qi))}}else{const Xr=(si,qi)=>{const pi=_.getSymbolInstanceTextSize(q,Te,this.transform.zoom,$e),Wn=this.collisionIndex.placeCollisionBox(_,pi,si,new s.P(0,0),ne,O,T,Z.predicate);return Wn&&Wn.box&&Wn.box.length&&(this.markUsedOrientation(_,qi,Te),this.placedOrientations[it]=qi),Wn};li(()=>Xr(ri,s.b6.horizontal),()=>{const si=je.verticalTextBox;return _.allowVerticalPlacement&&Ae>0&&si?(Lr(si),Xr(si,s.b6.vertical)):{box:null,offscreen:null,occluded:null}}),Wr(!!(Ot&&Ot.box&&Ot.box.length))}}if(ur=Ot,Be=ur&&ur.box&&ur.box.length>0,Le=ur&&ur.offscreen,ot=ur&&ur.occluded,Te.useRuntimeCollisionCircles){const Wr=_.text.placedSymbolArray.get(Te.centerJustifiedTextSymbolIndex>=0?Te.centerJustifiedTextSymbolIndex:Te.verticalPlacedTextSymbolIndex),li=s.b7(_.textSizeData,q,Wr),Xr=x.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(_,ne,Wr,_.lineVertexArray,_.glyphOffsetArray,li,T,M,I,h,H,Z.predicate,Te.collisionCircleDiameter*li/s.bc,Xr,this.retainedQueryData[_.bucketInstanceId].tileID),Be=ne||tr.circles.length>0&&!tr.collisionDetected,Le=Le&&tr.offscreen,ot=tr.occluded}if(je.iconFeatureIndex&&(Or=je.iconFeatureIndex),je.iconBox){const Wr=li=>{Lr(li);const Xr=Te.hasIconTextFit&&_t?rc(_t.x,_t.y,oe,H,this.transform.angle):new s.P(0,0),si=_.getSymbolInstanceIconSize($,this.transform.zoom,Te.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,si,li,Xr,J,O,T,Z.predicate)};Kt&&Kt.box&&Kt.box.length&&je.verticalIconBox?(ar=Wr(je.verticalIconBox),_e=ar.box.length>0):(ar=Wr(je.iconBox),_e=ar.box.length>0),Le=Le&&ar.offscreen,vt=ar.occluded}const Bi=V||Te.numHorizontalGlyphVertices===0&&Ae===0,Hr=X||Te.numIconVertices===0;if(Bi||Hr?Hr?Bi||(_e=_e&&Be):Be=_e&&Be:_e=Be=_e&&Be,Be&&ur&&ur.box&&this.collisionIndex.insertCollisionBox(ur.box,x.get("text-ignore-placement"),_.bucketInstanceId,Kt&&Kt.box&&Mr?Mr:Br,Z.ID),_e&&ar&&this.collisionIndex.insertCollisionBox(ar.box,x.get("icon-ignore-placement"),_.bucketInstanceId,Or,Z.ID),tr&&(Be&&this.collisionIndex.insertCollisionCircles(tr.circles,x.get("text-ignore-placement"),_.bucketInstanceId,Br,Z.ID),h)){const Wr=_.bucketInstanceId;let li=this.collisionCircleArrays[Wr];li===void 0&&(li=this.collisionCircleArrays[Wr]=new ec);for(let Xr=0;Xr<tr.circles.length;Xr+=4)li.circles.push(tr.circles[Xr+0]),li.circles.push(tr.circles[Xr+1]),li.circles.push(tr.circles[Xr+2]),li.circles.push(tr.collisionDetected?1:0)}const ln=_.projection.name!=="globe";fe=fe&&(ln||!ot),ye=ye&&(ln||!vt),this.placements[it]=new vo(Be||fe,_e||ye,Le||_.justReloaded),o.add(it)};if(he&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,this.retainedQueryData[_.bucketInstanceId].tileID),_.updateZOffset()),ae){const Te=_.getSortedSymbolIndexes(this.transform.angle);for(let $e=Te.length-1;$e>=0;--$e){const je=Te[$e];De(_.symbolInstances.get(je),je,_.collisionArrays[je])}_.hasAnyZOffset&&s.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const Te=_.getSortedIndexesByZOffset();for(let $e=0;$e<Te.length;++$e){const je=Te[$e];De(_.symbolInstances.get(je),je,_.collisionArrays[je])}}else for(let Te=i.symbolInstanceStart;Te<i.symbolInstanceEnd;Te++)De(_.symbolInstances.get(Te),Te,_.collisionArrays[Te]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[_.bucketInstanceId];s.a6.invert(Te.invProjMatrix,T),Te.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(i,o,h,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:M,crossTileID:I}=h,L=s.be(o),O=p===s.b6.vertical?M:L==="left"?_:L==="center"?x:L==="right"?T:-1;_>=0&&(i.text.placedSymbolArray.get(_).crossTileID=O>=0&&_!==O?0:I),x>=0&&(i.text.placedSymbolArray.get(x).crossTileID=O>=0&&x!==O?0:I),T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=O>=0&&T!==O?0:I),M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=O>=0&&M!==O?0:I)}markUsedOrientation(i,o,h){const p=o===s.b6.horizontal||o===s.b6.horizontalOnly?o:0,_=o===s.b6.vertical?o:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:I}=h,L=i.text.placedSymbolArray;x>=0&&(L.get(x).placedOrientation=p),T>=0&&(L.get(T).placedOrientation=p),M>=0&&(L.get(M).placedOrientation=p),I>=0&&(L.get(I).placedOrientation=_)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const p=o?o.symbolFadeChange(i):1,_=o?o.opacities:{},x=o?o.variableOffsets:{},T=o?o.placedOrientations:{};for(const M in this.placements){const I=this.placements[M],L=_[M];L?(this.opacities[M]=new es(L,p,I.text,I.icon,null,I.clipped),h=h||I.text!==L.text.placed||I.icon!==L.icon.placed):(this.opacities[M]=new es(null,p,I.text,I.icon,I.skipFade,I.clipped),h=h||I.text||I.icon)}for(const M in _){const I=_[M];if(!this.opacities[M]){const L=new es(I,p,!1,!1);L.isHidden()||(this.opacities[M]=L,h=h||I.text.placed||I.icon.placed)}}for(const M in x)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=x[M]);for(const M in T)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=T[M]);h?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:i)}updateLayerOpacities(i,o){const h=new Set;for(const p of o){const _=p.getBucket(i);_&&p.latestFeatureIndex&&i.fqid===_.layerIds[0]&&(this.updateBucketOpacities(_,h,p.collisionBoxArray),_.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,p.tileID),_.updateZOffset()))}}updateBucketOpacities(i,o,h){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const p=i.layers[0].layout,_=!!i.layers[0].dynamicFilter(),x=new es(null,0,!1,!1,!0),T=p.get("text-allow-overlap"),M=p.get("icon-allow-overlap"),I=p.get("text-variable-anchor"),L=p.get("text-rotation-alignment")==="map",O=p.get("text-pitch-alignment")==="map",F=new es(null,0,T&&(M||!i.hasIconData()||p.get("icon-optional")),M&&(T||!i.hasTextData()||p.get("text-optional")),!0);!i.collisionArrays&&h&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(h);const N=($,Z,V)=>{for(let X=0;X<Z/4;X++)$.opacityVertexArray.emplaceBack(V)};let q=0;for(let $=0;$<i.symbolInstances.length;$++){const Z=i.symbolInstances.get($),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:X,crossTileID:ne,numIconVertices:J}=Z,oe=o.has(ne);let H=this.opacities[ne];oe?H=x:H||(H=F,this.opacities[ne]=H),o.add(ne);const ae=V>0||X>0,he=J>0,fe=this.placedOrientations[ne],ye=fe===s.b6.vertical,De=fe===s.b6.horizontal||fe===s.b6.horizontalOnly;if(!ae&&!he||H.isHidden()||q++,ae){const Te=bl(H.text);N(i.text,V,ye?ma:Te),N(i.text,X,De?ma:Te);const $e=H.text.isHidden(),{leftJustifiedTextSymbolIndex:je,centerJustifiedTextSymbolIndex:it,rightJustifiedTextSymbolIndex:Ae,verticalPlacedTextSymbolIndex:Be}=Z,_e=i.text.placedSymbolArray,Le=$e||ye?1:0;je>=0&&(_e.get(je).hidden=Le),it>=0&&(_e.get(it).hidden=Le),Ae>=0&&(_e.get(Ae).hidden=Le),Be>=0&&(_e.get(Be).hidden=$e||De?1:0);const ot=this.variableOffsets[ne];ot&&this.markUsedJustification(i,ot.anchor,Z,fe);const vt=this.placedOrientations[ne];vt&&(this.markUsedJustification(i,"left",Z,vt),this.markUsedOrientation(i,vt,Z))}if(he){const Te=bl(H.icon),{placedIconSymbolIndex:$e,verticalPlacedIconSymbolIndex:je}=Z,it=i.icon.placedSymbolArray,Ae=H.icon.isHidden()?1:0;$e>=0&&(N(i.icon,J,ye?ma:Te),it.get($e).hidden=Ae),je>=0&&(N(i.icon,Z.numVerticalIconVertices,De?ma:Te),it.get(je).hidden=Ae)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Te=i.collisionArrays[$];if(Te){let $e=new s.P(0,0),je=!0;if(Te.textBox||Te.verticalTextBox){if(I){const Ae=this.variableOffsets[ne];Ae?($e=fa(Ae.anchor,Ae.width,Ae.height,Ae.textOffset,Ae.textScale),L&&$e._rotate(O?this.transform.angle:-this.transform.angle)):je=!1}_&&(je=!H.clipped),Te.textBox&&Ps(i.textCollisionBox.collisionVertexArray,H.text.placed,!je||ye,$e.x,$e.y),Te.verticalTextBox&&Ps(i.textCollisionBox.collisionVertexArray,H.text.placed,!je||De,$e.x,$e.y)}const it=je&&!!(!De&&Te.verticalIconBox);Te.iconBox&&Ps(i.iconCollisionBox.collisionVertexArray,H.icon.placed,it,Z.hasIconTextFit?$e.x:0,Z.hasIconTextFit?$e.y:0),Te.verticalIconBox&&Ps(i.iconCollisionBox.collisionVertexArray,H.icon.placed,!it,Z.hasIconTextFit?$e.x:0,Z.hasIconTextFit?$e.y:0)}}}if(i.fullyClipped=q===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=$.invProjMatrix,i.placementViewportMatrix=$.viewportMatrix,i.collisionCircleArray=$.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>i}setStale(){this.stale=!0}}function Ps(u,i,o,h,p){u.emplaceBack(i?1:0,o?1:0,h||0,p||0),u.emplaceBack(i?1:0,o?1:0,h||0,p||0),u.emplaceBack(i?1:0,o?1:0,h||0,p||0),u.emplaceBack(i?1:0,o?1:0,h||0,p||0)}const Na=Math.pow(2,25),Ju=Math.pow(2,24),Ls=Math.pow(2,17),Kc=Math.pow(2,16),pa=Math.pow(2,9),Qu=Math.pow(2,8),nd=Math.pow(2,1);function bl(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const i=u.placed?1:0,o=Math.floor(127*u.opacity);return o*Na+i*Ju+o*Ls+i*Kc+o*pa+i*Qu+o*nd+i}const ma=0;class eh{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,o,h,p,_){const x=this._bucketParts;for(;this._currentTileIndex<i.length;)if(o.getBucketParts(x,p,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((T,M)=>T.sortKey-M.sortKey));this._currentPartIndex<x.length;){const T=x[this._currentPartIndex];if(o.placeLayerBucketPart(T,this._seenCrossTileIDs,h,T.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class wl{constructor(i,o,h,p,_,x,T,M,I){this.placement=new Ku(i,_,x,T,M,I),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(i,o,h,p){const _=s.f.now(),x=()=>{const T=s.f.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=o[i[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){const I=T,L=I.layout.get("symbol-z-elevate"),O=this._inProgressLayer=this._inProgressLayer||new eh(I),F=s.ag(T.source,T.scope);if(O.continuePlacement(L?p[F]:h[F],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ic=512/s.V/2;class Ua{constructor(i,o,h){this.tileID=i,this.bucketInstanceId=h,this.index=new s.bg(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=i.canonical.x*s.V,_=i.canonical.y*s.V;for(let x=0;x<o.length;x++){const{key:T,crossTileID:M,tileAnchorX:I,tileAnchorY:L}=o.get(x),O=Math.floor((p+I)*ic),F=Math.floor((_+L)*ic);this.index.add(O,F),this.keys.push(T),this.crossTileIDs.push(M)}this.index.finish()}findMatches(i,o,h){const p=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),_=ic/Math.pow(2,o.canonical.z-this.tileID.canonical.z),x=o.canonical.x*s.V,T=o.canonical.y*s.V;for(let M=0;M<i.length;M++){const I=i.get(M);if(I.crossTileID)continue;const{key:L,tileAnchorX:O,tileAnchorY:F}=I,N=Math.floor((x+O)*_),q=Math.floor((T+F)*_),$=this.index.range(N-p,q-p,N+p,q+p);for(const Z of $){const V=this.crossTileIDs[Z];if(this.keys[Z]===L&&!h.has(V)){h.add(V),I.crossTileID=V;break}}}}}class nc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const o=Math.round((i-this.lng)/360);if(o!==0)for(const h in this.indexes){const p=this.indexes[h],_={};for(const x in p){const T=p[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+o),_[T.tileID.key]=T}this.indexes[h]=_}this.lng=i}addBucket(i,o,h){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let _=0;_<o.symbolInstances.length;_++)o.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const p=this.usedCrossTileIDs[i.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>i.overscaledZ)for(const T in x){const M=x[T];M.tileID.isChildOf(i)&&M.findMatches(o.symbolInstances,i,p)}else{const T=x[i.scaledTo(Number(_)).key];T&&T.findMatches(o.symbolInstances,i,p)}}for(let _=0;_<o.symbolInstances.length;_++){const x=o.symbolInstances.get(_);x.crossTileID||(x.crossTileID=h.generate(),p.add(x.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ua(i,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(i,o){for(const h of o.crossTileIDs)this.usedCrossTileIDs[i].delete(h)}removeStaleBuckets(i){let o=!1;for(const h in this.indexes){const p=this.indexes[h];for(const _ in p)i[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[_]),delete p[_],o=!0)}return o}}class ke{constructor(){this.layerIndexes={},this.crossTileIDs=new nc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,o,h,p){let _=this.layerIndexes[i.fqid];_===void 0&&(_=this.layerIndexes[i.fqid]=new oc);let x=!1;const T={};p.name!=="globe"&&_.handleWrapJump(h);for(const M of o){const I=M.getBucket(i);I&&i.fqid===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(M.tileID,I,this.crossTileIDs)&&(x=!0),T[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(i){const o={};i.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}class et{constructor(i=0,o=0,h=0,p=0){if(isNaN(i)||i<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=o,this.left=h,this.right=p}interpolate(i,o,h){return o.top!=null&&i.top!=null&&(this.top=s.U(i.top,o.top,h)),o.bottom!=null&&i.bottom!=null&&(this.bottom=s.U(i.bottom,o.bottom,h)),o.left!=null&&i.left!=null&&(this.left=s.U(i.left,o.left,h)),o.right!=null&&i.right!=null&&(this.right=s.U(i.right,o.right,h)),this}getCenter(i,o){const h=s.aa((this.left+i-this.right)/2,0,i),p=s.aa((this.top+o-this.bottom)/2,0,o);return new s.P(h,p)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new et(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function er(u,i){const o=s.bk(u,3);s.a6.fromQuat(u,i),s.bm(u,3,o)}function Cr(u,i){const o=s.bi.identity([]);return s.bi.rotateZ(o,o,-i),s.bi.rotateX(o,o,-u),o}function Ji(u,i){const o=[u[0],u[1],0],h=[i[0],i[1],0];if(s.N.length(o)>=1e-15){const x=s.N.normalize([],o);s.N.scale(h,x,s.N.dot(h,x)),i[0]=h[0],i[1]=h[1]}const p=s.N.cross([],i,u);if(s.N.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return Cr(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class mi{constructor(i,o){this.position=i,this.orientation=o}get position(){return this._position}set position(i){if(i){const o=i instanceof s.L?i:new s.L(i[0],i[1],i[2]);this._renderWorldCopies&&(o.x=s.bh(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(i,o){if(this.orientation=null,!this.position)return;const h=this.position,p=this._elevation?this._elevation.getAtPointOrZero(s.L.fromLngLat(i)):0,_=s.L.fromLngLat(i,p),x=[_.x-h.x,_.y-h.y,_.z-h.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Ji(x,o)}setPitchBearing(i,o){this.orientation=Cr(s.bj(i),s.bj(-o))}}class Qi{constructor(i,o){this._transform=s.a6.identity([]),this.orientation=o,this.position=i}get mercatorPosition(){const i=this.position;return new s.L(i[0],i[1],i[2])}get position(){const i=s.bk(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var o;i&&s.bm(this._transform,3,[(o=i)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||s.bi.identity([]),i&&er(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,o){this._orientation=Cr(i,o),er(this._transform,this._orientation)}forward(){const i=s.bk(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=s.bk(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=s.bk(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,o){const h=new Float64Array(16);return s.a6.invert(h,this.getWorldToCamera(i,o)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,o,h){const p=this.position;s.N.scale(p,p,-i);const _=new Float64Array(16);return s.a6.fromScaling(_,[h,h,h]),s.a6.translate(_,_,p),_[10]*=o,_}getWorldToCamera(i,o){const h=new Float64Array(16),p=new Float64Array(4),_=this.position;return s.bi.conjugate(p,this._orientation),s.N.scale(_,_,-i),s.a6.fromQuat(h,p),s.a6.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=o,h[9]*=o,h[10]*=o,h[11]*=o,h}getCameraToClipPerspective(i,o,h,p){const _=new Float64Array(16);return s.a6.perspective(_,i,o,h,p),_}getCameraToClipOrthographic(i,o,h,p,_,x){const T=new Float64Array(16);return s.a6.ortho(T,i,o,h,p,_,x),T}getDistanceToElevation(i,o=!1){const h=i===0?0:s.bl(i,o?s.au(this.position[1]):this.position[1]),p=this.forward();return(h-this.position[2])/p[2]}clone(){return new Qi([...this.position],[...this.orientation])}}const dn=(u,i,o)=>(1-o)*u+o*i,xo=u=>u*u*u*u*u;class Mn{constructor(i,o,h,p,_,x,T){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=i||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=p??60,this.setProjection(x),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new s.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new et,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new Mn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,o=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(i||h)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.ac(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.bo(this.projectionOptions);const h=!K(o,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.bo({name:"mercator"});const o=i!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bh(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const o=-i*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.b4.create(),s.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const o=s.aa(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=s.bj(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const o=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let p=0,_=0;for(let x=0;x<o.length;x++){const T=new s.P(o[x][0]*this.width,h+o[x][1]*(this.height-h)),M=i.pointCoordinate(T);if(!M)continue;const I=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);p+=M[3]*I,_+=I}return _===0?NaN:p/_}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*o,p=this._mercatorZfromZoom(i),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(p-h,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let h;h=i.z<this._camera.position[2]?[o.x,o.y,o.z]:[i.x,i.y,i.z];const p=s.N.length(s.N.sub([],this._camera.position,h));return s.aa(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let o=!1;if(i.orientation&&!s.bi.exactEquals(i.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(i.orientation)),i.position){const h=[i.position.x,i.position.y,i.position.z];s.N.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,o=new mi;return o.position=new s.L(i[0],i[1],i[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(i){if(!s.bi.length(i))return!1;s.bi.normalize(i,i);const o=s.N.transformQuat([],[0,0,-1],i),h=s.N.transformQuat([],[0,-1,0],i);if(h[2]<0)return!1;const p=Ji(o,h);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(i){const o=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;i[2]=s.aa(i[2],p/h,p/o),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,o,h){this._unmodified=!1,this._edgeInsets.interpolate(i,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const o=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(i){const o=[new s.bp(0,i)];if(this.renderWorldCopies){const h=this.pointCoordinate(new s.P(0,0)),p=this.pointCoordinate(new s.P(this.width,0)),_=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),T=Math.floor(Math.min(h.x,p.x,_.x,x.x)),M=Math.floor(Math.max(h.x,p.x,_.x,x.x)),I=1;for(let L=T-I;L<=M+I;L++)L!==0&&o.push(new s.bp(L,i))}return o}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,o,h){let p=[];if(o[0]===0&&o[1]===0)return p;for(const x of i){const T=x.canonical,M=x.overscaledZ,I=x.wrap,L=1<<T.z,O=T.x+1<L,F=T.x>0,N=T.y+1<L,q=T.y>0,$=x.wrap-(F?0:1),Z=x.wrap+(O?0:1),V=F?T.x-1:L-1,X=O?T.x+1:0;o[0]<0?(p.push(new s.am(M,Z,T.z,X,T.y)),o[1]<0&&N&&(p.push(new s.am(M,I,T.z,T.x,T.y+1)),p.push(new s.am(M,Z,T.z,X,T.y+1))),o[1]>0&&q&&(p.push(new s.am(M,I,T.z,T.x,T.y-1)),p.push(new s.am(M,Z,T.z,X,T.y-1)))):o[0]>0?(p.push(new s.am(M,$,T.z,V,T.y)),o[1]<0&&N&&(p.push(new s.am(M,I,T.z,T.x,T.y+1)),p.push(new s.am(M,$,T.z,V,T.y+1))),o[1]>0&&q&&(p.push(new s.am(M,I,T.z,T.x,T.y-1)),p.push(new s.am(M,$,T.z,V,T.y-1)))):o[1]<0&&N?p.push(new s.am(M,I,T.z,T.x,T.y+1)):q&&p.push(new s.am(M,I,T.z,T.x,T.y-1))}if(p.length>1){p.sort((M,I)=>M.overscaledZ-I.overscaledZ||M.wrap-I.wrap||M.canonical.z-I.canonical.z||M.canonical.x-I.canonical.x||M.canonical.y-I.canonical.y);let x=0,T=0;for(;T<p.length;)p[T].equals(p[x])?++T:p[++x]=p[T++];p.length=x+1}const _=[];for(const x of p)p.some(T=>x.isChildOf(T))||_.push(x);return p=_.filter(x=>!i.some(T=>!!(x.overscaledZ<h&&T.isChildOf(x))||x.equals(T)||x.isChildOf(T))),p}coveringTiles(i){let o=this.coveringZoomLevel(i);const h=o,p=this.elevation&&this.elevation.exaggeration(),_=p&&!i.isTerrainDEM,x=this.projection.name==="mercator";if(i.minzoom!==void 0&&o<i.minzoom)return[];i.maxzoom!==void 0&&o>i.maxzoom&&(o=i.maxzoom);const T=this.locationCoordinate(this.center),M=this.center.lat,I=1<<o,L=[I*T.x,I*T.y,0],O=this.projection.name==="globe",F=!O,N=s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,F),q=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=I*s.bl(1,this.center.lat),Z=this._camera.position[2]/s.bl(1,this.center.lat),V=[I*q.x,I*q.y,Z*(F?1:$)],X=O||p,ne=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),J=this.isLODDisabled(!0)?o:0;let oe;if(this._elevation&&i.isTerrainDEM)oe=1e4*this._elevation.exaggeration();else if(this._elevation){const _e=this._elevation.getMinMaxForVisibleTiles();oe=_e?_e.max:this._centerAltitude}else oe=this._centerAltitude;const H=i.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?s.br(this):1,he=_e=>{const ot=new s.L(_e.x+25e-6,_e.y,_e.z),vt=new s.L(_e.x,_e.y+25e-6,_e.z),_t=_e.toLngLat(),Ot=ot.toLngLat(),Kt=vt.toLngLat(),ur=this.locationCoordinate(_t),tr=this.locationCoordinate(Ot),ar=this.locationCoordinate(Kt),Br=Math.hypot(tr.x-ur.x,tr.y-ur.y),Mr=Math.hypot(ar.x-ur.x,ar.y-ur.y);return Math.sqrt(Br*Mr)*ae/25e-6},fe=_e=>{const Le=oe,ot=H;return{aabb:s.bu(this,I,0,0,0,_e,ot,Le,this.projection),zoom:0,x:0,y:0,minZ:ot,maxZ:Le,wrap:_e,fullyVisible:!1}},ye=[];let De=[];const Te=o,$e=i.reparseOverscaled?h:o,je=_e=>_e*_e,it=je((Z-this._centerAltitude)*$),Ae=_e=>{if(!this._elevation||!_e.tileID||!x)return;const Le=this._elevation.getMinMaxForTile(_e.tileID),ot=_e.aabb;Le?(ot.min[2]=Le.min,ot.max[2]=Le.max,ot.center[2]=(ot.min[2]+ot.max[2])/2):(_e.shouldSplit=Be(_e),_e.shouldSplit||(ot.min[2]=ot.max[2]=ot.center[2]=this._centerAltitude))},Be=_e=>{if(_e.zoom<J)return!0;if(_e.zoom===Te)return!1;if(_e.shouldSplit!=null)return _e.shouldSplit;const Le=_e.aabb.distanceX(V),ot=_e.aabb.distanceY(V);let vt=it,_t=1;if(O){vt=je(_e.aabb.distanceZ(V));const ur=Math.pow(2,_e.zoom),tr=s.au((_e.y+1)/ur),ar=s.au(_e.y/ur),Br=Math.min(Math.max(M,tr),ar),Mr=s.bJ(Br)/s.bJ(M);if(_t=Br===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mr/this._mercatorScaleRatio),this.zoom<=s.bG&&_e.zoom===Te-1&&Mr>=.9)return!0}else if(_&&(vt=je(_e.aabb.distanceZ(V)*$)),this.projection.isReprojectedInTileSpace&&h<=5){const ur=Math.pow(2,_e.zoom),tr=he(new s.L((_e.x+.5)/ur,(_e.y+.5)/ur));_t=tr>.85?1:tr}const Ot=Le*Le+ot*ot+vt,Kt=je((1<<Te-_e.zoom)*ne*_t*((ur,tr)=>{if(tr*je(.707)<ur)return 1;const ar=Math.sqrt(tr/ur);return ar/(1.4144271570014144+(Math.pow(1.1,ar-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(vt,it),Ot));return Ot<Kt};if(this.renderWorldCopies)for(let _e=1;_e<=3;_e++)ye.push(fe(-_e)),ye.push(fe(_e));for(ye.push(fe(0));ye.length>0;){const _e=ye.pop(),Le=_e.x,ot=_e.y;let vt=_e.fullyVisible;const _t=()=>this.projection.name==="globe"&&(_e.y===0||_e.y===(1<<_e.zoom)-1);if(!vt){let Ot=X?_e.aabb.intersects(N):_e.aabb.intersectsFlat(N);if(Ot===0&&_t()){const Kt=new s.bs(_e.zoom,Le,ot);Ot=s.bt(this,I,Kt,!0).intersects(N)}if(Ot===0)continue;vt=Ot===2}if(_e.zoom!==Te&&Be(_e))for(let Ot=0;Ot<4;Ot++){const Kt=(Le<<1)+Ot%2,ur=(ot<<1)+(Ot>>1),tr={aabb:x?_e.aabb.quadrant(Ot):s.bu(this,I,_e.zoom+1,Kt,ur,_e.wrap,_e.minZ,_e.maxZ,this.projection),zoom:_e.zoom+1,x:Kt,y:ur,wrap:_e.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:_e.minZ,maxZ:_e.maxZ};_&&!O&&(tr.tileID=new s.am(_e.zoom+1===Te?$e:_e.zoom+1,_e.wrap,_e.zoom+1,Kt,ur),Ae(tr)),ye.push(tr)}else{const Ot=_e.zoom===Te?$e:_e.zoom;if(i.minzoom&&i.minzoom>Ot)continue;if(!vt){let ar=X?_e.aabb.intersectsPrecise(N):_e.aabb.intersectsPreciseFlat(N);if(ar===0&&_t()){const Br=new s.bs(_e.zoom,Le,ot);ar=s.bt(this,I,Br,!0).intersectsPrecise(N)}if(ar===0)continue}const Kt=L[0]-(.5+Le+(_e.wrap<<_e.zoom))*(1<<o-_e.zoom),ur=L[1]-.5-ot,tr=_e.tileID?_e.tileID:new s.am(Ot,_e.wrap,_e.zoom,Le,ot);De.push({tileID:tr,distanceSq:Kt*Kt+ur*ur})}}if(this.fogCullDistSq){const _e=this.fogCullDistSq,Le=this.horizonLineFromTop();De=De.filter(ot=>{const vt=[0,0,0,1],_t=[s.V,s.V,0,1],Ot=this.calculateFogTileMatrix(ot.tileID.toUnwrapped());s.a7.transformMat4(vt,vt,Ot),s.a7.transformMat4(_t,_t,Ot);const Kt=s.a7.min([],vt,_t),ur=s.a7.max([],vt,_t),tr=s.bv(Kt,ur);if(tr===0)return!0;let ar=!1;const Br=this._elevation;if(Br&&tr>_e&&Le!==0){const Mr=this.calculateProjMatrix(ot.tileID.toUnwrapped());let Or;i.isTerrainDEM||(Or=Br.getMinMaxForTile(ot.tileID)),Or||(Or={min:H,max:oe});const Lr=s.bH(this.rotation),ri=[Lr[0]*s.V,Lr[1]*s.V,Or.max];s.N.transformMat4(ri,ri,Mr),ar=(1-ri[1])*this.height*.5<Le}return tr<_e||ar})}return De.sort((_e,Le)=>_e.distanceSq-Le.distanceSq).map(_e=>_e.tileID)}resize(i,o){this.width=i,this.height=o,this.pixelsToGLUnits=[2/i,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const o=s.aa(i.lat,-s.bw,s.bw),h=this.projection.project(i.lng,o);return new s.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,o){let h,p;const _=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;h=(o.x-_.x)/T,p=(o.y-_.y)/T}else{const T=this.pointCoordinate(o),M=this.pointCoordinate(_);h=T.x-M.x,p=T.y-M.y}const x=this.locationCoordinate(i);this.setLocation(new s.L(x.x-h,x.y-p))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,o){const h=o?s.bl(o,i.lat):void 0,p=this.projection.project(i.lng,i.lat);return new s.L(p.x,p.y,h)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,o){const h=o??this._centerAltitude,p=[i.x,i.y,0,1],_=[i.x,i.y,1,1];s.a7.transformMat4(p,p,this.pixelMatrixInverse),s.a7.transformMat4(_,_,this.pixelMatrixInverse);const x=_[3];s.a7.scale(p,p,1/p[3]),s.a7.scale(_,_,1/x);const T=p[2],M=_[2];return{p0:p,p1:_,t:T===M?0:(h-T)/(M-T)}}screenPointToMercatorRay(i){const o=[i.x,i.y,0,1],h=[i.x,i.y,1,1];return s.a7.transformMat4(o,o,this.pixelMatrixInverse),s.a7.transformMat4(h,h,this.pixelMatrixInverse),s.a7.scale(o,o,1/o[3]),s.a7.scale(h,h,1/h[3]),o[2]=s.bl(o[2],this._center.lat)*this.worldSize,h[2]=s.bl(h[2],this._center.lat)*this.worldSize,s.a7.scale(o,o,1/this.worldSize),s.a7.scale(h,h,1/this.worldSize),new s.a2([o[0],o[1],o[2]],s.N.normalize([],s.N.sub([],h,o)))}rayIntersectionCoordinate(i){const{p0:o,p1:h,t:p}=i,_=s.bl(o[2],this._center.lat),x=s.bl(h[2],this._center.lat);return new s.L(s.U(o[0],h[0],p)/this.worldSize,s.U(o[1],h[1],p)/this.worldSize,s.U(_,x,p))}pointCoordinate(i,o=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,o)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let o=this.projection.pointCoordinate3D(this,i.x,i.y);if(o)return new s.L(o[0],o[1],o[2]);let h=0,p=this.horizonLineFromTop();if(i.y>p)return this.pointCoordinate(i);const _=.02*p,x=i.clone();for(let T=0;T<10&&p-h>_;T++){x.y=s.U(h,p,.66);const M=this.projection.pointCoordinate3D(this,x.x,x.y);M?(p=x.y,o=M):h=x.y}return o?new s.L(o[0],o[1],o[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=s.bx)return!this.isPointAboveHorizon(i);const o=this.pointCoordinate(i);return o.y>=0&&o.y<=1}_coordinatePoint(i,o){const h=o&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,p=[i.x*this.worldSize,i.y*this.worldSize,h+i.toAltitude(),1];return s.a7.transformMat4(p,p,this.pixelMatrix),p[3]>0?new s.P(p[0]/p[3],p[1]/p[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:o}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new s.P(o,i)),x=this.pointLocation3D(new s.P(p,i)),T=this.pointLocation3D(new s.P(p,h)),M=this.pointLocation3D(new s.P(o,h));let I=Math.min(_.lng,x.lng,T.lng,M.lng),L=Math.max(_.lng,x.lng,T.lng,M.lng),O=Math.min(_.lat,x.lat,T.lat,M.lat),F=Math.max(_.lat,x.lat,T.lat,M.lat);const N=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,$=(Z,V,X,ne,J)=>{const oe=(Z+X)/2,H=(V+ne)/2,ae=new s.P(oe,H),{lng:he,lat:fe}=this.pointLocation3D(ae),ye=Math.max(0,I-he,O-fe,he-L,fe-F);I=Math.min(I,he),L=Math.max(L,he),O=Math.min(O,fe),F=Math.max(F,fe),(J<q||ye>N)&&($(Z,V,oe,H,J+1),$(oe,H,X,ne,J+1))};if($(o,i,p,i,1),$(p,i,p,h,1),$(p,h,o,h,1),$(o,h,o,i,1),this.projection.name==="globe"){const[Z,V]=s.by(this);Z?(F=90,L=180,I=-180):V&&(O=-90,L=180,I=-180)}return new s.ad(new s.bn(I,O),new s.bn(L,F))}_getBoundsRectangular(i,o){const{top:h,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,T=new s.P(p,h),M=new s.P(x,h),I=new s.P(x,_),L=new s.P(p,_);let O=this.pointCoordinate(T,i),F=this.pointCoordinate(M,i);const N=this.pointCoordinate(I,o),q=this.pointCoordinate(L,o),$=(Z,V)=>(V.y-Z.y)/(V.x-Z.x);return O.y>1&&F.y>=0?O=new s.L((1-q.y)/$(q,O)+q.x,1):O.y<0&&F.y<=1&&(O=new s.L(-q.y/$(q,O)+q.x,0)),F.y>1&&O.y>=0?F=new s.L((1-N.y)/$(N,F)+N.x,1):F.y<0&&O.y<=1&&(F=new s.L(-N.y/$(N,F)+N.x,0)),new s.ad().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=i.visibleDemTiles.reduce((h,p)=>{if(p.dem){const _=p.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*i.exaggeration(),o.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-o*(1-this._horizonShift);return i?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-s.bw,this.maxLat=s.bw,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.a5(this.minLng)*this.tileSize,this.worldMaxX=s.a5(this.maxLng)*this.tileSize,this.worldMinY=s.ae(this.maxLat)*this.tileSize,this.worldMaxY=s.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,o){return this.projection.createTileMatrix(this,o,i)}calculateDistanceTileData(i){const o=i.key,h=this._distanceTileDataCache;if(h[o])return h[o];const p=i.canonical,_=1/this.height,x=this.cameraWorldSize,T=x/this.zoomScale(p.z),M=(p.x+Math.pow(2,p.z)*i.wrap)*T,I=p.y*T,L=this.point;L.x*=x/this.worldSize,L.y*=x/this.worldSize;const O=this.angle,F=Math.sin(-O),N=-Math.cos(-O);return h[o]={bearing:[F,N],center:[(L.x-M)*_,(L.y-I)*_],scale:T/s.V*_},h[o]}calculateFogTileMatrix(i){const o=i.key,h=this._fogTileMatrixCache;if(h[o])return h[o];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return s.a6.multiply(p,this.worldToFogMatrix,p),h[o]=new Float32Array(p),h[o]}calculateProjMatrix(i,o=!1,h=!1){const p=i.key;let _;if(_=h?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const x=this.calculatePosMatrix(i,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.a6.multiply(x,T,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(i){const o=i.tileID.key,h=this._pixelsToTileUnitsCache;if(h[o])return h[o];const p=s.bz(i,this);return h[o]=p,h[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,o=s.a6.fromScaling([],[i,i,i]);return s.a6.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const o=s.bl(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(o),p=this._camera.forward(),_=s.bl(1,this._center.lat);h[2]/=_,p[2]/=_,s.N.normalize(p,p);const x=i.raycast(h,p,i.exaggeration());if(x){const T=s.N.scaleAndAdd([],h,p,x),M=new s.L(T[0],T[1],s.bl(T[2],s.au(T[1]))),I=(M.z+s.N.length([M.x-h[0],M.y-h[1],M.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const o=this._elevation,h=s.bl(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(h),_=o.getAtPointOrZero(new s.L(...p)),x=this.pixelsPerMeter/this.worldSize*_,T=this._minimumHeightOverTerrain(),M=p[2]-x;if(M<=T)if(M<0||i){const I=this.locationCoordinate(this._center,this._centerAltitude),L=[p[0],p[1],I.z-p[2]],O=s.N.length(L);L[2]-=(T-M)/this._pixelsPerMercatorPixel;const F=s.N.length(L);if(F===0)return;s.N.scale(L,L,O/F*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],I.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const F=this.center;return F.lat=s.aa(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(F.lng=s.aa(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const o=this._unmodified,{x:h,y:p}=this.point;let _=0,x=h,T=p;const M=this.width/2,I=this.height/2,L=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(p-I<L&&(T=L+I),p+I>O&&(T=O-I),O-L<this.height&&(_=Math.max(_,this.height/(O-L)),T=(O+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,q=this.worldSize/2-(F+N)/2;x=(h+q+this.worldSize)%this.worldSize-q,x-M<F&&(x=F+M),x+M>N&&(x=N-M),N-F<this.width&&(_=Math.max(_,this.width/(N-F)),x=(N+F)/2)}x===h&&T===p||(this.center=this.unproject(new s.P(x,T))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,o=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.bl(1,this.center.lat)/s.bl(1,s.bI));const p=s.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,_);let T;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-i.x/this.width,M[9]=2*i.y/this.height,this.isOrthographic){let fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ye=fe*this.aspect,De=-ye,Te=-fe;ye-=i.x,De-=i.x,fe+=i.y,Te+=i.y,T=this._camera.getCameraToClipOrthographic(De,ye,Te,fe,this._nearZ,this._farZ),(($e,je,it,Ae)=>{for(let Be=0;Be<16;Be++)$e[Be]=dn(je[Be],it[Be],Ae)})(T,T,M,xo(this.pitch>=15?1:this.pitch/15))}else T=M;const I=s.a6.mul([],M,x);let L=s.a6.mul([],T,x);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),ye=s.a6.identity([]);s.a6.translate(ye,ye,[fe.x*this.worldSize,fe.y*this.worldSize,0]),s.a6.multiply(ye,ye,s.bB(this)),s.a6.translate(ye,ye,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),s.a6.multiply(L,L,ye),s.a6.multiply(I,I,ye),this.inverseAdjustmentMatrix=s.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.a6.scale([],L,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=L,this.invProjMatrix=s.a6.invert(new Float64Array(16),this.projMatrix),o){const fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);fe[8]=2*-i.x/this.width,fe[9]=2*i.y/this.height,this.expandedFarZProjMatrix=s.a6.mul([],fe,x)}else this.expandedFarZProjMatrix=this.projMatrix;const O=s.a6.invert([],T);this.frustumCorners=s.bD.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const F=new Float32Array(16);s.a6.identity(F),s.a6.scale(F,F,[1,-1,1]),s.a6.rotateX(F,F,this._pitch),s.a6.rotateZ(F,F,this.angle);const N=s.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.a6.clone(N);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-i.x/this.width,N[9]=2*(i.y+q)/this.height,this.skyboxMatrix=s.a6.multiply(F,N,F);const $=this.point,Z=$.x,V=$.y,X=this.width%2/2,ne=this.height%2/2,J=Math.cos(this.angle),oe=Math.sin(this.angle),H=Z-Math.round(Z)+J*X+oe*ne,ae=V-Math.round(V)+J*ne+oe*X,he=new Float64Array(L);if(s.a6.translate(he,he,[H>.5?H-1:H,ae>.5?ae-1:ae,0]),this.alignedProjMatrix=he,L=s.a6.create(),s.a6.scale(L,L,[this.width/2,-this.height/2,1]),s.a6.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=s.a6.create(),s.a6.scale(L,L,[1,-1,1]),s.a6.translate(L,L,[-1,-1,0]),s.a6.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=s.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,I),this._calcFogMatrices(),this._distanceTileDataCache={},L=s.a6.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.bE(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.N.transformMat4(fe,fe,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,h=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[i,i,o];s.N.scale(_,_,p),s.N.scale(h,h,-1),s.N.multiply(h,h,_);const x=s.a6.create();s.a6.translate(x,x,h),s.a6.scale(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,o,p)}_computeCameraPosition(i){const o=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-i/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-h[0]*_,p.y/this.worldSize-h[1]*_,i/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],p=i[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((o-h)/p,1)),this._camera.position=s.N.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,o=this._camera.forward(),{pitch:h,bearing:p}=this._camera.getPitchBearing(),_=s.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.bj(this._maxPitch)),T=Math.max((i[2]-_)/Math.cos(h),x),M=this._zoomFromMercatorZ(T);s.N.scaleAndAdd(i,i,o,T),this._pitch=s.aa(h,s.bj(this.minPitch),s.bj(this.maxPitch)),this.angle=s.bh(p,-Math.PI,Math.PI),this._setZoom(s.aa(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.L(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let o=0,h=s.bx,p=0,_=1/0;for(;h-o>1e-6&&h>o;){const x=o+.5*(h-o),T=this.tileSize*Math.pow(2,x),M=this.getCameraToCenterDistance(this.projection,x,T),I=this.scaleZoom(M/(i*this.tileSize)),L=Math.abs(x-I);L<_&&(_=L,p=x),x<I?o=x:h=x}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,o){const h=Math.min(i.x,o.x),p=Math.max(i.x,o.x),_=Math.min(i.y,o.y),x=Math.max(i.y,o.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new s.P(h,_),new s.P(p,x),new s.P(h,x),new s.P(p,_)],M=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const L of T){const O=this.pointRayIntersection(L);if(O.t<0)return!0;const F=this.rayIntersectionCoordinate(O);if(F.x<M||F.y<0||F.x>I||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(i,o){const h=s.N.length(s.N.sub([],this._camera.position,i)),p=this._zoomFromMercatorZ(h)+o;return h-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([o,h,p],_){const x=[o,h,p,1];s.a7.transformMat4(x,x,_);const T=x[3]=Math.max(x[3],1e-6);return x[0]/=T,x[1]/=T,x[2]/=T,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,i))}}getCameraToCenterDistance(i,o=this.zoom,h=this.worldSize){const p=s.bA(i,o,this.width,this.height,1024),_=i.pixelSpaceConversion(this.center.lat,h,p);let x=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(x=dn(1,x,xo(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.a6.multiply(i,i,this.globeMatrix),i}getFrustum(i){return s.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Si={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Qn=(u,i)=>{if(i>0&&u.terrain&&s.w("Cutoff is currently disabled on terrain"),i<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=u.transform,h=Math.max(Math.abs(o._zoom-(u.minCutoffZoom-1)),1),p=o.isLODDisabled(!1)?s.O(60,45,o.pitch):s.O(30,15,o.pitch),_=o._farZ-o._nearZ,x=i*o.height,T=((1-(M=p))*o.cameraToCenterDistance+M*(o._farZ+x))*h;var M;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(T-o._nearZ)/_,(T-x-o._nearZ)/_]}}},An={cascadeCount:2,shadowMapResolution:2048};class eo{constructor(i,o){this.aabb=i,this.lastCascade=o}}class fs{add(i,o){const h=this.receivers[i.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],o.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],o.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],o.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],o.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],o.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],o.max[2])):this.receivers[i.key]=new eo(o,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,o,h){const p=s.bS.fromPoints(i.points);let _=0;for(const x in this.receivers){const T=this.receivers[x];if(!T||!p.intersectsAabb(T.aabb))continue;T.aabb.min=p.closestPoint(T.aabb.min),T.aabb.max=p.closestPoint(T.aabb.max);const M=T.aabb.getCorners();for(let I=0;I<h.length;I++){let L=!0;for(const O of M){const F=[O[0]*o,O[1]*o,O[2]];if(s.N.transformMat4(F,F,h[I].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){L=!1;break}}if(T.lastCascade=I,_=Math.max(_,I),L)break}}return _+1}}class Ws{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new fs,this._depthMode=new jt(i.context.gl.LEQUAL,jt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,i.tp.registerParameter(An,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(An,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,o){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const p=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||p<=0||(this._shadowLayerCount=h.style.order.reduce((q,$)=>{const Z=h.style._mergedLayers[$];return q+(Z.hasShadowPass()&&!Z.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const _=h.context,x=An.shadowMapResolution,T=An.shadowMapResolution;if(this._cascades.length===0||An.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<An.cascadeCount;++q){const $=h._shadowMapDebug,Z=_.gl,V=_.createFramebuffer(x,T,$,"texture"),X=new s.T(_,{width:x,height:T,data:null},Z.DEPTH_COMPONENT);if(V.depthAttachment.set(X.texture),$){const ne=new s.T(_,{width:x,height:T,data:null},Z.RGBA);V.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:V,texture:X,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.bq,scale:0})}}this.shadowDirection=Rs(o);let M=0;if(i.elevation){const q=i.elevation,$=[1e4,-1e4];q.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{const V=Z.dem.tree;$[0]=Math.min($[0],V.minimums[0]),$[1]=Math.max($[1],V.maximums[0])}),$[0]!==1e4&&(M=($[1]-$[0])*q.exaggeration())}const I=1.5*i.cameraToCenterDistance,L=3*I,O=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const $=this._cascades[q];let Z=i.height/50,V=1;An.cascadeCount===1?V=L:q===0?V=I:(Z=I,V=L);const[X,ne]=Jc(i,this.shadowDirection,Z,V,An.shadowMapResolution,M);$.scale=i.scale,$.matrix=X,$.boundingSphereRadius=ne,s.a6.invert(O,$.matrix),$.frustum=s.bq.fromInvProjectionMatrix(O,1,0,!0),$.far=V}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/An.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=An.shadowMapResolution,this._uniformValues.u_shadowmap_0=Si.ShadowMap0,this._uniformValues.u_shadowmap_1=Si.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const N=h.transform.elevation;for(const q of this._groundShadowTiles){let $={min:0,max:0};if(N){const Z=N.getMinMaxForTile(q);Z&&($=Z)}this.addShadowReceiver(q.toUnwrapped(),$.min,$.max)}}get enabled(){return this._enabled}set enabled(i){this._enabled=i}drawShadowPass(i,o){if(!this._enabled)return;const h=this.painter,p=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),p.viewport.set([0,0,An.shadowMapResolution,An.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){h.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:s.ax.white,depth:1});for(const x of i.order){const T=i._mergedLayers[x];if(!T.hasShadowPass()||T.isHidden(h.transform.zoom))continue;const M=i.getLayerSourceCache(T),I=M?o[M.id]:void 0;(T.type==="model"||I&&I.length)&&h.renderLayer(h,M,T,I)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const i=this.painter,o=i.style,h=i.context,p=o.directionalLight,_=o.ambientLight;if(!p||!_)return;const x=[],T=Qn(i,i.longestCutoffRange);T.shouldRenderCutoff&&x.push("RENDER_CUTOFF");const M=Os(p,_),I=new jt(h.gl.LEQUAL,jt.ReadOnly,i.depthRangeFor3D);for(const L of this._groundShadowTiles){const O=L.toUnwrapped(),F=i.isTileAffectedByFog(L),N=i.getOrCreateProgram("groundShadow",{defines:x,overrideFog:F});this.setupShadows(O,N),i.uploadCommonUniforms(h,N,O,null,T);const q={u_matrix:i.transform.calculateProjMatrix(O),u_ground_shadow_factor:M};N.draw(i,h.gl.TRIANGLES,I,ht.disabled,vr.multiply,dr.disabled,q,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?vr.unblended:vr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const o=this.painter.transform,h=o.calculatePosMatrix(i,o.worldSize);return s.a6.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(i){return s.a6.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,o,h,p=0){if(!this._enabled)return;const _=this.painter.transform,x=this.painter.context,T=x.gl,M=this._uniformValues,I=new Float64Array(16),L=_.calculatePosMatrix(i,_.worldSize);for(let O=0;O<this._cascades.length;O++)s.a6.multiply(I,this._cascades[O].matrix,L),M[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(T.TEXTURE0+Si.ShadowMap0+O),this._cascades[O].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const O=s.bR(i.canonical),F=2/_.tileSize*s.V/An.shadowMapResolution,N=F*this._cascades[0].boundingSphereRadius,q=F*this._cascades[this._cascades.length-1].boundingSphereRadius,$=(h==="vector-tile"?1:3)/Math.pow(2,p-i.canonical.z-(1-_.zoom+Math.floor(_.zoom)));M.u_shadow_normal_offset=[O,N*$,q*$],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(x,M)}setupShadowsFromMatrix(i,o,h=!1){if(!this._enabled)return;const p=this.painter.context,_=p.gl,x=this._uniformValues,T=new Float64Array(16);for(let M=0;M<An.cascadeCount;M++)s.a6.multiply(T,this._cascades[M].matrix,i),x[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),p.activeTexture.set(_.TEXTURE0+Si.ShadowMap0+M),this._cascades[M].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);this.useNormalOffset=h,h?(x.u_shadow_normal_offset=[1,5,5],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],o.setShadowUniformValues(p,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,o,h,p){if(p[2]>=0)return{};const _=function(M,I,L){const O=L/(1<<M.canonical.z);return new s.bS([M.canonical.x*O+M.wrap*L,M.canonical.y*O+M.wrap*L,0],[(M.canonical.x+1)*O+M.wrap*L,(M.canonical.y+1)*O+M.wrap*L,I])}(i,o,h).getCorners(),x=o/-p[2];p[0]<0?(s.N.add(_[0],_[0],[p[0]*x,0,0]),s.N.add(_[3],_[3],[p[0]*x,0,0])):p[0]>0&&(s.N.add(_[1],_[1],[p[0]*x,0,0]),s.N.add(_[2],_[2],[p[0]*x,0,0])),p[1]<0?(s.N.add(_[0],_[0],[0,p[1]*x,0]),s.N.add(_[1],_[1],[0,p[1]*x,0])):p[1]>0&&(s.N.add(_[2],_[2],[0,p[1]*x,0]),s.N.add(_[3],_[3],[0,p[1]*x,0]));const T={};return T.vertices=_,T.planes=[ps(_[1],_[0],_[4]),ps(_[2],_[1],_[5]),ps(_[3],_[2],_[6]),ps(_[0],_[3],_[7])],T}addShadowReceiver(i,o,h){this._receivers.add(i,s.bS.fromTileIdAndHeight(i,o,h))}getMaxCascadeForTile(i){const o=this._receivers.get(i);return o&&o.lastCascade?o.lastCascade:0}}function ps(u,i,o){const h=s.N.sub([],o,i),p=s.N.sub([],u,i),_=s.N.cross([],h,p),x=s.N.length(_);return x===0?[0,0,1,0]:(s.N.scale(_,_,1/x),[_[0],_[1],_[2],-s.N.dot(_,i)])}function Rs(u){const i=u.properties.get("direction"),o=s.bQ(i.x,i.y,i.z);o[2]=s.aa(o[2],0,75);const h=s.bT([o[0],o[1],o[2]]);return s.N.fromValues(h.x,h.y,h.z)}function Os(u,i){const o=u.properties.get("color"),h=u.properties.get("intensity"),p=u.properties.get("direction"),_=[p.x,p.y,p.z],x=i.properties.get("color"),T=i.properties.get("intensity"),M=Math.max(s.N.dot([0,0,1],_),0),I=[0,0,0];s.N.scale(I,x.toArray01Linear().slice(0,3),T);const L=[0,0,0];return s.N.scale(L,o.toArray01Linear().slice(0,3),M*h),s.bU([I[0]>0?I[0]/(I[0]+L[0]):0,I[1]>0?I[1]/(I[1]+L[1]):0,I[2]>0?I[2]/(I[2]+L[2]):0])}function Jc(u,i,o,h,p,_){const x=u.zoom,T=u.scale,M=u.worldSize,I=1/M,L=u.aspect,O=Math.sqrt(1+L*L)*Math.tan(.5*u.fovX),F=O*O,N=h-o,q=h+o;let $,Z;F>N/q?($=h,Z=h*O):($=.5*q*(1+F),Z=.5*Math.sqrt(N*N+2*(h*h+o*o)*F+q*q*F*F));const V=u.projection.pixelsPerMeter(u.center.lat,M),X=u._camera.getCameraToWorldMercator(),ne=[0,0,-$*I];s.N.transformMat4(ne,ne,X);let J=Z*I;const oe=u._edgeInsets;if(!(oe.left===0&&oe.top===0&&oe.right===0&&oe.bottom===0||oe.left===oe.right&&oe.top===oe.bottom)){const vt=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?V:1),_t=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,o,h);_t[8]=2*-u.centerOffset.x/u.width,_t[9]=2*u.centerOffset.y/u.height;const Ot=new Float64Array(16);s.a6.mul(Ot,_t,vt);const Kt=new Float64Array(16);s.a6.invert(Kt,Ot);const ur=s.bq.fromInvProjectionMatrix(Kt,M,x,!0);for(const tr of ur.points){const ar=((H=tr)[0]/=T,H[1]/=T,H[2]=s.bl(H[2],u._center.lat),H);J=Math.max(J,s.N.len(s.N.subtract([],ne,ar)))}}var H;J*=p/(p-1);const ae=Math.acos(i[2]),he=Math.atan2(-i[0],-i[1]),fe=new Qi;fe.position=ne,fe.setPitchBearing(ae,he);const ye=fe.getWorldToCamera(M,V),De=J*M,Te=Math.min(u._mercatorZfromZoom(17)*M*-2,-2*De),$e=fe.getCameraToClipOrthographic(-De,De,-De,De,Te,(De+_*V)/i[2]),je=new Float64Array(16);s.a6.multiply(je,$e,ye);const it=s.N.fromValues(Math.floor(1e6*ne[0])/1e6*M,Math.floor(1e6*ne[1])/1e6*M,0),Ae=.5*p,Be=[0,0,0];s.N.transformMat4(Be,it,je),s.N.scale(Be,Be,Ae);const _e=[Math.floor(Be[0]),Math.floor(Be[1]),Math.floor(Be[2])],Le=[0,0,0];s.N.sub(Le,Be,_e),s.N.scale(Le,Le,-1/Ae);const ot=new Float64Array(16);return s.a6.identity(ot),s.a6.translate(ot,ot,Le),s.a6.multiply(je,ot,je),[je,De]}const Xs=(u,i)=>Ht(u,i&&i.filter(o=>o.identifier!=="source.canvas")),th=s.ac(Kr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Fi=s.ac(Kr,["setCenter","setZoom","setBearing","setPitch"]),Vi={version:8,layers:[],sources:{}},Tl={duration:300,delay:0},Ys=new Set(["fill","line","background","hillshade","raster"]);class Do extends s.E{constructor(i,o={}){super(),this.map=i,this.scope=o.scope||"",this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=s.e({},Tl),this._buildingIndex=new Xu(this),this.crossTileSymbolIndex=new ke,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Cn,this.dispatcher=o.dispatcher?o.dispatcher:new s.bW(s.bX(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Jn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.bY(i._requestManager,o.localFontFamily?s.bZ.all:o.localIdeographFontFamily?s.bZ.ideographs:s.bZ.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Kn(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this.dispatcher.broadcast("setReferrer",s.b_());const h=this;this._rtlTextPluginCallback=Do.registerForPluginStateChange(p=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,x)=>{if(s.b$(_),x&&x.every(T=>T))for(const T in h._sourceCaches){const M=h._sourceCaches[T],I=M.getSource().type;I!=="vector"&&I!=="geojson"||M.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const x in this._layers){const T=this._layers[x];T.source===_.id&&this._validateLayer(T)}})}loadURL(i,o={}){this.fire(new s.b("dataloading",{dataType:"style"}));const h=typeof o.validate=="boolean"?o.validate:!s.c0(i);i=this.map._requestManager.normalizeStyleURL(i,o.accessToken),this.resolvedImports.add(i);const p=this.importsCache.get(i);if(p)return this._load(p,h);const _=this.map._requestManager.transformRequest(i,s.R.Style);this._request=s.g(_,(x,T)=>{if(this._request=null,x)this.fire(new s.a(x));else if(T)return this.importsCache.set(i,T),this._load(T,h)})}loadJSON(i,o={}){this.fire(new s.b("dataloading",{dataType:"style"})),this._request=s.f.frame(()=>{this._request=null,this._load(i,o.validate!==!1)})}loadEmpty(){this.fire(new s.b("dataloading",{dataType:"style"})),this._load(Vi,!1)}_loadImports(i,o,h){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of i){const x=this._createFragmentStyle(_),T=new Promise(L=>{x.once("style.import.load",L),x.once("error",L)}).then(()=>this.mergeAll());if(p.push(T),this.resolvedImports.has(_.url)){x.loadEmpty();continue}const M=_.data||this.importsCache.get(_.url);M?x.loadJSON(M,{validate:o}):_.url?x.loadURL(_.url,{validate:o}):x.loadEmpty();const I={style:x,id:_.id,config:_.config};if(h){const L=this.fragments.findIndex(({id:O})=>O===h);this.fragments=this.fragments.slice(0,L).concat(I).concat(this.fragments.slice(L))}else this.fragments.push(I)}return Promise.allSettled(p)}_createFragmentStyle(i){const o=this.scope?s.ag(i.id,this.scope):i.id,h=new Do(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:i.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return h.setEventedParent(this.map,{style:h}),h}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const i=this.isRootStyle();this._shouldPrecompile=i,this.fire(new s.b(i?"style.load":"style.import.load"))}_load(i,o){const h=i.schema;if(this.isRootStyle()&&(i.fragment||h&&i.fragment!==!1)){const x=s.e({},Vi,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(x,o)}if(this.setConfig(this._config,h),o&&Xs(this,cr(i)))return;this._loaded=!0,this.stylesheet=s.c1(i);for(const x in i.sources)this.addSource(x,i.sources[x],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const p=Yl(this.stylesheet.layers);if(this._order=p.map(x=>x.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const x=this.stylesheet.lights[0];this.light=new Ut(x.properties,x.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ut(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const x of p){const T=s.c2(x,this.scope,this.options);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize();const M=this.getOwnLayerSourceCache(T),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&T.canCastShadows()&&I&&(M.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const _=this.stylesheet.terrain;_&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(_,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.b("data",{dataType:"style"})),i.imports?this._loadImports(i.imports,o).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,o,h,p,_,x,T,M;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(I=>{if(I.stylesheet){if(I.light!=null&&(i=I.light),I.stylesheet.lights)for(const L of I.stylesheet.lights)L.type==="ambient"&&I.ambientLight!=null&&(o=I.ambientLight),L.type==="directional"&&I.directionalLight!=null&&(h=I.directionalLight);p=this._prioritizeTerrain(p,I.terrain,I.stylesheet.terrain),I.stylesheet.fog&&I.fog!=null&&(_=I.fog),I.stylesheet.camera!=null&&(M=I.stylesheet.camera),I.stylesheet.projection!=null&&(x=I.stylesheet.projection),I.stylesheet.transition!=null&&(T=I.stylesheet.transition)}}),this.light=i,this.ambientLight=o,this.directionalLight=h,this.fog=_,p===null?delete this.terrain:this.terrain=p,this.camera=M||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=s.e({},Tl,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const o=h=>{for(const p of h.fragments)o(p.style);i(h)};o(this)}_prioritizeTerrain(i,o,h){const p=i&&i.drapeRenderMode===0;return h===null?o&&o.drapeRenderMode===0?o:p?i:null:o!=null&&(!i||p||o&&o.drapeRenderMode===1)?o:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{i=this._prioritizeTerrain(i,o.terrain,o.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(i=o.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},o={},h={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const x=s.ag(_,p.scope);i[x]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const x=s.ag(_,p.scope);o[x]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const x=s.ag(_,p.scope);h[x]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=h}mergeLayers(){const i={},o=[],h={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const x of _._order){const T=_._layers[x];if(T.type==="slot"){const M=s.c3(x);if(i[M])continue;i[M]=[]}T.slot&&i[T.slot]?i[T.slot].push(T):o.push(T)}}),this._mergedOrder=[];const p=(_=[])=>{for(const x of _)if(x.type==="slot"){const T=s.c3(x.id);i[T]&&p(i[T])}else{const T=s.ag(x.id,x.scope);this._mergedOrder.push(T),h[T]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0)}};p(o),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=s.e({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(o,h,p){let _,x,T;const M=s.f.devicePixelRatio>1?"@2x":"";let I=s.g(h.transformRequest(h.normalizeSpriteURL(o,M,".json"),s.R.SpriteJSON),(F,N)=>{I=null,T||(T=F,_=N,O())}),L=s.d(h.transformRequest(h.normalizeSpriteURL(o,M,".png"),s.R.SpriteImage),(F,N)=>{L=null,T||(T=F,x=N,O())});function O(){if(T)p(T);else if(_&&x){const F=s.f.getImageData(x),N={};for(const q in _){const{width:$,height:Z,x:V,y:X,sdf:ne,pixelRatio:J,stretchX:oe,stretchY:H,content:ae}=_[q],he=new s.h({width:$,height:Z});s.h.copy(F,he,{x:V,y:X},{x:0,y:0},{width:$,height:Z}),N[q]={data:he,pixelRatio:J,sdf:ne,stretchX:oe,stretchY:H,content:ae}}p(null,N)}}return{cancel(){I&&(I.cancel(),I=null),L&&(L.cancel(),L=null)}}}(i,this.map._requestManager,(o,h)=>{if(this._spriteRequest=null,o)this.fire(new s.a(o));else if(h)for(const p in h)this.imageManager.addImage(p,this.scope,h[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.b("data",{dataType:"style"}))})}_validateLayer(i){const o=this.getOwnSource(i.source);if(!o)return;const h=i.sourceLayer;h&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(h)===-1)&&this.fire(new s.a(new Error(`Source layer "${h}" does not exist on source "${o.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,o)=>{const h=this.fragments[o];return h&&h.style&&(i.data=h.style.serialize()),i})}_serializeSources(){const i={};for(const o in this._sourceCaches){const h=this._sourceCaches[o].getSource();i[h.id]||(i[h.id]=h.serialize())}return i}_serializeLayers(i){const o=[];for(const h of i){const p=this._layers[h];p&&p.type!=="custom"&&o.push(p.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&(typeof i.isLayerDraped=="function"?i.isLayerDraped(this.getLayerSourceCache(i)):Ys.has(i.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const o=this.getOwnLayer(i);if(o)return o;this.fire(new s.a(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const o=this.getOwnSource(i);if(o)return o;this.fire(new s.a(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const o=this.calculateLightsBrightness();i.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const h=this._changes.isDirty();if(this._changes.isDirty()){const _=this._changes.getLayerUpdatesByScope();for(const x in _){const{updatedIds:T,removedIds:M}=_[x];(T||M)&&this._updateWorkerLayers(x,T,M)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const p={};for(const _ in this._mergedSourceCaches){const x=this._mergedSourceCaches[_];p[_]=x.used,x.used=!1,x.tileCoverLift=0}for(const _ of this._mergedOrder){const x=this._mergedLayers[_];if(x.recalculate(i,this._availableImages),!x.isHidden(i.zoom)){const T=this.getLayerSourceCache(x);T&&(T.used=!0,T.tileCoverLift=Math.max(T.tileCoverLift,x.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let T=x.minzoom||0;T<(x.maxzoom||25.5);T++){const M=this.map.painter;if(M){const I=x.getProgramIds();if(!I)continue;for(const L of I){const O=x.getDefaultProgramParams(L,i.zoom);O&&(M.style=this,this.fog&&(M._fogVisible=!0,O.overrideFog=!0,M.getOrCreateProgram(L,O)),M._fogVisible=!1,O.overrideFog=!1,M.getOrCreateProgram(L,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,M.getOrCreateProgram(L,O)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const _ in p){const x=this._mergedSourceCaches[_];p[_]!==x.used&&x.getSource().fire(new s.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new s.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,o,h){const p=this.getFragmentStyle(i);p&&this.dispatcher.broadcast("updateLayers",{layers:o?p._serializeLayers(o):[],scope:i,removedIds:h||[],options:p.options})}setState(i){if(this._checkLoaded(),Xs(this,cr(i)))return!1;(i=s.c1(i)).layers=Yl(i.layers);const o=function(p,_){if(!p)return[{command:Kr.setStyle,args:[_]}];let x=[];try{if(!K(p.version,_.version))return[{command:Kr.setStyle,args:[_]}];K(p.center,_.center)||x.push({command:Kr.setCenter,args:[_.center]}),K(p.zoom,_.zoom)||x.push({command:Kr.setZoom,args:[_.zoom]}),K(p.bearing,_.bearing)||x.push({command:Kr.setBearing,args:[_.bearing]}),K(p.pitch,_.pitch)||x.push({command:Kr.setPitch,args:[_.pitch]}),K(p.sprite,_.sprite)||x.push({command:Kr.setSprite,args:[_.sprite]}),K(p.glyphs,_.glyphs)||x.push({command:Kr.setGlyphs,args:[_.glyphs]}),K(p.imports,_.imports)||function(O=[],F=[],N){F=F||[];const q=(O=O||[]).map(Qo),$=F.map(Qo),Z=O.reduce(pl,{}),V=F.reduce(pl,{}),X=q.slice();let ne,J,oe,H;for(ne=0,J=0;ne<q.length;ne++)oe=q[ne],V.hasOwnProperty(oe)?J++:(N.push({command:Kr.removeImport,args:[oe]}),X.splice(X.indexOf(oe,J),1));for(ne=0,J=0;ne<$.length;ne++)oe=$[$.length-1-ne],X[X.length-1-ne]!==oe&&(Z.hasOwnProperty(oe)?(N.push({command:Kr.removeImport,args:[oe]}),X.splice(X.lastIndexOf(oe,X.length-J),1)):J++,H=X[X.length-ne],N.push({command:Kr.addImport,args:[V[oe],H]}),X.splice(X.length-ne,0,oe));for(const ae of F){const he=Z[ae.id];he&&!K(he,ae)&&N.push({command:Kr.updateImport,args:[ae.id,ae]})}}(p.imports,_.imports,x),K(p.transition,_.transition)||x.push({command:Kr.setTransition,args:[_.transition]}),K(p.light,_.light)||x.push({command:Kr.setLight,args:[_.light]}),K(p.fog,_.fog)||x.push({command:Kr.setFog,args:[_.fog]}),K(p.projection,_.projection)||x.push({command:Kr.setProjection,args:[_.projection]}),K(p.lights,_.lights)||x.push({command:Kr.setLights,args:[_.lights]}),K(p.camera,_.camera)||x.push({command:Kr.setCamera,args:[_.camera]});const T={},M=[];(function(O,F,N,q){let $;for($ in F=F||{},O=O||{})O.hasOwnProperty($)&&(F.hasOwnProperty($)||Kl($,N,q));for($ in F){if(!F.hasOwnProperty($))continue;const Z=F[$];O.hasOwnProperty($)?K(O[$],Z)||(O[$].type==="geojson"&&Z.type==="geojson"&&id(O,F,$)?N.push({command:Kr.setGeoJSONSourceData,args:[$,Z.data]}):Yu($,F,N,q)):Mo($,F,N)}})(p.sources,_.sources,M,T);const I=[];p.layers&&p.layers.forEach(O=>{O.source&&T[O.source]?x.push({command:Kr.removeLayer,args:[O.id]}):I.push(O)});let L=p.terrain;L&&T[L.source]&&(x.push({command:Kr.setTerrain,args:[void 0]}),L=void 0),x=x.concat(M),K(L,_.terrain)||x.push({command:Kr.setTerrain,args:[_.terrain]}),function(O,F,N){F=F||[];const q=(O=O||[]).map(Qo),$=F.map(Qo),Z=O.reduce(pl,{}),V=F.reduce(pl,{}),X=q.slice(),ne=Object.create(null);let J,oe,H,ae,he,fe,ye;for(J=0,oe=0;J<q.length;J++)H=q[J],V.hasOwnProperty(H)?oe++:(N.push({command:Kr.removeLayer,args:[H]}),X.splice(X.indexOf(H,oe),1));for(J=0,oe=0;J<$.length;J++)H=$[$.length-1-J],X[X.length-1-J]!==H&&(Z.hasOwnProperty(H)?(N.push({command:Kr.removeLayer,args:[H]}),X.splice(X.lastIndexOf(H,X.length-oe),1)):oe++,fe=X[X.length-J],N.push({command:Kr.addLayer,args:[V[H],fe]}),X.splice(X.length-J,0,H),ne[H]=!0);for(J=0;J<$.length;J++)if(H=$[J],ae=Z[H],he=V[H],!ne[H]&&!K(ae,he))if(K(ae.source,he.source)&&K(ae["source-layer"],he["source-layer"])&&K(ae.type,he.type)){for(ye in As(ae.layout,he.layout,N,H,null,Kr.setLayoutProperty),As(ae.paint,he.paint,N,H,null,Kr.setPaintProperty),K(ae.slot,he.slot)||N.push({command:Kr.setSlot,args:[H,he.slot]}),K(ae.filter,he.filter)||N.push({command:Kr.setFilter,args:[H,he.filter]}),K(ae.minzoom,he.minzoom)&&K(ae.maxzoom,he.maxzoom)||N.push({command:Kr.setLayerZoomRange,args:[H,he.minzoom,he.maxzoom]}),ae)ae.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?As(ae[ye],he[ye],N,H,ye.slice(6),Kr.setPaintProperty):K(ae[ye],he[ye])||N.push({command:Kr.setLayerProperty,args:[H,ye,he[ye]]}));for(ye in he)he.hasOwnProperty(ye)&&!ae.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?As(ae[ye],he[ye],N,H,ye.slice(6),Kr.setPaintProperty):K(ae[ye],he[ye])||N.push({command:Kr.setLayerProperty,args:[H,ye,he[ye]]}))}else N.push({command:Kr.removeLayer,args:[H]}),fe=X[X.lastIndexOf(H)+1],N.push({command:Kr.addLayer,args:[he,fe]})}(I,_.layers,x)}catch(T){console.warn("Unable to compute style diff:",T),x=[{command:Kr.setStyle,args:[_]}]}return x}(this.serialize(),i).filter(p=>!(p.command in Fi));if(o.length===0)return!1;const h=o.filter(p=>!(p.command in th));if(h.length>0)throw new Error(`Unimplemented: ${h.map(p=>p.command).join(", ")}.`);return o.forEach(p=>{this[p.command].apply(this,p.args)}),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,o){return this.getImage(i)?this.fire(new s.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,o),this._afterImageUpdated(i),this)}updateImage(i,o){this.imageManager.updateImage(i,this.scope,o)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new s.a(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,o,h={}){return this._checkLoaded(),this._validate(Nt,`models.${i}`,o,null,h)||(this.modelManager.addModel(i,o,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new s.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,o,h={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Er,`sources.${i}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const p=Sn(i,o,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=x=>{const T=(x?"symbol:":"other:")+p.id,M=s.ag(T,this.scope),I=this._sourceCaches[T]=new Uo(M,p,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=I,I.onAdd(this.map)};_(!1),o.type!=="vector"&&o.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const o=this.getOwnSource(i);if(!o)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===i)return this.fire(new s.a(new Error(`Source "${i}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new s.a(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const h=this.getOwnSourceCaches(i);for(const p of h){const _=s.c3(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new s.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,o){this._checkLoaded(),this.getOwnSource(i).setData(o),this._changes.setDirty()}getOwnSource(i){const o=this.getOwnSourceCache(i);return o&&o.getSource()}getOwnSources(){const i=[];for(const o in this._otherSourceCaches){const h=this.getOwnSourceCache(o);h&&i.push(h.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const o in i){const h=i[o]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const p of i){if(this._validate(Oe,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(o)}else this.ambientLight=new jn(p,So,this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(o)}else this.directionalLight=new jn(p,Tn,this.scope,this.options)}}const h=new s.K(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,o=this.ambientLight;if(!i||!o)return;const h=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),p=i.properties.get("color").toArray01(),_=i.properties.get("intensity"),x=i.properties.get("direction"),T=1-s.bQ(x.x,x.y,x.z)[2]/90,M=h(p)*_*T,I=o.properties.get("color").toArray01(),L=o.properties.get("intensity");return(M+h(I)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(s.c4(i)){const o=s.c5(i),h=this.fragments.find(({id:_})=>_===o);if(!h)throw new Error(`Style import not found: ${i}`);const p=s.c3(i);return h.style.getFragmentStyle(p)}{const o=this.fragments.find(({id:h})=>h===i);if(!o)throw new Error(`Style import not found: ${i}`);return o.style}}getConfigProperty(i,o){const h=this.getFragmentStyle(i);if(!h)return null;const p=s.ag(o,h.scope),_=h.options.get(p),x=_?_.value||_.default:null;return x?x.serialize():null}setConfigProperty(i,o,h){const p=s.r(h);if(p.result!=="success")return void Xs(this,p.value);const _=p.value.expression,x=this.getFragmentStyle(i);if(!x)return;const T=s.ag(o,x.scope),M=x.options.get(T);M&&(this.options.set(T,{...M,value:_}),this.updateConfigDependencies())}setConfig(i,o){if(this._config=i,i||o)if(o)for(const h in o){let p,_;const x=s.r(o[h].default);if(x.result==="success"&&(p=x.value.expression),i&&i[h]!==void 0){const F=s.r(i[h]);F.result==="success"&&(_=F.value.expression)}const{minValue:T,maxValue:M,stepValue:I,type:L,values:O}=o[h];if(p){const F=s.ag(h,this.scope);this.options.set(F,{default:p,value:_,minValue:T,maxValue:M,stepValue:I,type:L,values:O})}else this.fire(new s.a(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new s.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const i of this._configDependentLayers){const o=this.getLayer(i);o&&(o.possiblyEvaluateVisibility(),this._updateLayer(o))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(i,o,h={}){this._checkLoaded();const p=i.id;if(this._layers[p])return void this.fire(new s.a(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(i.type==="custom"){if(Xs(this,s.c6(i)))return;_=s.c2(i,this.scope,this.options)}else{if(typeof i.source=="object"&&(this.addSource(p,i.source),i=s.c1(i),i=s.e(i,{source:p})),this._validate(de,`layers.${p}`,i,{arrayIndex:-1},h))return;_=s.c2(i,this.scope,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[_.id]=_.serialize()}_.isConfigDependent&&this._configDependentLayers.add(_.fqid);let x=this._order.length;if(o){const L=this._order.indexOf(o);if(L===-1)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));_.slot===this._layers[o].slot?x=L:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const T=this.getOwnLayerSourceCache(_),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&_.canCastShadows()&&M&&(T.castsShadows=!0);const I=this._changes.getRemovedLayer(_);if(I&&_.source&&T&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const L=s.ag(_.source,_.scope);I.type!==_.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),T.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(i,o){this._checkLoaded();const h=this._checkLayer(i);if(!h||i===o)return;const p=this._order.indexOf(i);this._order.splice(p,1);let _=this._order.length;if(o){const x=this._order.indexOf(o);if(x===-1)return void this.fire(new s.a(new Error(`Layer with id "${o}" does not exist on this map.`)));h.slot===this._layers[o].slot?_=x:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const o=this._checkLayer(i);if(!o)return;o.setEventedParent(null);const h=this._order.indexOf(i);this._order.splice(h,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const p=this.getOwnLayerSourceCache(o);if(p&&p.castsShadows){let _=!1;for(const x in this._layers)if(this._layers[x].source===o.source&&this._layers[x].canCastShadows()){_=!0;break}p.castsShadows=_}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const o in this._layers)if(this._layers[o].type===i)return!0;return!1}setLayerZoomRange(i,o,h){this._checkLoaded();const p=this._checkLayer(i);p&&(p.minzoom===o&&p.maxzoom===h||(o!=null&&(p.minzoom=o),h!=null&&(p.maxzoom=h),this._updateLayer(p)))}setSlot(i,o){this._checkLoaded();const h=this._checkLayer(i);h&&h.slot!==o&&(h.slot=o,this._updateLayer(h))}setFilter(i,o,h={}){this._checkLoaded();const p=this._checkLayer(i);if(p&&!K(p.filter,o))return o==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Fe,`layers.${p.id}.filter`,o,{layerType:p.type},h)||(p.filter=s.c1(o),this._updateLayer(p)))}getFilter(i){const o=this._checkLayer(i);if(o)return s.c1(o.filter)}setLayoutProperty(i,o,h,p={}){this._checkLoaded();const _=this._checkLayer(i);if(_&&!K(_.getLayoutProperty(o),h)){if(h!=null&&(!p||p.validate!==!1)&&Xs(_,nt.call(cr,{key:`layers.${i}.layout.${o}`,layerType:_.type,objectKey:o,value:h,styleSpec:s.D,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(o,h),_.isConfigDependent&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(i,o){const h=this._checkLayer(i);if(h)return h.getLayoutProperty(o)}setPaintProperty(i,o,h,p={}){this._checkLoaded();const _=this._checkLayer(i);if(!_||K(_.getPaintProperty(o),h)||h!=null&&(!p||p.validate!==!1)&&Xs(_,Ze.call(cr,{key:`layers.${i}.paint.${o}`,layerType:_.type,objectKey:o,value:h,styleSpec:s.D})))return;const x=_.setPaintProperty(o,h);_.isConfigDependent&&this._configDependentLayers.add(_.fqid),x&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(i,o){const h=this._checkLayer(i);if(h)return h.getPaintProperty(o)}setFeatureState(i,o){this._checkLoaded();const h=i.source,p=i.sourceLayer,_=this._checkSource(h);if(!_)return;const x=_.type;if(x==="geojson"&&p)return void this.fire(new s.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!p)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new s.a(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(h);for(const M of T)M.setFeatureState(p,i.id,o)}removeFeatureState(i,o){this._checkLoaded();const h=i.source,p=this._checkSource(h);if(!p)return;const _=p.type,x=_==="vector"?i.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new s.a(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(h);for(const M of T)M.removeFeatureState(x,i.id,o)}getFeatureState(i){this._checkLoaded();const o=i.source,h=i.sourceLayer,p=this._checkSource(o);if(p){if(p.type!=="vector"||h)return i.id===void 0&&this.fire(new s.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(h,i.id);this.fire(new s.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=s.e({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return s.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),o=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return s.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const o=this.getLayerSourceCache(i),h=s.ag(i.source,i.scope),p=this._changes.getUpdatedSourceCaches();i.source&&!p[h]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),o.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const o=T=>this._mergedLayers[T].type==="fill-extrusion"||this._mergedLayers[T].type==="model",h=this.order,p={},_=[];for(let T=h.length-1;T>=0;T--){const M=h[T];if(o(M)){p[M]=T;for(const I of i){const L=I[M];if(L)for(const O of L)_.push(O)}}}_.sort((T,M)=>M.intersectionZ-T.intersectionZ);const x=[];for(let T=h.length-1;T>=0;T--){const M=h[T];if(o(M))for(let I=_.length-1;I>=0;I--){const L=_[I].feature;if(p[L.layer.id]<T)break;x.push(L),_.pop()}else for(const I of i){const L=I[M];if(L)for(const O of L)x.push(O.feature)}}return x}queryRenderedFeatures(i,o,h){o&&o.filter&&this._validate(Fe,"queryRenderedFeatures.filter",o.filter,null,o),o.scope=this.scope,o.availableImages=this._availableImages,o.serializedLayers=this._serializedLayers;const p={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.a(new Error("parameters.layers must be an Array."))),[];for(const I of o.layers){const L=this._mergedLayers[I];if(!L)return this.fire(new s.a(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];p[L.source]=!0}}const _=[],x=o.serializedLayers||{},T=o&&o.layers?o.layers.some(I=>{const L=this.getLayer(I);return L&&L.is3D()}):this.has3DLayers(),M=En.createFromScreenPoints(i,h);for(const I in this._mergedSourceCaches){const L=this._mergedSourceCaches[I].getSource();if(!L||L.scope!==o.scope)continue;const O=this._mergedSourceCaches[I].getSource().id;o.layers&&!p[O]||_.push(Xl(this._mergedSourceCaches[I],this._mergedLayers,x,M,o,h,T,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(I,L,O,F,N,q,$){const Z={},V=q.queryRenderedSymbols(F),X=[];for(const ne of Object.keys(V).map(Number))X.push($[ne]);X.sort(za);for(const ne of X){const J=ne.featureIndex.lookupSymbolFeatures(V[ne.bucketInstanceId],L,ne.bucketIndex,ne.sourceLayerIndex,N.filter,N.layers,N.availableImages,I);for(const oe in J){const H=Z[oe]=Z[oe]||[],ae=J[oe];ae.sort((he,fe)=>{const ye=ne.featureSortOrder;if(ye){const De=ye.indexOf(he.featureIndex);return ye.indexOf(fe.featureIndex)-De}return fe.featureIndex-he.featureIndex});for(const he of ae)H.push(he)}}for(const ne in Z)Z[ne].forEach(J=>{const oe=J.feature,H=O(I[ne]);if(!H)return;const ae=H.getFeatureState(oe.layer["source-layer"],oe.id);oe.source=oe.layer.source,oe.layer["source-layer"]&&(oe.sourceLayer=oe.layer["source-layer"]),oe.state=ae});return Z}(this._mergedLayers,x,this.getLayerSourceCache.bind(this),M.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(i,o){o&&o.filter&&this._validate(Fe,"querySourceFeatures.filter",o.filter,null,o);const h=this.getOwnSourceCaches(i);let p=[];for(const _ of h)p=p.concat(cs(_,o));return p}addSourceType(i,o,h){return Do.getSourceType(i)?h(new Error(`A source type called "${i}" already exists.`)):(Do.setSourceType(i,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:o.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,o,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const T in i)if(!K(i[T],p[T])){_=!0;break}if(!_)return;const x=this._getTransitionParameters();this.light.setLight(i,o,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,o=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&o!==0||delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let h=i;const p=i.source==null;if(o===1){if(typeof h.source=="object"){const T="terrain-dem-src";this.addSource(T,h.source),h=s.c1(h),h=s.e(h,{source:T})}const _=s.e({},h),x={};if(this.terrain&&p){_.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(x.style=T.serialize())}if(this._validate(W,"terrain",_,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&o!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,o),this.fire(new s.b("data",{dataType:"style"}))}else{const _=this.terrain,x=_.get();for(const T of Object.keys(s.D.terrain))!h.hasOwnProperty(T)&&s.D.terrain[T].default&&(h[T]=s.D.terrain[T].default);for(const T in i)if(!K(i[T],x[T])){_.set(i,this.options),this.stylesheet.terrain=i;const M=this._getTransitionParameters({duration:0});_.updateTransitions(M),this.fire(new s.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const o=this.fog=new _o(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!K(o.get(),i)){o.set(i,this.options),this.stylesheet.fog=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}}else this._createFog(i);this._markersNeedUpdate=!0}_getTransitionParameters(i){return{now:s.f.now(),transition:s.e(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],o=[];for(const h in this._mergedLayers)this.isLayerDraped(this._mergedLayers[h])?i.push(h):o.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...o)}_createTerrain(i,o){const h=this.terrain=new fi(i,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});h.updateTransitions(p)}_force3DLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const o=this._layers[i];o.type==="symbol"&&this._updateLayer(o)}}_validate(i,o,h,p,_={}){if(_&&_.validate===!1)return!1;const x=s.e({},this.serialize());return Xs(this,i.call(cr,s.e({key:o,style:x,value:h,styleSpec:s.D},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const o=this.getSourceCaches(i);for(const h of o)h.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const o=this.getSourceCaches(i);for(const h of o)h.resume(),h.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let o;this.directionalLight&&(o=Rs(this.directionalLight));for(const h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(i,void 0,void 0,o)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const o=this._sourceCaches[i];o.resume(),o.reload()}}_updatePlacement(i,o,h,p,_=!1){let x=!1,T=!1;const M={},I={};for(const L of this._mergedOrder){const O=this._mergedLayers[L];if(O.type!=="symbol")continue;const F=s.ag(O.source,O.scope);let N=M[F];if(!N){const $=this.getLayerSourceCache(O);if(!$)continue;const Z=$.getRenderableIds(!0).map(V=>$.getTileByID(V));I[F]=Z.slice(),N=M[F]=Z.sort((V,X)=>X.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(X.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(O,N,i.center.lng,i.projection);x=x||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new s.b("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.f.now(),i.zoom))&&(this.pauseablePlacement=new wl(i,this._mergedOrder,_,o,h,p,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.f.now()),T=!0),x&&this.pauseablePlacement.placement.setStale()),T||x){this._buildingIndex.onNewFrame(i.zoom);for(const L of this._mergedOrder){const O=this._mergedLayers[L];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[s.ag(O.source,O.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.f.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,o){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:_})=>_===i.id)!==-1)return this.fire(new s.a(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!o)return h.push(i),this._loadImports([i],!0),this;const p=h.findIndex(({id:_})=>_===o);return p===-1?this.fire(new s.a(new Error(`Import with id "${o}" does not exist on this map.`))):(this.stylesheet.imports=h.slice(0,p).concat(i).concat(h.slice(p)),this._loadImports([i],!0,o),this)}updateImport(i,o){this._checkLoaded();const h=this.stylesheet.imports||[],p=this.getImportIndex(i);return p===-1?this:typeof o=="string"?(this.setImportUrl(i,o),this):(o.url&&o.url!==h[p].url&&this.setImportUrl(i,o.url),K(o.config,h[p].config)||this.setImportConfig(i,o.config),K(o.data,h[p].data)||this.setImportData(i,o.data),this)}moveImport(i,o){this._checkLoaded();let h=this.stylesheet.imports||[];const p=this.getImportIndex(i);if(p===-1)return this;const _=this.getImportIndex(o);if(_===-1)return this;const x=h[p],T=this.fragments[p];return h=h.filter(({id:M})=>M!==i),this.fragments=this.fragments.filter(({id:M})=>M!==i),this.stylesheet.imports=h.slice(0,_).concat(x).concat(h.slice(_)),this.fragments=this.fragments.slice(0,_).concat(T).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(i,o){this._checkLoaded();const h=this.stylesheet.imports||[],p=this.getImportIndex(i);if(p===-1)return this;h[p].url=o;const _=this.fragments[p];return _.style=this._createFragmentStyle(h[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(o),this}setImportData(i,o){this._checkLoaded();const h=this.getImportIndex(i),p=this.stylesheet.imports||[];return h===-1?this:o?(this.fragments[h].style.setState(o),this._reloadImports(),this):(delete p[h].data,this.setImportUrl(i,p[h].url))}setImportConfig(i,o){this._checkLoaded();const h=this.getImportIndex(i),p=this.stylesheet.imports||[];if(h===-1)return this;o?p[h].config=o:delete p[h].config;const _=this.fragments[h],x=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=o,_.style.setConfig(o,x),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const o=this.stylesheet.imports||[],h=this.getImportIndex(i);return h===-1||(o.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports()),this}getImportIndex(i){const o=(this.stylesheet.imports||[]).findIndex(h=>h.id===i);return o===-1&&this.fire(new s.a(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),o}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const o in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[o];h&&i.push(h.getSource())}return i}getSource(i,o){const h=this.getSourceCache(i,o);return h&&h.getSource()}getLayerSource(i){const o=this.getLayerSourceCache(i);return o&&o.getSource()}getSourceCache(i,o){const h=s.ag(i,o);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(i){const o=s.ag(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(i){const o=[];return this._mergedOtherSourceCaches[i]&&o.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&o.push(this._mergedSymbolSourceCaches[i]),o}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const o in i){const h=i[o];h==="reload"?this.reloadSource(o):h==="clear"&&this.clearSource(o)}}updateLayers(i){const o=this._changes.getUpdatedPaintProperties();for(const h of o){const p=this.getLayer(h);p&&p.updateTransitions(i)}}getImages(i,o,h){this.imageManager.getImages(o.icons,o.scope,h),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(o.tileID.key,o.type,o.icons)};p(this._otherSourceCaches[o.source]),p(this._symbolSourceCaches[o.source])}getGlyphs(i,o,h){this.glyphManager.getGlyphs(o.stacks,o.scope,h)}getResource(i,o,h){return s.c9(o,h)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const o=[];return this._otherSourceCaches[i]&&o.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&o.push(this._symbolSourceCaches[i]),o}_isSourceCacheLoaded(i){const o=this.getOwnSourceCaches(i);return o.length===0?(this.fire(new s.a(new Error(`There is no source with ID '${i}'`))),!1):o.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Do.getSourceType=function(u){return ls[u]},Do.setSourceType=function(u,i){ls[u]=i},Do.registerForPluginStateChange=s.bV;var bo=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Vo=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,ts=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ks="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ja=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Js=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qs=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_a=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ds=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,El=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ea=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const zs=[];Ga(bo,zs),Ga(ts,zs),Ga(Vo,zs);const Ao={"_prelude_fog.vertex.glsl":Js,"_prelude_terrain.vertex.glsl":ja,"_prelude_shadow.vertex.glsl":El,"_prelude_fog.fragment.glsl":Qs,"_prelude_shadow.fragment.glsl":ea,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_a,"_prelude_raster_particle.glsl":Ds},ks={};oi("",ja),oi(Qs,Js),oi(ea,El),oi(_a,""),oi(Ds,"");const Va=oi(Vo,ts),rh=bo;var od={background:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:oi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:oi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:oi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:oi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:oi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:oi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:oi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:oi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:oi("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:oi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:oi("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:oi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:oi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:oi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:oi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:oi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ks),skyboxGradient:oi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ks),skyboxCapture:oi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:oi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:oi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:oi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:oi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Ga(u,i){const o=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of o)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=h.split(" ");for(const _ of p)i.includes(_)||i.push(_)}}function oi(u,i){const o=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(I=>{const L=I.split(" ");return L[L.length-1]}),p=[...new Set(p)]);const _={},x=[],T=[];if(u=u.replace(o,(I,L)=>(T.push(L),"")),(i=i.replace(o,(I,L)=>(x.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...zs];Ga(u,M),Ga(i,M);for(const I of[...x,...T])Ao[I]||console.error(`Undefined include: ${I}`),ks[I]||(ks[I]=[],Ga(Ao[I],ks[I])),M=[...M,...ks[I]];return{fragmentSource:u=u.replace(h,(I,L,O,F,N)=>(_[N]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${O} ${F} ${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${O} ${F} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${O} ${F} ${N};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(h,(I,L,O,F,N)=>{const q=F==="float"?"vec2":F,$=N.match(/color/)?"color":q;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${O} ${F} a_${N};
#endif
`:_[N]?L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${O} ${q} a_${N};
out ${O} ${F} ${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:L==="initialize"?$==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${O} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${$}(a_${N}, u_${N}_t);
#else
    ${O} ${F} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${O} ${F} a_${N};
    out ${O} ${F} ${N};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${O} ${q} a_${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:L==="define-instanced"?$==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${O} ${F} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${q} a_${N};
#else
uniform ${O} ${F} u_${N};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${O} ${F} ${N} = a_${N};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${O} ${F} ${N} = a_${N};
#else
    ${O} ${F} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${O} ${F} ${N} = unpack_mix_${$}(a_${N}, u_${N}_t);
#else
    ${O} ${F} ${N} = u_${N};
#endif
`}),staticAttributes:p,usedDefines:M,vertexIncludes:x,fragmentIncludes:T}}class sd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,o,h,p,_,x,T,M){this.context=i;let I=this.boundPaintVertexBuffers.length!==p.length;for(let O=0;!I&&O<p.length;O++)this.boundPaintVertexBuffers[O]!==p[O]&&(I=!0);let L=this.boundDynamicVertexBuffers.length!==T.length;for(let O=0;!L&&O<T.length;O++)this.boundDynamicVertexBuffers[O]!==T[O]&&(L=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||I||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==x)this.freshBind(o,h,p,_,x,T,M);else{i.bindVertexArrayOES.set(this.vao);for(const O of T)O&&(O.bind(),M&&O.instanceCount&&O.setVertexAttribDivisor(i.gl,o,M));_&&_.dynamicDraw&&_.bind()}}freshBind(i,o,h,p,_,x,T){const M=i.numAttributes,I=this.context,L=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=x,o.enableAttributes(L,i),o.bind(),o.setVertexAttribPointers(L,i,_);for(const O of h)O.enableAttributes(L,i),O.bind(),O.setVertexAttribPointers(L,i,_);for(const O of x)O&&(O.enableAttributes(L,i),O.bind(),O.setVertexAttribPointers(L,i,_),T&&O.instanceCount&&O.setVertexAttribDivisor(L,i,T));p&&p.bind(),I.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function B_(u,i){const o=Math.pow(2,i.canonical.z),h=i.canonical.y;return[new s.L(0,h/o).toLngLat().lat,new s.L(0,(h+1)/o).toLngLat().lat]}function ih(u,i,o,h,p,_,x){const T=u.context,M=T.gl,I=o.hillshadeFBO;if(!I)return;u.prepareDrawTile();const L=u.isTileAffectedByFog(i),O=u.getOrCreateProgram("hillshade",{overrideFog:L});T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,I.colorAttachment.get());const F=((Z,V,X,ne)=>{const J=X.paint.get("hillshade-shadow-color"),oe=X.paint.get("hillshade-highlight-color"),H=X.paint.get("hillshade-accent-color"),ae=X.paint.get("hillshade-emissive-strength");let he=s.bj(X.paint.get("hillshade-illumination-direction"));if(X.paint.get("hillshade-illumination-anchor")==="viewport")he-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){const ye=Z.style.directionalLight.properties.get("direction"),De=s.bQ(ye.x,ye.y,ye.z);he=s.bj(De[1])}const fe=!Z.options.moving;return{u_matrix:ne||Z.transform.calculateProjMatrix(V.tileID.toUnwrapped(),fe),u_image:0,u_latrange:B_(0,V.tileID),u_light:[X.paint.get("hillshade-exaggeration"),he],u_shadow:J,u_highlight:oe,u_emissive_strength:ae,u_accent:H}})(u,o,h,u.terrain?i.projMatrix:null);u.uploadCommonUniforms(T,O,i.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:q,tileBoundsSegments:$}=u.getTileBoundsBuffers(o);O.draw(u,M.TRIANGLES,p,_,x,dr.disabled,F,h.id,N,q,$)}function lp(u,i,o){if(!i.needsDEMTextureUpload)return;const h=u.context,p=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||u.getTileTexture(o.stride);const _=o.getPixels();i.demTexture?i.demTexture.update(_,{premultiply:!1}):i.demTexture=new s.T(h,_,p.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ad(u,i,o){const h=u.context,p=h.gl;if(!i.dem)return;const _=i.dem;if(h.activeTexture.set(p.TEXTURE1),lp(u,i,_),!i.demTexture)return;i.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const x=_.dim;h.activeTexture.set(p.TEXTURE0);let T=i.hillshadeFBO;if(!T){const F=new s.T(h,{width:x,height:x,data:null},p.RGBA);F.bind(p.LINEAR,p.CLAMP_TO_EDGE),T=i.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),T.colorAttachment.set(F.texture)}h.bindFramebuffer.set(T.framebuffer),h.viewport.set([0,0,x,x]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:I,tileBoundsSegments:L}=u.getMercatorTileBoundsBuffers(),O=[];u.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(u,p.TRIANGLES,jt.disabled,ht.disabled,vr.unblended,dr.disabled,((F,N)=>{const q=N.stride,$=s.a6.create();return s.a6.ortho($,0,s.V,-s.V,0,0,1),s.a6.translate($,$,[0,-s.V,0]),{u_matrix:$,u_image:1,u_dimension:[q,q],u_zoom:F.overscaledZ}})(i.tileID,_),o.id,M,I,L),i.needsHillshadePrepare=!1}const cp=u=>({u_matrix:new s.bK(u),u_image0:new s.bO(u),u_skirt_height:new s.bN(u),u_ground_shadow_factor:new s.bM(u)}),nh=(u,i,o)=>({u_matrix:u,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:o}),up=(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:o,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:x,u_frustum_tr:T,u_frustum_br:M,u_frustum_bl:I,u_globe_pos:L,u_globe_radius:O,u_viewport:F,u_grid_matrix:$?Float32Array.from($):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:q});function Qc(u,i){return u!=null&&i!=null&&!(!u.hasData()||!i.hasData())&&u.demTexture!=null&&i.demTexture!=null&&u.tileID.key!==i.tileID.key}const sc=new class{constructor(){this.operations={}}newMorphing(u,i,o,h,p){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==o.tileID.key&&(_.queued=o)}else this.operations[u]={startTime:h,phase:0,duration:p,from:i,to:o,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const i=this.operations[u];return{from:i.from,to:i.to,phase:i.phase}}update(u){for(const i in this.operations){const o=this.operations[i];for(o.phase=(u-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,u)){delete this.operations[i];break}}}_nextOp(u,i){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=i,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},ld={0:null,1:"TERRAIN_VERTEX_MORPHING"};function cd(u,i,o){if(i===0)return 0;const h=i<1&&o===514?.25/i:1;return 6*Math.pow(1.5,22-u)*Math.max(i,1)*h}function ac(u,i){const o=1<<u.z;return!i&&(u.x===0||u.x===o-1)||u.y===0||u.y===o-1}const ud=u=>({u_matrix:u});function hd(u,i,o,h,p){if(p>0){const _=s.f.now(),x=(_-u.timeAdded)/p,T=i?(_-i.timeAdded)/p:-1,M=o.getSource(),I=h.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),L=!i||Math.abs(i.tileID.overscaledZ-I)>Math.abs(u.tileID.overscaledZ-I),O=L&&u.refreshedUponExpiration?1:s.aa(L?x:1-T,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),i?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class N_ extends Uo{constructor(i){const o={type:"raster-dem",maxzoom:i.transform.maxZoom},h=new s.bW(s.bX(),null),p=Sn("mock-dem",o,h,i.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,o){i.state="loaded",o(null)}}class U_ extends Uo{constructor(i){const o=Sn("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new s.bW(s.bX(),null),i.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,o,h){if(i.freezeTileCoverage)return;this.transform=i;const p=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){const T=new Ms(x,this._source.tileSize*x.overscaleFactor(),i.tileZoom);T.state="loaded",this._tiles[x.key]=T}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(i){const o=this.proxyCachedFBO[i];if(o!==void 0){const h=Object.values(o);this.renderCachePool.push(...h),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hp extends s.am{constructor(i,o,h){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=o,this.projMatrix=h}}class j_ extends s.ck{constructor(i,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,p,_]=function(M){const I=new s.aN,L=new s.aw,O=131;I.reserve(17161),L.reserve(33800);const F=s.V/128,N=s.V+F/2,q=N+F;for(let Z=-F;Z<q;Z+=F)for(let V=-F;V<q;V+=F){const X=V<0||V>N||Z<0||Z>N?24575:0,ne=s.aa(Math.round(V),0,s.V),J=s.aa(Math.round(Z),0,s.V);I.emplaceBack(ne+X,J)}const $=(Z,V)=>{const X=V*O+Z;L.emplaceBack(X+1,X,X+O),L.emplaceBack(X+O,X+O+1,X+1)};for(let Z=1;Z<129;Z++)for(let V=1;V<129;V++)$(V,Z);return[0,129].forEach(Z=>{for(let V=0;V<130;V++)$(V,Z),$(Z,V)}),[I,L,32768]}(),x=i.context;this.gridBuffer=x.createVertexBuffer(h,s.aP.members),this.gridIndexBuffer=x.createIndexBuffer(p),this.gridSegments=s.aB.simpleSegment(0,0,h.length,p.length),this.gridNoSkirtSegments=s.aB.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new U_(o.map),this.orthoMatrix=s.a6.create(),s.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.V,0,s.V,0,1);const T=x.gl;this._overlapStencilMode=new ht({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new N_(o.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,o,h){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const p=i.terrain.properties,_=i.terrain.drapeRenderMode===0,x=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.f.now();const T=i.terrain&&i.terrain.scope,M=p.get("source"),I=_?this._mockSourceCache:i.getSourceCache(M,T);if(!I)return void s.w(`Couldn't find terrain source "${M}".`);if(this.sourceCache=I,this._exaggeration=x?this.calculateExaggeration(o):p.get("exaggeration"),!o.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(o,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),o.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(i){const o=this._previousCameraAltitude,h=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=h;const p=o!=null?h-o:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=i.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(_);let T=_-this._previousZoom;const M=this._previousUpdateTimestamp;let I=_;this._evaluationZoom!=null&&(I=this._evaluationZoom,Math.abs(_-I)>.5&&(T=.5*(_-I+T)),T*p<0&&(I+=T)),this._evaluationZoom=I;const L=x.getExaggeration(I),O=L===x.getExaggeration(Math.max(0,I-.1));if(O&&Math.abs(L-this._exaggeration)<.01)return L;let F=Math.min(.1,.00375*(this._updateTimestamp-M));return(O||L<.1||Math.abs(T)<1e-4)&&(F=Math.min(.2,4*F)),s.U(this._exaggeration,L,F)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(s.L.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=o.getIds().map(M=>{const I=o.getTileByID(M).tileID;return I.projMatrix=h.calculateProjMatrix(I.toUnwrapped()),I});(function(M,I){const L=I.transform.pointCoordinate(I.transform.getCameraPoint()),O=new s.P(L.x,L.y);M.sort((F,N)=>{if(N.overscaledZ-F.overscaledZ)return N.overscaledZ-F.overscaledZ;const q=new s.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),$=new s.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),Z=O.mult(1<<F.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(q)-Z.distSqr($)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const M in x){const I=x[M];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,i[M],_),I.usedForTerrain))continue;const L=i[M];I.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[o.id]=p.map(M=>new hp(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const I=this.terrainTileForTile[M.key];if(!I)continue;const L=I.tileID.key;L in T||(this._visibleDemTiles.push(I),T[L]=L)}}_assignTerrainTiles(i){this._initializing||i.forEach(o=>{if(this.terrainTileForTile[o.key])return;const h=this._findTileCoveringTileID(o,this.sourceCache);h&&(this.terrainTileForTile[o.key]=h)})}_prepareDEMTextures(){const i=this.painter.context,o=i.gl;for(const h in this.terrainTileForTile){const p=this.terrainTileForTile[h],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(i.activeTexture.set(o.TEXTURE1),lp(this.painter,p,_))}}_prepareDemTileUniforms(i,o,h,p){if(!o||o.demTexture==null)return!1;const _=i.tileID.canonical,x=Math.pow(2,o.tileID.canonical.z-_.z),T=p||"";return h[`u_dem_tl${T}`]=[_.x*x%1,_.y*x%1],h[`u_dem_scale${T}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,o=i.gl;if(!this._emptyDepthBufferTexture){const h=new s.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.T(i,h,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const o=this._visibleDemTiles.reduce((h,p)=>{if(!p.dem)return h;const _=p.dem.tree.minimums[0];return _>0&&i++,h+_},0);return i?o/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,o=i.gl;i.activeTexture.set(o.TEXTURE2);const h=this._getLoadedAreaMinimum(),[p,_]=(()=>{const T=new s.cm({width:1,height:1},new Float32Array([h]));return[o.R32F,T]})();this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new s.T(i,_,p,{premultiply:!1}),x}setupElevationDraw(i,o,h){const p=this.painter.context,_=p.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};x.u_exaggeration=this.exaggeration();let T=null,M=null,I=1;if(h&&h.morphing&&this._useVertexMorphing){const F=h.morphing.srcDemTile,N=h.morphing.dstDemTile;I=h.morphing.phase,F&&N&&(this._prepareDemTileUniforms(i,F,x,"_prev")&&(M=F),this._prepareDemTileUniforms(i,N,x)&&(T=N))}const L=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST,O=F=>{x.u_dem_size=F.size[0]===1?1:F.size[0]-2};if(M&&T)p.activeTexture.set(_.TEXTURE2),T.demTexture.bind(L(T),_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE4),M.demTexture.bind(L(M),_.CLAMP_TO_EDGE),T.demTexture&&O(T.demTexture),x.u_dem_lerp=I;else{T=this.terrainTileForTile[i.tileID.key],p.activeTexture.set(_.TEXTURE2);const F=this._prepareDemTileUniforms(i,T,x)?T.demTexture:this.emptyDEMTexture;F.bind(L(T),_.CLAMP_TO_EDGE),O(F)}if(p.activeTexture.set(_.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&T){const F=(1<<T.tileID.canonical.z)*s.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=F}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),o.setTerrainUniformValues(p,x),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,i.tileID.canonical,h&&h.useDenormalizedUpVectorScale);o.setGlobeUniformValues(p,F)}}globeUniformValues(i,o,h){const p=i.projection;return{u_tile_tl_up:p.upVector(o,0,0),u_tile_tr_up:p.upVector(o,s.V,0),u_tile_br_up:p.upVector(o,s.V,s.V),u_tile_bl_up:p.upVector(o,0,s.V),u_tile_up_scale:h?s.cl(1):p.upVectorScale(o,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const o=this.painter,h=this.painter.context;i.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,x,T,M){if(p.transform.projection.name==="globe")(function(I,L,O,F,N){const q=I.context,$=q.gl;let Z,V;const X=I.transform,ne=s.cd(I,q,X),J=($e,je)=>{if(V===je)return;const it=[ld[je],"PROJECTION_GLOBE_VIEW"];ne&&it.push("CUSTOM_ANTIALIASING");const Ae=I.isTileAffectedByFog($e);Z=I.getOrCreateProgram("globeRaster",{defines:it,overrideFog:Ae}),V=je},oe=I.colorModeForRenderPass(),H=new jt($.LEQUAL,jt.ReadWrite,I.depthRangeFor3D);sc.update(N);const ae=s.ce(X),he=[s.a5(X.center.lng),s.ae(X.center.lat)],fe=I.globeSharedBuffers,ye=[X.width*s.f.devicePixelRatio,X.height*s.f.devicePixelRatio],De=Float32Array.from(X.globeMatrix),Te={useDenormalizedUpVectorScale:!0};{const $e=I.transform,je=cd($e.zoom,L.exaggeration(),L.sourceCache._source.tileSize);V=-1;const it=$.TRIANGLES;for(const Ae of F){const Be=O.getTile(Ae),_e=ht.disabled,Le=L.prevTerrainTileForTile[Ae.key],ot=L.terrainTileForTile[Ae.key];Qc(Le,ot)&&sc.newMorphing(Ae.key,Le,ot,N,250),q.activeTexture.set($.TEXTURE0),Be.texture&&Be.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const vt=sc.getMorphValuesForProxy(Ae.key),_t=vt?1:0;vt&&s.j(Te,{morphing:{srcDemTile:vt.from,dstDemTile:vt.to,phase:s.cc(vt.phase)}});const Ot=s.cf(Ae.canonical),Kt=s.cg(Ot.getCenter().lat),ur=s.ch(Ae.canonical,Ot,Kt,$e.worldSize/$e._pixelsPerMercatorPixel),tr=s.aT(s.ci(Ae.canonical)),ar=up($e.expandedFarZProjMatrix,De,ae,tr,s.S($e.zoom),he,$e.frustumCorners.TL,$e.frustumCorners.TR,$e.frustumCorners.BR,$e.frustumCorners.BL,$e.globeCenterInViewSpace,$e.globeRadius,ye,je,$e._farZ,ur);if(J(Ae,_t),Z&&(L.setupElevationDraw(Be,Z,Te),I.uploadCommonUniforms(q,Z,Ae.toUnwrapped()),fe)){const[Br,Mr,Or]=fe.getGridBuffers(Kt,je!==0);Z.draw(I,it,H,_e,oe,dr.backCCW,ar,"globe_raster",Br,Mr,Or)}}}if(fe&&(I.renderDefaultNorthPole||I.renderDefaultSouthPole)){const $e=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&$e.push("CUSTOM_ANTIALIASING"),Z=I.getOrCreateProgram("globeRaster",{defines:$e});for(const je of F){const{x:it,y:Ae,z:Be}=je.canonical,_e=Ae===0,Le=Ae===(1<<Be)-1,[ot,vt,_t,Ot]=fe.getPoleBuffers(Be,!1);if(Ot&&(_e||Le)){const Kt=O.getTile(je);q.activeTexture.set($.TEXTURE0),Kt.texture&&Kt.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);let ur=s.cj(Be,it,X);const tr=s.aT(s.ci(je.canonical)),ar=(Br,Mr)=>Br.draw(I,$.TRIANGLES,H,ht.disabled,oe,dr.disabled,up(X.expandedFarZProjMatrix,ur,ur,tr,0,he,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,ye,0,X._farZ),"globe_pole_raster",Mr,_t,Ot);L.setupElevationDraw(Kt,Z,Te),I.uploadCommonUniforms(q,Z,je.toUnwrapped()),_e&&I.renderDefaultNorthPole&&ar(Z,ot),Le&&I.renderDefaultSouthPole&&(ur=s.a6.scale(s.a6.create(),ur,[1,-1,1]),ar(Z,vt))}}}})(p,_,x,T,M);else{const I=p.context,L=I.gl;let O,F;const N=p.shadowRenderer,q=Qn(p,p.longestCutoffRange),$=oe=>{if(F===oe)return;const H=[];H.push(ld[oe]),q.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),O=p.getOrCreateProgram("terrainRaster",{defines:H}),F=oe},Z=p.colorModeForRenderPass(),V=new jt(L.LEQUAL,jt.ReadWrite,p.depthRangeFor3D);sc.update(M);const X=p.transform,ne=cd(X.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let J=[0,0,0];if(N){const oe=p.style.directionalLight,H=p.style.ambientLight;oe&&H&&(J=Os(oe,H))}{F=-1;const oe=L.TRIANGLES,[H,ae]=[_.gridIndexBuffer,_.gridSegments];for(const he of T){const fe=x.getTile(he),ye=ht.disabled,De=_.prevTerrainTileForTile[he.key],Te=_.terrainTileForTile[he.key];Qc(De,Te)&&sc.newMorphing(he.key,De,Te,M,250),I.activeTexture.set(L.TEXTURE0),fe.texture&&fe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const $e=sc.getMorphValuesForProxy(he.key),je=$e?1:0;let it;$e&&(it={morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:s.cc($e.phase)}});const Ae=nh(he.projMatrix,ac(he.canonical,X.renderWorldCopies)?ne/10:ne,J);if($(je),!O)continue;_.setupElevationDraw(fe,O,it);const Be=he.toUnwrapped();N&&N.setupShadows(Be,O),p.uploadCommonUniforms(I,O,Be,null,q),O.draw(p,oe,V,ye,Z,dr.backCCW,Ae,"terrain_raster",_.gridBuffer,H,ae)}}}}(o,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const o=this.painter,h=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],x=this._drapedRenderBatches.shift(),T=o.style.order,M=[];let I=0;for(const L of _){const O=p.getTileByID(L.proxyTileKey),F=p.proxyCachedFBO[L.key]?p.proxyCachedFBO[L.key][i]:void 0,N=F!==void 0?p.renderCache[F]:this.pool[I++],q=F!==void 0;if(O.texture=N.tex,q&&!N.dirty){M.push(O.tileID);continue}let $;h.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(h.clear({color:s.ax.transparent,stencil:0}),N.dirty=!1);for(let Z=x.start;Z<=x.end;++Z){const V=o.style._mergedLayers[T[Z]];if(V.isHidden(o.transform.zoom))continue;const X=o.style.getLayerSourceCache(V),ne=X?this.proxyToSource[L.key][X.id]:[L];if(!ne)continue;const J=ne;h.viewport.set([0,0,N.fb.width,N.fb.height]),$!==(X?X.id:null)&&(this._setupStencil(N,ne,V,X),$=X?X.id:null),o.renderLayer(o,X,V,J)}if(this._drapedRenderBatches.length===0)for(const Z of this._pendingGroundEffectLayers){const V=o.style._mergedLayers[T[Z]];if(V.isHidden(o.transform.zoom))continue;const X=o.style.getLayerSourceCache(V),ne=X?this.proxyToSource[L.key][X.id]:[L];if(!ne)continue;const J=ne;h.viewport.set([0,0,N.fb.width,N.fb.height]),$!==(X?X.id:null)&&(this._setupStencil(N,ne,V,X),$=X?X.id:null),o.renderLayer(o,X,V,J)}this.renderedToTile?(N.dirty=!0,M.push(O.tileID)):q||--I,I===5&&(I=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),x.end+1}postRender(){}isLayerOrderingCorrect(i){const o=i.order.length;let h=-1,p=o;for(let _=0;_<o;++_)this._style.isLayerDraped(i._mergedLayers[i.order[_]])?h=Math.max(h,_):p=Math.min(p,_);return p>h}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{i=Math.min(i,o.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,o,h){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const x=_.tileID,T=1<<x.overscaledZ,{x:M,y:I}=x.canonical,L=M/T,O=(M+1)/T,F=I/T,N=(I+1)/T;return{minx:L,miny:F,maxx:O,maxy:N,t:_.dem.tree.raycastRoot(L,F,O,N,i,o,h),tile:_}});p.sort((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,i,o,h);if(x!=null)return x}return null}_createFBO(){const i=this.painter.context,o=i.gl,h=this.drapeBufferSize;i.activeTexture.set(o.TEXTURE0);const p=new s.T(i,{width:h[0],height:h[1],data:null},o.RGBA);p.bind(o.LINEAR,o.CLAMP_TO_EDGE);const _=i.createFramebuffer(h[0],h[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new Ti(i,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const o=this._style._mergedLayers[i],h=o.isHidden(this.painter.transform.zoom);return o.type==="custom"?!h&&o.shouldRedrape():!h&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const h of this._style.getSources())if(h instanceof Lt){i=!0;break}if(!i)return;const o={};for(let h=0;h<this._style.order.length;++h){const p=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(p);if(_&&!o[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof s.Z){o[_.id]=!0;for(const x of this.proxyCoords){const T=this.proxyToSource[x.key][_.id];if(T)for(const M of T)this._clearRenderCacheForTile(_.id,M)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof Pt){i=!0;break}if(!i)return;const o={};for(let h=0;h<this._style.order.length;++h){const p=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(p);if(!_||o[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const x=p.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const M=this.proxyToSource[T.key][_.id];if(M)for(const I of M){const L=hd(_.getTile(I),_.findLoadedParent(I,0),_,this.painter.transform,x);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(_.id,I)}}}}_setupDrapedRenderBatches(){const i=this._style.order,o=i.length;if(o===0)return;const h=[];this._pendingGroundEffectLayers=[];let p,_=0,x=this._style._mergedLayers[i[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<o;)x=this._style._mergedLayers[i[_]];for(;_<o;++_){const T=this._style._mergedLayers[i[_]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?p===void 0&&(p=_):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(h.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&h.push({start:p,end:_-1}),h.length!==0){const T=h[h.length-1];this._pendingGroundEffectLayers.every(M=>M>T.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(i){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const x=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let T=0;T<x.length;++T){const M=Object.values(x[T]);o.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,p=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const T=h[x];if(o.getTileByID(T.key),o.proxyCachedFBO[T.key]!==void 0){const M=i[T.key],I=this.proxyToSource[T.key];let L=0;for(const O in I){const F=I[O],N=M[O];if(!N||N.length!==F.length||F.some((q,$)=>q!==N[$]||p[O]&&p[O].hasOwnProperty(q.key))){L=-1;break}++L}for(const O in o.proxyCachedFBO[T.key])o.renderCache[o.proxyCachedFBO[T.key][O]].dirty=L<0||L!==Object.values(M).length}}const _=[...this._drapedRenderBatches];_.sort((x,T)=>T.end-T.start-(x.end-x.start));for(const x of _)for(const T of h){if(o.proxyCachedFBO[T.key])continue;let M=o.renderCachePool.pop();M===void 0&&o.renderCache.length<50&&(M=o.renderCache.length,o.renderCache.push(this._createFBO())),M!==void 0&&(o.proxyCachedFBO[T.key]={},o.proxyCachedFBO[T.key][x.start]=M,o.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(i,o,h,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,x=_.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let T;if(h.isTileClipped())T=o.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):ht.disabled}_renderTileClippingMasks(i,o){const h=this.painter,p=this.painter.context,_=p.gl;h._tileClippingMaskIDs={},p.setColorMode(vr.disabled),p.setDepthMode(jt.disabled);const x=h.getOrCreateProgram("clippingMask");for(const T of i){const M=h._tileClippingMaskIDs[T.key]=--o;x.draw(h,_.TRIANGLES,jt.disabled,new ht({func:_.ALWAYS,mask:0},M,255,_.KEEP,_.KEEP,_.REPLACE),vr.disabled,dr.disabled,ud(T.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(i){const o=this.painter.transform;if(i.x<0||i.x>o.width||i.y<0||i.y>o.height)return null;const h=[i.x,i.y,1,1];s.a7.transformMat4(h,h,o.pixelMatrixInverse),s.a7.scale(h,h,1/h[3]),h[0]/=o.worldSize,h[1]/=o.worldSize;const p=o._camera.position,_=s.bl(1,o.center.lat),x=[p[0],p[1],p[2]/_,0],T=s.N.subtract([],h.slice(0,3),x);s.N.normalize(T,T);const M=this.raycast(x,T,this._exaggeration);return M!==null&&M?(s.N.scaleAndAdd(x,x,T,M),x[3]=x[2],x[2]*=_,x):null}drawDepth(){const i=this.painter,o=i.context,h=this.proxySourceCache,p=Math.ceil(i.width),_=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const x=o.gl,T=o.createFramebuffer(p,_,!0,"renderbuffer");o.activeTexture.set(x.TEXTURE0);const M=new s.T(o,{width:p,height:_,data:null},x.RGBA);M.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.colorAttachment.set(M.texture);const I=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,p,_);T.depthAttachment.set(I),this._depthFBO=T,this._depthTexture=M}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,p,_]),function(x,T,M,I){if(x.transform.projection.name==="globe")return;const L=x.context,O=L.gl;L.clear({depth:1});const F=x.getOrCreateProgram("terrainDepth"),N=new jt(O.LESS,jt.ReadWrite,x.depthRangeFor3D);for(const q of I){const $=M.getTile(q),Z=nh(q.projMatrix,0,[0,0,0]);T.setupElevationDraw($,F),F.draw(x,O.TRIANGLES,N,ht.disabled,vr.unblended,dr.backCCW,Z,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(i,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,o,h){if(i.getSource()instanceof s.ap)return this._setupProxiedCoordsForImageSource(i,o,h);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const p=this.proxiedCoords[i.id]=[],_=this.proxyCoords;for(let M=0;M<_.length;M++){const I=_[M],L=this._findTileCoveringTileID(I,i);if(L){const O=this._createProxiedId(I,L,h[I.key]&&h[I.key][i.id]);p.push(O),this.proxyToSource[I.key][i.id]=[O]}}let x=!1;const T=new Set;for(let M=0;M<o.length;M++){const I=i.getTile(o[M]);if(!I||!I.hasData())continue;const L=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==I.tileID.canonical.z){const O=this.proxyToSource[L.tileID.key][i.id],F=this._createProxiedId(L.tileID,I,h[L.tileID.key]&&h[L.tileID.key][i.id]);O?O.splice(O.length-1,0,F):this.proxyToSource[L.tileID.key][i.id]=[F];const N=this.proxyToSource[L.tileID.key][i.id];T.has(N)||T.add(N),p.push(F),x=!0}}if(this._sourceTilesOverlap[i.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const M of T)M.sort((I,L)=>L.overscaledZ-I.overscaledZ)}_setupProxiedCoordsForImageSource(i,o,h){if(!i.getSource().loaded())return;const p=this.proxiedCoords[i.id]=[],_=this.proxyCoords,x=i.getSource(),T=x.tileID;if(!T)return;const M=new s.P(T.x,T.y)._div(1<<T.z),I=x.coordinates.map(s.L.fromLngLat).reduce((O,F)=>(O.min.x=Math.min(O.min.x,F.x-M.x),O.min.y=Math.min(O.min.y,F.y-M.y),O.max.x=Math.max(O.max.x,F.x-M.x),O.max.y=Math.max(O.max.y,F.y-M.y),O),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(O,F)=>{const N=O.wrap+O.canonical.x/(1<<O.canonical.z),q=O.canonical.y/(1<<O.canonical.z),$=s.V/(1<<O.canonical.z),Z=F.wrap+F.canonical.x/(1<<F.canonical.z),V=F.canonical.y/(1<<F.canonical.z);return N+$<Z+I.min.x||N>Z+I.max.x||q+$<V+I.min.y||q>V+I.max.y};for(let O=0;O<_.length;O++){const F=_[O];for(let N=0;N<o.length;N++){const q=i.getTile(o[N]);if(!q||!q.hasData()||L(F,q.tileID))continue;const $=this._createProxiedId(F,q,h[F.key]&&h[F.key][i.id]),Z=this.proxyToSource[F.key][i.id];Z?Z.push($):this.proxyToSource[F.key][i.id]=[$],p.push($)}}}_createProxiedId(i,o,h){let p=this.orthoMatrix;if(h){const _=h.find(x=>x.key===o.tileID.key);if(_)return _}if(o.tileID.key!==i.key){const _=i.canonical.z-o.tileID.canonical.z;let x,T,M;p=s.a6.create();const I=o.tileID.wrap-i.wrap<<i.overscaledZ;_>0?(x=s.V>>_,T=x*((o.tileID.canonical.x<<_)-i.canonical.x+I),M=x*((o.tileID.canonical.y<<_)-i.canonical.y)):(x=s.V<<-_,T=s.V*(o.tileID.canonical.x-(i.canonical.x+I<<-_)),M=s.V*(o.tileID.canonical.y-(i.canonical.y<<-_))),s.a6.ortho(p,0,x,0,x,0,1),s.a6.translate(p,p,[T,M,0])}return new hp(o.tileID,i.key,p)}_findTileCoveringTileID(i,o){let h=o.getTile(i);if(h&&h.hasData())return h;const p=this._findCoveringTileCache[o.id],_=p[i.key];if(h=_?o.getTileByID(_):null,h&&h.hasData()||_===null)return h;let x=h?h.tileID:i,T=x.overscaledZ;const M=o.getSource().minzoom,I=[];if(!_){const O=o.getSource().maxzoom;if(i.canonical.z>=O){const F=i.canonical.z-O;o.getSource().reparseOverscaled?(T=Math.max(i.canonical.z+2,o.transform.tileZoom),x=new s.am(T,i.wrap,O,i.canonical.x>>F,i.canonical.y>>F)):F!==0&&(T=O,x=new s.am(T,i.wrap,O,i.canonical.x>>F,i.canonical.y>>F))}x.key!==i.key&&(I.push(x.key),h=o.getTile(x))}const L=O=>{I.forEach(F=>{p[F]=O}),I.length=0};for(T-=1;T>=M&&(!h||!h.hasData());T--){h&&L(h.tileID.key);const O=x.calculateScaledKey(T);if(h=o.getTileByID(O),h&&h.hasData())break;const F=p[O];if(F===null)break;F===void 0?I.push(O):h=o.getTileByID(F)}return L(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,o){let h=this._tilesDirty[i];h||(h=this._tilesDirty[i]={}),h[o.key]=!0}}function dd(u,i,o){const h=function(T,M,I){const L=s.N.dot(M,T),O=s.N.dot(I,[.2126,.7152,.0722]),F=(q,$,Z)=>(1-Z)*q+Z*$,N=F(1-.3*Math.min(O,1),1,Math.min(L+1,1));return F(.92,1,Math.asin(s.aa(M[2],-1,1))/Math.PI+.5)*N}(u,[0,0,1],i),p=[0,0,0];s.N.scale(p,o.slice(0,3),h);const _=[0,0,0];s.N.scale(_,i.slice(0,3),u[2]);const x=[0,0,0];return s.N.add(x,p,_),s.bU(x)}const fd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dp=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class pd{static cacheKey(i,o,h,p){let _=`${o}${p?p.cacheKey:""}`;for(const x of h)i.usedDefines.includes(x)&&(_+=`/${x}`);return _}constructor(i,o,h,p,_,x,T){const M=i.gl;this.program=M.createProgram(),this.configuration=p,this.name=o,this.fixedDefines=[...x];const I=p?p.getBinderAttributes():[],L=(h.staticAttributes||[]).concat(I);let O=p?p.defines():[];O=O.concat(x.map(V=>`#define ${V}`));const F=`#version 300 es
`;let N=F+O.concat("precision mediump float;",rh,Va.fragmentSource).join(`
`);for(const V of h.fragmentIncludes)N+=`
${Ao[V]}`;N+=`
${h.fragmentSource}`;let q=F+O.concat("precision highp float;",rh,Va.vertexSource).join(`
`);for(const V of h.vertexIncludes)q+=`
${Ao[V]}`;q+=`
${h.vertexSource}`;const $=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource($,N),M.compileShader($),M.attachShader(this.program,$);const Z=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Z,q),M.compileShader(Z),M.attachShader(this.program,Z),this.attributes={},this.numAttributes=L.length;for(let V=0;V<this.numAttributes;V++)if(L[V]){const X=L[V].startsWith("a_")?L[V]:`a_${L[V]}`;M.bindAttribLocation(this.program,V,X),this.attributes[X]=V}T&&T.shaderVaryings.length>0&&M.transformFeedbackVaryings(this.program,T.shaderVaryings,T.bufferMode),M.linkProgram(this.program),M.deleteShader(Z),M.deleteShader($),this.fixedUniforms=_(i),this.binderUniforms=p?p.getUniforms(i):[],x.includes("TERRAIN")&&(this.terrainUniforms=(V=>({u_dem:new s.bO(V),u_dem_prev:new s.bO(V),u_dem_tl:new s.bL(V),u_dem_scale:new s.bN(V),u_dem_tl_prev:new s.bL(V),u_dem_scale_prev:new s.bN(V),u_dem_size:new s.bN(V),u_dem_lerp:new s.bN(V),u_exaggeration:new s.bN(V),u_depth:new s.bO(V),u_depth_size_inv:new s.bL(V),u_meter_to_dem:new s.bN(V),u_label_plane_matrix_inv:new s.bK(V)}))(i)),x.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new s.bM(V),u_tile_tr_up:new s.bM(V),u_tile_br_up:new s.bM(V),u_tile_bl_up:new s.bM(V),u_tile_up_scale:new s.bN(V)}))(i)),x.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new s.bK(V),u_fog_range:new s.bL(V),u_fog_color:new s.bP(V),u_fog_horizon_blend:new s.bN(V),u_fog_vertical_limit:new s.bL(V),u_fog_temporal_offset:new s.bN(V),u_frustum_tl:new s.bM(V),u_frustum_tr:new s.bM(V),u_frustum_br:new s.bM(V),u_frustum_bl:new s.bM(V),u_globe_pos:new s.bM(V),u_globe_radius:new s.bN(V),u_globe_transition:new s.bN(V),u_is_globe:new s.bO(V),u_viewport:new s.bL(V)}))(i)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(V=>({u_cutoff_params:new s.bP(V)}))(i)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(V=>({u_lighting_ambient_color:new s.bM(V),u_lighting_directional_dir:new s.bM(V),u_lighting_directional_color:new s.bM(V),u_ground_radiance:new s.bM(V)}))(i)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(V=>({u_light_matrix_0:new s.bK(V),u_light_matrix_1:new s.bK(V),u_fade_range:new s.bL(V),u_shadow_normal_offset:new s.bM(V),u_shadow_intensity:new s.bN(V),u_shadow_texel_size:new s.bN(V),u_shadow_map_resolution:new s.bN(V),u_shadow_direction:new s.bM(V),u_shadow_bias:new s.bM(V),u_shadowmap_0:new s.bO(V),u_shadowmap_1:new s.bO(V)}))(i))}}setTerrainUniformValues(i,o){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const p in o)h[p]&&h[p].set(this.program,p,o[p])}}setGlobeUniformValues(i,o){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const p in o)h[p]&&h[p].set(this.program,p,o[p])}}setFogUniformValues(i,o){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const p in o)h[p].set(this.program,p,o[p])}}setCutoffUniformValues(i,o){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const p in o)h[p].set(this.program,p,o[p])}}setLightsUniformValues(i,o){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const p in o)h[p].set(this.program,p,o[p])}}setShadowUniformValues(i,o){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;i.program.set(this.program);for(const p in o)h[p].set(this.program,p,o[p])}_drawDebugWireframe(i,o,h,p,_,x,T,M,I,L){const O=i.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;const F=i.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||i._terrain&&i._terrain.renderingToTexture||!fd.includes(this.name))||!(!O.layers3D||!dp.includes(this.name))))return;const N=F.gl,q=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,_,F);if(!q)return;const $=[...this.fixedDefines];$.push("DEBUG_WIREFRAME");const Z=i.getOrCreateProgram(this.name,{config:this.configuration,defines:$});F.program.set(Z.program);const V=(J,oe,H)=>{if(oe[J]&&H[J])for(const ae in oe[J])H[J][ae]&&H[J][ae].set(H.program,ae,oe[J][ae].current)};I&&I.setUniforms(Z.program,F,Z.binderUniforms,T,{zoom:M}),V("fixedUniforms",this,Z),V("terrainUniforms",this,Z),V("globeUniforms",this,Z),V("fogUniforms",this,Z),V("lightsUniforms",this,Z),V("shadowUniforms",this,Z),q.bind(),F.setColorMode(new vr([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],s.ax.transparent,[!0,!0,!0,!1])),F.setDepthMode(new jt(o.func===N.LESS?N.LEQUAL:o.func,jt.ReadOnly,o.range)),F.setStencilMode(ht.disabled);const X=3*x.primitiveLength*2,ne=3*x.primitiveOffset*2*2;L&&L>1?N.drawElementsInstanced(N.LINES,X,N.UNSIGNED_SHORT,ne,L):N.drawElements(N.LINES,X,N.UNSIGNED_SHORT,ne),_.bind(),F.program.set(this.program),F.setDepthMode(o),F.setStencilMode(h),F.setColorMode(p)}draw(i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V){const X=i.context,ne=X.gl;if(this.failedToCreate)return;X.program.set(this.program),X.setDepthMode(h),X.setStencilMode(p),X.setColorMode(_),X.setCullFace(x);for(const ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,T[ae]);q&&q.setUniforms(this.program,X,this.binderUniforms,F,{zoom:N});const J={[ne.POINTS]:1,[ne.LINES]:2,[ne.TRIANGLES]:3,[ne.LINE_STRIP]:1}[o],oe=V&&V.length>0;if(oe){for(const ae of V)ne.bindBufferBase(ne.TRANSFORM_FEEDBACK_BUFFER,ae.targetIndex,ae.buffer.buffer);ne.beginTransformFeedback(o)}const H=Z&&Z>0?1:void 0;for(const ae of O.get()){const he=ae.vaos||(ae.vaos={});(he[M]||(he[M]=new sd)).bind(X,this,I,q?q.getPaintVertexBuffers():[],L,ae.vertexOffset,$||[],H),Z&&Z>1?ne.drawElementsInstanced(o,ae.primitiveLength*J,ne.UNSIGNED_SHORT,ae.primitiveOffset*J*2,Z):L?ne.drawElements(o,ae.primitiveLength*J,ne.UNSIGNED_SHORT,ae.primitiveOffset*J*2):ne.drawArrays(o,ae.vertexOffset,ae.vertexLength),o===ne.TRIANGLES&&L&&this._drawDebugWireframe(i,h,p,_,L,ae,F,N,q,Z)}oe&&ne.endTransformFeedback()}}function md(u,i){const o=Math.pow(2,i.tileID.overscaledZ),h=i.tileSize*Math.pow(2,u.transform.tileZoom)/o,p=h*(i.tileID.canonical.x+i.tileID.wrap*o),_=h*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.a3(i,1,u.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const fp=s.a6.create(),_d=(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$)=>{const Z=i.style.light,V=Z.properties.get("position"),X=[V.x,V.y,V.z],ne=s.co.create();Z.properties.get("anchor")==="viewport"&&(s.co.fromRotation(ne,-i.transform.angle),s.N.transformMat3(X,X,ne));const J=Z.properties.get("color"),oe=i.transform,H={u_matrix:u,u_lightpos:X,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[J.r,J.g,J.b],u_vertical_gradient:+o,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:_,u_flood_light_color:O,u_vertical_scale:F,u_flood_light_intensity:N,u_ground_shadow_factor:q,u_emissive_strength:$};return oe.projection.name==="globe"&&(H.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],H.u_zoom_transition=M,H.u_inv_rot_matrix=L,H.u_merc_center=I,H.u_up_dir=oe.projection.upVector(new s.bs(0,0,0),I[0]*s.V,I[1]*s.V),H.u_height_lift=T),H},gd=(u,i,o)=>({u_matrix:u,u_edge_radius:i,u_vertical_scale:o}),Sl=(u,i,o,h,p,_,x,T,M,I,L,O,F,N)=>{const q=_d(u,i,o,h,p,_,x,M,I,L,O,F,N,1,[0,0,0],0),$={u_height_factor:-Math.pow(2,x.overscaledZ)/T.tileSize/8};return s.e(q,md(i,T),$)},lc=(u,i)=>({u_matrix:u,u_emissive_strength:i}),yd=(u,i,o,h)=>s.e(lc(u,i),md(o,h)),Ml=(u,i,o)=>({u_matrix:u,u_world:o,u_emissive_strength:i}),pp=(u,i,o,h,p)=>s.e(yd(u,i,o,h),{u_world:p}),oh=(u,i,o,h)=>{const p=s.V/o.tileSize;return{u_matrix:u,u_camera_to_center_distance:i.getCameraToCenterDistance(h),u_extrude_scale:[i.pixelsToGLUnits[0]/p,i.pixelsToGLUnits[1]/p]}},vd=(u,i,o=1)=>({u_matrix:u,u_color:i,u_overlay:0,u_overlay_scale:o}),mp=s.a6.create(),xd=(u,i,o,h,p,_,x)=>{const T=u.transform,M=T.projection.name==="globe",I=M?s.cp(T.zoom,i.canonical)*T._pixelsPerMercatorPixel:s.a3(o,1,_),L={u_matrix:i.projMatrix,u_extrude_scale:I,u_intensity:x,u_inv_rot_matrix:mp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){L.u_inv_rot_matrix=h,L.u_merc_center=p,L.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],L.u_zoom_transition=s.S(T.zoom);const O=p[0]*s.V,F=p[1]*s.V;L.u_up_dir=T.projection.upVector(new s.bs(0,0,0),O,F)}return L};function sh(u,[i,o,h,p],[_,x]){if(_===x)return[0,0,0,0];const T=255*(u-1)/(u*(x-_));return[i*T,o*T,h*T,p*T]}function _p(u,i,[o,h]){return o===h?0:.5/u+(i-o)*(u-1)/(u*(h-o))}const bd=(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V,X,ne,J)=>{return{u_matrix:u,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:h,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:I,u_fade_t:L.mix,u_opacity:L.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(H=O.paint.get("raster-saturation"),H>0?1-1/(1.001-H):-H),u_contrast_factor:(oe=O.paint.get("raster-contrast"),oe>0?1/(1-oe):1+oe),u_spin_weights:eu(O.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:N,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:M,u_colorization_mix:sh(s.cq,$,V),u_colorization_offset:_p(s.cq,Z,V),u_color_ramp:q,u_texture_offset:[ne/(X+2*ne),X/(X+2*ne)],u_texture_res:[X+2*ne,X+2*ne],u_emissive_strength:J};var oe,H};function eu(u){u*=Math.PI/180;const i=Math.sin(u),o=Math.cos(u);return[(2*o+1)/3,(-Math.sqrt(3)*i-o+1)/3,(Math.sqrt(3)*i-o+1)/3]}const V_=(u,i,o,h,p,_,x,T,M,I,L,O)=>({u_matrix:u,u_normalize_matrix:i,u_globe_matrix:o,u_merc_matrix:h,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:I,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:M}),G_=(u,i,o,h,p,_,x,T)=>({u_tile_offset:u,u_velocity:i,u_color_ramp:h,u_velocity_res:o,u_max_speed:p,u_texture_offset:_,u_data_scale:x,u_data_offset:T}),gp=(u,i,o,h,p,_,x,T)=>({u_velocity:u,u_velocity_res:i,u_max_speed:o,u_speed_factor:h,u_lifetime_delta:p,u_rand_seed:Math.random(),u_texture_offset:_,u_data_scale:x,u_data_offset:T}),yp=s.a6.create(),ah=(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V)=>{const X=p.transform,ne={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:X.getCameraToCenterDistance($),u_rotate_symbol:+o,u_aspect_ratio:X.width/X.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:T,u_is_text:+M,u_pitch_with_map:+h,u_texsize:I,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:yp,u_up_vector:[0,-1,0],u_icon_transition:V||0,u_icon_saturation:Z};return $.name==="globe"&&(ne.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],ne.u_zoom_transition=O,ne.u_inv_rot_matrix=N,ne.u_merc_center=F,ne.u_camera_forward=X._camera.forward(),ne.u_ecef_origin=s.cr(X.globeMatrix,L.toUnwrapped()),ne.u_tile_matrix=Float32Array.from(X.globeMatrix),ne.u_up_vector=q),ne},tu=(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z)=>s.e(ah(u,i,o,h,p,_,x,T,M,I,O,F,N,q,$,Z,1),{u_gamma_scale:h?p.transform.getCameraToCenterDistance(Z)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:s.f.devicePixelRatio,u_is_halo:+L,undefined:void 0}),lh=(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$)=>s.e(tu(u,i,o,h,p,_,x,T,!0,M,!0,L,O,F,N,q,$),{u_texsize_icon:I,u_texture_icon:1}),wd=(u,i,o,h)=>({u_matrix:u,u_emissive_strength:i,u_opacity:o,u_color:h}),ru=(u,i,o,h,p,_,x)=>s.e(function(T,M,I,L){const O=I.imageManager.getPattern(T.toString(),M),{width:F,height:N}=I.imageManager.getPixelSize(M),q=Math.pow(2,L.tileID.overscaledZ),$=L.tileSize*Math.pow(2,I.transform.tileZoom)/q,Z=$*(L.tileID.canonical.x+L.tileID.wrap*q),V=$*L.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[F,N],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/s.a3(L,1,I.transform.tileZoom),u_pixel_coord_upper:[Z>>16,V>>16],u_pixel_coord_lower:[65535&Z,65535&V]}}(p,_,h,x),{u_matrix:u,u_emissive_strength:i,u_opacity:o}),ch=(u,i,o,h,p,_,x,T,M,I,L,O,F=[0,0,0],N)=>{const q=h.style.light,$=q.properties.get("position"),Z=[-$.x,-$.y,$.z],V=s.co.create();q.properties.get("anchor")==="viewport"&&(s.co.fromRotation(V,-h.transform.angle),s.N.transformMat3(Z,Z,V));const X=I.alphaMode==="MASK",ne=q.properties.get("color"),J=O.paint.get("model-ambient-occlusion-intensity"),oe=O.paint.get("model-color").constantOr(s.ax.white),H=O.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:i,u_normal_matrix:o,u_lightpos:Z,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:F,u_opacity:p,u_baseTextureIsAlpha:0,u_alphaMask:+X,u_alphaCutoff:I.alphaCutoff,u_baseColorFactor:[_.r,_.g,_.b,_.a],u_emissiveFactor:[x[0],x[1],x[2],1],u_metallicFactor:T,u_roughnessFactor:M,u_baseColorTexture:Si.BaseColor,u_metallicRoughnessTexture:Si.MetallicRoughness,u_normalTexture:Si.Normal,u_occlusionTexture:Si.Occlusion,u_emissionTexture:Si.Emission,u_color_mix:[oe.r,oe.g,oe.b,H],u_aoIntensity:J,u_emissive_strength:L,u_occlusionTextureTransform:N||[0,0,0,0]}},iu=new Float32Array(16),nu=(u,i=iu,o=iu)=>({u_matrix:u,u_instance:i,u_node_matrix:o}),$_={fillExtrusion:u=>({u_matrix:new s.bK(u),u_lightpos:new s.bM(u),u_lightintensity:new s.bN(u),u_lightcolor:new s.bM(u),u_vertical_gradient:new s.bN(u),u_opacity:new s.bN(u),u_edge_radius:new s.bN(u),u_ao:new s.bL(u),u_tile_id:new s.bM(u),u_zoom_transition:new s.bN(u),u_inv_rot_matrix:new s.bK(u),u_merc_center:new s.bL(u),u_up_dir:new s.bM(u),u_height_lift:new s.bN(u),u_flood_light_color:new s.bM(u),u_vertical_scale:new s.bN(u),u_flood_light_intensity:new s.bN(u),u_ground_shadow_factor:new s.bM(u),u_emissive_strength:new s.bN(u)}),fillExtrusionDepth:u=>({u_matrix:new s.bK(u),u_edge_radius:new s.bN(u),u_vertical_scale:new s.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new s.bK(u),u_lightpos:new s.bM(u),u_lightintensity:new s.bN(u),u_lightcolor:new s.bM(u),u_vertical_gradient:new s.bN(u),u_height_factor:new s.bN(u),u_edge_radius:new s.bN(u),u_ao:new s.bL(u),u_tile_id:new s.bM(u),u_zoom_transition:new s.bN(u),u_inv_rot_matrix:new s.bK(u),u_merc_center:new s.bL(u),u_up_dir:new s.bM(u),u_height_lift:new s.bN(u),u_image:new s.bO(u),u_texsize:new s.bL(u),u_pixel_coord_upper:new s.bL(u),u_pixel_coord_lower:new s.bL(u),u_tile_units_to_pixels:new s.bN(u),u_opacity:new s.bN(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new s.bK(u),u_opacity:new s.bN(u),u_ao_pass:new s.bN(u),u_meter_to_tile:new s.bN(u),u_ao:new s.bL(u),u_flood_light_intensity:new s.bN(u),u_flood_light_color:new s.bM(u),u_attenuation:new s.bN(u),u_edge_radius:new s.bN(u),u_fb:new s.bO(u),u_fb_size:new s.bN(u)}),fill:u=>({u_matrix:new s.bK(u),u_emissive_strength:new s.bN(u)}),fillPattern:u=>({u_matrix:new s.bK(u),u_emissive_strength:new s.bN(u),u_image:new s.bO(u),u_texsize:new s.bL(u),u_pixel_coord_upper:new s.bL(u),u_pixel_coord_lower:new s.bL(u),u_tile_units_to_pixels:new s.bN(u)}),fillOutline:u=>({u_matrix:new s.bK(u),u_emissive_strength:new s.bN(u),u_world:new s.bL(u)}),fillOutlinePattern:u=>({u_matrix:new s.bK(u),u_emissive_strength:new s.bN(u),u_world:new s.bL(u),u_image:new s.bO(u),u_texsize:new s.bL(u),u_pixel_coord_upper:new s.bL(u),u_pixel_coord_lower:new s.bL(u),u_tile_units_to_pixels:new s.bN(u)}),circle:s.cs,collisionBox:u=>({u_matrix:new s.bK(u),u_camera_to_center_distance:new s.bN(u),u_extrude_scale:new s.bL(u)}),collisionCircle:u=>({u_matrix:new s.bK(u),u_inv_matrix:new s.bK(u),u_camera_to_center_distance:new s.bN(u),u_viewport_size:new s.bL(u)}),debug:u=>({u_color:new s.ca(u),u_matrix:new s.bK(u),u_overlay:new s.bO(u),u_overlay_scale:new s.bN(u)}),clippingMask:u=>({u_matrix:new s.bK(u)}),heatmap:u=>({u_extrude_scale:new s.bN(u),u_intensity:new s.bN(u),u_matrix:new s.bK(u),u_inv_rot_matrix:new s.bK(u),u_merc_center:new s.bL(u),u_tile_id:new s.bM(u),u_zoom_transition:new s.bN(u),u_up_dir:new s.bM(u)}),heatmapTexture:u=>({u_image:new s.bO(u),u_color_ramp:new s.bO(u),u_opacity:new s.bN(u)}),hillshade:u=>({u_matrix:new s.bK(u),u_image:new s.bO(u),u_latrange:new s.bL(u),u_light:new s.bL(u),u_shadow:new s.ca(u),u_highlight:new s.ca(u),u_emissive_strength:new s.bN(u),u_accent:new s.ca(u)}),hillshadePrepare:u=>({u_matrix:new s.bK(u),u_image:new s.bO(u),u_dimension:new s.bL(u),u_zoom:new s.bN(u)}),line:s.ct,linePattern:s.cu,raster:u=>({u_matrix:new s.bK(u),u_normalize_matrix:new s.bK(u),u_globe_matrix:new s.bK(u),u_merc_matrix:new s.bK(u),u_grid_matrix:new s.cb(u),u_tl_parent:new s.bL(u),u_scale_parent:new s.bN(u),u_fade_t:new s.bN(u),u_opacity:new s.bN(u),u_image0:new s.bO(u),u_image1:new s.bO(u),u_brightness_low:new s.bN(u),u_brightness_high:new s.bN(u),u_saturation_factor:new s.bN(u),u_contrast_factor:new s.bN(u),u_spin_weights:new s.bM(u),u_perspective_transform:new s.bL(u),u_raster_elevation:new s.bN(u),u_zoom_transition:new s.bN(u),u_merc_center:new s.bL(u),u_cutoff_params:new s.bP(u),u_colorization_mix:new s.bP(u),u_colorization_offset:new s.bN(u),u_color_ramp:new s.bO(u),u_texture_offset:new s.bL(u),u_texture_res:new s.bL(u),u_emissive_strength:new s.bN(u)}),rasterParticle:u=>({u_matrix:new s.bK(u),u_normalize_matrix:new s.bK(u),u_globe_matrix:new s.bK(u),u_merc_matrix:new s.bK(u),u_grid_matrix:new s.cb(u),u_tl_parent:new s.bL(u),u_scale_parent:new s.bN(u),u_fade_t:new s.bN(u),u_opacity:new s.bN(u),u_image0:new s.bO(u),u_image1:new s.bO(u),u_raster_elevation:new s.bN(u),u_zoom_transition:new s.bN(u),u_merc_center:new s.bL(u),u_cutoff_params:new s.bP(u)}),rasterParticleTexture:u=>({u_texture:new s.bO(u),u_opacity:new s.bN(u)}),rasterParticleDraw:u=>({u_tile_offset:new s.bL(u),u_velocity:new s.bO(u),u_color_ramp:new s.bO(u),u_velocity_res:new s.bL(u),u_max_speed:new s.bN(u),u_texture_offset:new s.bL(u),u_data_scale:new s.bP(u),u_data_offset:new s.bN(u)}),rasterParticleUpdate:u=>({u_velocity:new s.bO(u),u_velocity_res:new s.bL(u),u_max_speed:new s.bN(u),u_speed_factor:new s.bN(u),u_lifetime_delta:new s.bN(u),u_rand_seed:new s.bN(u),u_texture_offset:new s.bL(u),u_data_scale:new s.bP(u),u_data_offset:new s.bN(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new s.bO(u),u_is_size_feature_constant:new s.bO(u),u_size_t:new s.bN(u),u_size:new s.bN(u),u_camera_to_center_distance:new s.bN(u),u_rotate_symbol:new s.bO(u),u_aspect_ratio:new s.bN(u),u_fade_change:new s.bN(u),u_matrix:new s.bK(u),u_label_plane_matrix:new s.bK(u),u_coord_matrix:new s.bK(u),u_is_text:new s.bO(u),u_pitch_with_map:new s.bO(u),u_texsize:new s.bL(u),u_tile_id:new s.bM(u),u_zoom_transition:new s.bN(u),u_inv_rot_matrix:new s.bK(u),u_merc_center:new s.bL(u),u_camera_forward:new s.bM(u),u_tile_matrix:new s.bK(u),u_up_vector:new s.bM(u),u_ecef_origin:new s.bM(u),u_texture:new s.bO(u),u_icon_transition:new s.bN(u),u_icon_saturation:new s.bN(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new s.bO(u),u_is_size_feature_constant:new s.bO(u),u_size_t:new s.bN(u),u_size:new s.bN(u),u_camera_to_center_distance:new s.bN(u),u_rotate_symbol:new s.bO(u),u_aspect_ratio:new s.bN(u),u_fade_change:new s.bN(u),u_matrix:new s.bK(u),u_label_plane_matrix:new s.bK(u),u_coord_matrix:new s.bK(u),u_is_text:new s.bO(u),u_pitch_with_map:new s.bO(u),u_texsize:new s.bL(u),u_texture:new s.bO(u),u_gamma_scale:new s.bN(u),u_device_pixel_ratio:new s.bN(u),u_tile_id:new s.bM(u),u_zoom_transition:new s.bN(u),u_inv_rot_matrix:new s.bK(u),u_merc_center:new s.bL(u),u_camera_forward:new s.bM(u),u_tile_matrix:new s.bK(u),u_up_vector:new s.bM(u),u_ecef_origin:new s.bM(u),u_is_halo:new s.bO(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new s.bO(u),u_is_size_feature_constant:new s.bO(u),u_size_t:new s.bN(u),u_size:new s.bN(u),u_camera_to_center_distance:new s.bN(u),u_rotate_symbol:new s.bO(u),u_aspect_ratio:new s.bN(u),u_fade_change:new s.bN(u),u_matrix:new s.bK(u),u_label_plane_matrix:new s.bK(u),u_coord_matrix:new s.bK(u),u_is_text:new s.bO(u),u_pitch_with_map:new s.bO(u),u_texsize:new s.bL(u),u_texsize_icon:new s.bL(u),u_texture:new s.bO(u),u_texture_icon:new s.bO(u),u_gamma_scale:new s.bN(u),u_device_pixel_ratio:new s.bN(u),u_is_halo:new s.bO(u)}),background:u=>({u_matrix:new s.bK(u),u_emissive_strength:new s.bN(u),u_opacity:new s.bN(u),u_color:new s.ca(u)}),backgroundPattern:u=>({u_matrix:new s.bK(u),u_emissive_strength:new s.bN(u),u_opacity:new s.bN(u),u_image:new s.bO(u),u_pattern_tl:new s.bL(u),u_pattern_br:new s.bL(u),u_texsize:new s.bL(u),u_pattern_size:new s.bL(u),u_pixel_coord_upper:new s.bL(u),u_pixel_coord_lower:new s.bL(u),u_tile_units_to_pixels:new s.bN(u)}),terrainRaster:cp,terrainDepth:cp,skybox:u=>({u_matrix:new s.bK(u),u_sun_direction:new s.bM(u),u_cubemap:new s.bO(u),u_opacity:new s.bN(u),u_temporal_offset:new s.bN(u)}),skyboxGradient:u=>({u_matrix:new s.bK(u),u_color_ramp:new s.bO(u),u_center_direction:new s.bM(u),u_radius:new s.bN(u),u_opacity:new s.bN(u),u_temporal_offset:new s.bN(u)}),skyboxCapture:u=>({u_matrix_3f:new s.cb(u),u_sun_direction:new s.bM(u),u_sun_intensity:new s.bN(u),u_color_tint_r:new s.bP(u),u_color_tint_m:new s.bP(u),u_luminance:new s.bN(u)}),globeRaster:u=>({u_proj_matrix:new s.bK(u),u_globe_matrix:new s.bK(u),u_normalize_matrix:new s.bK(u),u_merc_matrix:new s.bK(u),u_zoom_transition:new s.bN(u),u_merc_center:new s.bL(u),u_image0:new s.bO(u),u_grid_matrix:new s.cb(u),u_skirt_height:new s.bN(u),u_far_z_cutoff:new s.bN(u),u_frustum_tl:new s.bM(u),u_frustum_tr:new s.bM(u),u_frustum_br:new s.bM(u),u_frustum_bl:new s.bM(u),u_globe_pos:new s.bM(u),u_globe_radius:new s.bN(u),u_viewport:new s.bL(u)}),globeAtmosphere:u=>({u_frustum_tl:new s.bM(u),u_frustum_tr:new s.bM(u),u_frustum_br:new s.bM(u),u_frustum_bl:new s.bM(u),u_horizon:new s.bN(u),u_transition:new s.bN(u),u_fadeout_range:new s.bN(u),u_color:new s.bP(u),u_high_color:new s.bP(u),u_space_color:new s.bP(u),u_temporal_offset:new s.bN(u),u_horizon_angle:new s.bN(u)}),model:u=>({u_matrix:new s.bK(u),u_lighting_matrix:new s.bK(u),u_normal_matrix:new s.bK(u),u_lightpos:new s.bM(u),u_lightintensity:new s.bN(u),u_lightcolor:new s.bM(u),u_camera_pos:new s.bM(u),u_opacity:new s.bN(u),u_baseColorFactor:new s.bP(u),u_emissiveFactor:new s.bP(u),u_metallicFactor:new s.bN(u),u_roughnessFactor:new s.bN(u),u_baseTextureIsAlpha:new s.bO(u),u_alphaMask:new s.bO(u),u_alphaCutoff:new s.bN(u),u_baseColorTexture:new s.bO(u),u_metallicRoughnessTexture:new s.bO(u),u_normalTexture:new s.bO(u),u_occlusionTexture:new s.bO(u),u_emissionTexture:new s.bO(u),u_color_mix:new s.bP(u),u_aoIntensity:new s.bN(u),u_emissive_strength:new s.bN(u),u_occlusionTextureTransform:new s.bP(u)}),modelDepth:u=>({u_matrix:new s.bK(u),u_instance:new s.bK(u),u_node_matrix:new s.bK(u)}),groundShadow:u=>({u_matrix:new s.bK(u),u_ground_shadow_factor:new s.bM(u)}),stars:u=>({u_matrix:new s.bK(u),u_up:new s.bM(u),u_right:new s.bM(u),u_intensity_multiplier:new s.bN(u)})};let Fs;function Bs(u,i,o,h,p,_,x){const T=u.context,M=T.gl,I=u.transform,L=u.getOrCreateProgram("collisionBox"),O=[];let F=0,N=0;for(let J=0;J<h.length;J++){const oe=h[J],H=i.getTile(oe),ae=H.getBucket(o);if(!ae)continue;const he=Ba(oe,ae,I);let fe=he;p[0]===0&&p[1]===0||(fe=u.translatePosMatrix(he,H,p,_));const ye=x?ae.textCollisionBox:ae.iconCollisionBox,De=ae.collisionCircleArray;if(De.length>0){const Te=s.a6.create(),$e=fe;s.a6.mul(Te,ae.placementInvProjMatrix,I.glCoordMatrix),s.a6.mul(Te,Te,ae.placementViewportMatrix),O.push({circleArray:De,circleOffset:N,transform:$e,invTransform:Te,projection:ae.getProjection()}),F+=De.length/4,N=F}ye&&(u.terrain&&u.terrain.setupElevationDraw(H,L),L.draw(u,M.LINES,jt.disabled,ht.disabled,u.colorModeForRenderPass(),dr.disabled,oh(fe,I,H,ae.getProjection()),o.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,I.zoom,null,[ye.collisionVertexBuffer,ye.collisionVertexBufferExt]))}if(!x||!O.length)return;const q=u.getOrCreateProgram("collisionCircle"),$=new s.cv;$.resize(4*F),$._trim();let Z=0;for(const J of O)for(let oe=0;oe<J.circleArray.length/4;oe++){const H=4*oe,ae=J.circleArray[H+0],he=J.circleArray[H+1],fe=J.circleArray[H+2],ye=J.circleArray[H+3];$.emplace(Z++,ae,he,fe,ye,0),$.emplace(Z++,ae,he,fe,ye,1),$.emplace(Z++,ae,he,fe,ye,2),$.emplace(Z++,ae,he,fe,ye,3)}(!Fs||Fs.length<2*F)&&(Fs=function(J){const oe=2*J,H=new s.aw;H.resize(oe),H._trim();for(let ae=0;ae<oe;ae++){const he=6*ae;H.uint16[he+0]=4*ae+0,H.uint16[he+1]=4*ae+1,H.uint16[he+2]=4*ae+2,H.uint16[he+3]=4*ae+2,H.uint16[he+4]=4*ae+3,H.uint16[he+5]=4*ae+0}return H}(F));const V=T.createIndexBuffer(Fs,!0),X=T.createVertexBuffer($,s.cw.members,!0);for(const J of O){const oe={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(ne=I).getCameraToCenterDistance(J.projection),u_viewport_size:[ne.width,ne.height]};q.draw(u,M.TRIANGLES,jt.disabled,ht.disabled,u.colorModeForRenderPass(),dr.disabled,oe,o.id,X,V,s.aB.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,I.zoom)}var ne;X.destroy(),V.destroy()}const ga=s.a6.create();function ou(u){const i=u._camera.getWorldToCamera(u.worldSize,1),o=s.a6.multiply([],i,u.globeMatrix);s.a6.invert(o,o);const h=[0,0,0],p=[0,1,0,0];return s.a7.transformMat4(p,p,o),h[0]=p[0],h[1]=p[1],h[2]=p[2],s.N.normalize(h,h),h}function Gt({width:u,height:i,anchor:o,textOffset:h,textScale:p},_){const{horizontalAlign:x,verticalAlign:T}=s.bf(o),M=-(x-.5)*u,I=-(T-.5)*i,L=s.bd(o,h);return new s.P((M/p+L[0])*_,(I/p+L[1])*_)}function vp(u,i,o,h,p,_,x,T,M,I,L){const O=u.text.placedSymbolArray,F=u.text.dynamicLayoutVertexArray,N=u.icon.dynamicLayoutVertexArray,q={},$=u.getProjection(),Z=jo(T,$,_),V=_.elevation,X=$.upVectorScale(T.canonical,_.center.lat,_.worldSize).metersToTile;F.clear();for(let ne=0;ne<O.length;ne++){const J=O.get(ne),{tileAnchorX:oe,tileAnchorY:H,numGlyphs:ae}=J,he=J.hidden||!J.crossTileID||u.allowVerticalPlacement&&!J.placedOrientation?null:h[J.crossTileID];if(he){let fe=0,ye=0,De=0;if(V){const ot=V?V.getAtTileOffset(T,oe,H):0,[vt,_t,Ot]=$.upVector(T.canonical,oe,H);fe=ot*vt*X,ye=ot*_t*X,De=ot*Ot*X}let[Te,$e,je,it]=uo(J.projectedAnchorX+fe,J.projectedAnchorY+ye,J.projectedAnchorZ+De,o?Z:x);const Ae=Jl(_.getCameraToCenterDistance($),it);let Be=p.evaluateSizeForFeature(u.textSizeData,I,J)*Ae/s.bc;o&&(Be*=u.tilePixelRatio/M);const _e=Gt(he,Be);o?({x:Te,y:$e,z:je}=$.projectTilePoint(oe+_e.x,H+_e.y,T.canonical),[Te,$e,je]=uo(Te+fe,$e+ye,je+De,x)):(i&&_e._rotate(-_.angle),Te+=_e.x,$e+=_e.y,je=0);const Le=u.allowVerticalPlacement&&J.placedOrientation===s.b6.vertical?Math.PI/2:0;for(let ot=0;ot<ae;ot++)s.b9(F,Te,$e,je,Le);L&&J.associatedIconIndex>=0&&(q[J.associatedIconIndex]={x:Te,y:$e,z:je,angle:Le})}else Cs(ae,F)}if(L){N.clear();const ne=u.icon.placedSymbolArray;for(let J=0;J<ne.length;J++){const oe=ne.get(J),{numGlyphs:H}=oe,ae=q[J];if(oe.hidden||!ae)Cs(H,N);else{const{x:he,y:fe,z:ye,angle:De}=ae;for(let Te=0;Te<H;Te++)s.b9(N,he,fe,ye,De)}}u.icon.dynamicLayoutVertexBuffer.updateData(N)}u.text.dynamicLayoutVertexBuffer.updateData(F)}function uh(u,i,o,h,p,_,x={}){const T=o.paint.get("icon-translate"),M=o.paint.get("text-translate"),I=o.paint.get("icon-translate-anchor"),L=o.paint.get("text-translate-anchor"),O=o.layout.get("icon-rotation-alignment"),F=o.layout.get("text-rotation-alignment"),N=o.layout.get("icon-pitch-alignment"),q=o.layout.get("text-pitch-alignment"),$=o.layout.get("icon-keep-upright"),Z=o.layout.get("text-keep-upright"),V=o.paint.get("icon-color-saturation"),X=u.context,ne=X.gl,J=u.transform,oe=O==="map",H=F==="map",ae=N==="map",he=q==="map",fe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ye=!1;const De=u.depthModeForSublayer(0,jt.ReadOnly),Te=[s.a5(J.center.lng),s.ae(J.center.lat)],$e=o.layout.get("text-variable-anchor"),je=J.projection.name==="globe",it=[],Ae=[0,-1,0];for(const Be of h){const _e=i.getTile(Be),Le=_e.getBucket(o);if(!Le||Le.projection.name==="mercator"&&je||Le.fullyClipped)continue;const ot=Le.projection.name==="globe",vt=ot?s.S(J.zoom):0,_t=jo(Be,Le.getProjection(),J),Ot=J.calculatePixelsToTileUnitsMatrix(_e),Kt=$e&&Le.hasTextData(),ur=Le.hasIconTextFit()&&Kt&&Le.hasIconData(),tr=Le.getProjection().createInversionMatrix(J,Be.canonical),ar=()=>{const ln=oe&&o.layout.get("symbol-placement")!=="point",Wr=[],li=ln||ur,Xr=o.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&ae&&Wr.push("PITCH_WITH_MAP_TERRAIN"),ot&&(Wr.push("PROJECTION_GLOBE_VIEW"),li&&Wr.push("PROJECTED_POS_ON_VIEWPORT")),Xr>0&&Wr.push("ICON_TRANSITION"),Le.icon.zOffsetVertexBuffer&&Wr.push("Z_OFFSET"),V<1&&Wr.push("SATURATION");const si=Le.icon.programConfigurations.get(o.id),qi=u.getOrCreateProgram(Le.sdfIcons?"symbolSDF":"symbolIcon",{config:si,defines:Wr});let pi;const Wn=_e.imageAtlasTexture?_e.imageAtlasTexture.size:[0,0],ho=Le.iconSizeData,qo=s.b5(ho,J.zoom),ra=ae||J.pitch!==0,Zo=ml(_t,_e.tileID.canonical,ae,oe,J,Le.getProjection(),Ot),Xn=_l(_t,_e.tileID.canonical,ae,oe,J,Le.getProjection(),Ot),Un=u.translatePosMatrix(Xn,_e,T,I,!0),Co=u.translatePosMatrix(_t,_e,T,I),ko=li?ga:Zo,Ho=oe&&!ae&&!ln;let ia=Ae;!je&&!J.mercatorFromTransition||oe||(ia=ou(J));const Ja=ot?ia:Ae;pi=Le.sdfIcons&&!Le.iconsInText?tu(ho.kind,qo,Ho,ae,u,Co,ko,Un,!1,Wn,!0,Be,vt,Te,tr,Ja,Le.getProjection()):ah(ho.kind,qo,Ho,ae,u,Co,ko,Un,!1,Wn,Be,vt,Te,tr,Ja,Le.getProjection(),V,Xr);const Ll=_e.imageAtlasTexture?_e.imageAtlasTexture:null,Eu=o.layout.get("icon-size").constantOr(0)!==1||Le.iconsNeedLinear,Su=Le.sdfIcons||u.options.rotating||u.options.zooming||Eu||ra?ne.LINEAR:ne.NEAREST,Jd=Le.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Mu=u.terrain&&ae&&ln?s.a6.invert(s.a6.create(),Zo):ga;if(ln&&Le.icon){const fc=J.elevation,xh=fc?fc.getAtTileOffsetFunc(Be,J.center.lat,J.worldSize,Le.getProjection()):null,ba=Hc(_t,_e.tileID.canonical,ae,oe,J,Le.getProjection(),Ot);yl(Le,_t,u,!1,ba,Xn,ae,$,xh,Be)}return{program:qi,buffers:Le.icon,uniformValues:pi,atlasTexture:Ll,atlasTextureIcon:null,atlasInterpolation:Su,atlasInterpolationIcon:null,isSDF:Le.sdfIcons,hasHalo:Jd,tile:_e,labelPlaneMatrixInv:Mu}},Br=()=>{const ln=H&&o.layout.get("symbol-placement")!=="point",Wr=[],li=ln||$e||ur;u.terrainRenderModeElevated()&&he&&Wr.push("PITCH_WITH_MAP_TERRAIN"),ot&&(Wr.push("PROJECTION_GLOBE_VIEW"),li&&Wr.push("PROJECTED_POS_ON_VIEWPORT")),Le.text.zOffsetVertexBuffer&&Wr.push("Z_OFFSET");const Xr=Le.text.programConfigurations.get(o.id),si=u.getOrCreateProgram(Le.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Xr,defines:Wr});let qi,pi=[0,0],Wn=null;const ho=Le.textSizeData;Le.iconsInText&&(pi=_e.imageAtlasTexture?_e.imageAtlasTexture.size:[0,0],Wn=_e.imageAtlasTexture?_e.imageAtlasTexture:null,qi=he||J.pitch!==0||u.options.rotating||u.options.zooming||ho.kind==="composite"||ho.kind==="camera"?ne.LINEAR:ne.NEAREST);const qo=_e.glyphAtlasTexture?_e.glyphAtlasTexture.size:[0,0],ra=s.b5(ho,J.zoom),Zo=ml(_t,_e.tileID.canonical,he,H,J,Le.getProjection(),Ot),Xn=_l(_t,_e.tileID.canonical,he,H,J,Le.getProjection(),Ot),Un=u.translatePosMatrix(Xn,_e,M,L,!0),Co=u.translatePosMatrix(_t,_e,M,L),ko=li?ga:Zo,Ho=H&&!he&&!ln;let ia=Ae;!je&&!J.mercatorFromTransition||H||(ia=ou(J));const Ja=ot?ia:Ae;let Ll;Ll=Le.iconsInText?lh(ho.kind,ra,Ho,he,u,Co,ko,Un,qo,pi,Be,vt,Te,tr,Ja,Le.getProjection()):tu(ho.kind,ra,Ho,he,u,Co,ko,Un,!0,qo,!0,Be,vt,Te,tr,Ja,Le.getProjection());const Eu=_e.glyphAtlasTexture?_e.glyphAtlasTexture:null,Su=ne.LINEAR,Jd=o.paint.get("text-halo-width").constantOr(1)!==0,Mu=u.terrain&&he&&ln?s.a6.invert(s.a6.create(),Zo):ga;if(ln&&Le.text){const fc=J.elevation,xh=fc?fc.getAtTileOffsetFunc(Be,J.center.lat,J.worldSize,Le.getProjection()):null,ba=Hc(_t,_e.tileID.canonical,he,H,J,Le.getProjection(),Ot);yl(Le,_t,u,!0,ba,Xn,he,Z,xh,Be)}return{program:si,buffers:Le.text,uniformValues:Ll,atlasTexture:Eu,atlasTextureIcon:Wn,atlasInterpolation:Su,atlasInterpolationIcon:qi,isSDF:!0,hasHalo:Jd,tile:_e,labelPlaneMatrixInv:Mu}},Mr=Le.icon.segments.get().length,Or=Le.text.segments.get().length,Lr=Mr&&!x.onlyText?ar():null,ri=Or&&!x.onlyIcons?Br():null,Bi=o.paint.get("icon-opacity").constantOr(1),Hr=o.paint.get("text-opacity").constantOr(1);if(fe&&Le.canOverlap){ye=!0;const ln=Bi&&!x.onlyText?Le.icon.segments.get():[],Wr=Hr&&!x.onlyIcons?Le.text.segments.get():[];for(const li of ln)it.push({segments:new s.aB([li]),sortKey:li.sortKey,state:Lr});for(const li of Wr)it.push({segments:new s.aB([li]),sortKey:li.sortKey,state:ri})}else x.onlyText||it.push({segments:Bi?Le.icon.segments:new s.aB([]),sortKey:0,state:Lr}),x.onlyIcons||it.push({segments:Hr?Le.text.segments:new s.aB([]),sortKey:0,state:ri})}ye&&it.sort((Be,_e)=>Be.sortKey-_e.sortKey);for(const Be of it){const _e=Be.state;if(_e)if(u.terrain&&u.terrain.setupElevationDraw(_e.tile,_e.program,{useDepthForOcclusion:J.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:_e.labelPlaneMatrixInv}),X.activeTexture.set(ne.TEXTURE0),_e.atlasTexture&&_e.atlasTexture.bind(_e.atlasInterpolation,ne.CLAMP_TO_EDGE,!0),_e.atlasTextureIcon&&(X.activeTexture.set(ne.TEXTURE1),_e.atlasTextureIcon&&_e.atlasTextureIcon.bind(_e.atlasInterpolationIcon,ne.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,_e.program),_e.hasHalo){const Le=_e.uniformValues;Le.u_is_halo=1,$a(_e.buffers,Be.segments,o,u,_e.program,De,p,_,Le,2),Le.u_is_halo=0}else{if(_e.isSDF){const Le=_e.uniformValues;_e.hasHalo&&(Le.u_is_halo=1,$a(_e.buffers,Be.segments,o,u,_e.program,De,p,_,Le,1)),Le.u_is_halo=0}$a(_e.buffers,Be.segments,o,u,_e.program,De,p,_,_e.uniformValues,1)}}}function $a(u,i,o,h,p,_,x,T,M,I){const L=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];p.draw(h,h.context.gl.TRIANGLES,_,x,T,dr.disabled,M,o.id,u.layoutVertexBuffer,u.indexBuffer,i,o.paint,h.transform.zoom,u.programConfigurations.get(o.id),L,I)}function Al(u,i,o,h,p,_,x){const T=u.context.gl,M=o.paint.get("fill-pattern"),I=M&&M.constantOr(1);let L,O,F,N,q;x?(O=I&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=T.LINES):(O=I?"fillPattern":"fill",L=T.TRIANGLES);for(const $ of h){const Z=i.getTile($);if(I&&!Z.patternsLoaded())continue;const V=Z.getBucket(o);if(!V)continue;u.prepareDrawTile();const X=V.programConfigurations.get(o.id),ne=u.isTileAffectedByFog($),J=u.getOrCreateProgram(O,{config:X,overrideFog:ne});I&&(u.context.activeTexture.set(T.TEXTURE0),Z.imageAtlasTexture&&Z.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),X.updatePaintBuffers());const oe=M.constantOr(null);if(oe&&Z.imageAtlas){const he=Z.imageAtlas.patternPositions[oe.toString()];he&&X.setConstantPatternPositions(he)}const H=u.translatePosMatrix($.projMatrix,Z,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),ae=o.paint.get("fill-emissive-strength");if(x){N=V.indexBuffer2,q=V.segments2;const he=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];F=O==="fillOutlinePattern"&&I?pp(H,ae,u,Z,he):Ml(H,ae,he)}else N=V.indexBuffer,q=V.segments,F=I?yd(H,ae,u,Z):lc(H,ae);u.uploadCommonUniforms(u.context,J,$.toUnwrapped()),J.draw(u,L,p,u.stencilModeForClipping($),_,dr.disabled,F,o.id,V.layoutVertexBuffer,N,q,o.paint,u.transform.zoom,X,void 0)}}function Jt(u,i,o,h,p,_,x,T){o.resetLayerRenderingStats(u);const M=u.context,I=M.gl,L=u.transform,O=o.paint.get("fill-extrusion-pattern"),F=O.constantOr(1),N=o.paint.get("fill-extrusion-opacity"),q=u.style.enable3dLights(),$=o.paint.get(q&&!F?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),$],V=o.layout.get("fill-extrusion-edge-radius"),X=V>0&&!o.paint.get("fill-extrusion-rounded-roof"),ne=X?0:V,J=L.projection.name==="globe"?s.cF():0,oe=L.projection.name==="globe",H=oe?s.S(L.zoom):0,ae=[s.a5(L.center.lng),s.ae(L.center.lat)],he=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),fe=o.paint.get("fill-extrusion-flood-light-intensity"),ye=o.paint.get("fill-extrusion-vertical-scale"),De=Qn(u,o.paint.get("fill-extrusion-cutoff-fade-range")),Te=o.paint.get("fill-extrusion-emissive-strength"),$e=[];let je;oe&&$e.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&$e.push("FAUX_AO"),X&&$e.push("ZERO_ROOF_RADIUS"),T&&$e.push("HAS_CENTROID"),fe>0&&$e.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&$e.push("RENDER_CUTOFF");const it=u.renderPass==="shadow",Ae=u.shadowRenderer,Be=it&&!!Ae;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let _e=[0,0,0];if(Ae){const vt=u.style.directionalLight,_t=u.style.ambientLight;vt&&_t&&(_e=Os(vt,_t)),je=$e.concat(["SHADOWS_SINGLE_CASCADE"])}const Le=Be?"fillExtrusionDepth":F?"fillExtrusionPattern":"fillExtrusion",ot=o.getLayerRenderingStats();for(const vt of h){const _t=i.getTile(vt),Ot=_t.getBucket(o);if(!Ot||Ot.projection.name!==L.projection.name)continue;let Kt=!1;Ae&&(Kt=Ae.getMaxCascadeForTile(vt.toUnwrapped())===0);const ur=u.isTileAffectedByFog(vt),tr=Ot.programConfigurations.get(o.id),ar=u.getOrCreateProgram(Le,{config:tr,defines:Kt?je:$e,overrideFog:ur});if(u.terrain&&u.terrain.setupElevationDraw(_t,ar,{useMeterToDem:!0}),!Ot.centroidVertexBuffer){const Bi=ar.attributes.a_centroid_pos;Bi!==void 0&&I.vertexAttrib2f(Bi,0,0)}!it&&Ae&&Ae.setupShadows(_t.tileID.toUnwrapped(),ar,"vector-tile",_t.tileID.overscaledZ),F&&(u.context.activeTexture.set(I.TEXTURE0),_t.imageAtlasTexture&&_t.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),tr.updatePaintBuffers());const Br=O.constantOr(null);if(Br&&_t.imageAtlas){const Bi=_t.imageAtlas.patternPositions[Br.toString()];Bi&&tr.setConstantPatternPositions(Bi)}const Mr=o.paint.get("fill-extrusion-vertical-gradient");let Or;if(it&&Ae){if(bp(_t.tileID,Ot,u))continue;const Bi=Ae.calculateShadowPassMatrixFromTile(_t.tileID.toUnwrapped());Or=gd(Bi,ne,ye)}else{const Bi=u.translatePosMatrix(vt.expandedProjMatrix,_t,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Hr=L.projection.createInversionMatrix(L,vt.canonical);Or=F?Sl(Bi,u,Mr,N,Z,ne,vt,_t,J,H,ae,Hr,he,ye):_d(Bi,u,Mr,N,Z,ne,vt,J,H,ae,Hr,he,ye,fe,_e,Te)}u.uploadCommonUniforms(M,ar,vt.toUnwrapped(),null,De);let Lr=Ot.segments;if(L.projection.name==="mercator"&&!it&&(Lr=Ot.getVisibleSegments(_t.tileID,u.terrain,u.transform.getFrustum(0)),!Lr.get().length))continue;if(ot)if(it)for(const Bi of Lr.get())ot.numRenderedVerticesInShadowPass+=Bi.primitiveLength;else for(const Bi of Lr.get())ot.numRenderedVerticesInTransparentPass+=Bi.primitiveLength;const ri=[];(u.terrain||T)&&ri.push(Ot.centroidVertexBuffer),oe&&ri.push(Ot.layoutVertexExtBuffer),ar.draw(u,M.gl.TRIANGLES,p,_,x,dr.backCCW,Or,o.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Lr,o.paint,u.transform.zoom,tr,ri)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function qa(u,i,o,h,p,_,x,T,M,I,L,O,F,N,q,$,Z,V,X){const ne=u.context,J=ne.gl,oe=u.transform,H=u.transform.zoom,ae=[],he=Qn(u,o.paint.get("fill-extrusion-cutoff-fade-range"));I==="clear"?(ae.push("CLEAR_SUBPASS"),X&&(ae.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(J.TEXTURE0),X.bind(J.LINEAR,J.CLAMP_TO_EDGE))):I==="sdf"&&ae.push("SDF_SUBPASS"),Z&&ae.push("HAS_CENTROID"),he.shouldRenderCutoff&&ae.push("RENDER_CUTOFF");const fe=o.layout.get("fill-extrusion-edge-radius"),ye=(De,Te,$e,je,it)=>{const Ae=Te.programConfigurations.get(o.id),Be=u.isTileAffectedByFog(De),_e=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ae,defines:ae,overrideFog:Be}),Le=((vt,_t,Ot,Kt,ur,tr,ar,Br,Mr,Or,Lr)=>({u_matrix:_t,u_opacity:Ot,u_ao_pass:Kt?1:0,u_meter_to_tile:ur,u_ao:tr,u_flood_light_intensity:ar,u_flood_light_color:Br,u_attenuation:Mr,u_edge_radius:Or,u_fb:0,u_fb_size:Lr}))(0,je,L,M,it,[O,F*it],N,q,$,H>=17?0:fe*it,X?X.size[0]:0),ot=[];Z&&ot.push(Te.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ne,_e,De.toUnwrapped(),null,he),_e.draw(u,ne.gl.TRIANGLES,p,_,x,T,Le,o.id,Te.vertexBuffer,Te.indexBuffer,$e,o.paint,H,Ae,ot)};for(const De of h){const Te=i.getTile(De),$e=Te.getBucket(o);if(!$e||$e.projection.name!==oe.projection.name||!$e.groundEffect||$e.groundEffect&&!$e.groundEffect.hasData())continue;const je=$e.groundEffect,it=1/$e.tileToMeter;{const Ae=u.translatePosMatrix(De.projMatrix,Te,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Be=je.getDefaultSegment();ye(De,je,Be,Ae,it)}if(V)for(let Ae=0;Ae<4;Ae++){const Be=s.cG[Ae](De),_e=i.getTile(Be);if(!_e)continue;const Le=_e.getBucket(o);if(!Le||Le.projection.name!==oe.projection.name||!Le.groundEffect||Le.groundEffect&&!Le.groundEffect.hasData())continue;const ot=Le.groundEffect;let vt,_t;Ae===0?(vt=[-s.V,0,0],_t=1):Ae===1?(vt=[s.V,0,0],_t=0):Ae===2?(vt=[0,-s.V,0],_t=3):(vt=[0,s.V,0],_t=2);const Ot=ot.regionSegments[_t];if(!Ot)continue;const Kt=new Float32Array(16);s.a6.translate(Kt,De.projMatrix,vt),ye(De,ot,Ot,u.translatePosMatrix(Kt,Te,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),it)}}}function q_(u,i,o,h,p,_,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const T=_?_.findDEMTileFor(o):null;if(!(T&&T.dem||x))return;const M=V=>new s.P(Math.ceil((V+s.cJ)*s.cK),0),I=V=>{const X=i.getSource().minzoom,ne=oe=>{const H=i.getTileByID(oe);if(H&&H.hasData())return H.getBucket(p)},J=[0,-1,1];for(const oe of J){if(V.overscaledZ+oe<X)continue;const H=ne(V.calculateScaledKey(V.overscaledZ+oe));if(H)return H}},L=[0,0,0],O=(V,X)=>(L[0]=Math.min(V.min.y,X.min.y),L[1]=Math.max(V.max.y,X.max.y),L[2]=s.V-X.min.x>V.max.x?X.min.x-s.V:V.max.x,L),F=(V,X)=>(L[0]=Math.min(V.min.x,X.min.x),L[1]=Math.max(V.max.x,X.max.x),L[2]=s.V-X.min.y>V.max.y?X.min.y-s.V:V.max.y,L),N=[(V,X)=>O(V,X),(V,X)=>O(X,V),(V,X)=>F(V,X),(V,X)=>F(X,V)],q=(V,X,ne,J,oe,H,ae)=>{if(!_)return 0;const he=[[H?ne:V,H?V:ne,0],[H?ne:X,H?X:ne,0]],fe=ae<0?s.V+ae:ae,ye=[H?fe:(V+X)/2,H?(V+X)/2:fe,0];return ne===0&&ae<0||ne!==0&&ae>0?_.getForTilePoints(oe,[ye],!0,J):he.push(ye),_.getForTilePoints(o,he,!0,T),Math.max(he[0][2],he[1][2],ye[2])/_.exaggeration()};for(let V=0;V<4;V++){const X=h.borderFeatureIndices[V];if(X.length===0)continue;const ne=s.cG[V](o),J=I(ne);if(!(J&&J instanceof s.cH)||h.borderDoneWithNeighborZ[V]===J.canonical.z)continue;J.centroidVertexArray.length===0&&J.createCentroidsBuffer();const oe=_?_.findDEMTileFor(ne):null;if(!(oe&&oe.dem||x))continue;const H=(V<2?1:5)-V,ae=J.borderDoneWithNeighborZ[H]!==h.canonical.z,he=J.borderFeatureIndices[H];let fe=0;if(h.canonical.z!==J.canonical.z){for(const ye of X)h.showCentroid(h.featuresOnBorder[ye]);if(ae)for(const ye of he)J.showCentroid(J.featuresOnBorder[ye]);h.borderDoneWithNeighborZ[V]=J.canonical.z,J.borderDoneWithNeighborZ[H]=h.canonical.z}for(const ye of X){const De=h.featuresOnBorder[ye],Te=h.centroidData[De.centroidDataIndex],$e=De.borders[V];let je;for(;fe<he.length;){je=J.featuresOnBorder[he[fe]];const it=je.borders[H];if(it[1]>$e[0]+3||it[0]>$e[0]-3)break;J.showCentroid(je),fe++}if(je&&fe<he.length){const it=fe;let Ae=0;for(;!(je.borders[H][0]>$e[1]-3)&&(Ae++,++fe!==he.length);)je=J.featuresOnBorder[he[fe]];if(je=J.featuresOnBorder[he[it]],Ae>1){const Le=je.borders[H];Math.abs($e[0]-Le[0])<3&&Math.abs($e[1]-Le[1])<3&&(Ae=1,fe=it+1)}else if(Ae===0){h.showCentroid(De);continue}const Be=J.centroidData[je.centroidDataIndex];x&&Ae===1&&((($=Te).flags|(Z=Be).flags)&s.cI?($.flags|=s.cI,Z.flags|=s.cI):($.flags&=~s.cI,Z.flags&=~s.cI));const _e=De.intersectsCount()>1||je.intersectsCount()>1;if(Ae>1)fe=it,Te.centroidXY=Be.centroidXY=new s.P(0,0);else if(oe&&oe.dem&&!_e){const Le=N[V](Te,Be),ot=V%2?s.V-1:0,vt=q(Le[0],Math.min(s.V-1,Le[1]),ot,oe,ne,V<2,Le[2]);Te.centroidXY=Be.centroidXY=M(vt)}else _e?Te.centroidXY=Be.centroidXY=new s.P(0,0):(Te.centroidXY=h.encodeBorderCentroid(De),Be.centroidXY=J.encodeBorderCentroid(je));h.writeCentroidToBuffer(Te),J.writeCentroidToBuffer(Be)}else h.showCentroid(De)}h.borderDoneWithNeighborZ[V]=J.canonical.z,J.borderDoneWithNeighborZ[H]=h.canonical.z}var $,Z;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const Z_=[1,0,0],Td=[0,1,0],xp=[0,0,1];function bp(u,i,o){const h=o.transform,p=o.shadowRenderer;if(!p)return!0;const _=u.toUnwrapped(),x=h.tileSize*p._cascades[o.currentShadowCascade].scale;let T=i.maxHeight;if(h.elevation){const $=h.elevation.getMinMaxForTile(u);$&&(T+=$.max)}const M=[...p.shadowDirection];M[2]=-M[2];const I=p.computeSimplifiedTileShadowVolume(_,T,x,M);if(!I)return!1;const L=[Z_,Td,xp,M,[M[0],0,M[2]],[0,M[1],M[2]]],O=h.projection.name==="globe",F=h.scaleZoom(x),N=s.bq.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,F,!O),q=p.getCurrentCascadeFrustum();return N.intersectsPrecise(I.vertices,I.planes,L)===0||q.intersectsPrecise(I.vertices,I.planes,L)===0}function wp(u){return[u[0]*s.cL,u[1]*s.cL,u[2]*s.cL,0]}function Ed(u,i,o,h,p,_,x,T,M){const I=h.getSource(),L=o.globeSharedBuffers;if(!L)return;let O,F,N;if(i&&(O=h.getTile(i)),I instanceof s.ap?(F=I.texture,N=s.cj(0,0,o.transform)):O&&i&&(F=O.texture,N=s.cj(i.canonical.z,i.canonical.x,o.transform)),!F||!N)return;u||(N=s.a6.scale(s.a6.create(),N,[1,-1,1]));const q=o.context,$=q.gl,Z=p.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR,V=o.colorModeForDrapableLayerRenderPass(_),X=x.defines;X.push("GLOBE_POLES");const ne=new jt($.LEQUAL,jt.ReadWrite,o.depthRangeFor3D),J=Float32Array.from(o.transform.expandedFarZProjMatrix),oe=Float32Array.from(s.aT(s.ci(new s.bs(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),q.activeTexture.set($.TEXTURE0),F.bind(Z,$.CLAMP_TO_EDGE),q.activeTexture.set($.TEXTURE1),F.bind(Z,$.CLAMP_TO_EDGE),F.useMipmap&&q.extTextureFilterAnisotropic&&o.transform.pitch>20&&$.texParameterf($.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[H,ae,he,fe]=i?L.getPoleBuffers(i.canonical.z,!1):L.getPoleBuffers(0,!0),ye=p.paint.get("raster-elevation");let De;u?(De=H,o.renderDefaultNorthPole=ye!==0):(De=ae,o.renderDefaultSouthPole=ye!==0);const Te=wp(x.mix),$e=((it,Ae,Be,_e,Le,ot,vt,_t,Ot,Kt,ur,tr,ar)=>bd(it,Ae,Be,new Float32Array(16),new Float32Array(9),[0,0],_e,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ot,[0,0],_t,2,Kt,ur,tr,1,0,ar))(J,oe,N,s.S(o.transform.zoom),0,p,0,ye,0,Te,x.offset,x.range,_),je=o.getOrCreateProgram("raster",{defines:X});o.uploadCommonUniforms(q,je,null),je.draw(o,$.TRIANGLES,ne,M,V,T,$e,p.id,De,he,fe)}function Sd(u){const i=u._nearZ,o=u.projection.farthestPixelDistance(u),h=o-i,p=.2*u.height,_=i+p;return[i,o,(_-p-i)/h,(_-i)/h]}function Md(u,i,o,h){if(u)return i instanceof gt&&u instanceof ua?i.getTextureDescriptor(u,o,!0):{texture:u.texture,mix:wp(h.mix),offset:h.offset,buffer:0,tileSize:1}}function Ad(u,i,o){if(!u)return null;const h=i.getTextureDescriptor(u,o,!0);if(!h)return null;let{texture:p,mix:_,offset:x,tileSize:T,buffer:M,format:I}=h;if(!p||!I)return null;let L=!1;return I==="uint32"&&(L=!0,_[3]=0,_=sh(s.cM,_,[0,o.paint.get("raster-particle-max-speed")]),x=_p(s.cM,x,[0,o.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[M/(T+2*M),T/(T+2*M)],tileSize:T,scalarData:L,scale:_,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[I]]}}function Id(u){const i=u._nearZ,o=u.projection.farthestPixelDistance(u),h=o-i,p=.2*u.height,_=i+p;return[i,o,(_-p-i)/h,(_-i)/h]}const Go=new s.ax(1,0,0,1),Za=new s.ax(0,1,0,1),Tp=new s.ax(0,0,1,1),Cd=new s.ax(1,0,1,1),Pd=new s.ax(0,1,1,1);function Ha(u,i,o,h,p,_,x){const T=u.context,M=u.transform,I=T.gl,L=M.projection.name==="globe",O=L?["PROJECTION_GLOBE_VIEW"]:[];let F=s.a6.clone(o.projMatrix);if(L&&s.S(M.zoom)>0){const Te=s.aS(o.canonical,M),$e=s.cN(Te);F=s.a6.multiply(new Float32Array(16),M.globeMatrix,$e),s.a6.multiply(F,M.projMatrix,F)}const N=s.a6.create();N[12]+=2*p/(s.f.devicePixelRatio*M.width),N[13]+=2*_/(s.f.devicePixelRatio*M.height),s.a6.multiply(F,N,F);const q=u.getOrCreateProgram("debug",{defines:O}),$=i.getTileByID(o.key);u.terrain&&u.terrain.setupElevationDraw($,q);const Z=jt.disabled,V=ht.disabled,X=u.colorModeForRenderPass(),ne="$debug";T.activeTexture.set(I.TEXTURE0),u.emptyTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),L?$._makeGlobeTileDebugBuffers(u.context,M):$._makeDebugTileBoundsBuffers(u.context,M.projection);const J=$._tileDebugBuffer||u.debugBuffer,oe=$._tileDebugIndexBuffer||u.debugIndexBuffer,H=$._tileDebugSegments||u.debugSegments;if(q.draw(u,I.LINE_STRIP,Z,V,X,dr.disabled,vd(F,h),ne,J,oe,H,null,null,null,[$._globeTileDebugBorderBuffer]),x){const Te=$.latestRawTileData,$e=Math.floor((Te&&Te.byteLength||0)/1024);let je=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(je+=` => ${o.overscaledZ}`),je+=` ${$.state}`,je+=` ${$e}kb`,function(it,Ae){it.initDebugOverlayCanvas();const Be=it.debugOverlayCanvas,_e=it.context.gl,Le=it.debugOverlayCanvas.getContext("2d");Le.clearRect(0,0,Be.width,Be.height),Le.shadowColor="white",Le.shadowBlur=2,Le.lineWidth=1.5,Le.strokeStyle="white",Le.textBaseline="top",Le.font="bold 36px Open Sans, sans-serif",Le.fillText(Ae,5,5),Le.strokeText(Ae,5,5),it.debugOverlayTexture.update(Be),it.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(u,je)}const ae=i.getTile(o).tileSize,he=512/Math.min(ae,512)*(o.overscaledZ/M.zoom)*.5,fe=$._tileDebugTextBuffer||u.debugBuffer,ye=$._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,De=$._tileDebugTextSegments||u.debugSegments;q.draw(u,I.TRIANGLES,Z,V,vr.alphaBlended,dr.disabled,vd(F,s.ax.transparent,he),ne,fe,ye,De,null,null,null,[$._globeTileDebugTextBuffer])}function Ld(u,i,o,h){sn(u,0,i+o/2,u.transform.width,o,h)}function rs(u,i,o,h){sn(u,i-o/2,0,o,u.transform.height,h)}function sn(u,i,o,h,p,_){const x=u.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(i*s.f.devicePixelRatio,o*s.f.devicePixelRatio,h*s.f.devicePixelRatio,p*s.f.devicePixelRatio),x.clear({color:_}),T.disable(T.SCISSOR_TEST)}const hh=s.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rd}=hh;function ya(u,i,o,h){u.emplaceBack(i,o,h)}class Od{constructor(i){this.vertexArray=new s.az,this.indices=new s.aw,ya(this.vertexArray,-1,-1,1),ya(this.vertexArray,1,-1,1),ya(this.vertexArray,-1,1,1),ya(this.vertexArray,1,1,1),ya(this.vertexArray,-1,-1,-1),ya(this.vertexArray,1,-1,-1),ya(this.vertexArray,-1,1,-1),ya(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Rd),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=s.aB.simpleSegment(0,0,36,12)}}function Il(u,i,o,h,p,_){const x=u.context.gl,T=i.paint.get("sky-atmosphere-color"),M=i.paint.get("sky-atmosphere-halo-color"),I=i.paint.get("sky-atmosphere-sun-intensity"),L=((O,F,N,q,$)=>({u_matrix_3f:O,u_sun_direction:F,u_sun_intensity:N,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[$.r,$.g,$.b,$.a],u_luminance:5e-5}))(s.co.fromMat4(s.co.create(),h),p,I,T,M);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,i.skyboxTexture,0),o.draw(u,x.TRIANGLES,jt.disabled,ht.disabled,vr.unblended,dr.frontCW,L,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const H_=s.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class cc{constructor(i){const o=new s.cO;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const h=new s.aw;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(o,H_.members),this.indexBuffer=i.createIndexBuffer(h),this.segments=s.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const su=s.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class xt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class fr{constructor(i){this.colorModeAlphaBlendedWriteRGB=new vr([1,Ei,1,Ei],s.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new vr([1,0,1,0],s.ax.transparent,[!1,!1,!1,!0]),this.params=new xt,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const o=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new cc(o);const h=this.params.sizeRange,p=this.params.intensityRange,_=function(L){const O=s.aA(30),F=[];for(let N=0;N<L;++N){const q=2*Math.PI*O(),$=Math.acos(1-2*O())-.5*Math.PI;F.push(s.N.fromValues(Math.cos($)*Math.cos(q),Math.cos($)*Math.sin(q),Math.sin($)))}return F}(this.params.starsCount),x=s.aA(300),T=new s.cP,M=new s.aw;let I=0;for(let L=0;L<_.length;++L){const O=s.N.scale([],_[L],200),F=Math.max(0,1+.01*h*(1*x()-.5)),N=Math.max(0,1+.01*p*(1*x()-.5));T.emplaceBack(O[0],O[1],O[2],-1,-1,F,N),T.emplaceBack(O[0],O[1],O[2],1,-1,F,N),T.emplaceBack(O[0],O[1],O[2],1,1,F,N),T.emplaceBack(O[0],O[1],O[2],-1,1,F,N),M.emplaceBack(I+0,I+1,I+2),M.emplaceBack(I+0,I+2,I+3),I+=4}this.starsVx=o.createVertexBuffer(T,su.members),this.starsIdx=o.createIndexBuffer(M),this.starsSegments=s.aB.simpleSegment(0,0,T.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,o){const h=i.context,p=h.gl,_=i.transform,x=new jt(p.LEQUAL,jt.ReadOnly,[0,1]),T=s.S(_.zoom),M=o.properties.get("color").toArray01(),I=o.properties.get("high-color").toArray01(),L=o.properties.get("space-color").toArray01PremultipliedAlpha(),O=5e-4,F=s.cQ(o.properties.get("horizon-blend"),0,1,O,.25),N=s.cd(i,h,_)&&F===O?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,q=i.frameCounter/1e3%1,$=s.N.length(_.globeCenterInViewSpace),Z=Math.sqrt(Math.pow($,2)-Math.pow(N,2)),V=Math.acos(Z/$),X=ne=>{const J=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&J.push("ALPHA_PASS");const oe=i.getOrCreateProgram("globeAtmosphere",{defines:J}),H=((he,fe,ye,De,Te,$e,je,it,Ae,Be,_e,Le)=>({u_frustum_tl:he,u_frustum_tr:fe,u_frustum_br:ye,u_frustum_bl:De,u_horizon:Te,u_transition:$e,u_fadeout_range:je,u_color:it,u_high_color:Ae,u_space_color:Be,u_temporal_offset:_e,u_horizon_angle:Le}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,T,F,M,I,L,q,V);i.uploadCommonUniforms(h,oe);const ae=this.atmosphereBuffer;ae&&oe.draw(i,p.TRIANGLES,x,ht.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,dr.backCW,H,ne?"atmosphere_glow_alpha":"atmosphere_glow",ae.vertexBuffer,ae.indexBuffer,ae.segments)};X(!1),X(!0)}drawStars(i,o){const h=s.aa(o.properties.get("star-intensity"),0,1);if(h===0)return;const p=i.context,_=p.gl,x=i.transform,T=i.getOrCreateProgram("stars"),M=s.bi.identity([]);s.bi.rotateX(M,M,-x._pitch),s.bi.rotateZ(M,M,-x.angle),s.bi.rotateX(M,M,s.bj(x._center.lat)),s.bi.rotateY(M,M,-s.bj(x._center.lng));const I=s.a6.fromQuat(new Float32Array(16),M),L=s.a6.multiply([],x.starsProjMatrix,I),O=s.co.fromMat4([],I),F=s.co.invert([],O),N=[0,1,0];s.N.transformMat3(N,N,F),s.N.scale(N,N,this.params.sizeMultiplier);const q=[1,0,0];s.N.transformMat3(q,q,F),s.N.scale(q,q,this.params.sizeMultiplier);const $=(Z=N,V=q,X=h,{u_matrix:Float32Array.from(L),u_up:Z,u_right:V,u_intensity_multiplier:X});var Z,V,X;i.uploadCommonUniforms(p,T),this.starsVx&&this.starsIdx&&T.draw(i,_.TRIANGLES,jt.disabled,ht.disabled,this.colorModeAlphaBlendedWriteRGB,dr.disabled,$,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Cl(u,i){const o=[...u],h=i.cameraWorldSizeForFog/i.worldSize,p=s.a6.identity([]);return s.a6.scale(p,p,[h,h,1]),s.a6.multiply(o,p,o),s.a6.multiply(o,i.worldToFogMatrix,o),o}function an(u,i,o,h){const p=o.material,_=h.context,{baseColorTexture:x,metallicRoughnessTexture:T}=p.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:I,emissionTexture:L}=p;function O(F,N,q){if(F&&(u.push(N),_.activeTexture.set(_.gl.TEXTURE0+q),F.gfxTexture)){const{minFilter:$,magFilter:Z,wrapS:V,wrapT:X}=F.sampler;F.gfxTexture.bindExtraParam($,Z,V,X)}}O(x,"HAS_TEXTURE_u_baseColorTexture",Si.BaseColor),O(T,"HAS_TEXTURE_u_metallicRoughnessTexture",Si.MetallicRoughness),O(M,"HAS_TEXTURE_u_normalTexture",Si.Normal),O(I,"HAS_TEXTURE_u_occlusionTexture",Si.Occlusion),O(L,"HAS_TEXTURE_u_emissionTexture",Si.Emission),o.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(o.texcoordBuffer)),o.colorBuffer&&(u.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(o.colorBuffer)),o.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(o.normalBuffer)),o.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(o.pbrBuffer)),p.alphaMode!=="OPAQUE"&&p.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),p.defined||u.push("DIFFUSE_SHADED"),u.push("USE_STANDARD_DERIVATIVES")}function au(u,i,o,h,p,_){const x=o.paint.get("model-opacity"),T=i.context,M=new jt(i.context.gl.LEQUAL,jt.ReadWrite,i.depthRangeFor3D),I=i.transform,L=u.mesh,O=L.material,F=O.pbrMetallicRoughness,N=i.style.fog;let q;q=i.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:s.a6.multiply([],h.zScaleMatrix,u.nodeModelMatrix),s.a6.multiply(q,h.negCameraPosMatrix,q);const $=s.a6.invert([],q);s.a6.transpose($,$);const Z=o.paint.get("model-emissive-strength").constantOr(0),V=ch(new Float32Array(u.worldViewProjection),new Float32Array(q),new Float32Array($),i,x,F.baseColorFactor,O.emissiveFactor,F.metallicFactor,F.roughnessFactor,O,Z,o),X={defines:[]},ne=[];an(X.defines,ne,L,i);const J=i.shadowRenderer;J&&(J.useNormalOffset=!1);let oe=null;if(N){const he=Cl(u.nodeModelMatrix,i.transform);if(oe=new Float32Array(he),I.projection.name!=="globe"){const fe=L.aabb.min,ye=L.aabb.max,[De,Te]=N.getOpacityForBounds(he,fe[0],fe[1],ye[0],ye[1]);X.overrideFog=De>=$r||Te>=$r}}const H=Qn(i,o.paint.get("model-cutoff-fade-range"));H.shouldRenderCutoff&&X.defines.push("RENDER_CUTOFF");const ae=i.getOrCreateProgram("model",X);i.uploadCommonUniforms(T,ae,null,oe,H),i.renderPass!=="shadow"&&J&&J.setupShadowsFromMatrix(u.nodeModelMatrix,ae),ae.draw(i,T.gl.TRIANGLES,M,p,_,L.material.doubleSided?dr.disabled:dr.backCCW,V,o.id,L.vertexBuffer,L.indexBuffer,L.segments,o.paint,i.transform.zoom,void 0,ne)}function lu(u,i,o,h,p,_,x){let T;T=u.projection.name==="globe"?s.cS(o,u):[...o],s.a6.multiply(T,T,i.matrix);const M=s.a6.multiply([],h,T);if(i.meshes)for(const I of i.meshes){if(I.material.alphaMode!=="BLEND"){x.push({mesh:I,depth:0,modelIndex:p,worldViewProjection:M,nodeModelMatrix:T});continue}const L=s.N.transformMat4([],I.centroid,M);L[2]>0&&_.push({mesh:I,depth:L[2],modelIndex:p,worldViewProjection:M,nodeModelMatrix:T})}if(i.children)for(const I of i.children)lu(u,I,o,h,p,_,x)}function Re(u,i,o,h){const p=o.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),x=p.getShadowPassColorMode(),T=p.calculateShadowPassMatrixFromMatrix(i),M=nu(T);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,_,ht.disabled,x,dr.backCCW,M,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,o.transform.zoom,void 0,void 0)}function Dd(u,i,o){const h=i.updateZoomBasedPaintProperties(),p=function(_,x,T){let M,I,L,O=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&O>0){const F=_.terrain,N=F.findDEMTileFor(T);N&&N.dem?M=s.cU.create(F,T,N):O=0}if(O===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),O===x.validForExaggeration&&(O===0||M&&M._demTile&&M._demTile.tileID===x.validForDEMTile.id&&M._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const F in x.instancesPerModel){const N=x.instancesPerModel[F];for(let q=0;q<N.instancedDataArray.length;++q){const $=(M?O*M.getElevationAt(0|N.instancedDataArray.float32[16*q],0|N.instancedDataArray.float32[16*q+1],!0,!0):0)+N.instancesEvaluatedElevation[q];N.instancedDataArray.float32[16*q+6]=$,I=I?Math.min(x.terrainElevationMin,$):$,L=L?Math.max(x.terrainElevationMax,$):$}}return x.terrainElevationMin=I||0,x.terrainElevationMax=L||0,x.validForExaggeration=O,x.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,i,o);(h||p)&&(i.uploaded=!1,i.upload(u.context))}const is={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.bS([0,0,0],[s.V,s.V,0])};function Ep(u,i){const o=1<<u.canonical.z,h=i.getFreeCameraOptions().position,p=i.elevation,_=u.canonical.x/o,x=(u.canonical.x+1)/o,T=u.canonical.y/o,M=(u.canonical.y+1)/o;let I=i._centerAltitude;if(p){const N=p.getMinMaxForTile(u);N&&N.max>I&&(I=N.max)}const L=s.aa(h.x,_,x)-h.x,O=s.aa(h.y,T,M)-h.y,F=s.bl(I,i.center.lat)-h.z;return i._zoomFromMercatorZ(Math.sqrt(L*L+O*O+F*F))}function zd(u,i,o,h,p,_,x){const T=u.context,M=u.renderPass==="shadow",I=u.shadowRenderer,L=M&&I?I.getShadowPassDepthMode():new jt(T.gl.LEQUAL,jt.ReadWrite,u.depthRangeFor3D),O=u.isTileAffectedByFog(_);if(o.meshes)for(const F of o.meshes){const N=["MODEL_POSITION_ON_GPU"],q=[];let $,Z,V;h.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");const X=Qn(u,i.paint.get("model-cutoff-fade-range"));if(X.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),M&&I)$=u.getOrCreateProgram("modelDepth",{defines:N}),Z=nu(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(o.matrix)),V=I.getShadowPassColorMode();else{an(N,q,F,u),$=u.getOrCreateProgram("model",{defines:N,overrideFog:O});const J=F.material,oe=J.pbrMetallicRoughness,H=i.paint.get("model-opacity"),ae=i.paint.get("model-emissive-strength").constantOr(0);Z=ch(_.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),u,H,oe.baseColorFactor,J.emissiveFactor,oe.metallicFactor,oe.roughnessFactor,J,ae,i,p),I&&(x.shadowUniformsInitialized?$.setShadowUniformValues(T,I.getShadowUniformValues()):(I.setupShadows(_.toUnwrapped(),$,"model-tile",_.overscaledZ),x.shadowUniformsInitialized=!0)),V=X.shouldRenderCutoff||H<1||J.alphaMode!=="OPAQUE"?vr.alphaBlended:vr.unblended}u.uploadCommonUniforms(T,$,_.toUnwrapped(),null,X);const ne=F.material.doubleSided?dr.disabled:dr.backCCW;if(h.instancedDataArray.length>20)q.push(h.instancedDataBuffer),$.draw(u,T.gl.TRIANGLES,L,ht.disabled,V,ne,Z,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,u.transform.zoom,void 0,q,h.instancedDataArray.length);else{const J=M?"u_instance":"u_normal_matrix";for(let oe=0;oe<h.instancedDataArray.length;++oe)Z[J]=new Float32Array(h.instancedDataArray.arrayBuffer,64*oe,16),$.draw(u,T.gl.TRIANGLES,L,ht.disabled,V,ne,Z,i.id,F.vertexBuffer,F.indexBuffer,F.segments,i.paint,u.transform.zoom,void 0,q)}}if(o.children)for(const F of o.children)zd(u,i,F,h,p,_,x)}const uc=[1,-1,1];function W_(u,i,o,h){if(!o.modelManager)return!0;const p=o.modelManager;if(!o.shadowRenderer)return!0;const _=o.shadowRenderer,x=i.aabb;let T=!0,M=u.maxHeight;if(M===0){let L=0;for(const O in u.instancesPerModel){const F=p.getModel(O,h);F?L=Math.max(L,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):T=!1}M=u.maxScale*L*1.41+u.maxVerticalOffset,T&&(u.maxHeight=M)}x.max[2]=M,x.min[2]+=u.terrainElevationMin,x.max[2]+=u.terrainElevationMax,s.N.transformMat4(x.min,x.min,i.tileMatrix),s.N.transformMat4(x.max,x.max,i.tileMatrix);const I=x.intersects(_.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=I===2),I===0}class X_{}class Sp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,o,h){{const O=this._storage.get(o.id);if(O)return O.lastUsedFrameIdx=i,O.buf}const p=h.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),x=new ArrayBuffer(_),T=new Int16Array(x);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const M=new s.cW;for(let O=0;O<_/2;O+=3){const F=T[O],N=T[O+1],q=T[O+2];M.emplaceBack(F,N),M.emplaceBack(N,q),M.emplaceBack(q,F)}const I=h.bindVertexArrayOES.current,L=new X_;return L.buf=new Li(h,M),L.lastUsedFrameIdx=i,this._storage.set(o.id,L),h.bindVertexArrayOES.set(I),L.buf}update(i){for(const[o,h]of this._storage)i-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(o))}destroy(){for(const[i,o]of this._storage)o.buf.destroy(),this._storage.delete(i)}}class cu{registerParameter(i,o,h,p,_){}registerButton(i,o,h){}}const uu={symbol:function(u,i,o,h,p){if(u.renderPass!=="translucent")return;const _=ht.disabled,x=u.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(I,L,O,F,N,q,$){const Z=L.transform,V=N==="map",X=q==="map";for(const ne of I){const J=F.getTile(ne),oe=J.getBucket(O);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const H=s.b5(oe.textSizeData,Z.zoom),ae=jo(ne,oe.getProjection(),Z),he=Z.calculatePixelsToTileUnitsMatrix(J),fe=ml(ae,J.tileID.canonical,X,V,Z,oe.getProjection(),he),ye=oe.hasIconTextFit()&&oe.hasIconData();if(H){const De=Math.pow(2,Z.zoom-J.tileID.overscaledZ);vp(oe,V,X,$,s.cx,Z,fe,ne,De,H,ye)}}}(h,u,o,i,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),p);const T=o.paint.get("icon-opacity").constantOr(1)!==0,M=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(T||M)?uh(u,i,o,h,_,x):(T&&uh(u,i,o,h,_,x,{onlyIcons:!0}),M&&uh(u,i,o,h,_,x,{onlyText:!0})),i.map.showCollisionBoxes&&(Bs(u,i,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Bs(u,i,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(u,i,o,h){if(u.renderPass!=="translucent")return;const p=o.paint.get("circle-opacity"),_=o.paint.get("circle-stroke-width"),x=o.paint.get("circle-stroke-opacity"),T=o.layout.get("circle-sort-key").constantOr(1)!==void 0,M=o.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;const I=u.context,L=I.gl,O=u.transform,F=u.depthModeForSublayer(0,jt.ReadOnly),N=ht.disabled,q=u.colorModeForDrapableLayerRenderPass(M),$=O.projection.name==="globe",Z=[s.a5(O.center.lng),s.ae(O.center.lat)],V=[];for(let ne=0;ne<h.length;ne++){const J=h[ne],oe=i.getTile(J),H=oe.getBucket(o);if(!H||H.projection.name!==O.projection.name)continue;const ae=H.programConfigurations.get(o.id),he=s.cy(o),fe=u.isTileAffectedByFog(J);$&&he.push("PROJECTION_GLOBE_VIEW");const ye=u.getOrCreateProgram("circle",{config:ae,defines:he,overrideFog:fe}),De=H.layoutVertexBuffer,Te=H.globeExtVertexBuffer,$e=H.indexBuffer,je=O.projection.createInversionMatrix(O,J.canonical),it={programConfiguration:ae,program:ye,layoutVertexBuffer:De,globeExtVertexBuffer:Te,indexBuffer:$e,uniformValues:s.cz(u,J,oe,je,Z,o),tile:oe};if(T){const Ae=H.segments.get();for(const Be of Ae)V.push({segments:new s.aB([Be]),sortKey:Be.sortKey,state:it})}else V.push({segments:H.segments,sortKey:0,state:it})}T&&V.sort((ne,J)=>ne.sortKey-J.sortKey);const X={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(const ne of V){const{programConfiguration:J,program:oe,layoutVertexBuffer:H,globeExtVertexBuffer:ae,indexBuffer:he,uniformValues:fe,tile:ye}=ne.state,De=ne.segments;u.terrain&&u.terrain.setupElevationDraw(ye,oe,X),u.uploadCommonUniforms(I,oe,ye.tileID.toUnwrapped()),oe.draw(u,L.TRIANGLES,F,N,q,dr.disabled,fe,o.id,H,he,De,o.paint,O.zoom,J,[ae])}},heatmap:function(u,i,o,h){if(o.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const p=u.context,_=p.gl,x=ht.disabled,T=new vr([_.ONE,_.ONE,_.ONE,_.ONE],s.ax.transparent,[!0,!0,!0,!0]);(function(N,q,$,Z){const V=N.gl,X=q.width*Z,ne=q.height*Z;N.activeTexture.set(V.TEXTURE1),N.viewport.set([0,0,X,ne]);let J=$.heatmapFbo;if(!J||J&&(J.width!==X||J.height!==ne)){J&&J.destroy();const oe=V.createTexture();V.bindTexture(V.TEXTURE_2D,oe),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),J=$.heatmapFbo=N.createFramebuffer(X,ne,!0,null),function(H,ae,he,fe,ye,De){const Te=H.gl;Te.texImage2D(Te.TEXTURE_2D,0,H.extRenderToTextureHalfFloat?Te.RGBA16F:Te.RGBA,ye,De,0,Te.RGBA,H.extRenderToTextureHalfFloat?Te.HALF_FLOAT:Te.UNSIGNED_BYTE,null),fe.colorAttachment.set(he)}(N,0,oe,J,X,ne)}else V.bindTexture(V.TEXTURE_2D,J.colorAttachment.get()),N.bindFramebuffer.set(J.framebuffer)})(p,u,o,u.transform.projection.name==="globe"?.5:.25),p.clear({color:s.ax.transparent});const M=u.transform,I=M.projection.name==="globe",L=I?["PROJECTION_GLOBE_VIEW"]:[],O=I?dr.frontCCW:dr.disabled,F=[s.a5(M.center.lng),s.ae(M.center.lat)];for(let N=0;N<h.length;N++){const q=h[N];if(i.hasRenderableParent(q))continue;const $=i.getTile(q),Z=$.getBucket(o);if(!Z||Z.projection.name!==M.projection.name)continue;const V=u.isTileAffectedByFog(q),X=Z.programConfigurations.get(o.id),ne=u.getOrCreateProgram("heatmap",{config:X,defines:L,overrideFog:V}),{zoom:J}=u.transform;u.terrain&&u.terrain.setupElevationDraw($,ne),u.uploadCommonUniforms(p,ne,q.toUnwrapped());const oe=M.projection.createInversionMatrix(M,q.canonical);ne.draw(u,_.TRIANGLES,jt.disabled,x,T,O,xd(u,q,$,oe,F,J,o.paint.get("heatmap-intensity")),o.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,o.paint,u.transform.zoom,X,I?[Z.globeExtVertexBuffer]:null)}p.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(p,_){const x=p.context,T=x.gl,M=_.heatmapFbo;if(!M)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1);let I=_.colorRampTexture;I||(I=_.colorRampTexture=new s.T(x,_.colorRamp,T.RGBA)),I.bind(T.LINEAR,T.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,T.TRIANGLES,jt.disabled,ht.disabled,p.colorModeForRenderPass(),dr.disabled,((L,O,F,N)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(u,o))},line:function(u,i,o,h){if(u.renderPass!=="translucent")return;const p=o.paint.get("line-opacity"),_=o.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const x=o.paint.get("line-emissive-strength"),T=u.depthModeForSublayer(0,jt.ReadOnly),M=u.colorModeForDrapableLayerRenderPass(x),I=u.terrain&&u.terrain.renderingToTexture?1:s.f.devicePixelRatio,L=o.paint.get("line-dasharray"),O=L.constantOr(1),F=o.layout.get("line-cap"),N=o.paint.get("line-pattern"),q=N.constantOr(1),$=o.paint.get("line-pattern").constantOr(1),Z=o.paint.get("line-opacity").constantOr(1)!==1;let V=!$&&Z;const X=o.paint.get("line-gradient"),ne=q?"linePattern":"line",J=u.context,oe=J.gl,H=s.cA(o);u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(V=!1);for(const ae of h){const he=i.getTile(ae);if(q&&!he.patternsLoaded())continue;const fe=he.getBucket(o);if(!fe)continue;u.prepareDrawTile();const ye=fe.programConfigurations.get(o.id),De=u.isTileAffectedByFog(ae),Te=u.getOrCreateProgram(ne,{config:ye,defines:H,overrideFog:De}),$e=N.constantOr(null);if($e&&he.imageAtlas){const vt=he.imageAtlas.patternPositions[$e.toString()];vt&&ye.setConstantPatternPositions(vt)}const je=L.constantOr(null),it=F.constantOr(null);if(!q&&je&&it&&he.lineAtlas){const vt=he.lineAtlas.getDash(je,it);vt&&ye.setConstantPatternPositions(vt)}let[Ae,Be]=o.paint.get("line-trim-offset");(it==="round"||it==="square")&&Ae!==Be&&(Ae===0&&(Ae-=1),Be===1&&(Be+=1));const _e=u.terrain?ae.projMatrix:null,Le=q?s.cB(u,he,o,_e,I,[Ae,Be]):s.cC(u,he,o,_e,fe.lineClipsArray.length,I,[Ae,Be]);if(X){const vt=fe.gradients[o.id];let _t=vt.texture;if(o.gradientVersion!==vt.version){let Ot=256;if(o.stepInterpolant){const Kt=i.getSource().maxzoom,ur=ae.canonical.z===Kt?Math.ceil(1<<u.transform.maxZoom-ae.canonical.z):1;Ot=s.aa(s.cD(fe.maxLineLength/s.V*1024*ur),256,J.maxTextureSize)}vt.gradient=s.cE({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ot,image:vt.gradient||void 0,clips:fe.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new s.T(J,vt.gradient,oe.RGBA),vt.version=o.gradientVersion,_t=vt.texture}J.activeTexture.set(oe.TEXTURE1),_t.bind(o.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}O&&(J.activeTexture.set(oe.TEXTURE0),he.lineAtlasTexture&&he.lineAtlasTexture.bind(oe.LINEAR,oe.REPEAT),ye.updatePaintBuffers()),q&&(J.activeTexture.set(oe.TEXTURE0),he.imageAtlasTexture&&he.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),ye.updatePaintBuffers()),u.uploadCommonUniforms(J,Te,ae.toUnwrapped());const ot=vt=>{Te.draw(u,oe.TRIANGLES,T,vt,M,dr.disabled,Le,o.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,o.paint,u.transform.zoom,ye,[fe.layoutVertexBuffer2])};if(V){const vt=u.stencilModeForClipping(ae).ref;vt===0&&u.terrain&&J.clear({stencil:0});const _t={func:oe.EQUAL,mask:255};Le.u_alpha_discard_threshold=.8,ot(new ht(_t,vt,255,oe.KEEP,oe.KEEP,oe.INVERT)),Le.u_alpha_discard_threshold=0,ot(new ht(_t,vt,255,oe.KEEP,oe.KEEP,oe.KEEP))}else ot(u.stencilModeForClipping(ae))}V&&(u.resetStencilClippingMasks(),u.terrain&&J.clear({stencil:0}))},fill:function(u,i,o,h){const p=o.paint.get("fill-color"),_=o.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const x=o.paint.get("fill-emissive-strength"),T=u.colorModeForDrapableLayerRenderPass(x),M=o.paint.get("fill-pattern"),I=u.opaquePassEnabledForLayer()&&!M.constantOr(1)&&p.constantOr(s.ax.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===I){const L=u.depthModeForSublayer(1,u.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);Al(u,i,o,h,L,T,!1)}if(u.renderPass==="translucent"&&o.paint.get("fill-antialias")){const L=u.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);Al(u,i,o,h,L,T,!0)}},"fill-extrusion":function(u,i,o,h){const p=o.paint.get("fill-extrusion-opacity"),_=u.context,x=_.gl,T=u.terrain,M=T&&T.renderingToTexture;if(p===0)return;const I=u.conflationActive&&u.layerUsedInConflation(o,i.getSource());if(I&&function(L,O,F,N){for(const q of N){const $=O.getTile(q).getBucket(F);$&&($.updateReplacement(q,L.replacementSource),$.uploadCentroid(L.context))}}(u,i,o,h),T||I)for(const L of h){const O=i.getTile(L).getBucket(o);O&&q_(u.context,i,L,O,o,T,I)}if(u.renderPass==="shadow"&&u.shadowRenderer){const L=u.shadowRenderer;if(T&&p<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.Z)return;const O=L.getShadowPassDepthMode(),F=L.getShadowPassColorMode();Jt(u,i,o,h,O,ht.disabled,F,I)}else if(u.renderPass==="translucent"){const L=!o.paint.get("fill-extrusion-pattern").constantOr(1),O=o.paint.get("fill-extrusion-color").constantOr(s.ax.white);if(!M&&O.a!==0){const F=new jt(u.context.gl.LEQUAL,jt.ReadWrite,u.depthRangeFor3D);p===1&&L?Jt(u,i,o,h,F,ht.disabled,vr.unblended,I):(Jt(u,i,o,h,F,ht.disabled,vr.disabled,I),Jt(u,i,o,h,F,u.stencilModeFor3D(),u.colorModeForRenderPass(),I),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&L&&(!T&&u.transform.projection.name!=="globe"||M)){const F=o.paint.get("fill-extrusion-opacity"),N=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),$=o.paint.get("fill-extrusion-flood-light-intensity"),Z=o.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),V=N>0&&q>0,X=$>0,ne=(oe,H,ae)=>(1-ae)*oe+ae*H,J=oe=>{const H=u.depthModeForSublayer(1,jt.ReadOnly,x.LEQUAL,!0),ae=o.paint.get(oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),he=ne(.1,3,ae),fe=u._showOverdrawInspector;if(!fe){const ye=new ht({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),De=new vr([x.ONE,x.ONE,x.ONE,x.ONE],s.ax.transparent,[!1,!1,!1,!0],x.MIN);qa(u,i,o,h,H,ye,De,dr.disabled,oe,"sdf",F,N,q,$,Z,he,I,!1)}{const ye=fe?ht.disabled:new ht({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),De=fe?u.colorModeForRenderPass():new vr([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],s.ax.transparent,[!0,!0,!0,!0]);qa(u,i,o,h,H,ye,De,dr.disabled,oe,"color",F,N,q,$,Z,he,I,!1)}};if(M){const oe=(H,ae,he)=>{const fe=u.depthModeForSublayer(1,jt.ReadOnly,x.LEQUAL,!1),ye=o.paint.get(H?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=ne(.1,3,ye);{const Te=new vr([x.ONE,x.ONE,x.ONE,x.ONE],s.ax.transparent,[!1,!1,!1,!0]);qa(u,i,o,h,fe,ht.disabled,Te,dr.disabled,H,"clear",F,N,q,$,Z,De,I,ae)}{const Te=new ht({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),$e=new vr([x.ONE,x.ONE,x.ONE,x.ONE],s.ax.transparent,[!1,!1,!1,!0],x.MIN);qa(u,i,o,h,fe,Te,$e,dr.disabled,H,"sdf",F,N,q,$,Z,De,I,ae)}{const Te=H?x.ZERO:x.ONE_MINUS_DST_ALPHA,$e=new ht({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),je=new vr([Te,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],s.ax.transparent,[!0,!0,!0,!0]);qa(u,i,o,h,fe,$e,je,dr.disabled,H,"color",F,N,q,$,Z,De,I,ae)}{const Te=new vr([x.ONE,x.ONE,x.ONE,H?x.ZERO:x.ONE],s.ax.transparent,[!1,!1,!1,!0],H?x.FUNC_ADD:x.MAX);qa(u,i,o,h,fe,ht.disabled,Te,dr.disabled,H,"clear",F,N,q,$,Z,De,I,ae,he)}};if(V||X){let H;if(u.prepareDrawTile(),T){const ae=T.drapeBufferSize[0],he=T.drapeBufferSize[1];H=T.framebufferCopyTexture,H&&(!H||H.size[0]===ae&&H.size[1]===he)||(H&&H.destroy(),H=T.framebufferCopyTexture=new s.T(_,new s.h({width:ae,height:he}),x.RGBA)),H.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGBA,0,0,ae,he,0)}V&&oe(!0,!1,H),X&&oe(!1,!0,H)}}else V&&J(!0),X&&J(!1)}}},hillshade:function(u,i,o,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const p=u.context,_=u.terrain&&u.terrain.renderingToTexture,[x,T]=u.renderPass!=="translucent"||_?[{},h]:u.stencilConfigForOverlap(h);for(const M of T){const I=i.getTile(M);if(I.needsHillshadePrepare&&u.renderPass==="offscreen")ad(u,I,o);else if(u.renderPass==="translucent"){const L=u.depthModeForSublayer(0,jt.ReadOnly),O=o.paint.get("hillshade-emissive-strength"),F=u.colorModeForDrapableLayerRenderPass(O),N=_&&u.terrain?u.terrain.stencilModeForRTTOverlap(M):x[M.overscaledZ];ih(u,M,I,o,L,N,F)}}p.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,i,o,h,p,_){if(u.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const x=u.transform.projection.name==="globe",T=o.paint.get("raster-elevation")!==0,M=T&&x;if(u.renderElevatedRasterBackface&&!M)return;const I=u.context,L=I.gl,O=i.getSource(),F=function(H,ae,he,fe){const ye=ae.paint.get("raster-color"),De=H.type==="raster-array",Te=[],$e=ae.paint.get("raster-resampling"),je=ae.paint.get("raster-color-mix");let it=ae.paint.get("raster-color-range");const Ae=[je[0],je[1],je[2],0],Be=je[3];let _e=$e==="nearest"?fe.NEAREST:fe.LINEAR;if(De&&(Te.push("RASTER_ARRAY"),ye||Te.push("RASTER_COLOR"),$e==="linear"&&Te.push("RASTER_ARRAY_LINEAR"),_e=fe.NEAREST,!it&&H.rasterLayers)){const Le=H.rasterLayers.find(({id:ot})=>ot===ae.sourceLayer);Le&&Le.fields&&Le.fields.range&&(it=Le.fields.range)}if(it=it||[0,1],ye){Te.push("RASTER_COLOR"),he.activeTexture.set(fe.TEXTURE2),ae.updateColorRamp(it);let Le=ae.colorRampTexture;Le||(Le=ae.colorRampTexture=new s.T(he,ae.colorRamp,fe.RGBA)),Le.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}return{mix:Ae,range:it,offset:Be,defines:Te,resampling:_e}}(O,o,I,L);if(O instanceof s.ap&&!h.length&&!x)return;const N=o.paint.get("raster-emissive-strength"),q=u.colorModeForDrapableLayerRenderPass(N),$=u.terrain&&u.terrain.renderingToTexture,Z=!u.options.moving,V=o.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(O instanceof s.ap&&!h.length&&(O.onNorthPole||O.onSouthPole)){const H=T?u.stencilModeFor3D():ht.disabled;return void Ed(!!O.onNorthPole,null,u,i,o,N,F,dr.disabled,H)}if(!h.length)return;const[X,ne]=O instanceof s.ap||$?[{},h]:u.stencilConfigForOverlap(h),J=ne[ne.length-1].overscaledZ;M&&F.defines.push("PROJECTION_GLOBE_VIEW"),T&&F.defines.push("RENDER_CUTOFF");const oe=(H,ae,he)=>{for(const fe of H){const ye=fe.toUnwrapped(),De=i.getTile(fe);if($&&(!De||!De.hasData()))continue;I.activeTexture.set(L.TEXTURE0);const Te=Md(De,O,o,F);if(!Te||!Te.texture)continue;const{texture:$e,mix:je,offset:it,tileSize:Ae,buffer:Be}=Te;let _e,Le;$?(_e=jt.disabled,Le=fe.projMatrix):T?(_e=new jt(L.LEQUAL,jt.ReadWrite,u.depthRangeFor3D),Le=x?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(ye,Z)):(_e=u.depthModeForSublayer(fe.overscaledZ-J,o.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,L.LESS),Le=u.transform.calculateProjMatrix(ye,Z));const ot=u.terrain&&$?u.terrain.stencilModeForRTTOverlap(fe):X[fe.overscaledZ],vt=_?0:o.paint.get("raster-fade-duration");De.registerFadeDuration(vt);const _t=i.findLoadedParent(fe,0),Ot=hd(De,_t,i,u.transform,vt);let Kt,ur;u.terrain&&u.terrain.prepareDrawTile(),I.activeTexture.set(L.TEXTURE0),$e.bind(V,L.CLAMP_TO_EDGE),I.activeTexture.set(L.TEXTURE1),_t?(_t.texture&&_t.texture.bind(V,L.CLAMP_TO_EDGE),Kt=Math.pow(2,_t.tileID.overscaledZ-De.tileID.overscaledZ),ur=[De.tileID.canonical.x*Kt%1,De.tileID.canonical.y*Kt%1]):$e.bind(V,L.CLAMP_TO_EDGE),$e.useMipmap&&I.extTextureFilterAnisotropic&&u.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const tr=u.transform;let ar;const Br=T?Sd(tr):[0,0,0,0];let Mr,Or,Lr,ri,Bi,Hr=0;if(M&&O instanceof s.ap&&O.coordinates.length>3)Mr=Float32Array.from(s.aT(s.ci(new s.bs(0,0,0)))),Or=Float32Array.from(tr.globeMatrix),Lr=Float32Array.from(s.ce(tr)),ri=[s.a5(tr.center.lng),s.ae(tr.center.lat)],ar=O.elevatedGlobePerspectiveTransform,Bi=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(M){const Xr=s.cf(fe.canonical);Hr=s.cg(Xr.getCenter().lat),Mr=Float32Array.from(s.aT(s.ci(fe.canonical))),Or=Float32Array.from(tr.globeMatrix),Lr=Float32Array.from(s.ce(tr)),ri=[s.a5(tr.center.lng),s.ae(tr.center.lat)],ar=[0,0],Bi=Float32Array.from(s.ch(fe.canonical,Xr,Hr,tr.worldSize/tr._pixelsPerMercatorPixel))}else ar=O instanceof s.ap?O.perspectiveTransform:[0,0],Mr=new Float32Array(16),Or=new Float32Array(9),Lr=new Float32Array(16),ri=[0,0],Bi=new Float32Array(9);const ln=bd(Le,Mr,Or,Lr,Bi,ur||[0,0],s.S(u.transform.zoom),ri,Br,Kt||1,Ot,o,ar,T?o.paint.get("raster-elevation"):0,2,je,it,F.range,Ae,Be,N),Wr=u.isTileAffectedByFog(fe),li=u.getOrCreateProgram("raster",{defines:F.defines,overrideFog:Wr});if(u.uploadCommonUniforms(I,li,ye),O instanceof s.ap){const Xr=O.elevatedGlobeVertexBuffer,si=O.elevatedGlobeIndexBuffer;if($||!x)O.boundsBuffer&&O.boundsSegments&&li.draw(u,L.TRIANGLES,_e,ht.disabled,q,dr.disabled,ln,o.id,O.boundsBuffer,u.quadTriangleIndexBuffer,O.boundsSegments);else if(Xr&&si){const qi=tr.zoom<=s.bG?O.elevatedGlobeSegments:O.getSegmentsForLongitude(tr.center.lng);qi&&li.draw(u,L.TRIANGLES,_e,ht.disabled,q,ae,ln,o.id,Xr,si,qi)}}else if(M){_e=new jt(L.LEQUAL,jt.ReadOnly,u.depthRangeFor3D);const Xr=u.globeSharedBuffers;if(Xr){const[si,qi,pi]=Xr.getGridBuffers(Hr,!1);li.draw(u,L.TRIANGLES,_e,he||ot,u.colorModeForRenderPass(),ae,ln,o.id,si,qi,pi)}}else{const{tileBoundsBuffer:Xr,tileBoundsIndexBuffer:si,tileBoundsSegments:qi}=u.getTileBoundsBuffers(De);li.draw(u,L.TRIANGLES,_e,ot,q,dr.disabled,ln,o.id,Xr,si,qi)}}if(!(O instanceof s.ap)&&M)for(const fe of H){const ye=fe.canonical.y===(1<<fe.canonical.z)-1;fe.canonical.y===0&&Ed(!0,fe,u,i,o,N,F,ae,he||ht.disabled),ye&&Ed(!1,fe,u,i,o,N,F,ae===dr.frontCW?dr.backCW:dr.frontCW,he||ht.disabled)}};M?oe(ne,u.renderElevatedRasterBackface?dr.backCW:dr.frontCW,u.stencilModeFor3D()):oe(ne,dr.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,i,o,h,p,_){u.renderPass==="offscreen"&&function(x,T,M,I){if(!I.length)return;const L=x.context,O=L.gl,F=T.getSource();if(!(F instanceof gt))return;const N=[];for(const Z of I){const V=T.getTile(Z);if(!(V instanceof ua))continue;const X=Ad(V,F,M);if(!X)continue;const ne=[X.tileSize,X.tileSize];let J=M.tileFramebuffer;J||(J=M.tileFramebuffer=L.createFramebuffer(ne[0],ne[1],!0,null));let oe=V.rasterParticleState;const H=M.paint.get("raster-particle-count");oe||(oe=V.rasterParticleState=new Ln(L,Z,ne,H));const ae=oe.update(M.lastInvalidatedAt);oe.numParticles!==H&&oe.setNumParticles(Z,H);const he=oe.targetColorTexture;oe.targetColorTexture=oe.backgroundColorTexture,oe.backgroundColorTexture=he;const fe=oe.particleVertices0;oe.particleVertices0=oe.particleVertices1,oe.particleVertices1=fe,N.push([Z,X,oe,ae])}if(N.length===0)return;const q=s.f.now(),$=M.previousDrawTimestamp?.001*(q-M.previousDrawTimestamp):.0167;if(M.previousDrawTimestamp=q,M.hasColorMap()){L.activeTexture.set(O.TEXTURE0+2);let Z=M.colorRampTexture;Z||(Z=M.colorRampTexture=new s.T(L,M.colorRamp,O.RGBA)),Z.bind(O.LINEAR,O.CLAMP_TO_EDGE)}L.bindFramebuffer.set(M.tileFramebuffer.framebuffer),L.activeTexture.set(O.TEXTURE0),function(Z,V,X){const ne=Z.context,J=ne.gl,oe=V.tileFramebuffer;ne.activeTexture.set(J.TEXTURE0);const H={u_texture:0,u_opacity:1.05*(he=V.paint.get("raster-particle-fade-opacity-factor"))/(he+.05)},ae=Z.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var he;for(const fe of X){const[,,ye,De]=fe;oe.colorAttachment.set(ye.targetColorTexture.texture),ne.viewport.set([0,0,oe.width,oe.height]),ne.clear({color:s.ax.transparent}),De&&(ye.backgroundColorTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE),ae.draw(Z,J.TRIANGLES,jt.disabled,ht.disabled,vr.alphaBlended,dr.disabled,H,V.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments))}}(x,M,N),function(Z,V,X,ne){const J=Z.context.gl,oe=X.tileFramebuffer,H=Z.transform.projection.name==="globe",ae=X.paint.get("raster-particle-max-speed");for(const he of ne){const[fe,ye,De]=he;ye.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE),oe.colorAttachment.set(De.targetColorTexture.texture);const Te=Z.getOrCreateProgram("rasterParticleDraw",{defines:ye.defines,overrideFog:!1}),$e=ye.scalarData?[]:[0,1,2,3].map(Ae=>s.cG[Ae](fe));$e.push(fe);const je=fe.canonical.x,it=fe.canonical.y;for(const Ae of $e){const Be=V.getTile(H?Ae.wrapped():Ae);if(!Be)continue;const _e=Be.rasterParticleState;if(!_e)continue;const Le=G_([Ae.canonical.x+(1<<Ae.canonical.z)*(Ae.wrap-fe.wrap)-je,Ae.canonical.y-it],0,ye.texture.size,2,ae,ye.textureOffset,ye.scale,ye.offset);Te.draw(Z,J.POINTS,jt.disabled,ht.disabled,vr.alphaBlended,dr.disabled,Le,X.id,_e.particleVertices0,void 0,_e.particleSegment)}}}(x,T,M,N),function(Z,V,X,ne){const J=Z.context.gl;let oe=V.transformFeedbackObject;oe||(oe=V.transformFeedbackObject=J.createTransformFeedback()),J.bindTransformFeedback(J.TRANSFORM_FEEDBACK,V.transformFeedbackObject);const H=V.paint.get("raster-particle-max-speed"),ae=ne*V.paint.get("raster-particle-speed-factor")*.3,he=(fe=V.paint.get("raster-particle-reset-rate-factor"),Math.pow(fe,6));var fe;for(const ye of X){const[,De,Te]=ye;De.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const $e=gp(0,De.texture.size,H,ae,he,De.textureOffset,De.scale,De.offset);Z.getOrCreateProgram("rasterParticleUpdate",{defines:De.defines,transformFeedback:{bufferMode:J.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(Z,J.POINTS,jt.disabled,ht.disabled,vr.disabled,dr.disabled,$e,V.id,Te.particleVertices0,void 0,Te.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:Te.particleVertices1,targetIndex:0}])}J.bindTransformFeedback(J.TRANSFORM_FEEDBACK,null)}(x,M,N,$)}(u,i,o,h),u.renderPass==="translucent"&&(function(x,T,M,I,L){const O=x.context,F=O.gl,N=!x.options.moving,q=x.transform.projection.name==="globe";if(!I.length)return;const[$,Z]=x.stencilConfigForOverlap(I),V=[];q&&V.push("PROJECTION_GLOBE_VIEW");for(const X of Z){const ne=X.toUnwrapped(),J=T.getTile(X);if(!J.rasterParticleState)continue;const oe=J.rasterParticleState,H=100;J.registerFadeDuration(H);const ae=T.findLoadedParent(X,0),he=hd(J,ae,T,x.transform,H);let fe,ye;x.terrain&&x.terrain.prepareDrawTile(),O.activeTexture.set(F.TEXTURE0),oe.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),O.activeTexture.set(F.TEXTURE1),ae&&ae.rasterParticleState?(ae.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),fe=Math.pow(2,ae.tileID.overscaledZ-J.tileID.overscaledZ),ye=[J.tileID.canonical.x*fe%1,J.tileID.canonical.y*fe%1]):oe.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const De=q?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ne,N),Te=x.transform,$e=Id(Te),je=s.cf(X.canonical),it=s.cg(je.getCenter().lat);let Ae,Be,_e,Le,ot;q?(Ae=Float32Array.from(s.aT(s.ci(X.canonical))),Be=Float32Array.from(Te.globeMatrix),_e=Float32Array.from(s.ce(Te)),Le=[s.a5(Te.center.lng),s.ae(Te.center.lat)],ot=Float32Array.from(s.ch(X.canonical,je,it,Te.worldSize/Te._pixelsPerMercatorPixel))):(Ae=new Float32Array(16),Be=new Float32Array(9),_e=new Float32Array(16),Le=[0,0],ot=new Float32Array(9));const vt=V_(De,Ae,Be,_e,ot,ye||[0,0],s.S(x.transform.zoom),Le,$e,fe||1,he,250),_t=x.isTileAffectedByFog(X),Ot=x.getOrCreateProgram("rasterParticle",{defines:V,overrideFog:_t});if(x.uploadCommonUniforms(O,Ot,ne),q){const Kt=new jt(F.LEQUAL,jt.ReadWrite,x.depthRangeFor3D),ur=0,tr=x.globeSharedBuffers;if(tr){const[ar,Br,Mr]=tr.getGridBuffers(it,ur!==0);Ot.draw(x,F.TRIANGLES,Kt,ht.disabled,vr.alphaBlended,dr.backCCW,vt,M.id,ar,Br,Mr)}}else{const Kt=x.depthModeForSublayer(0,jt.ReadOnly),ur=$[X.overscaledZ],{tileBoundsBuffer:tr,tileBoundsIndexBuffer:ar,tileBoundsSegments:Br}=x.getTileBoundsBuffers(J);Ot.draw(x,F.TRIANGLES,Kt,ur,vr.alphaBlended,dr.disabled,vt,M.id,tr,ar,Br)}}x.resetStencilClippingMasks()}(u,i,o,h),u.style.map.triggerRepaint())},background:function(u,i,o,h){const p=o.paint.get("background-color"),_=o.paint.get("background-opacity"),x=o.paint.get("background-emissive-strength");if(_===0)return;const T=u.context,M=T.gl,I=u.transform,L=I.tileSize,O=o.paint.get("background-pattern");if(u.isPatternMissing(O,o.scope))return;const F=!O&&p.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==F)return;const N=ht.disabled,q=u.depthModeForSublayer(0,F==="opaque"?jt.ReadWrite:jt.ReadOnly),$=u.colorModeForDrapableLayerRenderPass(x),Z=O?"backgroundPattern":"background";let V,X=h;X||(V=u.getBackgroundTiles(),X=Object.values(V).map(ne=>ne.tileID)),O&&(T.activeTexture.set(M.TEXTURE0),u.imageManager.bind(u.context,o.scope));for(const ne of X){const J=u.isTileAffectedByFog(ne),oe=u.getOrCreateProgram(Z,{overrideFog:J}),H=ne.toUnwrapped(),ae=h?ne.projMatrix:u.transform.calculateProjMatrix(H);u.prepareDrawTile();const he=i?i.getTile(ne):V?V[ne.key]:new Ms(ne,L,I.zoom,u),fe=O?ru(ae,x,_,u,O,o.scope,{tileID:ne,tileSize:L}):wd(ae,x,_,p);u.uploadCommonUniforms(T,oe,H);const{tileBoundsBuffer:ye,tileBoundsIndexBuffer:De,tileBoundsSegments:Te}=u.getTileBoundsBuffers(he);oe.draw(u,M.TRIANGLES,q,N,$,dr.disabled,fe,o.id,ye,De,Te)}},sky:function(u,i,o){const h=u._atmosphere?s.S(u.transform.zoom):1,p=o.paint.get("sky-opacity")*h;if(p===0)return;const _=u.context,x=o.paint.get("sky-type"),T=new jt(_.gl.LEQUAL,jt.ReadOnly,[0,1]),M=u.frameCounter/1e3%1;x==="atmosphere"?u.renderPass==="offscreen"?o.needsSkyboxCapture(u)&&(function(I,L,O,F){const N=I.context,q=N.gl;let $=L.skyboxFbo;if(!$){$=L.skyboxFbo=N.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Od(N),L.skyboxTexture=N.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let ne=0;ne<6;++ne)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}N.bindFramebuffer.set($.framebuffer),N.viewport.set([0,0,32,32]);const Z=L.getCenter(I,!0),V=I.getOrCreateProgram("skyboxCapture"),X=new Float64Array(16);s.a6.identity(X),s.a6.rotateY(X,X,.5*-Math.PI),Il(I,L,V,X,Z,0),s.a6.identity(X),s.a6.rotateY(X,X,.5*Math.PI),Il(I,L,V,X,Z,1),s.a6.identity(X),s.a6.rotateX(X,X,.5*-Math.PI),Il(I,L,V,X,Z,2),s.a6.identity(X),s.a6.rotateX(X,X,.5*Math.PI),Il(I,L,V,X,Z,3),s.a6.identity(X),Il(I,L,V,X,Z,4),s.a6.identity(X),s.a6.rotateY(X,X,Math.PI),Il(I,L,V,X,Z,5),N.viewport.set([0,0,I.width,I.height])}(u,o),o.markSkyboxValid(u)):u.renderPass==="sky"&&function(I,L,O,F,N){const q=I.context,$=q.gl,Z=I.transform,V=I.getOrCreateProgram("skybox");q.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,L.skyboxTexture);const X=((ne,J,oe,H,ae)=>({u_matrix:ne,u_sun_direction:J,u_cubemap:0,u_opacity:H,u_temporal_offset:ae}))(Z.skyboxMatrix,L.getCenter(I,!1),0,F,N);I.uploadCommonUniforms(q,V),V.draw(I,$.TRIANGLES,O,ht.disabled,I.colorModeForRenderPass(),dr.backCW,X,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(u,o,T,p,M):x==="gradient"&&u.renderPass==="sky"&&function(I,L,O,F,N){const q=I.context,$=q.gl,Z=I.transform,V=I.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Od(q)),q.activeTexture.set($.TEXTURE0);let X=L.colorRampTexture;X||(X=L.colorRampTexture=new s.T(q,L.colorRamp,$.RGBA)),X.bind($.LINEAR,$.CLAMP_TO_EDGE);const ne=((J,oe,H,ae,he)=>({u_matrix:J,u_color_ramp:0,u_center_direction:oe,u_radius:s.bj(H),u_opacity:ae,u_temporal_offset:he}))(Z.skyboxMatrix,L.getCenter(I,!1),L.paint.get("sky-gradient-radius"),F,N);I.uploadCommonUniforms(q,V),V.draw(I,$.TRIANGLES,O,ht.disabled,I.colorModeForRenderPass(),dr.backCW,ne,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(u,o,T,p,M)},debug:function(u,i,o,h,p,_){for(let x=0;x<o.length;x++)if(p){const I=new s.ax(h.r*.8,h.g*.8,h.b*.8,1);Ha(u,i,o[x],h,-1,-1,_),Ha(u,i,o[x],h,-1,1,_),Ha(u,i,o[x],h,1,1,_),Ha(u,i,o[x],h,1,-1,_),Ha(u,i,o[x],I,0,0,_)}else Ha(u,i,o[x],h,0,0,_)},custom:function(u,i,o,h){const p=u.context,_=o.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&o.isLayerDraped(i)){if(u.renderPass==="offscreen"){const x=_.prerender;if(x){if(u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const T=u.transform.pointMerc;x.call(_,p.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),s.S(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else x.call(_,p.gl,u.transform.customLayerMatrix());p.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const T=_.renderToTile;if(T){const M=h[0].canonical,I=new s.L(M.x+h[0].wrap*(1<<M.z),M.y,M.z);p.setDepthMode(jt.disabled),p.setStencilMode(ht.disabled),p.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),T.call(_,p.gl,I),p.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),p.setStencilMode(ht.disabled);const x=_.renderingMode==="3d"?new jt(u.context.gl.LEQUAL,jt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,jt.ReadOnly);if(p.setDepthMode(x),u.transform.projection.name==="globe"){const T=u.transform.pointMerc;_.render(p.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),s.S(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else _.render(p.gl,u.transform.customLayerMatrix());p.setDirty(),u.setBaseState(),p.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,i,o,h){if(u.renderPass==="opaque")return;const p=o.paint.get("model-opacity");if(p===0)return;const _=o.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!_||u.terrain&&p<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.Z))return;const x=u.shadowRenderer,T=o.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,T||(x.enabled=!1));const M=()=>{x&&(x.useNormalOffset=!0,T||(x.enabled=!0))},I=i.getSource();if(u.renderPass==="light-beam"&&I.type!=="batched-model")return;if(I.type==="vector"||I.type==="geojson")return function(V,X,ne,J){const oe=V.transform;if(oe.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${oe.projection.name} projection is not yet implemented`);const H=oe.getFreeCameraOptions().position;if(!V.modelManager)return;const ae=V.modelManager;ne.modelManager=ae;const he=V.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const fe=ne._unevaluatedLayout._values["model-id"],ye={...ne.layout.get("model-id").parameters};for(const De of J){const Te=X.getTile(De).getBucket(ne);if(!Te||Te.projection.name!==oe.projection.name)continue;const $e=Ep(De,oe);ye.zoom=$e;const je=fe.possiblyEvaluate(ye);if(Dd(V,Te,De),is.shadowUniformsInitialized=!1,is.useSingleShadowCascade=!!he&&he.getMaxCascadeForTile(De.toUnwrapped())===0,V.renderPass==="shadow"&&he){if(V.currentShadowCascade===1&&Te.isInsideFirstShadowMapFrustum)continue;const Be=oe.calculatePosMatrix(De.toUnwrapped(),oe.worldSize);if(is.tileMatrix.set(Be),is.shadowTileMatrix=Float32Array.from(he.calculateShadowPassMatrixFromMatrix(Be)),is.aabb.min.fill(0),is.aabb.max[0]=is.aabb.max[1]=s.V,is.aabb.max[2]=0,W_(Te,is,V,ne.scope))continue}const it=1<<De.canonical.z,Ae=[((H.x-De.wrap)*it-De.canonical.x)*s.V,(H.y*it-De.canonical.y)*s.V,H.z*it*s.V];for(let Be in Te.instancesPerModel){const _e=Te.instancesPerModel[Be];_e.features.length>0&&(Be=je.evaluate(_e.features[0].feature,{}));const Le=ae.getModel(Be,ne.scope);if(Le&&Le.uploaded)for(const ot of Le.nodes)zd(V,ne,ot,_e,Ae,De,is)}}}(u,i,o,h),void M();if(!I.loaded())return;if(I.type==="batched-model")return function(V,X,ne,J){ne.resetLayerRenderingStats(V);const oe=V.context,H=V.transform,ae=V.style.fog,he=V.shadowRenderer;if(H.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${H.projection.name} projection is not yet implemented`);const fe=V.transform.getFreeCameraOptions().position,ye=s.N.scale([],[fe.x,fe.y,fe.z],V.transform.worldSize);s.N.negate(ye,ye);const De=s.a6.identity([]),Te=s.cR(H.center.lat,H.zoom),$e=s.a6.fromScaling([],[1,1,1/Te]);s.a6.translate(De,De,ye);const je=ne.paint.get("model-opacity"),it=new jt(oe.gl.LEQUAL,jt.ReadWrite,V.depthRangeFor3D),Ae=new jt(oe.gl.LEQUAL,jt.ReadOnly,V.depthRangeFor3D),Be=new s.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),_e=V.renderPass==="shadow",Le=_e&&he?he.getCurrentCascadeFrustum():H.getFrustum(H.scaleZoom(H.worldSize)),ot=ne.getLayerRenderingStats(),vt=function(_t,Ot){for(const Kt of J){const ur=X.getTile(Kt).getBucket(ne);if(!ur||!ur.uploaded)continue;let tr=!1;he&&(tr=he.getMaxCascadeForTile(Kt.toUnwrapped())===0);const ar=H.calculatePosMatrix(Kt.toUnwrapped(),H.worldSize),Br=ur.modelTraits;for(const Mr of ur.getNodesInfo()){if(Mr.hiddenByReplacement||!Mr.node.meshes)continue;const Or=Mr.evaluatedScale,Lr=Mr.node;let ri=0;if(V.terrain&&Lr.elevation&&(ri=Lr.elevation*V.terrain.exaggeration()),Or[0]<=1&&Or[1]<=1&&Or[2]<=1&&(()=>{const qi=Mr.getLocalBounds();return Be.min=[...qi.min],Be.max=[...qi.max],Be.min[2]+=ri,Be.max[2]+=ri,s.N.transformMat4(Be.min,Be.min,ar),s.N.transformMat4(Be.max,Be.max,ar),Be})().intersects(Le)===0)continue;const Bi=V.renderPass==="light-beam",Hr=[...ar];s.a6.translate(Hr,Hr,[(Lr.anchor?Lr.anchor[0]:0)*(Or[0]-1),(Lr.anchor?Lr.anchor[1]:0)*(Or[1]-1),ri]),s.N.exactEquals(Or,s.cT)||s.a6.scale(Hr,Hr,Or),s.a6.multiply(Hr,Hr,Lr.matrix);const ln=s.a6.multiply([],$e,Hr);s.a6.multiply(ln,De,ln);const Wr=s.a6.invert([],ln);s.a6.transpose(Wr,Wr),s.a6.scale(Wr,Wr,uc);const li=s.a6.multiply([],H.expandedFarZProjMatrix,Hr),Xr=Br&s.cV.HasMapboxMeshFeatures,si=Xr?0:Mr.evaluatedRMEA[0][2];for(let qi=0;qi<Lr.meshes.length;++qi){const pi=Lr.meshes[qi],Wn=qi===Lr.lightMeshIndex;if(Wn){if(!Bi&&!V.terrain&&V.shadowRenderer){V.currentLayer<V.firstLightBeamLayer&&(V.firstLightBeamLayer=V.currentLayer);continue}}else if(Bi)continue;const ho={defines:[]},qo=[];if(an(ho.defines,qo,pi,V),Xr||ho.defines.push("DIFFUSE_SHADED"),tr&&ho.defines.push("SHADOWS_SINGLE_CASCADE"),ot&&(_e?ot.numRenderedVerticesInShadowPass+=pi.vertexArray.length:ot.numRenderedVerticesInTransparentPass+=pi.vertexArray.length),_e){Re(pi,Hr,V,ne);continue}let ra=null;if(ae){const Ho=Cl(Hr,V.transform);if(ra=new Float32Array(Ho),H.projection.name!=="globe"){const ia=pi.aabb.min,Ja=pi.aabb.max,[Ll,Eu]=ae.getOpacityForBounds(Ho,ia[0],ia[1],Ja[0],Ja[1]);ho.overrideFog=Ll>=$r||Eu>=$r}}const Zo=pi.material;let Xn;Zo.occlusionTexture&&Zo.occlusionTexture.offsetScale&&(Xn=Zo.occlusionTexture.offsetScale,ho.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!_e&&he&&(he.useNormalOffset=!!pi.normalBuffer);const Un=V.getOrCreateProgram("model",ho);!_e&&he&&he.setupShadowsFromMatrix(Hr,Un,he.useNormalOffset),V.uploadCommonUniforms(oe,Un,Kt.toUnwrapped(),ra);const Co=Zo.pbrMetallicRoughness;Co.metallicFactor=.9,Co.roughnessFactor=.5;const ko=ch(new Float32Array(li),new Float32Array(ln),new Float32Array(Wr),V,je,Co.baseColorFactor,Zo.emissiveFactor,Co.metallicFactor,Co.roughnessFactor,Zo,si,ne,[0,0,0],Xn);Un.draw(V,oe.gl.TRIANGLES,Ot&&!Wn?it:Ae,ht.disabled,_t?Wn||je<1||Mr.hasTranslucentParts?vr.alphaBlended:vr.unblended:vr.disabled,dr.backCCW,ko,ne.id,pi.vertexBuffer,pi.indexBuffer,pi.segments,ne.paint,V.transform.zoom,void 0,qo)}}}};(function(_t,Ot,Kt,ur){const tr=_t.terrain?_t.terrain.exaggeration():0,ar=_t.transform.zoom;for(const Br of ur){const Mr=Ot.getTile(Br).getBucket(Kt);Mr&&(_t.conflationActive&&Mr.updateReplacement(Br,_t.replacementSource),Mr.evaluateScale(_t,Kt),_t.terrain&&tr>0&&Mr.elevationUpdate(_t.terrain,tr,Br,Kt.source),Mr.needsReEvaluation(_t,ar,Kt)&&Mr.evaluate(Kt))}})(V,X,ne,J),je===1?vt(!0,!0):(vt(!1,!0),vt(!0,!1))}(u,i,o,h),void M();const L=I.getModels(),O=[],F=u.transform.getFreeCameraOptions().position,N=s.N.scale([],[F.x,F.y,F.z],u.transform.worldSize);s.N.negate(N,N);const q=[],$=[];let Z=0;for(const V of L){const X=o.paint.get("model-rotation").constantOr(null),ne=o.paint.get("model-scale").constantOr(null),J=o.paint.get("model-translation").constantOr(null);V.computeModelMatrix(u,X,ne,J,!0,!0,!1);const oe=s.a6.identity([]),H=s.cR(V.position.lat,u.transform.zoom),ae=s.a6.fromScaling([],[1,1,1/H]);s.a6.translate(oe,oe,N),O.push({zScaleMatrix:ae,negCameraPosMatrix:oe});for(const he of V.nodes)lu(u.transform,he,V.matrix,u.transform.expandedFarZProjMatrix,Z,q,$);Z++}if(q.sort((V,X)=>X.depth-V.depth),u.renderPass!=="shadow"){if(p===1)for(const V of $)au(V,u,o,O[V.modelIndex],ht.disabled,u.colorModeForRenderPass());else{for(const V of $)au(V,u,o,O[V.modelIndex],ht.disabled,vr.disabled);for(const V of $)au(V,u,o,O[V.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const V of q)au(V,u,o,O[V.modelIndex],ht.disabled,u.colorModeForRenderPass());M()}else{for(const V of $)Re(V.mesh,V.nodeModelMatrix,u,o);for(const V of q)Re(V.mesh,V.nodeModelMatrix,u,o);M()}}},kd={model:function(u,i,o){const h=u.scope,p=i.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,h));if(p.type==="batched-model")return;const _=p.getModels();for(const x of _)x.upload(o.context)},raster:function(u,i,o){const h=i.getSource();if(!(h instanceof gt&&h.loaded()))return;const p=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!p)return;const _=u.paint.get("raster-array-band")||h.getInitialBand(p);if(_==null)return;const x=i.getIds().map(T=>i.getTileByID(T));for(const T of x)T.updateNeeded(p,_)&&h.prepareTile(T,p,_)},"raster-particle":function(u,i,o){const h=i.getSource();if(!(h instanceof gt&&h.loaded()))return;const p=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!p)return;const _=u.paint.get("raster-particle-array-band")||h.getInitialBand(p);if(_==null)return;const x=i.getIds().map(T=>i.getTileByID(T));for(const T of x)T.updateNeeded(p,_)&&h.prepareTile(T,p,_)}};class Mp{constructor(i,o,h,p){this.context=new on(i,o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=p,this._debugParams={showTerrainProxyTiles:!1},p.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Uo.maxUnderzooming+Uo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Ws(this),this._wireframeDebugCache=new Sp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(i,o){const h=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new j_(this,i));const p=this._terrain;this.transform.elevation=h?p:null,p.update(i,this.transform,o),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(i){const o=i.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,p]=o.getFovAdjustedRange(this.transform._fov);if(h>p)return void(this.transform.fogCullDistSq=null);const _=h+.78*(p-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,o){if(this.width=i*s.f.devicePixelRatio,this.height=o*s.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const i=this.context,o=new s.aN;o.emplaceBack(0,0),o.emplaceBack(s.V,0),o.emplaceBack(0,s.V),o.emplaceBack(s.V,s.V),this.tileExtentBuffer=i.createVertexBuffer(o,s.aP.members),this.tileExtentSegments=s.aB.simpleSegment(0,0,4,2);const h=new s.aN;h.emplaceBack(0,0),h.emplaceBack(s.V,0),h.emplaceBack(0,s.V),h.emplaceBack(s.V,s.V),this.debugBuffer=i.createVertexBuffer(h,s.aP.members),this.debugSegments=s.aB.simpleSegment(0,0,4,5);const p=new s.aN;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(p,s.aP.members),this.viewportSegments=s.aB.simpleSegment(0,0,4,2);const _=new s.av;_.emplaceBack(0,0,0,0),_.emplaceBack(s.V,0,s.V,0),_.emplaceBack(0,s.V,0,s.V),_.emplaceBack(s.V,s.V,s.V,s.V),this.mercatorBoundsBuffer=i.createVertexBuffer(_,s.aR.members),this.mercatorBoundsSegments=s.aB.simpleSegment(0,0,4,2);const x=new s.aw;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(x);const T=new s.aO;for(const I of[0,1,3,2,0])T.emplaceBack(I);this.debugIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new s.T(i,new s.h({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=s.a6.create();const M=this.context.gl;this.stencilClearMode=new ht({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,jt.disabled,this.stencilClearMode,vr.disabled,dr.disabled,ud(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,o,h){if(!o||this.currentStencilSource===o.id||!i.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const M of h)if(this._tileClippingMaskIDs[M.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=o.id;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(vr.disabled),p.setDepthMode(jt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of h){const M=o.getTile(T),I=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:O,tileBoundsSegments:F}=this.getTileBoundsBuffers(M);x.draw(this,_.TRIANGLES,jt.disabled,new ht({func:_.ALWAYS,mask:0},I,255,_.KEEP,_.KEEP,_.REPLACE),vr.disabled,dr.disabled,ud(T.projMatrix),"$clipping",L,O,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,o=this.context.gl;return new ht({func:o.NOTEQUAL,mask:255},i,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const o=this.context.gl;return new ht({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(i){const o=this.context.gl,h=i.sort((x,T)=>T.overscaledZ-x.overscaledZ),p=h[h.length-1].overscaledZ,_=h[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let T=0;T<_;T++)x[T+p]=new ht({func:o.GEQUAL,mask:255},T+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=_,[x,h]}return[{[p]:ht.disabled},h]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new vr([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new s.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?vr.unblended:vr.alphaBlended}colorModeForDrapableLayerRenderPass(i){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new vr([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.ax(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,o,h,p=!1){if(!this.opaquePassEnabledForLayer()&&!p)return jt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new jt(h||this.context.gl.LEQUAL,o,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,o){this._wireframeDebugCache.update(this.frameCounter),this.style=i,this.options=o;const h=this.style._mergedLayers,p=this.style.order,_=p.map(H=>h[H]),x=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(s.f.now()),this.imageManager.beginFrame();let T=0,M=!1;for(const H in x){const ae=x[H];ae.used&&(ae.prepare(this.context),ae.getSource().usedInConflation&&++T)}for(const H of _)H.isHidden(this.transform.zoom)||this.prepareLayer(H);const I={},L={},O={},F={},N={};for(const H in x){const ae=x[H];I[H]=ae.getVisibleCoordinates(),L[H]=I[H].slice().reverse(),O[H]=ae.getVisibleCoordinates(!0).reverse(),F[H]=ae.getShadowCasterCoordinates(),N[H]=ae.sortCoordinatesByDistance(I[H])}const q=H=>{const ae=this.style.getLayerSourceCache(H);return ae&&ae.used?ae.getSource():null};if(T){const H=[];for(const ae of _)this.layerUsedInConflation(ae,q(ae))&&H.push(ae);if(H&&H.length>1){const ae=[];for(const he of H){const fe=this.style.getLayerSourceCache(he);fe&&fe.used&&fe.getSource().usedInConflation&&ae.push({layer:he.fqid,cache:fe})}this.replacementSource.setSources(ae),M=!0}}M||this.replacementSource.clear(),this.conflationActive=M,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const H of _){const ae=H.cutoffRange();if(this.longestCutoffRange=Math.max(ae,this.longestCutoffRange),ae>0){const he=q(H);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),H.minzoom&&(this.minCutoffZoom=Math.max(H.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let H=0;H<_.length;H++)if(_[H].is3D()){this.opaquePassCutoff=H;break}const $=this.style&&this.style.fog;$?(this._fogVisible=$.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=$.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0);const Z=this._shadowRenderer;if(Z){Z.updateShadowParameters(this.transform,this.style.directionalLight);for(const H in x)for(const ae of I[H]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(ae)||he),Z.addShadowReceiver(ae.toUnwrapped(),he.min,he.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cZ(this.context.gl))return;this.renderPass="offscreen";for(const H of _){const ae=i.getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const he=ae?L[ae.id]:void 0;(H.type==="custom"||H.type==="raster"||H.type==="raster-particle"||H.isSky()||he&&he.length)&&this.renderLayer(this,ae,H,he)}this.depthRangeFor3D=[0,1-(_.length+2)*this.numSublayers*this.depthEpsilon];const V=this.terrain;V&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&V.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,F)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const X=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ne=(()=>{if(o.showOverdrawInspector)return s.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!X){const H=this.style.fog.properties.get("color").toArray01();return new s.ax(...H)}if(this.style.fog&&this.transform.projection.supportsFog&&X){const H=this.style.fog.properties.get("space-color").toArray01();return new s.ax(...H)}return s.ax.transparent})();if(this.context.clear({color:ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&X&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const H=_[this.currentLayer],ae=i.getLayerSourceCache(H);if(H.isSky())continue;const he=ae?(H.is3D()?N:L)[ae.id]:void 0;this._renderTileClippingMasks(H,ae,he),this.renderLayer(this,ae,H,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&X&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const H=_[this.currentLayer],ae=i.getLayerSourceCache(H);H.isSky()&&this.renderLayer(this,ae,H,ae?L[ae.id]:void 0)}function J(H,ae){let he;return ae&&(he=(H.type==="symbol"?O:H.is3D()?N:L)[ae.id]),he}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<p.length;){const H=_[this.currentLayer];if(H.type==="raster"){const ae=i.getLayerSourceCache(H);this.renderLayer(this,ae,H,J(H,ae))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let oe=0;for(Z&&(oe=Z.getShadowCastingLayerCount());this.currentLayer<p.length;){const H=_[this.currentLayer],ae=i.getLayerSourceCache(H);if(H.isSky())++this.currentLayer;else if(V&&this.style.isLayerDraped(H)){if(H.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=V.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(H,ae,ae?I[ae.id]:void 0),this.renderLayer(this,ae,H,J(H,ae)),!V&&Z&&oe>0&&H.hasShadowPass()&&--oe==0&&(Z.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const he=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=he;this.currentLayer++){const fe=_[this.currentLayer];if(!fe.hasLightBeamPass())continue;const ye=i.getLayerSourceCache(fe);this.renderLayer(this,ye,fe,ye?L[ye.id]:void 0)}this.currentLayer=he,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let H=null;_.forEach(ae=>{const he=i.getLayerSourceCache(ae);he&&!ae.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!H||H.getSource().maxzoom<he.getSource().maxzoom)&&(H=he)}),H&&this.options.showTileBoundaries&&uu.debug(this,H,H.getVisibleCoordinates(),s.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&uu.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(H){const ae=H.transform.padding;Ld(H,H.transform.height-(ae.top||0),3,Go),Ld(H,ae.bottom||0,3,Za),rs(H,ae.left||0,3,Tp),rs(H,H.transform.width-(ae.right||0),3,Cd);const he=H.transform.centerPoint;(function(fe,ye,De,Te){sn(fe,ye-1,De-10,2,20,Te),sn(fe,ye-10,De-1,20,2,Te)})(H,he.x,H.transform.height-he.y,Pd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),M||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:o}=this.transform.projection,h=!o||!o.includes(i.type);if(kd[i.type]&&(h||this.terrain&&i.type==="custom")){const p=this.style.getLayerSourceCache(i);kd[i.type](i,p,this)}this.gpuTimingEnd()}renderLayer(i,o,h,p){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||p&&p.length)&&(this.id=h.id,this.gpuTimingStart(h),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(h.type)||i.terrain&&h.type==="custom")&&uu[h.type](i,o,h,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,h=this.context.gl;let p=this.gpuTimers[i.id];p||(p=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:h.createQuery()}),p.calls++,h.beginQuery(o.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,o=this.context.gl,h=o.createQuery();this.deferredRenderGpuTimeQueries.push(h),o.beginQuery(i.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const o={};for(const h in i){const p=i[h],_=this.context.extTimerQuery,x=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),o[h]=x}return o}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery,h=this.context.gl;let p=0;for(const _ of i)p+=o.getQueryParameter(_,h.QUERY_RESULT)/1e6,o.deleteQueryEXT(_);return p}translatePosMatrix(i,o,h,p,_){if(!h[0]&&!h[1])return i;const x=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const I=Math.sin(x),L=Math.cos(x);h=[h[0]*L-h[1]*I,h[0]*I+h[1]*L]}const T=[_?h[0]:s.a3(o,h[0],this.transform.zoom),_?h[1]:s.a3(o,h[1],this.transform.zoom),0],M=new Float32Array(16);return s.a6.translate(M,i,T),M}saveTileTexture(i){const o=i.size[0],h=this._tileTextures[o];h?h.push(i):this._tileTextures[o]=[i]}getTileTexture(i){const o=this._tileTextures[i];return o&&o.length>0?o.pop():null}isPatternMissing(i,o){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString(),o)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,o,h){const p=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,_=this.terrain&&this.terrain.exaggeration()===0,x=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT"),_&&x.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||p||o!==void 0&&!o||x.push("FOG","FOG_DITHERING"),p&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(i,o){this.cache=this.cache||{};const h=o&&o.defines||[],p=o&&o.config,_=o&&o.transformFeedback,x=this.currentGlobalDefines(i,o&&o.overrideFog,o&&o.overrideRtt).concat(h),T=pd.cacheKey(od[i],i,x,p);return this.cache[T]||(this.cache[T]=new pd(this.context,i,od[i],p,$_[i],x,_)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,o){if(this.style.enable3dLights()){const h=this.style.directionalLight,p=this.style.ambientLight;if(h&&p){const _=((x,T)=>{const M=x.properties.get("direction"),I=x.properties.get("color").toArray01(),L=x.properties.get("intensity"),O=T.properties.get("color").toArray01(),F=T.properties.get("intensity"),N=[M.x,M.y,M.z],q=s.cn(O,F),$=s.cn(I,L);return{u_lighting_ambient_color:q,u_lighting_directional_dir:N,u_lighting_directional_color:$,u_ground_radiance:dd(N,$,q)}})(h,p);o.setLightsUniformValues(i,_)}}}uploadCommonUniforms(i,o,h,p,_){if(this.uploadCommonLightUniforms(i,o),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const T=x.getOpacity(this.transform.pitch),M=((I,L,O,F,N,q,$,Z,V,X,ne,J)=>{const oe=I.transform,H=L.properties.get("color").toArray01();H[3]=F;const ae=I.frameCounter/1e3%1,[he,fe]=L.properties.get("vertical-range");return{u_fog_matrix:O?oe.calculateFogTileMatrix(O):J||I.identityMat,u_fog_range:L.getFovAdjustedRange(oe._fov),u_fog_color:H,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(he,fe),fe],u_fog_temporal_offset:ae,u_frustum_tl:N,u_frustum_tr:q,u_frustum_br:$,u_frustum_bl:Z,u_globe_pos:V,u_globe_radius:X,u_viewport:ne,u_globe_transition:s.S(oe.zoom),u_is_globe:+(oe.projection.name==="globe")}})(this,x,h,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.f.devicePixelRatio,this.transform.height*s.f.devicePixelRatio],p);o.setFogUniformValues(i,M)}_&&o.setCutoffUniformValues(i,_.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,o=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const p of h)o[p.key]=i[p.key]||new Ms(p,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(i,o){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||i.sourceLayer!=="building"&&(!o||o.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[i.key];return o||(this._cachedTileFogOpacities[i.key]=o=this.style.fog.getOpacityForTile(i)),o[0]>=$r||o[1]>=$r}}function hu(u,i){let o=!1,h=null;const p=()=>{h=null,o&&(u(),h=setTimeout(p,i),o=!1)};return()=>(o=!0,h||p(),h)}class dh{constructor(i){this._hashName=i&&encodeURIComponent(i),s.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=hu(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const o=Fd(i);if(this._hashName){const h=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(x=>{const T=x.split("=")[0];return T===h?(p=!0,`${T}=${o}`):x}).filter(x=>x);return p||_.push(`${h}=${o}`),`#${_.join("&")}`}return`#${o}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let o;return i.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(o=h)}),(o&&o[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(o[3]||0):i.getBearing();return i.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Fd(u,i){const o=u.getCenter(),h=Math.round(100*u.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),x=Math.round(o.lng*_)/_,T=Math.round(o.lat*_)/_,M=u.getBearing(),I=u.getPitch();let L=i?`/${x}/${T}/${h}`:`${h}/${T}/${x}`;return(M||I)&&(L+="/"+Math.round(10*M)/10),I&&(L+=`/${Math.round(I)}`),L}const du={linearity:.3,easing:s.c_(0,0,.3,1)},$o=s.e({deceleration:2500,maxSpeed:1400},du),Y_=s.e({deceleration:20,maxSpeed:1400},du),fh=s.e({deceleration:1e3,maxSpeed:360},du),Xi=s.e({deceleration:1e3,maxSpeed:90},du);class xi{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.f.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,o=s.f.now();for(;i.length>0&&o-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)o.zoom+=_.zoomDelta||0,o.bearing+=_.bearingDelta||0,o.pitch+=_.pitchDelta||0,_.panDelta&&o.pan._add(_.panDelta),_.around&&(o.around=_.around),_.pinchAround&&(o.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(o.pan.mag()){const _=Ns(o.pan.mag(),h,s.e({},$o,i||{}));p.offset=o.pan.mult(_.amount/o.pan.mag()),p.center=this._map.transform.center,fu(p,_)}if(o.zoom){const _=Ns(o.zoom,h,Y_);p.zoom=this._map.transform.zoom+_.amount,fu(p,_)}if(o.bearing){const _=Ns(o.bearing,h,fh);p.bearing=this._map.transform.bearing+s.aa(_.amount,-179,179),fu(p,_)}if(o.pitch){const _=Ns(o.pitch,h,Xi);p.pitch=this._map.transform.pitch+_.amount,fu(p,_)}if(p.zoom||p.bearing){const _=o.pinchAround===void 0?o.around:o.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function fu(u,i){(!u.duration||u.duration<i.duration)&&(u.duration=i.duration,u.easing=i.easing)}function Ns(u,i,o){const{maxSpeed:h,linearity:p,deceleration:_}=o,x=s.aa(u*p/(i/1e3),-h,h),T=Math.abs(x)/(_*p);return{easing:o.easing,duration:1e3*T,amount:x*(T/2)}}class zo extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h,p={}){const _=hr(o.getCanvasContainer(),h),x=o.unproject(_);super(i,s.e({point:_,lngLat:x,originalEvent:h},p)),this._defaultPrevented=!1,this.target=o}}class va extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){const p=i==="touchend"?h.changedTouches:h.touches,_=Ai(o.getCanvasContainer(),p),x=_.map(M=>o.unproject(M)),T=_.reduce((M,I,L,O)=>M.add(I.div(O.length)),new s.P(0,0));super(i,{points:_,point:T,lngLats:x,lngLat:o.unproject(T),originalEvent:h}),this._defaultPrevented=!1}}class Bd extends s.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,o,h){super(i,{originalEvent:h}),this._defaultPrevented=!1}}class Nd{constructor(i,o){this._map=i,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Bd(i.type,this._map,i))}mousedown(i,o){return this._mousedownPos=o,this._firePreventable(new zo(i.type,this._map,i))}mouseup(i){this._map.fire(new zo(i.type,this._map,i))}preclick(i){const o=s.e({},i);o.type="preclick",this._map.fire(new zo(o.type,this._map,o))}click(i,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(i),this._map.fire(new zo(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new zo(i.type,this._map,i))}mouseover(i){this._map.fire(new zo(i.type,this._map,i))}mouseout(i){this._map.fire(new zo(i.type,this._map,i))}touchstart(i){return this._firePreventable(new va(i.type,this._map,i))}touchmove(i){this._map.fire(new va(i.type,this._map,i))}touchend(i){this._map.fire(new va(i.type,this._map,i))}touchcancel(i){this._map.fire(new va(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wa{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new zo(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new zo(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xa{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,o){this.isEnabled()&&i.shiftKey&&i.button===0&&($t(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(i,o){if(!this._active)return;const h=o,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(h)||!this._box&&h.dist(p)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=Ee("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const x=Math.min(p.x,h.x),T=Math.max(p.x,h.x),M=Math.min(p.y,h.y),I=Math.max(p.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${M}px)`,this._box.style.width=T-x+"px",this._box.style.height=I-M+"px")})}mouseupWindow(i,o){if(!this._active)return;const h=this._startPos,p=o;if(h&&i.button===0){if(this.reset(),zr(),h.x!==p.x||h.y!==p.y)return this._map.fire(new s.b("boxzoomend",{originalEvent:i})),{cameraAnimation:_=>_.fitScreenCoordinates(h,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),It(),delete this._startPos,delete this._lastPos}_fireEvent(i,o){return this._map.fire(new s.b(i,{originalEvent:o}))}}function hc(u,i){const o={};for(let h=0;h<u.length;h++)o[u[h].identifier]=i[h];return o}class ph{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const _=new s.P(0,0);for(const x of p)_._add(x);return _.div(p.length)}(o),this.touches=hc(h,o)))}touchmove(i,o,h){if(this.aborted||!this.centroid)return;const p=hc(h,o);for(const _ in this.touches){const x=p[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(i,o,h){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class pu{constructor(i){this.singleTap=new ph(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,o,h){this.singleTap.touchstart(i,o,h)}touchmove(i,o,h){this.singleTap.touchmove(i,o,h)}touchend(i,o,h){const p=this.singleTap.touchend(i,o,h);if(p){const _=i.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(_&&x||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Ud{constructor(){this._zoomIn=new pu({numTouches:1,numTaps:2}),this._zoomOut=new pu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,o,h){this._zoomIn.touchstart(i,o,h),this._zoomOut.touchstart(i,o,h)}touchmove(i,o,h){this._zoomIn.touchmove(i,o,h),this._zoomOut.touchmove(i,o,h)}touchend(i,o,h){const p=this._zoomIn.touchend(i,o,h),_=this._zoomOut.touchend(i,o,h);return p?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:i})}):_?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jd={0:1,2:2};class ta{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,o){return!1}_move(i,o){return{}}mousedown(i,o){if(this._lastPoint)return;const h=Ii(i);this._correctButton(i,h)&&(this._lastPoint=o,this._eventButton=h)}mousemoveWindow(i,o){const h=this._lastPoint;if(h){if(i.preventDefault(),this._eventButton!=null&&function(p,_){const x=jd[_];return p.buttons===void 0||(p.buttons&x)!==x}(i,this._eventButton))this.reset();else if(this._moved||!(o.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(h,o)}}mouseupWindow(i){this._lastPoint&&Ii(i)===this._eventButton&&(this._moved&&zr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vd extends ta{mousedown(i,o){super.mousedown(i,o),this._lastPoint&&(this._active=!0)}_correctButton(i,o){return o===0&&!i.ctrlKey}_move(i,o){return{around:o,panDelta:o.sub(i)}}}class mu extends ta{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const h=.8*(o.x-i.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(i){i.preventDefault()}}class mh extends ta{_correctButton(i,o){return o===0&&i.ctrlKey||o===2}_move(i,o){const h=-.5*(o.y-i.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(i){i.preventDefault()}}class Gd{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(i,o,h){return this._calculateTransform(i,o,h)}touchmove(i,o,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!s.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,o,h)}}touchend(i,o,h){this._calculateTransform(i,o,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,o,h){h.length>0&&(this._active=!0);const p=hc(h,o),_=new s.P(0,0),x=new s.P(0,0);let T=0;for(const I in p){const L=p[I],O=this._touches[I];O&&(_._add(L),x._add(L.sub(O)),T++,p[I]=L)}if(this._touches=p,T<this._minTouches||!x.mag())return;const M=x.div(T);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(T),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ee("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Hn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,o,h){return{}}touchstart(i,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(i,o,h){const p=this._firstTwoTouches;if(!p)return;i.preventDefault();const[_,x]=p,T=dc(h,o,_),M=dc(h,o,x);if(!T||!M)return;const I=this._aroundCenter?null:T.add(M).div(2);return this._move([T,M],I,i)}touchend(i,o,h){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,x=dc(h,o,p),T=dc(h,o,_);x&&T||(this._active&&zr(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function dc(u,i,o){for(let h=0;h<u.length;h++)if(u[h].identifier===o)return i[h]}function _h(u,i){return Math.log(u/i)/Math.LN2}class _u extends Hn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,o){const h=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(_h(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_h(this._distance,h),pinchAround:o}}}function Ya(u,i){return 180*u.angleWith(i)/Math.PI}class $d extends Hn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,o){const h=this._vector;if(this._vector=i[0].sub(i[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ya(this._vector,h),pinchAround:o}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const o=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const p=Ya(i,h);return Math.abs(p)<o}}function gu(u){return Math.abs(u.y)>Math.abs(u.x)}class qd extends Hn{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,gu(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,o,h){const p=this._lastPoints;if(!p)return;const _=i[0].sub(p[0]),x=i[1].sub(p[1]);return this._map._cooperativeGestures&&!s.c$()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5})}gestureBeginsVertically(i,o,h){if(this._valid!==void 0)return this._valid;const p=i.mag()>=2,_=o.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=i.y>0==o.y>0;return gu(i)&&gu(o)&&x}}const Pl={panStep:100,bearingStep:15,pitchStep:10};class yu{constructor(){const i=Pl;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let o=0,h=0,p=0,_=0,x=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),_=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),_=1);break;case 38:i.shiftKey?p=1:(i.preventDefault(),x=-1);break;case 40:i.shiftKey?p=-1:(i.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:T=>{const M=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Zd,zoom:o?Math.round(M)+o*(i.shiftKey?2:1):M,bearing:T.getBearing()+h*this._bearingStep,pitch:T.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:T.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zd(u){return u*(2-u)}const vu=4.000244140625,Hd=1/450;class Ap{constructor(i,o){this._map=i,this._el=i.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Hd,s.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||s.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const h=s.f.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%vu==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(p*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),i.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=i,this._delta-=o,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=hr(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>vu?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&L!==0&&(L=1/L);const O=o(),F=Math.pow(2,O),N=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(N*L))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o(),p=this._startZoom,_=this._easing;let x,T=!1;if(this._type==="wheel"&&p&&_){const I=Math.min((s.f.now()-this._lastWheelEventTime)/200,1),L=_(I);x=s.U(p,h,L),I<1?this._frameId||(this._frameId=!0):T=!0}else x=h,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=x-o();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let o=s.d0;if(this._prevEase){const h=this._prevEase,p=(s.f.now()-h.start)/h.duration,_=h.easing(p+.01)-h.easing(p),x=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-x*x);o=s.c_(x,T,.25,1)}return this._prevEase={start:s.f.now(),duration:i,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ee("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ip{constructor(i,o){this._clickZoom=i,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,o){return i.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(i.shiftKey?-1:1),around:h.unproject(o)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pp{constructor(){this._tap=new pu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,o,h){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=o[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(i,o,h))}touchmove(i,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=o[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,i.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(i,o,h)}touchend(i,o,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(i,o,h)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lp{constructor(i,o,h){this._el=i,this._mousePan=o,this._touchPan=h}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rp{constructor(i,o,h){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Op{constructor(i,o,h,p){this._el=i,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xu=u=>u.zoom||u.drag||u.pitch||u.rotate;class Dp extends s.b{}class zp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,o){const h=s.N.sub([],o,i);this.radius=s.N.length(h[2]<0?s.N.div([],h,this.constants):[h[0],h[1],0])}projectRay(i){s.N.div(i,i,this.constants),s.N.normalize(i,i),s.N.mul(i,i,this.constants);const o=s.N.scale([],i,this.radius);if(o[2]>0){const h=s.N.scale([],[0,0,1],s.N.dot(o,[0,0,1])),p=s.N.scale([],s.N.normalize([],[o[0],o[1],0]),this.radius),_=s.N.add([],o,s.N.scale([],s.N.sub([],s.N.add([],p,h),o),2));o[0]=_[0],o[1]=_[1]}return o}}function bu(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class K_{constructor(i,o){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xi(i),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.aY(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,x]of this._listeners){const T=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,T,x)}}destroy(){for(const[i,o,h]of this._listeners){const p=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(o,p,h)}}_addDefaultHandlers(i){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new Nd(o,i));const p=o.boxZoom=new Xa(o,i);this._add("boxZoom",p);const _=new Ud,x=new Cp;o.doubleClickZoom=new Ip(x,_),this._add("tapZoom",_),this._add("clickZoom",x);const T=new Pp;this._add("tapDragZoom",T);const M=o.touchPitch=new qd(o);this._add("touchPitch",M);const I=new mu(i),L=new mh(i);o.dragRotate=new Rp(i,I,L),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const O=new Vd(i),F=new Gd(o,i);o.dragPan=new Lp(h,O,F),this._add("mousePan",O),this._add("touchPan",F,["touchZoom","touchRotate"]);const N=new $d,q=new _u;o.touchZoomRotate=new Op(h,q,N,T),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Wa(o));const $=o.scrollZoom=new Ap(o,this);this._add("scrollZoom",$,["mousePan"]);const Z=o.keyboard=new yu;this._add("keyboard",Z);for(const V of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[V]&&o[V].enable(i[V])}_add(i,o,h){this._handlers.push({handlerName:i,handler:o,allowed:h}),this._handlersById[i]=o}stop(i){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,o,h){for(const p in i)if(p!==h&&(!o||o.indexOf(p)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const o=[];for(const h of i)this._el.contains(h.target)&&o.push(h);return o}handleEvent(i,o){this._updatingCamera=!0;const h=i.type==="renderFrame",p=h?void 0:i,_={needsRenderFrame:!1},x={},T={},M=i.touches?this._getMapTouches(i.touches):void 0,I=M?Ai(this._el,M):h?void 0:hr(this._el,i);for(const{handlerName:F,handler:N,allowed:q}of this._handlers){if(!N.isEnabled())continue;let $;this._blockedByActive(T,q,F)?N.reset():N[o||i.type]&&($=N[o||i.type](i,I,M),this.mergeHandlerResult(_,x,$,F,p),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||N.isActive())&&(T[F]=N)}const L={};for(const F in this._previousActiveHandlers)T[F]||(L[F]=p);this._previousActiveHandlers=T,(Object.keys(L).length||bu(_))&&(this._changes.push([_,x,L]),this._triggerRenderFrame()),(Object.keys(T).length||bu(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=_;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(i,o,h,p,_){if(!h)return;s.e(i,h);const x={handlerName:p,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(o.zoom=x),h.panDelta!==void 0&&(o.drag=x),h.pitchDelta!==void 0&&(o.pitch=x),h.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){const i={},o={},h={};for(const[p,_,x]of this._changes)p.panDelta&&(i.panDelta=(i.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(i.around=p.around),p.aroundCoord!==void 0&&(i.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(i.pinchAround=p.pinchAround),p.noInertia&&(i.noInertia=p.noInertia),s.e(o,_),s.e(h,x);this._updateMapTransform(i,o,h),this._changes=[]}_updateMapTransform(i,o,h){const p=this._map,_=p.transform,x=X=>[X.x,X.y,X.z];if((X=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!bu(i)){const X=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),X!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!bu(i))return void this._fireEvents(o,h,!0);let{panDelta:T,zoomDelta:M,bearingDelta:I,pitchDelta:L,around:O,aroundCoord:F,pinchAround:N}=i;_._isCameraConstrained&&(M>0&&(M=0),_._isCameraConstrained=!1),N!==void 0&&(O=N),(M||(X=>o[X]&&!this._eventsInProgress[X])("drag"))&&O&&(this._dragOrigin=x(_.pointCoordinate3D(O)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),O=O||p.transform.centerPoint,I&&(_.bearing+=I),L&&(_.pitch+=L),_._updateCameraState();const q=[0,0,0];if(T)if(_.projection.name==="mercator"){const X=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O).dir),ne=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(O.sub(T)).dir);q[0]=ne[0]-X[0],q[1]=ne[1]-X[1]}else{const X=_.pointCoordinate(O);if(_.projection.name==="globe"){T=T.rotate(-_.angle);const ne=_._pixelsPerMercatorPixel/_.worldSize;q[0]=-T.x*s.d1(s.au(X.y))*ne,q[1]=-T.y*s.d1(_.center.lat)*ne}else{const ne=_.pointCoordinate(O.sub(T));X&&ne&&(q[0]=ne.x-X.x,q[1]=ne.y-X.y)}}const $=_.zoom,Z=[0,0,0];if(M){const X=x(F||_.pointCoordinate3D(O)),ne={dir:s.N.normalize([],s.N.sub([],X,_._camera.position))};if(ne.dir[2]<0){const J=_.zoomDeltaToMovement(X,M);s.N.scale(Z,ne.dir,J)}}const V=s.N.add(q,q,Z);_._translateCameraConstrained(V),M&&Math.abs(_.zoom-$)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(o,h,!0)}_fireEvents(i,o,h){const p=xu(this._eventsInProgress),_=xu(i),x={};for(const L in i){const{originalEvent:O}=i[L];this._eventsInProgress[L]||(x[`${L}start`]=O),this._eventsInProgress[L]=i[L]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in x)this._fireEvent(L,x[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in i){const{originalEvent:O}=i[L];this._fireEvent(L,O)}const T={};let M;for(const L in this._eventsInProgress){const{handlerName:O,originalEvent:F}=this._eventsInProgress[L];this._handlersById[O].isActive()||(delete this._eventsInProgress[L],M=o[O]||F,T[`${L}end`]=M)}for(const L in T)this._fireEvent(L,T[L]);const I=xu(this._eventsInProgress);if(h&&(p||_)&&!I){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;L?(O(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:M})):(this._map.fire(new s.b("moveend",{originalEvent:M})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,o){this._map.fire(new s.b(i,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Dp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const kp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class vn extends s.E{constructor(i,o){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,s.aY(["_renderFrameCallback"],this)}getCenter(){return new s.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(i,o){return this.jumpTo({center:i},o)}panBy(i,o,h){return i=s.P.convert(i).mult(-1),this.panTo(this.transform.center,s.e({offset:i},o),h)}panTo(i,o,h){return this.easeTo(s.e({center:i},o),h)}getZoom(){return this.transform.zoom}setZoom(i,o){return this.jumpTo({zoom:i},o),this}zoomTo(i,o,h){return this.easeTo(s.e({zoom:i},o),h)}zoomIn(i,o){return this.zoomTo(this.getZoom()+1,i,o),this}zoomOut(i,o){return this.zoomTo(this.getZoom()-1,i,o),this}getBearing(){return this.transform.bearing}setBearing(i,o){return this.jumpTo({bearing:i},o),this}getPadding(){return this.transform.padding}setPadding(i,o){return this.jumpTo({padding:i},o),this}rotateTo(i,o,h){return this.easeTo(s.e({bearing:i},o),h)}resetNorth(i,o){return this.rotateTo(0,s.e({duration:1e3},i),o),this}resetNorthPitch(i,o){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},i),o),this}snapToNorth(i,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,o):this}getPitch(){return this.transform.pitch}setPitch(i,o){return this.jumpTo({pitch:i},o),this}cameraForBounds(i,o){i=s.ad.convert(i);const h=o&&o.bearing||0,p=o&&o.pitch||0,_=i.getNorthWest(),x=i.getSouthEast();return this._cameraForBounds(this.transform,_,x,h,p,o)}_extendCameraOptions(i){const o={top:0,bottom:0,right:0,left:0};if(typeof(i=s.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const h=i.padding;i.padding={top:h,bottom:h,right:h,left:h}}return i.padding=s.e(o,i.padding),i}_minimumAABBFrustumDistance(i,o){const h=o.max[0]-o.min[0],p=o.max[1]-o.min[1];return h/p>i.aspect?h/(2*Math.tan(.5*i.fovX)*i.aspect):p/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,o,h,p,_,x){const T=i.clone(),M=this._extendCameraOptions(x);T.bearing=p,T.pitch=_;const I=s.bn.convert(o),L=s.bn.convert(h),O=.5*(I.lat+L.lat),F=.5*(I.lng+L.lng),N=s.d2(O,F),q=s.N.normalize([],N),$=s.N.normalize([],s.N.cross([],q,[0,1,0])),Z=s.N.cross([],$,q),V=[$[0],$[1],$[2],0,Z[0],Z[1],Z[2],0,q[0],q[1],q[2],0,0,0,0,1],X=[N,s.d2(I.lat,I.lng),s.d2(L.lat,I.lng),s.d2(L.lat,L.lng),s.d2(I.lat,L.lng),s.d2(O,I.lng),s.d2(O,L.lng),s.d2(I.lat,F),s.d2(L.lat,F)];let ne=s.bS.fromPoints(X.map(Le=>[s.N.dot($,Le),s.N.dot(Z,Le),s.N.dot(q,Le)]));const J=s.N.transformMat4([],ne.center,V);s.N.squaredLength(J)===0&&s.N.set(J,0,0,1),s.N.normalize(J,J),s.N.scale(J,J,s.ab),T.center=s.d3(J);const oe=T.getWorldToCameraMatrix(),H=s.a6.invert(new Float64Array(16),oe);ne=s.bS.applyTransform(ne,s.a6.multiply([],oe,V)),s.N.transformMat4(J,J,oe);const ae=.5*(ne.max[2]-ne.min[2]),he=this._minimumAABBFrustumDistance(T,ne),fe=s.N.scale([],[0,0,1],ae),ye=s.N.add(fe,J,fe),De=he+(T.pitch===0?0:s.N.distance(J,ye)),Te=T.globeCenterInViewSpace,$e=s.N.sub([],J,[Te[0],Te[1],Te[2]]);s.N.normalize($e,$e),s.N.scale($e,$e,De);const je=s.N.add([],J,$e);s.N.transformMat4(je,je,H);const it=s.d4/s.ab,Ae=s.N.length(je),Be=s.bl(Math.max(Ae*it-s.d4,Number.EPSILON),0),_e=Math.min(T.zoomFromMercatorZAdjusted(Be),M.maxZoom);return _e>.5*(s.bG+s.bx)?(T.setProjection({name:"mercator"}),T.zoom=_e,this._cameraForBounds(T,o,h,p,_,x)):{center:T.center,zoom:_e,bearing:p,pitch:_}}queryTerrainElevation(i,o){const h=this.transform.elevation;return h?(o=s.e({},{exaggerated:!0},o),h.getAtPoint(s.L.fromLngLat(i),null,o.exaggerated)):null}_cameraForBounds(i,o,h,p,_,x){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,o,h,p,_,x);const T=i.clone(),M=this._extendCameraOptions(x),I=T.padding;T.bearing=p,T.pitch=_;const L=s.bn.convert(o),O=s.bn.convert(h),F=new s.bn(L.lng,O.lat),N=new s.bn(O.lng,L.lat),q=T.project(L),$=T.project(O),Z=this.queryTerrainElevation(L),V=this.queryTerrainElevation(O),X=this.queryTerrainElevation(F),ne=this.queryTerrainElevation(N),J=[[q.x,q.y,Math.min(Z||0,V||0,X||0,ne||0)],[$.x,$.y,Math.max(Z||0,V||0,X||0,ne||0)]];let oe=s.bS.fromPoints(J);const H=T.getWorldToCameraMatrix(),ae=s.a6.invert(new Float64Array(16),H);oe=s.bS.applyTransform(oe,H);const he=s.N.sub([],oe.max,oe.min),fe=I.left||0,ye=I.right||0,De=I.bottom||0,Te=I.top||0,{left:$e,right:je,top:it,bottom:Ae}=M.padding,Be=.5*(fe+ye),_e=.5*(Te+De),Le=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(fe+ye+$e+je))/he[0],(T.height-(De+Te+Ae+it))/he[1])),M.maxZoom),ot=T.scale/T.zoomScale(Le);oe=new s.bS([oe.min[0]-($e+Be)*ot,oe.min[1]-(Ae+_e)*ot,oe.min[2]],[oe.max[0]+(je+Be)*ot,oe.max[1]+(it+_e)*ot,oe.max[2]]);const vt=.5*he[2],_t=this._minimumAABBFrustumDistance(T,oe),Ot=[0,0,1,0];s.a7.transformMat4(Ot,Ot,H),s.a7.normalize(Ot,Ot);const Kt=s.N.scale([],Ot,_t+vt),ur=s.N.add([],oe.center,Kt),tr=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new s.P(M.offset.x,M.offset.y):s.P.convert(M.offset)).rotate(-s.bj(p));oe.center[0]-=tr.x*ot,oe.center[1]+=tr.y*ot,s.N.transformMat4(oe.center,oe.center,ae),s.N.transformMat4(ur,ur,ae);const ar=[oe.center[0],oe.center[1],ur[2]*T.pixelsPerMeter];s.N.scale(ar,ar,1/T.worldSize);const Br=s.at(ar[0]),Mr=s.au(ar[1]),Or=Math.min(T._zoomFromMercatorZ(ar[2]),M.maxZoom),Lr=new s.bn(Br,Mr);return T.mercatorFromTransition&&Or<.5*(s.bG+s.bx)?(T.setProjection({name:"globe"}),T.zoom=Or,this._cameraForBounds(T,o,h,p,_,x)):{center:Lr,zoom:Or,bearing:p,pitch:_}}fitBounds(i,o,h){const p=this.cameraForBounds(i,o);return this._fitInternal(p,o,h)}fitScreenCoordinates(i,o,h,p,_){const x=s.P.convert(i),T=s.P.convert(o),M=new s.P(Math.min(x.x,T.x),Math.min(x.y,T.y)),I=new s.P(Math.max(x.x,T.x),Math.max(x.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,T))return this;const L=this.transform.pointLocation3D(M),O=this.transform.pointLocation3D(I),F=this.transform.pointLocation3D(new s.P(M.x,I.y)),N=this.transform.pointLocation3D(new s.P(I.x,M.y)),q=[Math.min(L.lng,O.lng,F.lng,N.lng),Math.min(L.lat,O.lat,F.lat,N.lat)],$=[Math.max(L.lng,O.lng,F.lng,N.lng),Math.max(L.lat,O.lat,F.lat,N.lat)],Z=p&&p.pitch?p.pitch:this.getPitch(),V=this._cameraForBounds(this.transform,q,$,h,Z,p);return this._fitInternal(V,p,_)}_fitInternal(i,o,h){return i?(delete(o=s.e(i,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(i,o){this.stop();const h=i.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,x=!1;return"zoom"in i&&h.zoom!==+i.zoom&&(p=!0,h.zoom=+i.zoom),i.center!==void 0&&(h.center=s.bn.convert(i.center)),"bearing"in i&&h.bearing!==+i.bearing&&(_=!0,h.bearing=+i.bearing),"pitch"in i&&h.pitch!==+i.pitch&&(x=!0,h.pitch=+i.pitch),i.padding==null||h.isPaddingEqual(i.padding)||(h.padding=i.padding),i.preloadOnly?(this._preloadTiles(h),this):(this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),p&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),_&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),x&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(kp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,o){const h=this.transform;if(!h.projection.supportsFreeCamera)return s.w(kp),this;this.stop();const p=h.zoom,_=h.pitch,x=h.bearing;h.setFreeCameraOptions(i);const T=p!==h.zoom,M=_!==h.pitch,I=x!==h.bearing;return this.fire(new s.b("movestart",o)).fire(new s.b("move",o)),T&&this.fire(new s.b("zoomstart",o)).fire(new s.b("zoom",o)).fire(new s.b("zoomend",o)),I&&this.fire(new s.b("rotatestart",o)).fire(new s.b("rotate",o)).fire(new s.b("rotateend",o)),M&&this.fire(new s.b("pitchstart",o)).fire(new s.b("pitch",o)).fire(new s.b("pitchend",o)),this.fire(new s.b("moveend",o)),this}easeTo(i,o){this._stop(!1,i.easeId),((i=s.e({offset:[0,0],duration:500,easing:s.d0},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const h=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),T=this.getPadding(),M="zoom"in i?+i.zoom:p,I="bearing"in i?this._normalizeBearing(i.bearing,_):_,L="pitch"in i?+i.pitch:x,O="padding"in i?i.padding:h.padding,F=s.P.convert(i.offset);let N,q,$;if(h.projection.name==="globe"){const fe=s.L.fromLngLat(h.center),ye=F.rotate(-h.angle);fe.x+=ye.x/h.worldSize,fe.y+=ye.y/h.worldSize;const De=fe.toLngLat(),Te=s.bn.convert(i.center||De);this._normalizeCenter(Te),N=h.centerPoint.add(ye),q=new s.P(fe.x,fe.y).mult(h.worldSize),$=new s.P(s.a5(Te.lng),s.ae(Te.lat)).mult(h.worldSize).sub(q)}else{N=h.centerPoint.add(F);const fe=h.pointLocation(N),ye=s.bn.convert(i.center||fe);this._normalizeCenter(ye),q=h.project(fe),$=h.project(ye).sub(q)}const Z=h.zoomScale(M-p);let V,X;i.around&&(V=s.bn.convert(i.around),X=h.locationPoint(V));const ne=this._zooming||M!==p,J=this._rotating||_!==I,oe=this._pitching||L!==x,H=!h.isPaddingEqual(O),ae=fe=>ye=>{if(ne&&(fe.zoom=s.U(p,M,ye)),J&&(fe.bearing=s.U(_,I,ye)),oe&&(fe.pitch=s.U(x,L,ye)),H&&(fe.interpolatePadding(T,O,ye),N=fe.centerPoint.add(F)),V)fe.setLocationAtPoint(V,X);else{const De=fe.zoomScale(fe.zoom-p),Te=M>p?Math.min(2,Z):Math.max(.5,Z),$e=Math.pow(Te,1-ye),je=fe.unproject(q.add($.mult(ye*$e)).mult(De));fe.setLocationAtPoint(fe.renderWorldCopies?je.wrap():je,N)}return i.preloadOnly||this._fireMoveEvents(o),fe};if(i.preloadOnly){const fe=this._emulate(ae,i.duration,h);return this._preloadTiles(fe),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=J,this._pitching=oe,this._easeId=i.easeId,this._prepareEase(o,i.noMoveStart,he),this._ease(ae(h),fe=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(o,fe)},i),this}_prepareEase(i,o,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||h.moving||this.fire(new s.b("movestart",i)),this._zooming&&!h.zooming&&this.fire(new s.b("zoomstart",i)),this._rotating&&!h.rotating&&this.fire(new s.b("rotatestart",i)),this._pitching&&!h.pitching&&this.fire(new s.b("pitchstart",i))}_fireMoveEvents(i){this.fire(new s.b("move",i)),this._zooming&&this.fire(new s.b("zoom",i)),this._rotating&&this.fire(new s.b("rotate",i)),this._pitching&&this.fire(new s.b("pitch",i))}_afterEase(i,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,h&&this.fire(new s.b("zoomend",i)),p&&this.fire(new s.b("rotateend",i)),_&&this.fire(new s.b("pitchend",i)),this.fire(new s.b("moveend",i))}flyTo(i,o){if(this._prefersReducedMotion(i)){const Ae=s.ac(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ae,o)}this.stop(),i=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.d0},i);const h=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),T="zoom"in i?s.aa(+i.zoom,h.minZoom,h.maxZoom):p,M="bearing"in i?this._normalizeBearing(i.bearing,_):_,I="pitch"in i?+i.pitch:x,L=h.zoomScale(T-p),O=s.P.convert(i.offset),F=h.centerPoint.add(O),N=h.pointLocation(F);let q=i.center;if(q&&i.padding){const Ae=this._cameraForBounds(this.transform,q,q,M,I,i);Ae&&(q=Ae.center)}q=s.bn.convert(q||N),this._normalizeCenter(q);const $=h.project(N),Z=h.project(q).sub($);let V=i.curve;const X=Math.max(h.width,h.height),ne=X/L,J=Z.mag();if("minZoom"in i){const Ae=s.aa(Math.min(i.minZoom,p,T),h.minZoom,h.maxZoom),Be=X/h.zoomScale(Ae-p);V=Math.sqrt(Be/J*2)}const oe=V*V;function H(Ae){const Be=(ne*ne-X*X+(Ae?-1:1)*oe*oe*J*J)/(2*(Ae?ne:X)*oe*J);return Math.log(Math.sqrt(Be*Be+1)-Be)}function ae(Ae){return(Math.exp(Ae)-Math.exp(-Ae))/2}function he(Ae){return(Math.exp(Ae)+Math.exp(-Ae))/2}const fe=H(0);let ye=function(Ae){return he(fe)/he(fe+V*Ae)},De=function(Ae){return X*((he(fe)*(ae(Be=fe+V*Ae)/he(Be))-ae(fe))/oe)/J;var Be},Te=(H(1)-fe)/V;if(Math.abs(J)<1e-6||!isFinite(Te)){if(Math.abs(X-ne)<1e-6)return this.easeTo(i,o);const Ae=ne<X?-1:1;Te=Math.abs(Math.log(ne/X))/V,De=function(){return 0},ye=function(Be){return Math.exp(Ae*V*Be)}}i.duration="duration"in i?+i.duration:1e3*Te/("screenSpeed"in i?+i.screenSpeed/V:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const $e=_!==M,je=I!==x,it=Ae=>Be=>{const _e=Be*Te,Le=1/ye(_e);Ae.zoom=Be===1?T:p+Ae.scaleZoom(Le),$e&&(Ae.bearing=s.U(_,M,Be)),je&&(Ae.pitch=s.U(x,I,Be));const ot=Be===1?q:Ae.unproject($.add(Z.mult(De(_e))).mult(Le));return Ae.setLocationAtPoint(Ae.renderWorldCopies?ot.wrap():ot,F),Ae._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),Ae};if(i.preloadOnly){const Ae=this._emulate(it,i.duration,h);return this._preloadTiles(Ae),this}return this._zooming=!0,this._rotating=$e,this._pitching=je,this._prepareEase(o,!1),this._ease(it(h),()=>this._afterEase(o),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,o)}if(!i){const h=this.handlers;h&&h.stop(!1)}return this}_ease(i,o,h){h.animate===!1||h.duration===0?(i(1),o()):(this._easeStart=s.f.now(),this._easeOptions=h,this._onEaseFrame=i,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((s.f.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,o){i=s.bh(i,-180,180);const h=Math.abs(i-o);return Math.abs(i-360-o)<h&&(i-=360),Math.abs(i+360-o)<h&&(i+=360),i}_normalizeCenter(i){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const h=i.lng-o.center.lng;i.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&s.f.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,o,h){const p=Math.ceil(15*o/1e3),_=[],x=i(h.clone());for(let T=0;T<=p;T++){const M=x(T/p);_.push(M.clone())}return _}}class Wd{constructor(i={}){this.options=i,s.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const o=this.options&&this.options.compact;return this._map=i,this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ee("button","mapboxgl-ctrl-attrib-button",this._container),Ee("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ee("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,o){const h=this._map._getUIString(`AttributionControl.${o}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.d5.ACCESS_TOKEN}];if(i){const h=o.reduce((p,_,x)=>(_.value&&(p+=`${_.key}=${_.value}${x<o.length-1?"&":""}`),p),"?");i.href=`${s.d5.FEEDBACK_URL}/${h}#${Fd(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const o=this._map.style._mergedSourceCaches;for(const p in o){const _=o[p];if(_.used){const x=_.getSource();x.attribution&&i.indexOf(x.attribution)<0&&i.push(x.attribution)}}i.sort((p,_)=>p.length-_.length),i=i.filter((p,_)=>{for(let x=_+1;x<i.length;x++)if(i[x].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const h=i.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,i.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fp{constructor(){s.aY(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Ee("div","mapboxgl-ctrl");const o=Ee("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const o in i){const h=i[o].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const o=i[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Bp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const o=++this._id;return this._queue.push({callback:i,id:o,cancelled:!1}),o}remove(i){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const p of h)if(p.id===i)return void(p.cancelled=!0)}run(i=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function wu(u,i,o){if(u=new s.bn(u.lng,u.lat),i){const h=new s.bn(u.lng-360,u.lat),p=new s.bn(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-o.center.lng)/360),x=o.locationPoint(u).distSqr(i),T=i.x<0||i.y<0||i.x>o.width||i.y>o.height;o.locationPoint(h).distSqr(i)<x&&(T||Math.abs(h.lng-o.center.lng)<_)?u=h:o.locationPoint(p).distSqr(i)<x&&(T||Math.abs(p.lng-o.center.lng)<_)&&(u=p)}for(;Math.abs(u.lng-o.center.lng)>180;){const h=o.locationPoint(u);if(h.x>=0&&h.y>=0&&h.x<=o.width&&h.y<=o.height)break;u.lng>o.center.lng?u.lng-=360:u.lng+=360}return u}const gh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Xd extends s.E{constructor(i,o){if(super(),(i instanceof HTMLElement||o)&&(i=s.e({element:i},o)),s.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=s.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ee("div");const _=41,x=27,T=Me("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),M=Me("radialGradient",{id:"shadowGradient"},Me("defs",{},T));Me("stop",{offset:"10%","stop-opacity":.4},M),Me("stop",{offset:"100%","stop-opacity":.05},M),Me("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),Me("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),Me("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),Me("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=s.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const h=this._element.classList;for(const _ in gh)h.remove(`mapboxgl-marker-anchor-${_}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=i&&i.className?i.className.trim().split(/\s+/):[];h.add(...p),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=s.bn.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const o=i.code,h=i.charCode||i.keyCode;o!=="Space"&&o!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(i){const o=i.originalEvent.target,h=this._element;this._popup&&(o===h||h.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,o=this._pos;if(!i||!o)return!1;const h=i.unproject(o),p=i.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(h)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const o=this._pos;if(!o||o.x<0||o.x>i.transform.width||o.y<0||o.y>i.transform.height)return void this._clearFadeTimer();const h=i.unproject(o);let p;i._showingGlobe()&&s.d6(i.transform,this._lngLat)?p=0:(p=1-i._queryFogOpacity(h),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${gh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const i=this._pos,o=this._map,h=this.getPitchAlignment();if(!o||!i||h!=="map")return"";if(!o._showingGlobe()){const M=o.getPitch();return M?`rotateX(${M}deg)`:""}const p=s.bF(s.d7(o.transform,this._lngLat)),_=i.sub(s.d8(o.transform)),x=Math.abs(_.x)+Math.abs(_.y);if(x===0)return"";const T=p/x;return`rotateX(${-_.y*T}deg) rotateY(${_.x*T}deg)`}_calculateZTransform(){const i=this._pos,o=this._map;if(!o||!i)return"";let h=0;const p=this.getRotationAlignment();if(p==="map")if(o._showingGlobe()){const _=o.project(new s.bn(this._lngLat.lng,this._lngLat.lat+.001)),x=o.project(new s.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);h=s.bF(Math.atan2(x.y,x.x))-90}else h=-o.getBearing();else if(p==="horizon"){const _=s.O(4,6,o.getZoom()),x=s.d8(o.transform);x.y+=_*o.transform.height;const T=i.sub(x),M=s.bF(Math.atan2(T.y,T.x));h=(M>90?M-270:M+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=wu(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=s.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const o=this._map;if(!o)return;const h=this._pointerdownPos,p=this._positionDelta;if(h&&p){if(!this._isDragging){const _=this._clickTolerance||o._clickTolerance;if(i.point.dist(h)<_)return;this._isDragging=!0}this._pos=i.point.sub(p),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.b("dragstart"))),this.fire(new s.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.b("dragend")),this._state="inactive"}_addDragHandler(i){const o=this._map,h=this._pos;o&&h&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(h),this._pointerdownPos=i.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const o=this._map;return o&&(i?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Np={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Up=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jp(u=new s.P(0,0),i="bottom"){if(typeof u=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(i){case"top":return new s.P(0,u);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-u);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(u,0);case"right":return new s.P(-u,0)}return new s.P(0,0)}return u instanceof s.P||Array.isArray(u)?s.P.convert(u):s.P.convert(u[i]||[0,0])}class Yd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const o=s.cc((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,o,h){this._start=this.getValue(o),this._end=i,this._startTime=o,this._endTime=o+h}}const Tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Vp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class Kd{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const yh={showCompass:!0,showZoom:!0,visualizePitch:!1};class xa{constructor(i,o,h=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new mu({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,h&&(this.mousePitch=new mh({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),s.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(i,o){this.mouseRotate.mousedown(i,o),this.mousePitch&&this.mousePitch.mousedown(i,o),$t()}move(i,o){const h=this.map,p=this.mouseRotate.mousemoveWindow(i,o),_=p&&p.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const x=this.mousePitch.mousemoveWindow(i,o),T=x&&x.pitchDelta;T&&h.setPitch(h.getPitch()+T)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){It(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(s.e({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),hr(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,hr(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ai(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Ai(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Io={maxWidth:100,unit:"metric"},Ka={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.dk,supported:Q,setRTLTextPlugin:s.dm,getRTLTextPluginStatus:s.dn,Map:class extends vn{constructor(u){const i=u;if((u=s.e({},Vp,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&s.d9(window)&&(u.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Mn(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!1,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Bp,this._domRenderTaskQueue=new Bp,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.aC(),this._locale=s.e({},Tu,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.da(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?{...u.contextCreateOptions}:{},typeof u.container=="string"){const o=document.getElementById(u.container);if(!o)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=o}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),s.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new Kd,this._tp=u.devtools?new cu(this):new cu,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,o=>{this.repaint=o}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,o=>{this.showTileAABBs=o}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,o=>{this.showPadding=o}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new K_(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||s.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),u.hash&&(this._hash=new dh(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const o=u.bounds;o&&(this.resize(),this.fitBounds(o,s.e({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Wd({customAttribution:u.customAttribution})),this._logoControl=new Fp,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.b(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.b(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(u,i){if(i===void 0&&(i=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new s.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[i];return i.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new s.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(u);return i>-1&&this._controls.splice(i,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new s.b("movestart",u)).fire(new s.b("move",u)),this.fire(new s.b("resize",u)),i&&this.fire(new s.b("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(s.ad.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new s.b("zoomstart")).fire(new s.b("zoom")).fire(new s.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new s.b("pitchstart")).fire(new s.b("pitch")).fire(new s.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(i=>i==="auto"?navigator.language:i):u}setLanguage(u){const i=this._parseLanguage(u);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,i=u.projection.name;let o;i==="globe"&&u.zoom>=s.bx?(u.setMercatorFromTransition(),o=!0):i==="mercator"&&u.zoom<s.bx&&(u.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,i){return this._updateProjection(u||i||{name:"mercator"})}_updateProjection(u){let i;return i=u.name==="globe"&&this.transform.zoom>=s.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(s.bn.convert(u))}unproject(u){return this.transform.pointLocation3D(s.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,i,o){if(u==="mouseenter"||u==="mouseover"){let h=!1;const p=x=>{const T=i.filter(I=>this.getLayer(I)),M=T.length?this.queryRenderedFeatures(x.point,{layers:T}):[];M.length?h||(h=!0,o.call(this,new zo(u,this,x.originalEvent,{features:M}))):h=!1},_=()=>{h=!1};return{layers:new Set(i),listener:o,delegates:{mousemove:p,mouseout:_}}}if(u==="mouseleave"||u==="mouseout"){let h=!1;const p=x=>{const T=i.filter(M=>this.getLayer(M));(T.length?this.queryRenderedFeatures(x.point,{layers:T}):[]).length?h=!0:h&&(h=!1,o.call(this,new zo(u,this,x.originalEvent)))},_=x=>{h&&(h=!1,o.call(this,new zo(u,this,x.originalEvent)))};return{layers:new Set(i),listener:o,delegates:{mousemove:p,mouseout:_}}}{const h=p=>{const _=i.filter(T=>this.getLayer(T)),x=_.length?this.queryRenderedFeatures(p.point,{layers:_}):[];x.length&&(p.features=x,o.call(this,p),delete p.features)};return{layers:new Set(i),listener:o,delegates:{[u]:h}}}}on(u,i,o){if(o===void 0)return super.on(u,i);if(Array.isArray(i)||(i=[i]),i){for(const p of i)if(!this._isValidId(p))return this}const h=this._createDelegatedListener(u,i,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(u,i,o){if(o===void 0)return super.once(u,i);if(Array.isArray(i)||(i=[i]),i){for(const p of i)if(!this._isValidId(p))return this}const h=this._createDelegatedListener(u,i,o);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(u,i,o){if(o===void 0)return super.off(u,i);i=new Set(Array.isArray(i)?i:[i]);for(const _ of i)if(!this._isValidId(_))return this;const h=(_,x)=>{if(_.size!==x.size)return!1;for(const T of _)if(!x.has(T))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[u]:void 0;return p&&(_=>{for(let x=0;x<_.length;x++){const T=_[x];if(T.listener===o&&h(T.layers,i)){for(const M in T.delegates)this.off(M,T.delegates[M]);return _.splice(x,1),this}}})(p),this}queryRenderedFeatures(u,i){if(!this.style)return[];if(i!==void 0||u===void 0||u instanceof s.P||Array.isArray(u)||(i=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const o of i.layers)if(!this._isValidId(o))return[]}return this.style.queryRenderedFeatures(u,i,this.transform)}querySourceFeatures(u,i){return this._isValidId(u)?this.style.querySourceFeatures(u,i):[]}isPointOnSurface(u){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&s.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(u))}setStyle(u,i){return(i=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(u,i))}_getUIString(u){const i=this._locale[u];if(i==null)throw new Error(`Missing UI string '${u}'`);return i}_updateStyle(u,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new Do(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Do(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,i){if(typeof u=="string"){const o=this._requestManager.normalizeStyleURL(u),h=this._requestManager.transformRequest(o,s.R.Style);s.g(h,(p,_)=>{p?this.fire(new s.a(p)):_&&this._updateDiff(_,i)})}else typeof u=="object"&&this._updateDiff(u,i)}_updateDiff(u,i){try{this.style.setState(u)&&this._update(!0)}catch(o){s.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(u,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new s.a(new Error("IDs can't be empty."))),!1):!s.c4(u)||(this.fire(new s.a(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}addSource(u,i){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,i),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,i,o){this._lazyInitEmptyStyle(),this.style.addSourceType(u,i,o)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,i,{pixelRatio:o=1,sdf:h=!1,stretchX:p,stretchY:_,content:x}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:T,height:M,data:I}=s.f.getImageData(i);this.style.addImage(u,{data:new s.h({width:T,height:M},I),pixelRatio:o,stretchX:p,stretchY:_,content:x,sdf:h,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new s.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:M}=i,I=i;this.style.addImage(u,{data:new s.h({width:T,height:M},new Uint8Array(I.data)),pixelRatio:o,stretchX:p,stretchY:_,content:x,sdf:h,version:0,userImage:I}),I.onAdd&&I.onAdd(this,u)}}updateImage(u,i){this._lazyInitEmptyStyle();const o=this.style.getImage(u);if(!o)return void this.fire(new s.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?s.f.getImageData(i):i,{width:p,height:_}=h,x=h.data;if(p===void 0||_===void 0)return void this.fire(new s.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==o.data.width||_!==o.data.height)return void this.fire(new s.a(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const T=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);o.data.replace(x,T),this.style.updateImage(u,o)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new s.a(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,i){s.d(this._requestManager.transformRequest(u,s.R.Image),(o,h)=>{i(o,h instanceof HTMLImageElement?s.f.getImageData(h):h)})}listImages(){return this.style.listImages()}addModel(u,i){this._lazyInitEmptyStyle(),this.style.addModel(u,i)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new s.a(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,i){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,i),this._update(!0)):this}getSlot(u){const i=this.getLayer(u);return i&&i.slot||null}setSlot(u,i){return this.style.setSlot(u,i),this.style.mergeLayers(),this._update(!0)}addImport(u,i){return this.style.addImport(u,i),this}updateImport(u,i){return typeof i!="string"&&i.id!==u?(this.removeImport(u),this.addImport(i)):(this.style.updateImport(u,i),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,i){return this.style.moveImport(u,i),this._update(!0)}moveLayer(u,i){return this._isValidId(u)?(this.style.moveLayer(u,i),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){return this._isValidId(u)?this.style.getOwnLayer(u):null}setLayerZoomRange(u,i,o){return this._isValidId(u)?(this.style.setLayerZoomRange(u,i,o),this._update(!0)):this}setFilter(u,i,o={}){return this._isValidId(u)?(this.style.setFilter(u,i,o),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,i,o,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,i,o,h),this._update(!0)):this}getPaintProperty(u,i){return this._isValidId(u)?this.style.getPaintProperty(u,i):null}setLayoutProperty(u,i,o,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,i,o,h),this._update(!0)):this}getLayoutProperty(u,i){return this._isValidId(u)?this.style.getLayoutProperty(u,i):null}getConfigProperty(u,i){return this.style.getConfigProperty(u,i)}setConfigProperty(u,i,o){return this.style.setConfigProperty(u,i,o),this._update(!0)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const i=u[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.bn.convert(u),this.transform):0}setFeatureState(u,i){return this._isValidId(u.source)?(this.style.setFeatureState(u,i),this._update()):this}removeFeatureState(u,i){return this._isValidId(u.source)?(this.style.removeFeatureState(u,i),this._update()):this}getFeatureState(u){return this._isValidId(u.source)?this.style.getFeatureState(u):null}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let o,h,p,_=this._container;for(;_&&(!h||!p);){const x=window.getComputedStyle(_).transform;x&&x!=="none"&&(o=x.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(h=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(p=o[3])),_=_.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=p?Math.abs(i/p):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ee("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Ee("div","mapboxgl-canvas-container",u);this._canvas=Ee("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=Ee("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{h[p]=Ee("div",`mapboxgl-ctrl-${p}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,i){const o=s.f.devicePixelRatio||1;this._canvas.width=o*Math.ceil(u),this._canvas.height=o*Math.ceil(i),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${i}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const i=this._markers.indexOf(u);i!==-1&&this._markers.splice(i,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const i=this._popups.indexOf(u);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const u=s.e({},Q.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",u);i?(s.db(i,!0),this.painter=new Mp(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.dc.testSupport(i)):this.fire(new s.a(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.b("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new s.b("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let i;this.fire(new s.b("renderstart"));const o=this.painter.context.extTimerQuery,h=s.f.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=p.createQuery(),p.beginQuery(o.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,I=this.transform.pitch,L=s.f.now(),O=new s.K(M,{now:L,fadeDuration:_,pitch:I,transition:this.style.transition});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const M=s.f.now()-h;p.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const I=p.getQueryParameter(i,p.QUERY_RESULT)/1e6;p.deleteQuery(i),this.fire(new s.b("gpu-timing-frame",{cpuTime:M,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(M);this.fire(new s.b("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(M);this.fire(new s.b("gpu-timing-deferred-render",{gpuTime:I}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new s.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new s.b("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const i of this._markers)u&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!u||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(u,i=!1){const o=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(i||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=u;const x=Math.abs(p-_);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(_),o(_);this._averageElevation.easeTo(_,u,300)}else if(x>1e-4)return this._averageElevation.jumpTo(_),o(_)}return!!this._averageElevation.isEasing(u)&&o(this._averageElevation.getValue(u))}_authenticate(){s.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===s.df||u.status===401)){const i=this.painter.context.gl;s.db(i,!1),this._logoControl instanceof Fp&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const o=this.painter.context.gl,h=o.createFramebuffer();function p(_){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,_,0);const x=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,x),x}return o.bindFramebuffer(o.FRAMEBUFFER,h),this._canvasPixelComparison(p(u),i.canvasCopies.map(p),i.timeStamps)}_canvasPixelComparison(u,i,o){let h=o[1]-o[0];const p=u.length/4;for(let _=0;_<i.length;_++){const x=i[_];let T=0;for(let M=0;M<x.length;M+=4)x[M]===u[M]&&x[M+1]===u[M+1]&&x[M+2]===u[M+2]&&x[M+3]===u[M+3]&&(T+=1);h+=(o[_+2]-o[_+1])*(1-T/p)}return h}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.dh(this.painter.context.gl),s.di.remove(),s.dj.remove(),this._removed=!0,this.fire(new s.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=s.f.frame(i=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(i)}))}_preloadTiles(u){const i=this.style?Object.values(this.style._sourceCaches):[];return s.b1(i,(o,h)=>o._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,i){s.dl(u,i)}get version(){return s.dk}},NavigationControl:class{constructor(u){this.options=s.e({},yh,u),this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(s.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Ee("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Ee("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:i}):o.resetNorth({},{originalEvent:i}))}),this._compassIcon=Ee("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const i=u.getZoom(),o=i===u.getMaxZoom(),h=i===u.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xa(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,i){const o=Ee("button",u,this._container);return o.type="button",o.addEventListener("click",i),o}_setButtonTitle(u,i){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${i}`);u.setAttribute("aria-label",o),u.firstElementChild&&u.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(u){super();const i=navigator.geolocation;this.options=s.e({geolocation:i},vh,u),s.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=hu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const i=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,u(o)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>i(o.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(u){const i=this._map.getMaxBounds(),o=u.coords;return!!i&&(o.longitude<i.getWest()||o.longitude>i.getEast()||o.latitude<i.getSouth()||o.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new s.b("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("geolocate",u)),this._finish()}}_updateCamera(u){const i=new s.bn(u.coords.longitude,u.coords.latitude),o=u.coords.accuracy,h=this._map.getBearing(),p=s.e({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(o),p,{geolocateSource:!0})}_updateMarker(u){if(u){const i=new s.bn(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,i=s.bl(1,u._center.lat)*u.worldSize,o=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.b("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Ee("button","mapboxgl-ctrl-geolocate",this._container),Ee("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ee("div","mapboxgl-user-location"),this._dotElement.appendChild(Ee("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ee("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ee("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.b("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wd,ScaleControl:class{constructor(u){this.options=s.e({},Io,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,i=this._map,o=i._containerHeight/2,h=i._containerWidth/2-u/2,p=i.unproject([h,o]),_=i.unproject([h+u,o]),x=p.distanceTo(_);if(this.options.unit==="imperial"){const T=3.2808*x;T>5280?this._setScale(u,T/5280,"mile"):this._setScale(u,T,"foot")}else this.options.unit==="nautical"?this._setScale(u,x/1852,"nautical-mile"):x>=1e3?this._setScale(u,x/1e3,"kilometer"):this._setScale(u,x,"meter")}_setScale(u,i,o){this._map._requestDomTask(()=>{const h=function(_){const x=Math.pow(10,`${Math.floor(_)}`.length-1);let T=_/x;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(M){const I=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*I)/I}(T),x*T}(i),p=h/i;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(h):`${h}&nbsp;${Ka[o]}`,this._container.style.width=u*p+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:s.w("Full screen control 'container' must be a DOM element.")),s.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=Ee("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ee("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(u){super(),this.options=s.e(Object.create(Np),u),s.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new s.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new s.b("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=s.bn.convert(u),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const i=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=u;h=o.firstChild,h;)i.appendChild(h);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Ee("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(u),this.options.closeButton){const o=this._closeButton=Ee("button","mapboxgl-popup-close-button",i);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let i;return this._classList.delete(u)?i=!1:(this._classList.add(u),i=!0),this._updateClassList(),i}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const i=this._map,o=this._container,h=this._pos;if(!i||!o||!h)return"bottom";const p=o.offsetWidth,_=o.offsetHeight,x=h.x<p/2,T=h.x>i.transform.width-p/2;if(h.y+u<_)return x?"top-left":T?"top-right":"top";if(h.y>i.transform.height-_){if(x)return"bottom-left";if(T)return"bottom-right"}return x?"left":T?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),u.className=i.join(" ")}_update(u){const i=this._map,o=this._content;if(!i||!this._lngLat&&!this._trackPointer||!o)return;let h=this._container;if(h||(h=this._container=Ee("div","mapboxgl-popup",i.getContainer()),this._tip=Ee("div","mapboxgl-popup-tip",h),h.appendChild(o)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wu(this._lngLat,this._pos,i.transform)),!this._trackPointer||u){const p=this._pos=this._trackPointer&&u?u:i.project(this._lngLat),_=jp(this.options.offset),x=this._anchor=this._getAnchor(_.y),T=jp(this.options.offset,x),M=p.add(T).round();i._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${gh[x]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&i._showingGlobe()){const p=s.d6(i.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Up);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Xd,Style:Do,LngLat:s.bn,LngLatBounds:s.ad,Point:s.P,MercatorCoordinate:s.L,FreeCameraOptions:mi,Evented:s.E,config:s.d5,prewarm:s.dp,clearPrewarmedResources:s.dq,get accessToken(){return s.d5.ACCESS_TOKEN},set accessToken(u){s.d5.ACCESS_TOKEN=u},get baseApiUrl(){return s.d5.API_URL},set baseApiUrl(u){s.d5.API_URL=u},get workerCount(){return s.dr.workerCount},set workerCount(u){s.dr.workerCount=u},get maxParallelImageRequests(){return s.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){s.d5.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){s.ds(u)},get workerUrl(){return s.dt.workerUrl},set workerUrl(u){s.dt.workerUrl=u},get workerClass(){return s.dt.workerClass},set workerClass(u){s.dt.workerClass=u},get workerParams(){return s.dt.workerParams},set workerParams(u){s.dt.workerParams=u},get dracoUrl(){return s.du()},set dracoUrl(u){s.dv(u)},get meshoptUrl(){return s.dw()},set meshoptUrl(u){s.dx(u)},setNow:s.f.setNow,restoreNow:s.f.restoreNow}});var j=P;return j})})(HE);var A0=HE.exports;const cl=np(A0);var td=x3,v3=Object.prototype.hasOwnProperty;function x3(){for(var l={},f=0;f<arguments.length;f++){var g=arguments[f];for(var b in g)v3.call(g,b)&&(l[b]=g[b])}return l}var XE={exports:{}};(function(l,f){(function(){var g={};l.exports=g,g.simpleFilter=function(b,E){return E.filter(function(P){return g.test(b,P)})},g.test=function(b,E){return g.match(b,E)!==null},g.match=function(b,E,P){P=P||{};var z=0,j=[],s=E.length,K=0,Q=0,re=P.pre||"",we=P.post||"",Ee=P.caseSensitive&&E||E.toLowerCase(),Me;b=P.caseSensitive&&b||b.toLowerCase();for(var Ce=0;Ce<s;Ce++)Me=E[Ce],Ee[Ce]===b[z]?(Me=re+Me+we,z+=1,Q+=1+Q):Q=0,K+=Q,j[j.length]=Me;return z===b.length?(K=Ee===b?1/0:K,{rendered:j.join(""),score:K}):null},g.filter=function(b,E,P){return!E||E.length===0?[]:typeof b!="string"?E:(P=P||{},E.reduce(function(z,j,s,K){var Q=j;P.extract&&(Q=P.extract(j));var re=g.match(b,Q,P);return re!=null&&(z[z.length]={string:re.rendered,score:re.score,index:s,original:j}),z},[]).sort(function(z,j){var s=j.score-z.score;return s||z.index-j.index}))}})()})(XE);var b3=XE.exports,Ts=function(l){return this.component=l,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,l.el.parentNode.insertBefore(this.wrapper,l.el.nextSibling),this};Ts.prototype.show=function(){this.element.style.display="block"};Ts.prototype.hide=function(){this.element.style.display="none"};Ts.prototype.add=function(l){this.items.push(l)};Ts.prototype.clear=function(){this.items=[],this.active=0};Ts.prototype.isEmpty=function(){return!this.items.length};Ts.prototype.isVisible=function(){return this.element.style.display==="block"};Ts.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var l=0;l<this.items.length;l++)this.drawItem(this.items[l],this.active===l);this.show()};Ts.prototype.drawItem=function(l,f){var g=document.createElement("li"),b=document.createElement("a");f&&(g.className+=" active"),b.innerHTML=l.string,g.appendChild(b),this.element.appendChild(g),g.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),g.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,l)}).bind(this))};Ts.prototype.handleMouseUp=function(l){this.selectingListItem=!1,this.component.value(l.original),this.clear(),this.draw()};Ts.prototype.move=function(l){this.active=l,this.draw()};Ts.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Ts.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Ts.prototype.drawError=function(l){var f=document.createElement("li");f.innerHTML=l,this.element.appendChild(f),this.show()};var w3=Ts,T3=td,E3=b3,S3=w3,Jo=function(l,f,g){return g=g||{},this.options=T3({minLength:2,limit:5,filter:!0,hideOnBlur:!0},g),this.el=l,this.data=f||[],this.list=new S3(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(b){this.handleKeyUp(b.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(b){this.handleKeyDown(b)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(b){this.handlePaste(b)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Jo.prototype.handleKeyUp=function(l){l===40||l===38||l===27||l===13||l===9||this.handleInputChange(this.el.value)};Jo.prototype.handleKeyDown=function(l){switch(l.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&l.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Jo.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Jo.prototype.handlePaste=function(l){if(l.clipboardData)this.handleInputChange(l.clipboardData.getData("Text"));else{var f=this;setTimeout(function(){f.handleInputChange(l.target.value)},100)}};Jo.prototype.handleInputChange=function(l){if(this.query=this.normalize(l),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(f){for(var g=0;g<f.length&&(this.list.add(f[g]),g!==this.options.limit-1);g++);this.list.draw()}).bind(this))};Jo.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Jo.prototype.update=function(l){this.data=l,this.handleKeyUp()};Jo.prototype.clear=function(){this.data=[],this.list.clear()};Jo.prototype.normalize=function(l){return l=l.toLowerCase(),l};Jo.prototype.match=function(l,f){return l.indexOf(f)>-1};Jo.prototype.value=function(l){if(this.selected=l,this.el.value=this.getItemValue(l),document.createEvent){var f=document.createEvent("HTMLEvents");f.initEvent("change",!0,!1),this.el.dispatchEvent(f)}else this.el.fireEvent("onchange")};Jo.prototype.getCandidates=function(l){var f={pre:"<strong>",post:"</strong>",extract:(function(b){return this.getItemValue(b)}).bind(this)},g;this.options.filter?(g=E3.filter(this.query,this.data,f),g=g.map((function(b){return{original:b.original,string:this.render(b.original,b.string)}}).bind(this))):g=this.data.map((function(b){var E=this.render(b);return{original:b,string:E}}).bind(this)),l(g)};Jo.prototype.getItemValue=function(l){return l};Jo.prototype.render=function(l,f){if(f)return f;for(var g=l.original?this.getItemValue(l.original):this.getItemValue(l),b=this.normalize(g),E=b.lastIndexOf(this.query);E>-1;){var P=E+this.query.length;g=g.slice(0,E)+"<strong>"+g.slice(E,P)+"</strong>"+g.slice(P),E=b.slice(0,E).lastIndexOf(this.query)}return g};Jo.prototype.renderError=function(l){this.list.drawError(l)};var M3=Jo,YE=M3,A3=YE;typeof window<"u"&&(window.Suggestions=YE);var I3="Expected a function",Zw=NaN,C3="[object Symbol]",P3=/^\s+|\s+$/g,L3=/^[-+]0x[0-9a-f]+$/i,R3=/^0b[01]+$/i,O3=/^0o[0-7]+$/i,D3=parseInt,z3=typeof so=="object"&&so&&so.Object===Object&&so,k3=typeof self=="object"&&self&&self.Object===Object&&self,F3=z3||k3||Function("return this")(),B3=Object.prototype,N3=B3.toString,U3=Math.max,j3=Math.min,Ry=function(){return F3.Date.now()};function V3(l,f,g){var b,E,P,z,j,s,K=0,Q=!1,re=!1,we=!0;if(typeof l!="function")throw new TypeError(I3);f=Hw(f)||0,r0(g)&&(Q=!!g.leading,re="maxWait"in g,P=re?U3(Hw(g.maxWait)||0,f):P,we="trailing"in g?!!g.trailing:we);function Ee(hr){var Ai=b,Ii=E;return b=E=void 0,K=hr,z=l.apply(Ii,Ai),z}function Me(hr){return K=hr,j=setTimeout(lt,f),Q?Ee(hr):z}function Ce(hr){var Ai=hr-s,Ii=hr-K,dt=f-Ai;return re?j3(dt,P-Ii):dt}function Ue(hr){var Ai=hr-s,Ii=hr-K;return s===void 0||Ai>=f||Ai<0||re&&Ii>=P}function lt(){var hr=Ry();if(Ue(hr))return $t(hr);j=setTimeout(lt,Ce(hr))}function $t(hr){return j=void 0,we&&b?Ee(hr):(b=E=void 0,z)}function It(){j!==void 0&&clearTimeout(j),K=0,b=s=E=j=void 0}function yr(){return j===void 0?z:$t(Ry())}function zr(){var hr=Ry(),Ai=Ue(hr);if(b=arguments,E=this,s=hr,Ai){if(j===void 0)return Me(s);if(re)return j=setTimeout(lt,f),Ee(s)}return j===void 0&&(j=setTimeout(lt,f)),z}return zr.cancel=It,zr.flush=yr,zr}function r0(l){var f=typeof l;return!!l&&(f=="object"||f=="function")}function G3(l){return!!l&&typeof l=="object"}function $3(l){return typeof l=="symbol"||G3(l)&&N3.call(l)==C3}function Hw(l){if(typeof l=="number")return l;if($3(l))return Zw;if(r0(l)){var f=typeof l.valueOf=="function"?l.valueOf():l;l=r0(f)?f+"":f}if(typeof l!="string")return l===0?l:+l;l=l.replace(P3,"");var g=R3.test(l);return g||O3.test(l)?D3(l.slice(2),g?2:8):L3.test(l)?Zw:+l}var q3=V3,I0={exports:{}},Zh=typeof Reflect=="object"?Reflect:null,Ww=Zh&&typeof Zh.apply=="function"?Zh.apply:function(f,g,b){return Function.prototype.apply.call(f,g,b)},Qm;Zh&&typeof Zh.ownKeys=="function"?Qm=Zh.ownKeys:Object.getOwnPropertySymbols?Qm=function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:Qm=function(f){return Object.getOwnPropertyNames(f)};function Z3(l){console&&console.warn&&console.warn(l)}var KE=Number.isNaN||function(f){return f!==f};function wn(){wn.init.call(this)}I0.exports=wn;I0.exports.once=Y3;wn.EventEmitter=wn;wn.prototype._events=void 0;wn.prototype._eventsCount=0;wn.prototype._maxListeners=void 0;var Xw=10;function P_(l){if(typeof l!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}Object.defineProperty(wn,"defaultMaxListeners",{enumerable:!0,get:function(){return Xw},set:function(l){if(typeof l!="number"||l<0||KE(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");Xw=l}});wn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wn.prototype.setMaxListeners=function(f){if(typeof f!="number"||f<0||KE(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this};function JE(l){return l._maxListeners===void 0?wn.defaultMaxListeners:l._maxListeners}wn.prototype.getMaxListeners=function(){return JE(this)};wn.prototype.emit=function(f){for(var g=[],b=1;b<arguments.length;b++)g.push(arguments[b]);var E=f==="error",P=this._events;if(P!==void 0)E=E&&P.error===void 0;else if(!E)return!1;if(E){var z;if(g.length>0&&(z=g[0]),z instanceof Error)throw z;var j=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw j.context=z,j}var s=P[f];if(s===void 0)return!1;if(typeof s=="function")Ww(s,this,g);else for(var K=s.length,Q=iS(s,K),b=0;b<K;++b)Ww(Q[b],this,g);return!0};function QE(l,f,g,b){var E,P,z;if(P_(g),P=l._events,P===void 0?(P=l._events=Object.create(null),l._eventsCount=0):(P.newListener!==void 0&&(l.emit("newListener",f,g.listener?g.listener:g),P=l._events),z=P[f]),z===void 0)z=P[f]=g,++l._eventsCount;else if(typeof z=="function"?z=P[f]=b?[g,z]:[z,g]:b?z.unshift(g):z.push(g),E=JE(l),E>0&&z.length>E&&!z.warned){z.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(f)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=l,j.type=f,j.count=z.length,Z3(j)}return l}wn.prototype.addListener=function(f,g){return QE(this,f,g,!1)};wn.prototype.on=wn.prototype.addListener;wn.prototype.prependListener=function(f,g){return QE(this,f,g,!0)};function H3(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function eS(l,f,g){var b={fired:!1,wrapFn:void 0,target:l,type:f,listener:g},E=H3.bind(b);return E.listener=g,b.wrapFn=E,E}wn.prototype.once=function(f,g){return P_(g),this.on(f,eS(this,f,g)),this};wn.prototype.prependOnceListener=function(f,g){return P_(g),this.prependListener(f,eS(this,f,g)),this};wn.prototype.removeListener=function(f,g){var b,E,P,z,j;if(P_(g),E=this._events,E===void 0)return this;if(b=E[f],b===void 0)return this;if(b===g||b.listener===g)--this._eventsCount===0?this._events=Object.create(null):(delete E[f],E.removeListener&&this.emit("removeListener",f,b.listener||g));else if(typeof b!="function"){for(P=-1,z=b.length-1;z>=0;z--)if(b[z]===g||b[z].listener===g){j=b[z].listener,P=z;break}if(P<0)return this;P===0?b.shift():W3(b,P),b.length===1&&(E[f]=b[0]),E.removeListener!==void 0&&this.emit("removeListener",f,j||g)}return this};wn.prototype.off=wn.prototype.removeListener;wn.prototype.removeAllListeners=function(f){var g,b,E;if(b=this._events,b===void 0)return this;if(b.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):b[f]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete b[f]),this;if(arguments.length===0){var P=Object.keys(b),z;for(E=0;E<P.length;++E)z=P[E],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(g=b[f],typeof g=="function")this.removeListener(f,g);else if(g!==void 0)for(E=g.length-1;E>=0;E--)this.removeListener(f,g[E]);return this};function tS(l,f,g){var b=l._events;if(b===void 0)return[];var E=b[f];return E===void 0?[]:typeof E=="function"?g?[E.listener||E]:[E]:g?X3(E):iS(E,E.length)}wn.prototype.listeners=function(f){return tS(this,f,!0)};wn.prototype.rawListeners=function(f){return tS(this,f,!1)};wn.listenerCount=function(l,f){return typeof l.listenerCount=="function"?l.listenerCount(f):rS.call(l,f)};wn.prototype.listenerCount=rS;function rS(l){var f=this._events;if(f!==void 0){var g=f[l];if(typeof g=="function")return 1;if(g!==void 0)return g.length}return 0}wn.prototype.eventNames=function(){return this._eventsCount>0?Qm(this._events):[]};function iS(l,f){for(var g=new Array(f),b=0;b<f;++b)g[b]=l[b];return g}function W3(l,f){for(;f+1<l.length;f++)l[f]=l[f+1];l.pop()}function X3(l){for(var f=new Array(l.length),g=0;g<f.length;++g)f[g]=l[g].listener||l[g];return f}function Y3(l,f){return new Promise(function(g,b){function E(z){l.removeListener(f,P),b(z)}function P(){typeof l.removeListener=="function"&&l.removeListener("error",E),g([].slice.call(arguments))}nS(l,f,P,{once:!0}),f!=="error"&&K3(l,E,{once:!0})})}function K3(l,f,g){typeof l.on=="function"&&nS(l,"error",f,g)}function nS(l,f,g,b){if(typeof l.on=="function")b.once?l.once(f,g):l.on(f,g);else if(typeof l.addEventListener=="function")l.addEventListener(f,function E(P){b.once&&l.removeEventListener(f,E),g(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l)}var J3=I0.exports,Q3={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function ez(l){var f=l.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return f?{key:f[1],value:f[2]}:null}function tz(l){var f=l.match(/<?([^>]*)>(.*)/);if(!f)return null;var g=f[1],b=f[2].split(";"),E=null,P=b.reduce(function(z,j){var s=ez(j);return s?s.key==="rel"?(E||(E=s.value),z):(z[s.key]=s.value,z):z},{});return E?{url:g,rel:E,params:P}:null}function rz(l){return l?l.split(/,\s*</).reduce(function(f,g){var b=tz(g);if(!b)return f;var E=b.rel.split(/\s+/);return E.forEach(function(P){f[P]||(f[P]={url:b.url,params:b.params})}),f},{}):{}}var iz=rz,nz=iz;function C0(l,f){this.request=l,this.headers=f.headers,this.rawBody=f.body,this.statusCode=f.statusCode;try{this.body=JSON.parse(f.body||"{}")}catch{this.body=f.body}this.links=nz(this.headers.link)}C0.prototype.hasNextPage=function(){return!!this.links.next};C0.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var oz=C0,L_={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},Yw=L_;function sz(l){var f=l.type||Yw.ERROR_HTTP,g;if(l.body)try{g=JSON.parse(l.body)}catch{g=l.body}else g=null;var b=l.message||null;b||(typeof g=="string"?b=g:g&&typeof g.message=="string"?b=g.message:f===Yw.ERROR_REQUEST_ABORTED&&(b="Request aborted")),this.message=b,this.type=f,this.statusCode=l.statusCode||null,this.request=l.request,this.body=g}var az=sz;function lz(l){var f=l.indexOf(":"),g=l.substring(0,f).trim().toLowerCase(),b=l.substring(f+1).trim();return{name:g,value:b}}function cz(l){var f={};return l&&l.trim().split(/[\r|\n]+/).forEach(function(g){var b=lz(g);f[b.name]=b.value}),f}var uz=cz,hz=oz,Kw=az,Oy=L_,dz=uz,a_={};function fz(l){var f=a_[l.id];f&&(f.abort(),delete a_[l.id])}function pz(l,f){return new hz(l,{body:f.response,headers:dz(f.getAllResponseHeaders()),statusCode:f.status})}function Jw(l){var f=l.total,g=l.loaded,b=100*g/f;return{total:f,transferred:g,percent:b}}function oS(l,f){return new Promise(function(g,b){f.onprogress=function(z){l.emitter.emit(Oy.EVENT_PROGRESS_DOWNLOAD,Jw(z))};var E=l.file;E&&(f.upload.onprogress=function(z){l.emitter.emit(Oy.EVENT_PROGRESS_UPLOAD,Jw(z))}),f.onerror=function(z){b(z)},f.onabort=function(){var z=new Kw({request:l,type:Oy.ERROR_REQUEST_ABORTED});b(z)},f.onload=function(){if(delete a_[l.id],f.status<200||f.status>=400){var z=new Kw({request:l,body:f.response,statusCode:f.status});b(z);return}g(f)};var P=l.body;typeof P=="string"?f.send(P):P?f.send(JSON.stringify(P)):E?f.send(E):f.send(),a_[l.id]=f}).then(function(g){return pz(l,g)})}function sS(l,f){var g=l.url(f),b=new window.XMLHttpRequest;return b.open(l.method,g),Object.keys(l.headers).forEach(function(E){b.setRequestHeader(E,l.headers[E])}),b}function mz(l){return Promise.resolve().then(function(){var f=sS(l,l.client.accessToken);return oS(l,f)})}var _z={browserAbort:fz,sendRequestXhr:oS,browserSend:mz,createRequestXhr:sS},l_={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */l_.exports;(function(l,f){(function(g){var b=f,E=l&&l.exports==b&&l,P=typeof so=="object"&&so;(P.global===P||P.window===P)&&(g=P);var z=function(Me){this.message=Me};z.prototype=new Error,z.prototype.name="InvalidCharacterError";var j=function(Me){throw new z(Me)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",K=/[\t\n\f\r ]/g,Q=function(Me){Me=String(Me).replace(K,"");var Ce=Me.length;Ce%4==0&&(Me=Me.replace(/==?$/,""),Ce=Me.length),(Ce%4==1||/[^+a-zA-Z0-9/]/.test(Me))&&j("Invalid character: the string to be decoded is not correctly encoded.");for(var Ue=0,lt,$t,It="",yr=-1;++yr<Ce;)$t=s.indexOf(Me.charAt(yr)),lt=Ue%4?lt*64+$t:$t,Ue++%4&&(It+=String.fromCharCode(255&lt>>(-2*Ue&6)));return It},re=function(Me){Me=String(Me),/[^\0-\xFF]/.test(Me)&&j("The string to be encoded contains characters outside of the Latin1 range.");for(var Ce=Me.length%3,Ue="",lt=-1,$t,It,yr,zr,hr=Me.length-Ce;++lt<hr;)$t=Me.charCodeAt(lt)<<16,It=Me.charCodeAt(++lt)<<8,yr=Me.charCodeAt(++lt),zr=$t+It+yr,Ue+=s.charAt(zr>>18&63)+s.charAt(zr>>12&63)+s.charAt(zr>>6&63)+s.charAt(zr&63);return Ce==2?($t=Me.charCodeAt(lt)<<8,It=Me.charCodeAt(++lt),zr=$t+It,Ue+=s.charAt(zr>>10)+s.charAt(zr>>4&63)+s.charAt(zr<<2&63)+"="):Ce==1&&(zr=Me.charCodeAt(lt),Ue+=s.charAt(zr>>2)+s.charAt(zr<<4&63)+"=="),Ue},we={encode:re,decode:Q,version:"0.1.0"};if(b&&!b.nodeType)if(E)E.exports=we;else for(var Ee in we)we.hasOwnProperty(Ee)&&(b[Ee]=we[Ee]);else g.base64=we})(so)})(l_,l_.exports);var gz=l_.exports,yz=gz,Dy={};function vz(l){if(Dy[l])return Dy[l];var f=l.split("."),g=f[0],b=f[1];if(!b)throw new Error("Invalid token");var E=xz(b),P={usage:g,user:E.u};return Fu(E,"a")&&(P.authorization=E.a),Fu(E,"exp")&&(P.expires=E.exp*1e3),Fu(E,"iat")&&(P.created=E.iat*1e3),Fu(E,"scopes")&&(P.scopes=E.scopes),Fu(E,"client")&&(P.client=E.client),Fu(E,"ll")&&(P.lastLogin=E.ll),Fu(E,"iu")&&(P.impersonator=E.iu),Dy[l]=P,P}function xz(l){try{return JSON.parse(yz.decode(l))}catch{throw new Error("Invalid token")}}function Fu(l,f){return Object.prototype.hasOwnProperty.call(l,f)}var aS=vz,lS={exports:{}};(function(l){var f=Object.prototype.hasOwnProperty,g="~";function b(){}Object.create&&(b.prototype=Object.create(null),new b().__proto__||(g=!1));function E(s,K,Q){this.fn=s,this.context=K,this.once=Q||!1}function P(s,K,Q,re,we){if(typeof Q!="function")throw new TypeError("The listener must be a function");var Ee=new E(Q,re||s,we),Me=g?g+K:K;return s._events[Me]?s._events[Me].fn?s._events[Me]=[s._events[Me],Ee]:s._events[Me].push(Ee):(s._events[Me]=Ee,s._eventsCount++),s}function z(s,K){--s._eventsCount===0?s._events=new b:delete s._events[K]}function j(){this._events=new b,this._eventsCount=0}j.prototype.eventNames=function(){var K=[],Q,re;if(this._eventsCount===0)return K;for(re in Q=this._events)f.call(Q,re)&&K.push(g?re.slice(1):re);return Object.getOwnPropertySymbols?K.concat(Object.getOwnPropertySymbols(Q)):K},j.prototype.listeners=function(K){var Q=g?g+K:K,re=this._events[Q];if(!re)return[];if(re.fn)return[re.fn];for(var we=0,Ee=re.length,Me=new Array(Ee);we<Ee;we++)Me[we]=re[we].fn;return Me},j.prototype.listenerCount=function(K){var Q=g?g+K:K,re=this._events[Q];return re?re.fn?1:re.length:0},j.prototype.emit=function(K,Q,re,we,Ee,Me){var Ce=g?g+K:K;if(!this._events[Ce])return!1;var Ue=this._events[Ce],lt=arguments.length,$t,It;if(Ue.fn){switch(Ue.once&&this.removeListener(K,Ue.fn,void 0,!0),lt){case 1:return Ue.fn.call(Ue.context),!0;case 2:return Ue.fn.call(Ue.context,Q),!0;case 3:return Ue.fn.call(Ue.context,Q,re),!0;case 4:return Ue.fn.call(Ue.context,Q,re,we),!0;case 5:return Ue.fn.call(Ue.context,Q,re,we,Ee),!0;case 6:return Ue.fn.call(Ue.context,Q,re,we,Ee,Me),!0}for(It=1,$t=new Array(lt-1);It<lt;It++)$t[It-1]=arguments[It];Ue.fn.apply(Ue.context,$t)}else{var yr=Ue.length,zr;for(It=0;It<yr;It++)switch(Ue[It].once&&this.removeListener(K,Ue[It].fn,void 0,!0),lt){case 1:Ue[It].fn.call(Ue[It].context);break;case 2:Ue[It].fn.call(Ue[It].context,Q);break;case 3:Ue[It].fn.call(Ue[It].context,Q,re);break;case 4:Ue[It].fn.call(Ue[It].context,Q,re,we);break;default:if(!$t)for(zr=1,$t=new Array(lt-1);zr<lt;zr++)$t[zr-1]=arguments[zr];Ue[It].fn.apply(Ue[It].context,$t)}}return!0},j.prototype.on=function(K,Q,re){return P(this,K,Q,re,!1)},j.prototype.once=function(K,Q,re){return P(this,K,Q,re,!0)},j.prototype.removeListener=function(K,Q,re,we){var Ee=g?g+K:K;if(!this._events[Ee])return this;if(!Q)return z(this,Ee),this;var Me=this._events[Ee];if(Me.fn)Me.fn===Q&&(!we||Me.once)&&(!re||Me.context===re)&&z(this,Ee);else{for(var Ce=0,Ue=[],lt=Me.length;Ce<lt;Ce++)(Me[Ce].fn!==Q||we&&!Me[Ce].once||re&&Me[Ce].context!==re)&&Ue.push(Me[Ce]);Ue.length?this._events[Ee]=Ue.length===1?Ue[0]:Ue:z(this,Ee)}return this},j.prototype.removeAllListeners=function(K){var Q;return K?(Q=g?g+K:K,this._events[Q]&&z(this,Q)):(this._events=new b,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=g,j.EventEmitter=j,l.exports=j})(lS);var bz=lS.exports;function wz(l){return l.map(encodeURIComponent).join(",")}function cS(l){return Array.isArray(l)?wz(l):encodeURIComponent(String(l))}function uS(l,f,g){if(g===!1||g===null)return l;var b=/\?/.test(l)?"&":"?",E=encodeURIComponent(f);return g!==void 0&&g!==""&&g!==!0&&(E+="="+cS(g)),""+l+b+E}function Tz(l,f){if(!f)return l;var g=l;return Object.keys(f).forEach(function(b){var E=f[b];E!==void 0&&(Array.isArray(E)&&(E=E.filter(function(P){return P!=null}).join(",")),g=uS(g,b,E))}),g}function Ez(l,f){if(!f||l.slice(0,4)==="http")return l;var g=l[0]==="/"?"":"/";return""+f.replace(/\/$/,"")+g+l}function Sz(l,f){return f?l.replace(/\/:([a-zA-Z0-9]+)/g,function(g,b){var E=f[b];if(E===void 0)throw new Error("Unspecified route parameter "+b);var P=cS(E);return"/"+P}):l}var Mz={appendQueryObject:Tz,appendQueryParam:uS,prependOrigin:Ez,interpolateRouteParams:Sz},Az=aS,P0=td,Iz=bz,Zm=Mz,Qw=L_,Cz=1;function Nc(l,f){if(!l)throw new Error("MapiRequest requires a client");if(!f||!f.path||!f.method)throw new Error("MapiRequest requires an options object with path and method properties");var g={};f.body&&(g["content-type"]="application/json");var b=P0(g,f.headers),E=Object.keys(b).reduce(function(P,z){return P[z.toLowerCase()]=b[z],P},{});this.id=Cz++,this._options=f,this.emitter=new Iz,this.client=l,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=f.path,this.method=f.method,this.origin=f.origin||l.origin,this.query=f.query||{},this.params=f.params||{},this.body=f.body||null,this.file=f.file||null,this.encoding=f.encoding||"utf8",this.sendFileAs=f.sendFileAs||null,this.headers=E}Nc.prototype.url=function(f){var g=Zm.prependOrigin(this.path,this.origin);g=Zm.appendQueryObject(g,this.query);var b=this.params,E=f??this.client.accessToken;if(E){g=Zm.appendQueryParam(g,"access_token",E);var P=Az(E).user;b=P0({ownerId:P},b)}return g=Zm.interpolateRouteParams(g,b),g};Nc.prototype.send=function(){var f=this;if(f.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return f.sent=!0,f.client.sendRequest(f).then(function(g){return f.response=g,f.emitter.emit(Qw.EVENT_RESPONSE,g),g},function(g){throw f.error=g,f.emitter.emit(Qw.EVENT_ERROR,g),g})};Nc.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Nc.prototype.eachPage=function(f){var g=this;function b(z){function j(){delete g._nextPageRequest;var s=z.nextPage();s&&(g._nextPageRequest=s,P(s))}f(null,z,j)}function E(z){f(z,null,function(){})}function P(z){z.send().then(b,E)}P(this)};Nc.prototype.clone=function(){return this._extend()};Nc.prototype._extend=function(f){var g=P0(this._options,f);return new Nc(this.client,g)};var Pz=Nc,Lz=aS,Rz=Pz,Oz=L_;function hS(l){if(!l||!l.accessToken)throw new Error("Cannot create a client without an access token");Lz(l.accessToken),this.accessToken=l.accessToken,this.origin=l.origin||Oz.API_ORIGIN}hS.prototype.createRequest=function(f){return new Rz(this,f)};var dS=hS,fS=_z,pS=dS;function Jh(l){pS.call(this,l)}Jh.prototype=Object.create(pS.prototype);Jh.prototype.constructor=Jh;Jh.prototype.sendRequest=fS.browserSend;Jh.prototype.abortRequest=fS.browserAbort;function Dz(l){return new Jh(l)}var mS=Dz,zz=mS,kz=zz,Fz=Object.prototype.toString,Bz=function(l){var f;return Fz.call(l)==="[object Object]"&&(f=Object.getPrototypeOf(l),f===null||f===Object.getPrototypeOf({}))},Nz=Bz,Uz=td,_S="value",zy=`
  `,Rn={};Rn.assert=function(l,f){return f=f||{},function(g){var b=Uc(l,g);if(b){var E=L0(b,f);throw f.apiName&&(E=f.apiName+": "+E),new Error(E)}}};Rn.shape=function(f){var g=$z(f);return function(E){var P=Uc(Rn.plainObject,E);if(P)return P;for(var z,j,s=[],K=0;K<g.length;K++)z=g[K].key,j=g[K].value,P=Uc(j,E[z]),P&&s.push([z].concat(P));return s.length<2?s[0]:function(Q){s=s.map(function(Ee){var Me=Ee[0],Ce=L0(Ee,Q).split(`
`).join(zy);return"- "+Me+": "+Ce});var re=Q.path.join("."),we=re===_S?"":" of "+re;return"The following properties"+we+" have invalid values:"+zy+s.join(zy)}}};Rn.strictShape=function(f){var g=Rn.shape(f);return function(E){var P=g(E);if(P)return P;var z=Object.keys(E).reduce(function(j,s){return f[s]===void 0&&j.push(s),j},[]);if(z.length!==0)return function(){return"The following keys are invalid: "+z.join(", ")}}};Rn.arrayOf=function(f){return gS(f)};Rn.tuple=function(){var f=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return gS(f)};function gS(l){var f=Array.isArray(l),g=function(b){return f?l[b]:l};return function(E){var P=Uc(Rn.plainArray,E);if(P)return P;if(f&&E.length!==l.length)return"an array with "+l.length+" items";for(var z=0;z<E.length;z++)if(P=Uc(g(z),E[z]),P)return[z].concat(P)}}Rn.required=function(f){function g(b){return b==null?function(E){return yS(E,vS(E.path)?"cannot be undefined/null.":"is required.")}:f.apply(this,arguments)}return g.__required=!0,g};Rn.oneOfType=function(){var f=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(b){var E=f.map(function(P){return Uc(P,b)}).filter(Boolean);if(E.length===f.length)return E.every(function(P){return P.length===1&&typeof P[0]=="string"})?jz(E.map(function(P){return P[0]})):E.reduce(function(P,z){return z.length>P.length?z:P})}};Rn.equal=function(f){return function(b){if(b!==f)return JSON.stringify(f)}};Rn.oneOf=function(){var f=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),g=f.map(function(b){return Rn.equal(b)});return Rn.oneOfType.apply(this,g)};Rn.range=function(f){var g=f[0],b=f[1];return function(P){var z=Uc(Rn.number,P);if(z||P<g||P>b)return"number between "+g+" & "+b+" (inclusive)"}};Rn.any=function(){};Rn.boolean=function(f){if(typeof f!="boolean")return"boolean"};Rn.number=function(f){if(typeof f!="number")return"number"};Rn.plainArray=function(f){if(!Array.isArray(f))return"array"};Rn.plainObject=function(f){if(!Nz(f))return"object"};Rn.string=function(f){if(typeof f!="string")return"string"};Rn.func=function(f){if(typeof f!="function")return"function"};function Uc(l,f){if(!(f==null&&!l.hasOwnProperty("__required"))){var g=l(f);if(g)return Array.isArray(g)?g:[g]}}function L0(l,f){var g=l.length,b=l[g-1],E=l.slice(0,g-1);return E.length===0&&(E=[_S]),f=Uz(f,{path:E}),typeof b=="function"?b(f):yS(f,Vz(b))}function jz(l){return l.length<2?l[0]:l.length===2?l.join(" or "):l.slice(0,-1).join(", ")+", or "+l.slice(-1)}function Vz(l){return"must be "+Gz(l)+"."}function Gz(l){return/^an? /.test(l)?l:/^[aeiou]/i.test(l)?"an "+l:/^[a-z]/i.test(l)?"a "+l:l}function yS(l,f){var g=vS(l.path),b=l.path.join(".")+" "+f,E=g?"Item at position ":"";return E+b}function vS(l){return typeof l[l.length-1]=="number"||typeof l[0]=="number"}function $z(l){return Object.keys(l||{}).map(function(f){return{key:f,value:l[f]}})}Rn.validate=Uc;Rn.processMessage=L0;var qz=Rn,Zz=td,Hh=qz;function Hz(l){if(typeof window<"u")return l instanceof so.Blob||l instanceof so.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof l=="string"||l.pipe!==void 0))return"Filename or Readable stream"}function Wz(l,f){return Hh.assert(Hh.strictShape(l),f)}function Xz(l){var f="date";if(typeof l=="boolean")return f;try{var g=new Date(l);if(g.getTime&&isNaN(g.getTime()))return f}catch{return f}}function Yz(l){return Hh.tuple(Hh.number,Hh.number)(l)}var Kz=Zz(Hh,{file:Hz,date:Xz,coordinates:Yz,assertShape:Wz});function Jz(l,f){var g=function(b,E){return f.indexOf(b)!==-1&&E!==void 0};return typeof f=="function"&&(g=f),Object.keys(l).filter(function(b){return g(b,l[b])}).reduce(function(b,E){return b[E]=l[E],b},{})}var Qz=Jz;function ek(l,f){return Object.keys(l).reduce(function(g,b){return g[b]=f(b,l[b]),g},{})}var tk=ek,rk=tk;function ik(l){return rk(l,function(f,g){return typeof g=="boolean"?JSON.stringify(g):g})}var nk=ik,ok=dS,sk=mS;function ak(l){return function(f){var g;ok.prototype.isPrototypeOf(f)?g=f:g=sk(f);var b=Object.create(l);return b.client=g,b}}var lk=ak,xS=td,Gi=Kz,c_=Qz,bS=nk,ck=lk,R0={},wS=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];R0.forwardGeocode=function(l){Gi.assertShape({query:Gi.required(Gi.string),mode:Gi.oneOf("mapbox.places","mapbox.places-permanent"),countries:Gi.arrayOf(Gi.string),proximity:Gi.oneOf(Gi.coordinates,"ip"),types:Gi.arrayOf(Gi.oneOf(wS)),autocomplete:Gi.boolean,bbox:Gi.arrayOf(Gi.number),limit:Gi.number,language:Gi.arrayOf(Gi.string),routing:Gi.boolean,fuzzyMatch:Gi.boolean,worldview:Gi.string})(l),l.mode=l.mode||"mapbox.places";var f=bS(xS({country:l.countries},c_(l,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:c_(l,["mode","query"]),query:f})};R0.reverseGeocode=function(l){Gi.assertShape({query:Gi.required(Gi.coordinates),mode:Gi.oneOf("mapbox.places","mapbox.places-permanent"),countries:Gi.arrayOf(Gi.string),types:Gi.arrayOf(Gi.oneOf(wS)),bbox:Gi.arrayOf(Gi.number),limit:Gi.number,language:Gi.arrayOf(Gi.string),reverseMode:Gi.oneOf("distance","score"),routing:Gi.boolean,worldview:Gi.string})(l),l.mode=l.mode||"mapbox.places";var f=bS(xS({country:l.countries},c_(l,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:c_(l,["mode","query"]),query:f})};var uk=ck(R0);let hk="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",TS=l=>crypto.getRandomValues(new Uint8Array(l)),ES=(l,f,g)=>{let b=(2<<Math.log(l.length-1)/Math.LN2)-1,E=-~(1.6*b*f/l.length);return(P=f)=>{let z="";for(;;){let j=g(E),s=E;for(;s--;)if(z+=l[j[s]&b]||"",z.length===P)return z}}},dk=(l,f=21)=>ES(l,f,TS),fk=(l=21)=>crypto.getRandomValues(new Uint8Array(l)).reduce((f,g)=>(g&=63,g<36?f+=g.toString(36):g<62?f+=(g-26).toString(36).toUpperCase():g>62?f+="-":f+="_",f),"");const pk=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:dk,customRandom:ES,nanoid:fk,random:TS,urlAlphabet:hk},Symbol.toStringTag,{value:"Module"})),mk=NO(pk);var _k=mk.nanoid;function SS(l){this.origin=l.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=l.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=l,this.send=this.send.bind(this),this.countries=l.countries?l.countries.split(","):null,this.types=l.types?l.types.split(","):null,this.bbox=l.bbox?l.bbox:null,this.language=l.language?l.language.split(","):null,this.limit=l.limit?+l.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(l),this.eventQueue=new Array,this.flushInterval=l.flushInterval||1e3,this.maxQueueSize=l.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}SS.prototype={select:function(l,f){var g=this.getSelectedIndex(l,f),b=this.getEventPayload("search.select",f);if(b.resultIndex=g,b.resultPlaceName=l.place_name,b.resultId=l.id,!(g===this.lastSentIndex&&b.queryString===this.lastSentInput||g==-1)&&(this.lastSentIndex=g,this.lastSentInput=b.queryString,!!b.queryString))return this.push(b)},start:function(l){var f=this.getEventPayload("search.start",l);if(f.queryString)return this.push(f)},keyevent:function(l,f){if(l.key&&!(l.metaKey||[9,27,37,39,13,38,40].indexOf(l.keyCode)!==-1)){var g=this.getEventPayload("search.keystroke",f);if(g.lastAction=l.key,!!g.queryString)return this.push(g)}},send:function(l,f){if(!this.enableEventLogging)return f?f():void 0;var g=this.getRequestOptions(l);this.request(g,(function(b){if(b)return this.handleError(b,f);if(f)return f()}).bind(this))},getRequestOptions:function(l){Array.isArray(l)||(l=[l]);var f={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)};return f},getEventPayload:function(l,f){var g;f.options.proximity?typeof f.options.proximity=="object"?g=[f.options.proximity.longitude,f.options.proximity.latitude]:f.options.proximity==="ip"?g=[999,999]:g=f.options.proximity:g=null;var b=f._map?f._map.getZoom():void 0,E={event:l,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:f.options.autocomplete,fuzzyMatch:f.options.fuzzyMatch,proximity:g,limit:f.options.limit,routing:f.options.routing,worldview:f.options.worldview,mapZoom:b,keyboardLocale:this.locale};return l==="search.select"?E.queryString=f.inputString:l!="search.select"&&f._inputEl?E.queryString=f._inputEl.value:E.queryString=f.inputString,E},request:function(l,f){var g=new XMLHttpRequest;g.onreadystatechange=function(){if(this.readyState==4)return this.status==204?f(null):f(this.statusText)},g.open(l.method,l.host+"/"+l.path,!0);for(var b in l.headers){var E=l.headers[b];g.setRequestHeader(b,E)}g.send(l.body)},handleError:function(l,f){if(f)return f(l)},generateSessionID:function(){return _k()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(l,f){if(f._typeahead){var g=f._typeahead.data,b=l.id,E=g.map(function(z){return z.id}),P=E.indexOf(b);return P}},shouldEnableLogging:function(l){return!(l.enableEventLogging===!1||l.origin&&l.origin!=="https://api.mapbox.com"||l.localGeocoder||l.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(l,f){this.eventQueue.push(l),(this.eventQueue.length>=this.maxQueueSize||f)&&this.flush()},remove:function(){this.flush()}};var gk=SS,yk={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},vk={placeholder:yk},MS={exports:{}};(function(l){(function(f,g,b){l.exports?l.exports=b():f[g]=b()})(so,"subtag",function(){var f="",g=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function b(s){return s.match(g)||[]}function E(s){return b(s).filter(function(K,Q){return K&&Q})}function P(s){return s=b(s),{language:s[1]||f,extlang:s[2]||f,script:s[3]||f,region:s[4]||f}}function z(s,K,Q){Object.defineProperty(s,K,{value:Q,enumerable:!0})}function j(s,K,Q){function re(we){return b(we)[s]||f}z(re,"pattern",K),z(P,Q,re)}return j(1,/^[a-zA-Z]{2,3}$/,"language"),j(2,/^[a-zA-Z]{3}$/,"extlang"),j(3,/^[a-zA-Z]{4}$/,"script"),j(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),z(P,"split",E),P})})(MS);var xk=MS.exports;function AS(){}AS.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const l={enableHighAccuracy:!0};return new Promise(function(f,g){window.navigator.geolocation.getCurrentPosition(f,g,l)})}};var bk=AS;function wk(l,f){const g=IS(l),b=["address","street","place","country"];var E;if(typeof f=="function")return f(g);const P=b.indexOf(f);return P===-1?E=b:E=b.slice(P),E.reduce(function(z,j){return g[j]?(z!==""&&(z=z+", "),z+g[j]):z},"")}function IS(l){const f=l.address||"",g=l.text||"",b=l.place_name||"",P={address:b.split(",")[0],houseNumber:f,street:g,placeName:b};return l.context.forEach(function(z){const j=z.id.split(".")[0];P[j]=z.text}),P}const Tk=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var Ek={transformFeatureToGeolocationText:wk,getAddressInfo:IS,REVERSE_GEOCODE_COORD_RGX:Tk},Sk=A3,Mk=q3,Bu=td,Ak=J3.EventEmitter,eT=Q3,ky=kz,Fy=uk,Ik=gk,Ck=vk,Pk=xk,Lk=bk,tT=Ek;const Pc={FORWARD:0,LOCAL:1,REVERSE:2};function Rk(){var l=document.createElement("div");return l.className="mapboxgl-ctrl-geocoder--powered-by",l.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',l}function CS(l){this._eventEmitter=new Ak,this.options=Bu({},this.options,l),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Lk}CS.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(l){return l.place_name},render:function(l){var f=l.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+f[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+f.splice(1,f.length).join(",")+"</div></div>"}},addTo:function(l){function f(g,b){if(!document.body.contains(b))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const E=g.onAdd();b.appendChild(E)}if(l._controlContainer)l.addControl(this);else if(l instanceof HTMLElement)f(this,l);else if(typeof l=="string"){const g=document.querySelectorAll(l);if(g.length===0)throw new Error("Element ",l,"not found.");if(g.length>1)throw new Error("Geocoder can only be added to a single html element");f(this,g[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(l){if(l&&typeof l!="string"&&(this._map=l),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Fy(ky({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Ik(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var f=this.container=document.createElement("div");f.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var g=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Mk(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(K){this.eventManager.keyevent(K,this)}).bind(this));var b=document.createElement("div");b.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var E=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(E),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),b.appendChild(this._clearEl),b.appendChild(this._loadingEl),f.appendChild(g),f.appendChild(this._inputEl),f.appendChild(b),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var P=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(P),b.appendChild(this._geolocateEl),this._showGeolocateButton()}var z=this._typeahead=new Sk(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),z.getItemValue=this.options.getItemValue;var j=z.list.draw,s=this._footerNode=Rk();return z.list.draw=function(){j.call(this),s.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),s.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(s)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),f},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(l){this._hideLoadingIcon();const f={geometry:{type:"Point",coordinates:[l.coords.longitude,l.coords.latitude]}};this._handleMarker(f),this._fly(f),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(f),this._showClearButton(),this.fresh=!1;const g={limit:1,language:[this.options.language],query:f.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const b=f.geometry.coordinates[0]+","+f.geometry.coordinates[1];this._setInputValue(b),this._eventEmitter.emit("result",{result:f})}else this.geocoderService.reverseGeocode(g).send().then((function(b){const E=b.body.features[0];if(E){const P=tT.transformFeatureToGeolocationText(E,this.options.addressAccuracy);this._setInputValue(P),E.user_coordinates=f.geometry.coordinates,this._eventEmitter.emit("result",{result:E})}else this._eventEmitter.emit("result",{result:{user_coordinates:f.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(l){l.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(l,f){var g=document.createElementNS("http://www.w3.org/2000/svg","svg");return g.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+l),g.setAttribute("viewBox","0 0 18 18"),g.setAttribute("xml:space","preserve"),g.setAttribute("width",18),g.setAttribute("height",18),g.innerHTML=f,g},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(l){this._inputEl.value=l,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(l){var f=(l.clipboardData||window.clipboardData).getData("text");f.length>=this.options.minLength&&this._geocode(f)},_onKeyDown:function(l){var f=27,g=9;if(l.keyCode===f&&this.options.clearAndBlurOnEsc)return this._clear(l),this._inputEl.blur();var b=l.target&&l.target.shadowRoot?l.target.shadowRoot.activeElement:l.target,E=b?b.value:"";if(!E)return this.fresh=!0,l.keyCode!==g&&this.clear(l),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(l.metaKey||[g,f,37,39,13,38,40].indexOf(l.keyCode)!==-1)&&b.value.length>=this.options.minLength&&this._geocode(b.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(l){this.options.clearOnBlur&&this._clearOnBlur(l),this.options.collapsed&&this._collapse()},_onChange:function(){var l=this._typeahead.selected;l&&JSON.stringify(l)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(l),this.options.marker&&this._mapboxgl&&this._handleMarker(l),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(l),this._eventEmitter.emit("result",{result:l}),this.eventManager.select(l,this))},_fly:function(l){var f;if(l.properties&&eT[l.properties.short_code])f=Bu({},this.options.flyTo),this._map&&this._map.fitBounds(eT[l.properties.short_code].bbox,f);else if(l.bbox){var g=l.bbox;f=Bu({},this.options.flyTo),this._map&&this._map.fitBounds([[g[0],g[1]],[g[2],g[3]]],f)}else{var b={zoom:this.options.zoom};f=Bu({},b,this.options.flyTo),l.center?f.center=l.center:l.geometry&&l.geometry.type&&l.geometry.type==="Point"&&l.geometry.coordinates&&(f.center=l.geometry.coordinates),this._map&&this._map.flyTo(f)}},_requestType:function(l,f){var g;return l.localGeocoderOnly?g=Pc.LOCAL:l.reverseGeocode&&tT.REVERSE_GEOCODE_COORD_RGX.test(f)?g=Pc.REVERSE:g=Pc.FORWARD,g},_setupConfig:function(l,f){const g=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],b=/[\s,]+/;var E=this,P=g.reduce(function(j,s){if(E.options[s]===void 0||E.options[s]===null)return j;["countries","types","language"].indexOf(s)>-1?j[s]=E.options[s].split(b):j[s]=E.options[s];const K=typeof E.options[s].longitude=="number"&&typeof E.options[s].latitude=="number";if(s==="proximity"&&K){const Q=E.options[s].longitude,re=E.options[s].latitude;j[s]=[Q,re]}return j},{});switch(l){case Pc.REVERSE:{var z=f.split(b).map(function(j){return parseFloat(j,10)});E.options.flipCoordinates||z.reverse(),P.types&&P.types[0],P=Bu(P,{query:z,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(j){j in P&&delete P[j]})}break;case Pc.FORWARD:{const j=f.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(j)&&(f=f.replace(/,/g," ")),P=Bu(P,{query:f})}break}return P},_geocode:function(l){this.inputString=l,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:l});const f=this._requestType(this.options,l),g=this._setupConfig(f,l);var b;switch(f){case Pc.LOCAL:b=Promise.resolve();break;case Pc.FORWARD:b=this.geocoderService.forwardGeocode(g).send();break;case Pc.REVERSE:b=this.geocoderService.reverseGeocode(g).send();break}var E=this.options.localGeocoder?this.options.localGeocoder(l)||[]:[],P=[],z=null;return b.catch((function(j){z=j}).bind(this)).then((function(j){this._hideLoadingIcon();var s={};return j?j.statusCode=="200"&&(s=j.body,s.request=j.request,s.headers=j.headers):s={type:"FeatureCollection",features:[]},s.config=g,this.fresh&&(this.eventManager.start(this),this.fresh=!1),s.features=s.features?E.concat(s.features):E,this.options.externalGeocoder?(P=this.options.externalGeocoder(l,s.features)||Promise.resolve([]),P.then(function(K){return s.features=s.features?K.concat(s.features):K,s},function(){return s})):s}).bind(this)).then((function(j){if(z)throw z;this.options.filter&&j.features.length&&(j.features=j.features.filter(this.options.filter)),j.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",j),this._typeahead.update(j.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",j))}).bind(this)).catch((function(j){this._hideLoadingIcon(),this._hideAttribution(),E.length&&this.options.localGeocoder||P.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(E)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:E}),this._eventEmitter.emit("error",{error:j})}).bind(this)),b},_clear:function(l){l&&l.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(l){this._clear(l),this._inputEl.focus()},_clearOnBlur:function(l){var f=this;l.relatedTarget&&f._clear(l)},_onQueryResult:function(l){var f=l.body;if(f.features.length){var g=f.features[0];this._typeahead.selected=g,this._inputEl.value=g.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var l=this._map.getCenter().wrap();this.setProximity({longitude:l.lng,latitude:l.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(l){return this._geocode(l).then(this._onQueryResult),this},_renderError:function(){var l="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(l)},_renderLocationError:function(){var l="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(l)},_renderNoResults:function(){var l="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(l)},_renderUserDeniedGeolocationError:function(){var l="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(l)},_renderMessage:function(l){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(l)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var l=this.options.language.split(",")[0],f=Pk.language(l),g=Ck.placeholder[f];if(g)return g}return"Search"},setInput:function(l,f){return f===void 0&&(f=!1),this._inputEl.value=l,this._typeahead.selected=null,this._typeahead.clear(),l.length>=this.options.minLength&&(f?this._geocode(l):this._onChange()),this},setProximity:function(l,f=!0){return this.options.proximity=l,f&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(l){return l&&typeof l=="function"&&(this._typeahead.render=l),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(l){var f=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=l||this.options.language||f,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(l){return this.options.zoom=l,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(l){return this.options.flyTo=l,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(l){return this.options.placeholder=l||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(l){return this.options.bbox=l,this},getCountries:function(){return this.options.countries},setCountries:function(l){return this.options.countries=l,this},getTypes:function(){return this.options.types},setTypes:function(l){return this.options.types=l,this},getMinLength:function(){return this.options.minLength},setMinLength:function(l){return this.options.minLength=l,this._typeahead&&(this._typeahead.options.minLength=l),this},getLimit:function(){return this.options.limit},setLimit:function(l){return this.options.limit=l,this._typeahead&&(this._typeahead.options.limit=l),this},getFilter:function(){return this.options.filter},setFilter:function(l){return this.options.filter=l,this},setOrigin:function(l){return this.options.origin=l,this.geocoderService=Fy(ky({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(l){return this.options.accessToken=l,this.geocoderService=Fy(ky({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(l){return this.options.autocomplete=l,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(l){return this.options.fuzzyMatch=l,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(l){return this.options.routing=l,this},getRouting:function(){return this.options.routing},setWorldview:function(l){return this.options.worldview=l,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(l){if(this._map){this._removeMarker();var f={color:"#4668F2"},g=Bu({},f,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(g),l.center?this.mapMarker.setLngLat(l.center).addTo(this._map):l.geometry&&l.geometry.type&&l.geometry.type==="Point"&&l.geometry.coordinates&&this.mapMarker.setLngLat(l.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(l,f){return this._eventEmitter.on(l,f),this},off:function(l,f){return this._eventEmitter.removeListener(l,f),this.eventManager.remove(),this}};var Ok=CS;const Dk=np(Ok);var PS={},zk=so&&so.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(PS,"__esModule",{value:!0});const kk=zk(S0);var R_=PS.default=kk.default,Fk=function l(f,g){if(f===g)return!0;if(f&&g&&typeof f=="object"&&typeof g=="object"){if(f.constructor!==g.constructor)return!1;var b,E,P;if(Array.isArray(f)){if(b=f.length,b!=g.length)return!1;for(E=b;E--!==0;)if(!l(f[E],g[E]))return!1;return!0}if(f.constructor===RegExp)return f.source===g.source&&f.flags===g.flags;if(f.valueOf!==Object.prototype.valueOf)return f.valueOf()===g.valueOf();if(f.toString!==Object.prototype.toString)return f.toString()===g.toString();if(P=Object.keys(f),b=P.length,b!==Object.keys(g).length)return!1;for(E=b;E--!==0;)if(!Object.prototype.hasOwnProperty.call(g,P[E]))return!1;for(E=b;E--!==0;){var z=P[E];if(!l(f[z],g[z]))return!1}return!0}return f!==f&&g!==g};const LS=np(Fk);var RS={exports:{}};(function(l,f){(function(g,b){l.exports=b()})(so,function(){var g=function(C,B){var ie={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},me={on:function(xe,Se,wt){if(ie[xe]===void 0)throw new Error("Invalid event type: "+xe);ie[xe].push({selector:Se,fn:wt})},render:function(xe){B.store.featureChanged(xe)}},ce=function(xe,Se){for(var wt=ie[xe],Ft=wt.length;Ft--;){var ft=wt[Ft];if(ft.selector(Se)){ft.fn.call(me,Se)||B.store.render(),B.ui.updateMapClasses();break}}};return C.start.call(me),{render:C.render,stop:function(){C.stop&&C.stop()},trash:function(){C.trash&&(C.trash(),B.store.render())},combineFeatures:function(){C.combineFeatures&&C.combineFeatures()},uncombineFeatures:function(){C.uncombineFeatures&&C.uncombineFeatures()},drag:function(xe){ce("drag",xe)},click:function(xe){ce("click",xe)},mousemove:function(xe){ce("mousemove",xe)},mousedown:function(xe){ce("mousedown",xe)},mouseup:function(xe){ce("mouseup",xe)},mouseout:function(xe){ce("mouseout",xe)},keydown:function(xe){ce("keydown",xe)},keyup:function(xe){ce("keyup",xe)},touchstart:function(xe){ce("touchstart",xe)},touchmove:function(xe){ce("touchmove",xe)},touchend:function(xe){ce("touchend",xe)},tap:function(xe){ce("tap",xe)}}};function b(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}function E(C){if(C.__esModule)return C;var B=C.default;if(typeof B=="function"){var ie=function me(){if(this instanceof me){var ce=[null];ce.push.apply(ce,arguments);var xe=Function.bind.apply(B,ce);return new xe}return B.apply(this,arguments)};ie.prototype=B.prototype}else ie={};return Object.defineProperty(ie,"__esModule",{value:!0}),Object.keys(C).forEach(function(me){var ce=Object.getOwnPropertyDescriptor(C,me);Object.defineProperty(ie,me,ce.get?ce:{enumerable:!0,get:function(){return C[me]}})}),ie}var P={},z={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},j=z;function s(C){var B=0;if(C&&C.length>0){B+=Math.abs(K(C[0]));for(var ie=1;ie<C.length;ie++)B-=Math.abs(K(C[ie]))}return B}function K(C){var B,ie,me,ce,xe,Se,wt=0,Ft=C.length;if(Ft>2){for(Se=0;Se<Ft;Se++)Se===Ft-2?(me=Ft-2,ce=Ft-1,xe=0):Se===Ft-1?(me=Ft-1,ce=0,xe=1):(me=Se,ce=Se+1,xe=Se+2),B=C[me],ie=C[ce],wt+=(Q(C[xe][0])-Q(B[0]))*Math.sin(Q(ie[1]));wt=wt*j.RADIUS*j.RADIUS/2}return wt}function Q(C){return C*Math.PI/180}P.geometry=function C(B){var ie,me=0;switch(B.type){case"Polygon":return s(B.coordinates);case"MultiPolygon":for(ie=0;ie<B.coordinates.length;ie++)me+=s(B.coordinates[ie]);return me;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ie=0;ie<B.geometries.length;ie++)me+=C(B.geometries[ie]);return me}},P.ring=K;var re={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},we={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Ee={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Me={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Ce={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Ue={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},lt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},$t={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},It={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},yr={ACTIVE:"true",INACTIVE:"false"},zr=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],hr=-85,Ai=Object.freeze({__proto__:null,classes:re,sources:we,cursors:Ee,types:Me,geojsonTypes:Ce,modes:Ue,events:lt,updateActions:$t,meta:It,activeStates:yr,interactions:zr,LAT_MIN:-90,LAT_RENDERED_MIN:hr,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Ii={Point:0,LineString:1,MultiLineString:1,Polygon:2};function dt(C,B){var ie=Ii[C.geometry.type]-Ii[B.geometry.type];return ie===0&&C.geometry.type===Ce.POLYGON?C.area-B.area:ie}function Cn(C){return C.map(function(B){return B.geometry.type===Ce.POLYGON&&(B.area=P.geometry({type:Ce.FEATURE,property:{},geometry:B.geometry})),B}).sort(dt).map(function(B){return delete B.area,B})}function Kn(C,B){return B===void 0&&(B=0),[[C.point.x-B,C.point.y-B],[C.point.x+B,C.point.y+B]]}function br(C){if(this._items={},this._nums={},this._length=C?C.length:0,C)for(var B=0,ie=C.length;B<ie;B++)this.add(C[B]),C[B]!==void 0&&(typeof C[B]=="string"?this._items[C[B]]=B:this._nums[C[B]]=B)}br.prototype.add=function(C){return this.has(C)||(this._length++,typeof C=="string"?this._items[C]=this._length:this._nums[C]=this._length),this},br.prototype.delete=function(C){return this.has(C)===!1||(this._length--,delete this._items[C],delete this._nums[C]),this},br.prototype.has=function(C){return(typeof C=="string"||typeof C=="number")&&(this._items[C]!==void 0||this._nums[C]!==void 0)},br.prototype.values=function(){var C=this,B=[];return Object.keys(this._items).forEach(function(ie){B.push({k:ie,v:C._items[ie]})}),Object.keys(this._nums).forEach(function(ie){B.push({k:JSON.parse(ie),v:C._nums[ie]})}),B.sort(function(ie,me){return ie.v-me.v}).map(function(ie){return ie.k})},br.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var zi=[It.FEATURE,It.MIDPOINT,It.VERTEX],Jn={click:function(C,B,ie){return Ct(C,B,ie,ie.options.clickBuffer)},touch:function(C,B,ie){return Ct(C,B,ie,ie.options.touchBuffer)}};function Ct(C,B,ie,me){if(ie.map===null)return[];var ce=C?Kn(C,me):B,xe={};ie.options.styles&&(xe.layers=ie.options.styles.map(function(ft){return ft.id}).filter(function(ft){return ie.map.getLayer(ft)!=null}));var Se=ie.map.queryRenderedFeatures(ce,xe).filter(function(ft){return zi.indexOf(ft.properties.meta)!==-1}),wt=new br,Ft=[];return Se.forEach(function(ft){var nr=ft.properties.id;wt.has(nr)||(wt.add(nr),Ft.push(ft))}),Cn(Ft)}function Ci(C,B){var ie=Jn.click(C,null,B),me={mouse:Ee.NONE};return ie[0]&&(me.mouse=ie[0].properties.active===yr.ACTIVE?Ee.MOVE:Ee.POINTER,me.feature=ie[0].properties.meta),B.events.currentModeName().indexOf("draw")!==-1&&(me.mouse=Ee.ADD),B.ui.queueMapClasses(me),B.ui.updateMapClasses(),ie[0]}function Jr(C,B){var ie=C.x-B.x,me=C.y-B.y;return Math.sqrt(ie*ie+me*me)}function Zt(C,B,ie){ie===void 0&&(ie={});var me=ie.fineTolerance!=null?ie.fineTolerance:4,ce=ie.grossTolerance!=null?ie.grossTolerance:12,xe=ie.interval!=null?ie.interval:500;C.point=C.point||B.point,C.time=C.time||B.time;var Se=Jr(C.point,B.point);return Se<me||Se<ce&&B.time-C.time<xe}function Pn(C,B,ie){ie===void 0&&(ie={});var me=ie.tolerance!=null?ie.tolerance:25,ce=ie.interval!=null?ie.interval:250;return C.point=C.point||B.point,C.time=C.time||B.time,Jr(C.point,B.point)<me&&B.time-C.time<ce}var kn={exports:{}},nn=kn.exports=function(C,B){if(B||(B=16),C===void 0&&(C=128),C<=0)return"0";for(var ie=Math.log(Math.pow(2,C))/Math.log(B),me=2;ie===1/0;me*=2)ie=Math.log(Math.pow(2,C/me))/Math.log(B)*me;var ce=ie-Math.floor(ie),xe="";for(me=0;me<Math.floor(ie);me++)xe=Math.floor(Math.random()*B).toString(B)+xe;if(ce){var Se=Math.pow(B,ce);xe=Math.floor(Math.random()*Se).toString(B)+xe}var wt=parseInt(xe,B);return wt!==1/0&&wt>=Math.pow(2,C)?nn(C,B):xe};nn.rack=function(C,B,ie){var me=function(xe){var Se=0;do{if(Se++>10){if(!ie)throw new Error("too many ID collisions, use more bits");C+=ie}var wt=nn(C,B)}while(Object.hasOwnProperty.call(ce,wt));return ce[wt]=xe,wt},ce=me.hats={};return me.get=function(xe){return me.hats[xe]},me.set=function(xe,Se){return me.hats[xe]=Se,me},me.bits=C||128,me.base=B||16,me};var _r=b(kn.exports),rr=function(C,B){this.ctx=C,this.properties=B.properties||{},this.coordinates=B.geometry.coordinates,this.id=B.id||_r(),this.type=B.geometry.type};rr.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},rr.prototype.incomingCoords=function(C){this.setCoordinates(C)},rr.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},rr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},rr.prototype.setProperty=function(C,B){this.properties[C]=B},rr.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Ce.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},rr.prototype.internal=function(C){var B={id:this.id,meta:It.FEATURE,"meta:type":this.type,active:yr.INACTIVE,mode:C};if(this.ctx.options.userProperties)for(var ie in this.properties)B["user_"+ie]=this.properties[ie];return{type:Ce.FEATURE,properties:B,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var pr=function(C,B){rr.call(this,C,B)};(pr.prototype=Object.create(rr.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},pr.prototype.updateCoordinate=function(C,B,ie){this.coordinates=arguments.length===3?[B,ie]:[C,B],this.changed()},pr.prototype.getCoordinate=function(){return this.getCoordinates()};var Ir=function(C,B){rr.call(this,C,B)};(Ir.prototype=Object.create(rr.prototype)).isValid=function(){return this.coordinates.length>1},Ir.prototype.addCoordinate=function(C,B,ie){this.changed();var me=parseInt(C,10);this.coordinates.splice(me,0,[B,ie])},Ir.prototype.getCoordinate=function(C){var B=parseInt(C,10);return JSON.parse(JSON.stringify(this.coordinates[B]))},Ir.prototype.removeCoordinate=function(C){this.changed(),this.coordinates.splice(parseInt(C,10),1)},Ir.prototype.updateCoordinate=function(C,B,ie){var me=parseInt(C,10);this.coordinates[me]=[B,ie],this.changed()};var gr=function(C,B){rr.call(this,C,B),this.coordinates=this.coordinates.map(function(ie){return ie.slice(0,-1)})};(gr.prototype=Object.create(rr.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(C){return C.length>2})},gr.prototype.incomingCoords=function(C){this.coordinates=C.map(function(B){return B.slice(0,-1)}),this.changed()},gr.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},gr.prototype.addCoordinate=function(C,B,ie){this.changed();var me=C.split(".").map(function(ce){return parseInt(ce,10)});this.coordinates[me[0]].splice(me[1],0,[B,ie])},gr.prototype.removeCoordinate=function(C){this.changed();var B=C.split(".").map(function(me){return parseInt(me,10)}),ie=this.coordinates[B[0]];ie&&(ie.splice(B[1],1),ie.length<3&&this.coordinates.splice(B[0],1))},gr.prototype.getCoordinate=function(C){var B=C.split(".").map(function(me){return parseInt(me,10)}),ie=this.coordinates[B[0]];return JSON.parse(JSON.stringify(ie[B[1]]))},gr.prototype.getCoordinates=function(){return this.coordinates.map(function(C){return C.concat([C[0]])})},gr.prototype.updateCoordinate=function(C,B,ie){this.changed();var me=C.split("."),ce=parseInt(me[0],10),xe=parseInt(me[1],10);this.coordinates[ce]===void 0&&(this.coordinates[ce]=[]),this.coordinates[ce][xe]=[B,ie]};var Ye={MultiPoint:pr,MultiLineString:Ir,MultiPolygon:gr},Yt=function(C,B,ie,me,ce){var xe=ie.split("."),Se=parseInt(xe[0],10),wt=xe[1]?xe.slice(1).join("."):null;return C[Se][B](wt,me,ce)},kt=function(C,B){if(rr.call(this,C,B),delete this.coordinates,this.model=Ye[B.geometry.type],this.model===void 0)throw new TypeError(B.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(B.geometry.coordinates)};function St(C){this.map=C.map,this.drawConfig=JSON.parse(JSON.stringify(C.options||{})),this._ctx=C}(kt.prototype=Object.create(rr.prototype))._coordinatesToFeatures=function(C){var B=this,ie=this.model.bind(this);return C.map(function(me){return new ie(B.ctx,{id:_r(),type:Ce.FEATURE,properties:{},geometry:{coordinates:me,type:B.type.replace("Multi","")}})})},kt.prototype.isValid=function(){return this.features.every(function(C){return C.isValid()})},kt.prototype.setCoordinates=function(C){this.features=this._coordinatesToFeatures(C),this.changed()},kt.prototype.getCoordinate=function(C){return Yt(this.features,"getCoordinate",C)},kt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(C){return C.type===Ce.POLYGON?C.getCoordinates():C.coordinates})))},kt.prototype.updateCoordinate=function(C,B,ie){Yt(this.features,"updateCoordinate",C,B,ie),this.changed()},kt.prototype.addCoordinate=function(C,B,ie){Yt(this.features,"addCoordinate",C,B,ie),this.changed()},kt.prototype.removeCoordinate=function(C){Yt(this.features,"removeCoordinate",C),this.changed()},kt.prototype.getFeatures=function(){return this.features},St.prototype.setSelected=function(C){return this._ctx.store.setSelected(C)},St.prototype.setSelectedCoordinates=function(C){var B=this;this._ctx.store.setSelectedCoordinates(C),C.reduce(function(ie,me){return ie[me.feature_id]===void 0&&(ie[me.feature_id]=!0,B._ctx.store.get(me.feature_id).changed()),ie},{})},St.prototype.getSelected=function(){return this._ctx.store.getSelected()},St.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},St.prototype.isSelected=function(C){return this._ctx.store.isSelected(C)},St.prototype.getFeature=function(C){return this._ctx.store.get(C)},St.prototype.select=function(C){return this._ctx.store.select(C)},St.prototype.deselect=function(C){return this._ctx.store.deselect(C)},St.prototype.deleteFeature=function(C,B){return B===void 0&&(B={}),this._ctx.store.delete(C,B)},St.prototype.addFeature=function(C){return this._ctx.store.add(C)},St.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},St.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},St.prototype.setActionableState=function(C){C===void 0&&(C={});var B={trash:C.trash||!1,combineFeatures:C.combineFeatures||!1,uncombineFeatures:C.uncombineFeatures||!1};return this._ctx.events.actionable(B)},St.prototype.changeMode=function(C,B,ie){return B===void 0&&(B={}),ie===void 0&&(ie={}),this._ctx.events.changeMode(C,B,ie)},St.prototype.updateUIClasses=function(C){return this._ctx.ui.queueMapClasses(C)},St.prototype.activateUIButton=function(C){return this._ctx.ui.setActiveButton(C)},St.prototype.featuresAt=function(C,B,ie){if(ie===void 0&&(ie="click"),ie!=="click"&&ie!=="touch")throw new Error("invalid buffer type");return Jn[ie](C,B,this._ctx)},St.prototype.newFeature=function(C){var B=C.geometry.type;return B===Ce.POINT?new pr(this._ctx,C):B===Ce.LINE_STRING?new Ir(this._ctx,C):B===Ce.POLYGON?new gr(this._ctx,C):new kt(this._ctx,C)},St.prototype.isInstanceOf=function(C,B){if(C===Ce.POINT)return B instanceof pr;if(C===Ce.LINE_STRING)return B instanceof Ir;if(C===Ce.POLYGON)return B instanceof gr;if(C==="MultiFeature")return B instanceof kt;throw new Error("Unknown feature class: "+C)},St.prototype.doRender=function(C){return this._ctx.store.featureChanged(C)},St.prototype.onSetup=function(){},St.prototype.onDrag=function(){},St.prototype.onClick=function(){},St.prototype.onMouseMove=function(){},St.prototype.onMouseDown=function(){},St.prototype.onMouseUp=function(){},St.prototype.onMouseOut=function(){},St.prototype.onKeyUp=function(){},St.prototype.onKeyDown=function(){},St.prototype.onTouchStart=function(){},St.prototype.onTouchMove=function(){},St.prototype.onTouchEnd=function(){},St.prototype.onTap=function(){},St.prototype.onStop=function(){},St.prototype.onTrash=function(){},St.prototype.onCombineFeature=function(){},St.prototype.onUncombineFeature=function(){},St.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var ai={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},bi=Object.keys(ai);function ge(C){var B=Object.keys(C);return function(ie,me){me===void 0&&(me={});var ce={},xe=B.reduce(function(Se,wt){return Se[wt]=C[wt],Se},new St(ie));return{start:function(){var Se=this;ce=xe.onSetup(me),bi.forEach(function(wt){var Ft,ft=ai[wt],nr=function(){return!1};C[ft]&&(nr=function(){return!0}),Se.on(wt,nr,(Ft=ft,function(qt){return xe[Ft](ce,qt)}))})},stop:function(){xe.onStop(ce)},trash:function(){xe.onTrash(ce)},combineFeatures:function(){xe.onCombineFeatures(ce)},uncombineFeatures:function(){xe.onUncombineFeatures(ce)},render:function(Se,wt){xe.toDisplayFeatures(ce,Se,wt)}}}}function ve(C){return[].concat(C).filter(function(B){return B!==void 0})}function We(){var C=this;if(!(C.ctx.map&&C.ctx.map.getSource(we.HOT)!==void 0))return Ft();var B=C.ctx.events.currentModeName();C.ctx.ui.queueMapClasses({mode:B});var ie=[],me=[];C.isDirty?me=C.getAllIds():(ie=C.getChangedIds().filter(function(ft){return C.get(ft)!==void 0}),me=C.sources.hot.filter(function(ft){return ft.properties.id&&ie.indexOf(ft.properties.id)===-1&&C.get(ft.properties.id)!==void 0}).map(function(ft){return ft.properties.id})),C.sources.hot=[];var ce=C.sources.cold.length;C.sources.cold=C.isDirty?[]:C.sources.cold.filter(function(ft){var nr=ft.properties.id||ft.properties.parent;return ie.indexOf(nr)===-1});var xe=ce!==C.sources.cold.length||me.length>0;function Se(ft,nr){var qt=C.get(ft).internal(B);C.ctx.events.currentModeRender(qt,function(Gr){C.sources[nr].push(Gr)})}if(ie.forEach(function(ft){return Se(ft,"hot")}),me.forEach(function(ft){return Se(ft,"cold")}),xe&&C.ctx.map.getSource(we.COLD).setData({type:Ce.FEATURE_COLLECTION,features:C.sources.cold}),C.ctx.map.getSource(we.HOT).setData({type:Ce.FEATURE_COLLECTION,features:C.sources.hot}),C._emitSelectionChange&&(C.ctx.map.fire(lt.SELECTION_CHANGE,{features:C.getSelected().map(function(ft){return ft.toGeoJSON()}),points:C.getSelectedCoordinates().map(function(ft){return{type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:ft.coordinates}}})}),C._emitSelectionChange=!1),C._deletedFeaturesToEmit.length){var wt=C._deletedFeaturesToEmit.map(function(ft){return ft.toGeoJSON()});C._deletedFeaturesToEmit=[],C.ctx.map.fire(lt.DELETE,{features:wt})}function Ft(){C.isDirty=!1,C.clearChangedIds()}Ft(),C.ctx.map.fire(lt.RENDER,{})}function rt(C){var B,ie=this;this._features={},this._featureIds=new br,this._selectedFeatureIds=new br,this._selectedCoordinates=[],this._changedFeatureIds=new br,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=C,this.sources={hot:[],cold:[]},this.render=function(){B||(B=requestAnimationFrame(function(){B=null,We.call(ie)}))},this.isDirty=!1}function ut(C,B){var ie=C._selectedCoordinates.filter(function(me){return C._selectedFeatureIds.has(me.feature_id)});C._selectedCoordinates.length===ie.length||B.silent||(C._emitSelectionChange=!0),C._selectedCoordinates=ie}rt.prototype.createRenderBatch=function(){var C=this,B=this.render,ie=0;return this.render=function(){ie++},function(){C.render=B,ie>0&&C.render()}},rt.prototype.setDirty=function(){return this.isDirty=!0,this},rt.prototype.featureChanged=function(C){return this._changedFeatureIds.add(C),this},rt.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},rt.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},rt.prototype.getAllIds=function(){return this._featureIds.values()},rt.prototype.add=function(C){return this.featureChanged(C.id),this._features[C.id]=C,this._featureIds.add(C.id),this},rt.prototype.delete=function(C,B){var ie=this;return B===void 0&&(B={}),ve(C).forEach(function(me){ie._featureIds.has(me)&&(ie._featureIds.delete(me),ie._selectedFeatureIds.delete(me),B.silent||ie._deletedFeaturesToEmit.indexOf(ie._features[me])===-1&&ie._deletedFeaturesToEmit.push(ie._features[me]),delete ie._features[me],ie.isDirty=!0)}),ut(this,B),this},rt.prototype.get=function(C){return this._features[C]},rt.prototype.getAll=function(){var C=this;return Object.keys(this._features).map(function(B){return C._features[B]})},rt.prototype.select=function(C,B){var ie=this;return B===void 0&&(B={}),ve(C).forEach(function(me){ie._selectedFeatureIds.has(me)||(ie._selectedFeatureIds.add(me),ie._changedFeatureIds.add(me),B.silent||(ie._emitSelectionChange=!0))}),this},rt.prototype.deselect=function(C,B){var ie=this;return B===void 0&&(B={}),ve(C).forEach(function(me){ie._selectedFeatureIds.has(me)&&(ie._selectedFeatureIds.delete(me),ie._changedFeatureIds.add(me),B.silent||(ie._emitSelectionChange=!0))}),ut(this,B),this},rt.prototype.clearSelected=function(C){return C===void 0&&(C={}),this.deselect(this._selectedFeatureIds.values(),{silent:C.silent}),this},rt.prototype.setSelected=function(C,B){var ie=this;return B===void 0&&(B={}),C=ve(C),this.deselect(this._selectedFeatureIds.values().filter(function(me){return C.indexOf(me)===-1}),{silent:B.silent}),this.select(C.filter(function(me){return!ie._selectedFeatureIds.has(me)}),{silent:B.silent}),this},rt.prototype.setSelectedCoordinates=function(C){return this._selectedCoordinates=C,this._emitSelectionChange=!0,this},rt.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},rt.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},rt.prototype.getSelected=function(){var C=this;return this._selectedFeatureIds.values().map(function(B){return C.get(B)})},rt.prototype.getSelectedCoordinates=function(){var C=this;return this._selectedCoordinates.map(function(B){return{coordinates:C.get(B.feature_id).getCoordinate(B.coord_path)}})},rt.prototype.isSelected=function(C){return this._selectedFeatureIds.has(C)},rt.prototype.setFeatureProperty=function(C,B,ie){this.get(C).setProperty(B,ie),this.featureChanged(C)},rt.prototype.storeMapConfig=function(){var C=this;zr.forEach(function(B){C.ctx.map[B]&&(C._mapInitialConfig[B]=C.ctx.map[B].isEnabled())})},rt.prototype.restoreMapConfig=function(){var C=this;Object.keys(this._mapInitialConfig).forEach(function(B){C._mapInitialConfig[B]?C.ctx.map[B].enable():C.ctx.map[B].disable()})},rt.prototype.getInitialConfigValue=function(C){return this._mapInitialConfig[C]===void 0||this._mapInitialConfig[C]};var Vt=function(){for(var C=arguments,B={},ie=0;ie<arguments.length;ie++){var me=C[ie];for(var ce in me)lr.call(me,ce)&&(B[ce]=me[ce])}return B},lr=Object.prototype.hasOwnProperty,bt=b(Vt),Qt=["mode","feature","mouse"];function Dt(C){var B=null,ie=null,me={onRemove:function(){return C.map.off("load",me.connect),clearInterval(ie),me.removeLayers(),C.store.restoreMapConfig(),C.ui.removeButtons(),C.events.removeEventListeners(),C.ui.clearMapClasses(),C.boxZoomInitial&&C.map.boxZoom.enable(),C.map=null,C.container=null,C.store=null,B&&B.parentNode&&B.parentNode.removeChild(B),B=null,this},connect:function(){C.map.off("load",me.connect),clearInterval(ie),me.addLayers(),C.store.storeMapConfig(),C.events.addEventListeners()},onAdd:function(ce){var xe=ce.fire;return ce.fire=function(Se,wt){var Ft=arguments;return xe.length===1&&arguments.length!==1&&(Ft=[bt({},{type:Se},wt)]),xe.apply(ce,Ft)},C.map=ce,C.events=function(Se){var wt=Object.keys(Se.options.modes).reduce(function(mt,ht){return mt[ht]=ge(Se.options.modes[ht]),mt},{}),Ft={},ft={},nr={},qt=null,Gr=null;nr.drag=function(mt,ht){ht({point:mt.point,time:new Date().getTime()})?(Se.ui.queueMapClasses({mouse:Ee.DRAG}),Gr.drag(mt)):mt.originalEvent.stopPropagation()},nr.mousedrag=function(mt){nr.drag(mt,function(ht){return!Zt(Ft,ht)})},nr.touchdrag=function(mt){nr.drag(mt,function(ht){return!Pn(ft,ht)})},nr.mousemove=function(mt){if((mt.originalEvent.buttons!==void 0?mt.originalEvent.buttons:mt.originalEvent.which)===1)return nr.mousedrag(mt);var ht=Ci(mt,Se);mt.featureTarget=ht,Gr.mousemove(mt)},nr.mousedown=function(mt){Ft={time:new Date().getTime(),point:mt.point};var ht=Ci(mt,Se);mt.featureTarget=ht,Gr.mousedown(mt)},nr.mouseup=function(mt){var ht=Ci(mt,Se);mt.featureTarget=ht,Zt(Ft,{point:mt.point,time:new Date().getTime()})?Gr.click(mt):Gr.mouseup(mt)},nr.mouseout=function(mt){Gr.mouseout(mt)},nr.touchstart=function(mt){if(Se.options.touchEnabled){ft={time:new Date().getTime(),point:mt.point};var ht=Jn.touch(mt,null,Se)[0];mt.featureTarget=ht,Gr.touchstart(mt)}},nr.touchmove=function(mt){if(Se.options.touchEnabled)return Gr.touchmove(mt),nr.touchdrag(mt)},nr.touchend=function(mt){if(mt.originalEvent.preventDefault(),Se.options.touchEnabled){var ht=Jn.touch(mt,null,Se)[0];mt.featureTarget=ht,Pn(ft,{time:new Date().getTime(),point:mt.point})?Gr.tap(mt):Gr.touchend(mt)}};var Ti=function(mt){return!(mt===8||mt===46||mt>=48&&mt<=57)};function Tr(mt,ht,Ei){Ei===void 0&&(Ei={}),Gr.stop();var vr=wt[mt];if(vr===void 0)throw new Error(mt+" is not valid");qt=mt;var hn=vr(Se,ht);Gr=g(hn,Se),Ei.silent||Se.map.fire(lt.MODE_CHANGE,{mode:mt}),Se.store.setDirty(),Se.store.render()}nr.keydown=function(mt){(mt.srcElement||mt.target).classList.contains("mapboxgl-canvas")&&(mt.keyCode!==8&&mt.keyCode!==46||!Se.options.controls.trash?Ti(mt.keyCode)?Gr.keydown(mt):mt.keyCode===49&&Se.options.controls.point?Tr(Ue.DRAW_POINT):mt.keyCode===50&&Se.options.controls.line_string?Tr(Ue.DRAW_LINE_STRING):mt.keyCode===51&&Se.options.controls.polygon&&Tr(Ue.DRAW_POLYGON):(mt.preventDefault(),Gr.trash()))},nr.keyup=function(mt){Ti(mt.keyCode)&&Gr.keyup(mt)},nr.zoomend=function(){Se.store.changeZoom()},nr.data=function(mt){if(mt.dataType==="style"){var ht=Se.setup,Ei=Se.map,vr=Se.options,hn=Se.store;vr.styles.some(function(Bn){return Ei.getLayer(Bn.id)})||(ht.addLayers(),hn.setDirty(),hn.render())}};var jt={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){qt=Se.options.defaultMode,Gr=g(wt[qt](Se),Se)},changeMode:Tr,actionable:function(mt){var ht=!1;Object.keys(mt).forEach(function(Ei){if(jt[Ei]===void 0)throw new Error("Invalid action type");jt[Ei]!==mt[Ei]&&(ht=!0),jt[Ei]=mt[Ei]}),ht&&Se.map.fire(lt.ACTIONABLE,{actions:jt})},currentModeName:function(){return qt},currentModeRender:function(mt,ht){return Gr.render(mt,ht)},fire:function(mt,ht){nr[mt]&&nr[mt](ht)},addEventListeners:function(){Se.map.on("mousemove",nr.mousemove),Se.map.on("mousedown",nr.mousedown),Se.map.on("mouseup",nr.mouseup),Se.map.on("data",nr.data),Se.map.on("touchmove",nr.touchmove),Se.map.on("touchstart",nr.touchstart),Se.map.on("touchend",nr.touchend),Se.container.addEventListener("mouseout",nr.mouseout),Se.options.keybindings&&(Se.container.addEventListener("keydown",nr.keydown),Se.container.addEventListener("keyup",nr.keyup))},removeEventListeners:function(){Se.map.off("mousemove",nr.mousemove),Se.map.off("mousedown",nr.mousedown),Se.map.off("mouseup",nr.mouseup),Se.map.off("data",nr.data),Se.map.off("touchmove",nr.touchmove),Se.map.off("touchstart",nr.touchstart),Se.map.off("touchend",nr.touchend),Se.container.removeEventListener("mouseout",nr.mouseout),Se.options.keybindings&&(Se.container.removeEventListener("keydown",nr.keydown),Se.container.removeEventListener("keyup",nr.keyup))},trash:function(mt){Gr.trash(mt)},combineFeatures:function(){Gr.combineFeatures()},uncombineFeatures:function(){Gr.uncombineFeatures()},getMode:function(){return qt}}}(C),C.ui=function(Se){var wt={},Ft=null,ft={mode:null,feature:null,mouse:null},nr={mode:null,feature:null,mouse:null};function qt(mt){nr=bt(nr,mt)}function Gr(){var mt,ht;if(Se.container){var Ei=[],vr=[];Qt.forEach(function(hn){nr[hn]!==ft[hn]&&(Ei.push(hn+"-"+ft[hn]),nr[hn]!==null&&vr.push(hn+"-"+nr[hn]))}),Ei.length>0&&(mt=Se.container.classList).remove.apply(mt,Ei),vr.length>0&&(ht=Se.container.classList).add.apply(ht,vr),ft=bt(ft,nr)}}function Ti(mt,ht){ht===void 0&&(ht={});var Ei=document.createElement("button");return Ei.className=re.CONTROL_BUTTON+" "+ht.className,Ei.setAttribute("title",ht.title),ht.container.appendChild(Ei),Ei.addEventListener("click",function(vr){if(vr.preventDefault(),vr.stopPropagation(),vr.target===Ft)return Tr(),void ht.onDeactivate();jt(mt),ht.onActivate()},!0),Ei}function Tr(){Ft&&(Ft.classList.remove(re.ACTIVE_BUTTON),Ft=null)}function jt(mt){Tr();var ht=wt[mt];ht&&ht&&mt!=="trash"&&(ht.classList.add(re.ACTIVE_BUTTON),Ft=ht)}return{setActiveButton:jt,queueMapClasses:qt,updateMapClasses:Gr,clearMapClasses:function(){qt({mode:null,feature:null,mouse:null}),Gr()},addButtons:function(){var mt=Se.options.controls,ht=document.createElement("div");return ht.className=re.CONTROL_GROUP+" "+re.CONTROL_BASE,mt&&(mt[Me.LINE]&&(wt[Me.LINE]=Ti(Me.LINE,{container:ht,className:re.CONTROL_BUTTON_LINE,title:"LineString tool "+(Se.options.keybindings?"(l)":""),onActivate:function(){return Se.events.changeMode(Ue.DRAW_LINE_STRING)},onDeactivate:function(){return Se.events.trash()}})),mt[Me.POLYGON]&&(wt[Me.POLYGON]=Ti(Me.POLYGON,{container:ht,className:re.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Se.options.keybindings?"(p)":""),onActivate:function(){return Se.events.changeMode(Ue.DRAW_POLYGON)},onDeactivate:function(){return Se.events.trash()}})),mt[Me.POINT]&&(wt[Me.POINT]=Ti(Me.POINT,{container:ht,className:re.CONTROL_BUTTON_POINT,title:"Marker tool "+(Se.options.keybindings?"(m)":""),onActivate:function(){return Se.events.changeMode(Ue.DRAW_POINT)},onDeactivate:function(){return Se.events.trash()}})),mt.trash&&(wt.trash=Ti("trash",{container:ht,className:re.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Se.events.trash()}})),mt.combine_features&&(wt.combine_features=Ti("combineFeatures",{container:ht,className:re.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Se.events.combineFeatures()}})),mt.uncombine_features&&(wt.uncombine_features=Ti("uncombineFeatures",{container:ht,className:re.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Se.events.uncombineFeatures()}}))),ht},removeButtons:function(){Object.keys(wt).forEach(function(mt){var ht=wt[mt];ht.parentNode&&ht.parentNode.removeChild(ht),delete wt[mt]})}}}(C),C.container=ce.getContainer(),C.store=new rt(C),B=C.ui.addButtons(),C.options.boxSelect&&(C.boxZoomInitial=ce.boxZoom.isEnabled(),ce.boxZoom.disable(),ce.dragPan.disable(),ce.dragPan.enable()),ce.loaded()?me.connect():(ce.on("load",me.connect),ie=setInterval(function(){ce.loaded()&&me.connect()},16)),C.events.start(),B},addLayers:function(){C.map.addSource(we.COLD,{data:{type:Ce.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.map.addSource(we.HOT,{data:{type:Ce.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.options.styles.forEach(function(ce){C.map.addLayer(ce)}),C.store.setDirty(!0),C.store.render()},removeLayers:function(){C.options.styles.forEach(function(ce){C.map.getLayer(ce.id)&&C.map.removeLayer(ce.id)}),C.map.getSource(we.COLD)&&C.map.removeSource(we.COLD),C.map.getSource(we.HOT)&&C.map.removeSource(we.HOT)}};return C.setup=me,me}var cr=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function Er(C){return function(B){var ie=B.featureTarget;return!!ie&&!!ie.properties&&ie.properties.meta===C}}function Sr(C){return!!C.originalEvent&&!!C.originalEvent.shiftKey&&C.originalEvent.button===0}function Oe(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===yr.ACTIVE&&C.featureTarget.properties.meta===It.FEATURE}function W(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===yr.INACTIVE&&C.featureTarget.properties.meta===It.FEATURE}function se(C){return C.featureTarget===void 0}function de(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.meta===It.FEATURE}function Fe(C){var B=C.featureTarget;return!!B&&!!B.properties&&B.properties.meta===It.VERTEX}function Ze(C){return!!C.originalEvent&&C.originalEvent.shiftKey===!0}function nt(C){return C.keyCode===27}function Nt(C){return C.keyCode===13}var He=Object.freeze({__proto__:null,isOfMetaType:Er,isShiftMousedown:Sr,isActiveFeature:Oe,isInactiveFeature:W,noTarget:se,isFeature:de,isVertex:Fe,isShiftDown:Ze,isEscapeKey:nt,isEnterKey:Nt,isTrue:function(){return!0}}),Ht=Tt;function Tt(C,B){this.x=C,this.y=B}Tt.prototype={clone:function(){return new Tt(this.x,this.y)},add:function(C){return this.clone()._add(C)},sub:function(C){return this.clone()._sub(C)},multByPoint:function(C){return this.clone()._multByPoint(C)},divByPoint:function(C){return this.clone()._divByPoint(C)},mult:function(C){return this.clone()._mult(C)},div:function(C){return this.clone()._div(C)},rotate:function(C){return this.clone()._rotate(C)},rotateAround:function(C,B){return this.clone()._rotateAround(C,B)},matMult:function(C){return this.clone()._matMult(C)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(C){return this.x===C.x&&this.y===C.y},dist:function(C){return Math.sqrt(this.distSqr(C))},distSqr:function(C){var B=C.x-this.x,ie=C.y-this.y;return B*B+ie*ie},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(C){return Math.atan2(this.y-C.y,this.x-C.x)},angleWith:function(C){return this.angleWithSep(C.x,C.y)},angleWithSep:function(C,B){return Math.atan2(this.x*B-this.y*C,this.x*C+this.y*B)},_matMult:function(C){var B=C[0]*this.x+C[1]*this.y,ie=C[2]*this.x+C[3]*this.y;return this.x=B,this.y=ie,this},_add:function(C){return this.x+=C.x,this.y+=C.y,this},_sub:function(C){return this.x-=C.x,this.y-=C.y,this},_mult:function(C){return this.x*=C,this.y*=C,this},_div:function(C){return this.x/=C,this.y/=C,this},_multByPoint:function(C){return this.x*=C.x,this.y*=C.y,this},_divByPoint:function(C){return this.x/=C.x,this.y/=C.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var C=this.y;return this.y=this.x,this.x=-C,this},_rotate:function(C){var B=Math.cos(C),ie=Math.sin(C),me=B*this.x-ie*this.y,ce=ie*this.x+B*this.y;return this.x=me,this.y=ce,this},_rotateAround:function(C,B){var ie=Math.cos(C),me=Math.sin(C),ce=B.x+ie*(this.x-B.x)-me*(this.y-B.y),xe=B.y+me*(this.x-B.x)+ie*(this.y-B.y);return this.x=ce,this.y=xe,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tt.convert=function(C){return C instanceof Tt?C:Array.isArray(C)?new Tt(C[0],C[1]):C};var Ut=b(Ht);function Rr(C,B){var ie=B.getBoundingClientRect();return new Ut(C.clientX-ie.left-(B.clientLeft||0),C.clientY-ie.top-(B.clientTop||0))}function fi(C,B,ie,me){return{type:Ce.FEATURE,properties:{meta:It.VERTEX,parent:C,coord_path:ie,active:me?yr.ACTIVE:yr.INACTIVE},geometry:{type:Ce.POINT,coordinates:B}}}function Ui(C,B,ie){var me=B.geometry.coordinates,ce=ie.geometry.coordinates;if(me[1]>85||me[1]<hr||ce[1]>85||ce[1]<hr)return null;var xe={lng:(me[0]+ce[0])/2,lat:(me[1]+ce[1])/2};return{type:Ce.FEATURE,properties:{meta:It.MIDPOINT,parent:C,lng:xe.lng,lat:xe.lat,coord_path:ie.properties.coord_path},geometry:{type:Ce.POINT,coordinates:[xe.lng,xe.lat]}}}function gi(C,B,ie){B===void 0&&(B={}),ie===void 0&&(ie=null);var me,ce=C.geometry,xe=ce.type,Se=ce.coordinates,wt=C.properties&&C.properties.id,Ft=[];function ft(qt,Gr){var Ti="",Tr=null;qt.forEach(function(jt,mt){var ht=Gr!=null?Gr+"."+mt:String(mt),Ei=fi(wt,jt,ht,nr(ht));if(B.midpoints&&Tr){var vr=Ui(wt,Tr,Ei);vr&&Ft.push(vr)}Tr=Ei;var hn=JSON.stringify(jt);Ti!==hn&&Ft.push(Ei),mt===0&&(Ti=hn)})}function nr(qt){return!!B.selectedPaths&&B.selectedPaths.indexOf(qt)!==-1}return xe===Ce.POINT?Ft.push(fi(wt,Se,ie,nr(ie))):xe===Ce.POLYGON?Se.forEach(function(qt,Gr){ft(qt,ie!==null?ie+"."+Gr:String(Gr))}):xe===Ce.LINE_STRING?ft(Se,ie):xe.indexOf(Ce.MULTI_PREFIX)===0&&(me=xe.replace(Ce.MULTI_PREFIX,""),Se.forEach(function(qt,Gr){var Ti={type:Ce.FEATURE,properties:C.properties,geometry:{type:me,coordinates:qt}};Ft=Ft.concat(gi(Ti,B,Gr))})),Ft}var $r={enable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C._ctx&&C._ctx.store&&C._ctx.store.getInitialConfigValue&&C._ctx.store.getInitialConfigValue("doubleClickZoom")&&C.map.doubleClickZoom.enable()},0)},disable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C.map.doubleClickZoom.disable()},0)}},ii={exports:{}},yi=function(C){if(!C||!C.type)return null;var B=ki[C.type];if(!B)return null;if(B==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:C}]};if(B==="feature")return{type:"FeatureCollection",features:[C]};if(B==="featurecollection")return C},ki={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Fn=b(yi),ji=Object.freeze({__proto__:null,default:function C(B){switch(B&&B.type||null){case"FeatureCollection":return B.features=B.features.reduce(function(ie,me){return ie.concat(C(me))},[]),B;case"Feature":return B.geometry?C(B.geometry).map(function(ie){var me={type:"Feature",properties:JSON.parse(JSON.stringify(B.properties)),geometry:ie};return B.id!==void 0&&(me.id=B.id),me}):[B];case"MultiPoint":return B.coordinates.map(function(ie){return{type:"Point",coordinates:ie}});case"MultiPolygon":return B.coordinates.map(function(ie){return{type:"Polygon",coordinates:ie}});case"MultiLineString":return B.coordinates.map(function(ie){return{type:"LineString",coordinates:ie}});case"GeometryCollection":return B.geometries.map(C).reduce(function(ie,me){return ie.concat(me)},[]);case"Point":case"Polygon":case"LineString":return[B]}}}),_o=yi,jn=E(ji),So=function(C){return function B(ie){return Array.isArray(ie)&&ie.length&&typeof ie[0]=="number"?[ie]:ie.reduce(function(me,ce){return Array.isArray(ce)&&Array.isArray(ce[0])?me.concat(B(ce)):(me.push(ce),me)},[])}(C)};jn instanceof Function||(jn=jn.default);var Tn={exports:{}},En=Tn.exports=function(C){return new Ge(C)};function Ge(C){this.value=C}function Xe(C,B,ie){var me=[],ce=[],xe=!0;return function Se(wt){var Ft=ie?ct(wt):wt,ft={},nr=!0,qt={node:Ft,node_:wt,path:[].concat(me),parent:ce[ce.length-1],parents:ce,key:me.slice(-1)[0],isRoot:me.length===0,level:me.length,circular:null,update:function(Tr,jt){qt.isRoot||(qt.parent.node[qt.key]=Tr),qt.node=Tr,jt&&(nr=!1)},delete:function(Tr){delete qt.parent.node[qt.key],Tr&&(nr=!1)},remove:function(Tr){Lt(qt.parent.node)?qt.parent.node.splice(qt.key,1):delete qt.parent.node[qt.key],Tr&&(nr=!1)},keys:null,before:function(Tr){ft.before=Tr},after:function(Tr){ft.after=Tr},pre:function(Tr){ft.pre=Tr},post:function(Tr){ft.post=Tr},stop:function(){xe=!1},block:function(){nr=!1}};if(!xe)return qt;function Gr(){if(typeof qt.node=="object"&&qt.node!==null){qt.keys&&qt.node_===qt.node||(qt.keys=yt(qt.node)),qt.isLeaf=qt.keys.length==0;for(var Tr=0;Tr<ce.length;Tr++)if(ce[Tr].node_===wt){qt.circular=ce[Tr];break}}else qt.isLeaf=!0,qt.keys=null;qt.notLeaf=!qt.isLeaf,qt.notRoot=!qt.isRoot}Gr();var Ti=B.call(qt,qt.node);return Ti!==void 0&&qt.update&&qt.update(Ti),ft.before&&ft.before.call(qt,qt.node),nr&&(typeof qt.node!="object"||qt.node===null||qt.circular||(ce.push(qt),Gr(),Pt(qt.keys,function(Tr,jt){me.push(Tr),ft.pre&&ft.pre.call(qt,qt.node[Tr],Tr);var mt=Se(qt.node[Tr]);ie&&gt.call(qt.node,Tr)&&(qt.node[Tr]=mt.node),mt.isLast=jt==qt.keys.length-1,mt.isFirst=jt==0,ft.post&&ft.post.call(qt,mt),me.pop()}),ce.pop()),ft.after&&ft.after.call(qt,qt.node)),qt}(C).node}function ct(C){if(typeof C=="object"&&C!==null){var B;if(Lt(C))B=[];else if(pt(C)==="[object Date]")B=new Date(C.getTime?C.getTime():C);else if(function(ce){return pt(ce)==="[object RegExp]"}(C))B=new RegExp(C);else if(function(ce){return pt(ce)==="[object Error]"}(C))B={message:C.message};else if(function(ce){return pt(ce)==="[object Boolean]"}(C))B=new Boolean(C);else if(function(ce){return pt(ce)==="[object Number]"}(C))B=new Number(C);else if(function(ce){return pt(ce)==="[object String]"}(C))B=new String(C);else if(Object.create&&Object.getPrototypeOf)B=Object.create(Object.getPrototypeOf(C));else if(C.constructor===Object)B={};else{var ie=C.constructor&&C.constructor.prototype||C.__proto__||{},me=function(){};me.prototype=ie,B=new me}return Pt(yt(C),function(ce){B[ce]=C[ce]}),B}return C}Ge.prototype.get=function(C){for(var B=this.value,ie=0;ie<C.length;ie++){var me=C[ie];if(!B||!gt.call(B,me)){B=void 0;break}B=B[me]}return B},Ge.prototype.has=function(C){for(var B=this.value,ie=0;ie<C.length;ie++){var me=C[ie];if(!B||!gt.call(B,me))return!1;B=B[me]}return!0},Ge.prototype.set=function(C,B){for(var ie=this.value,me=0;me<C.length-1;me++){var ce=C[me];gt.call(ie,ce)||(ie[ce]={}),ie=ie[ce]}return ie[C[me]]=B,B},Ge.prototype.map=function(C){return Xe(this.value,C,!0)},Ge.prototype.forEach=function(C){return this.value=Xe(this.value,C,!1),this.value},Ge.prototype.reduce=function(C,B){var ie=arguments.length===1,me=ie?this.value:B;return this.forEach(function(ce){this.isRoot&&ie||(me=C.call(this,me,ce))}),me},Ge.prototype.paths=function(){var C=[];return this.forEach(function(B){C.push(this.path)}),C},Ge.prototype.nodes=function(){var C=[];return this.forEach(function(B){C.push(this.node)}),C},Ge.prototype.clone=function(){var C=[],B=[];return function ie(me){for(var ce=0;ce<C.length;ce++)if(C[ce]===me)return B[ce];if(typeof me=="object"&&me!==null){var xe=ct(me);return C.push(me),B.push(xe),Pt(yt(me),function(Se){xe[Se]=ie(me[Se])}),C.pop(),B.pop(),xe}return me}(this.value)};var yt=Object.keys||function(C){var B=[];for(var ie in C)B.push(ie);return B};function pt(C){return Object.prototype.toString.call(C)}var Lt=Array.isArray||function(C){return Object.prototype.toString.call(C)==="[object Array]"},Pt=function(C,B){if(C.forEach)return C.forEach(B);for(var ie=0;ie<C.length;ie++)B(C[ie],ie,C)};Pt(yt(Ge.prototype),function(C){En[C]=function(B){var ie=[].slice.call(arguments,1),me=new Ge(B);return me[C].apply(me,ie)}});var gt=Object.hasOwnProperty||function(C,B){return B in C},zt=Tn.exports,At=sr;function sr(C){if(!(this instanceof sr))return new sr(C);this._bbox=C||[1/0,1/0,-1/0,-1/0],this._valid=!!C}sr.prototype.include=function(C){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],C[0]),this._bbox[1]=Math.min(this._bbox[1],C[1]),this._bbox[2]=Math.max(this._bbox[2],C[0]),this._bbox[3]=Math.max(this._bbox[3],C[1]),this},sr.prototype.equals=function(C){var B;return B=C instanceof sr?C.bbox():C,this._bbox[0]==B[0]&&this._bbox[1]==B[1]&&this._bbox[2]==B[2]&&this._bbox[3]==B[3]},sr.prototype.center=function(C){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},sr.prototype.union=function(C){var B;return this._valid=!0,B=C instanceof sr?C.bbox():C,this._bbox[0]=Math.min(this._bbox[0],B[0]),this._bbox[1]=Math.min(this._bbox[1],B[1]),this._bbox[2]=Math.max(this._bbox[2],B[2]),this._bbox[3]=Math.max(this._bbox[3],B[3]),this},sr.prototype.bbox=function(){return this._valid?this._bbox:null},sr.prototype.contains=function(C){if(!C)return this._fastContains();if(!this._valid)return null;var B=C[0],ie=C[1];return this._bbox[0]<=B&&this._bbox[1]<=ie&&this._bbox[2]>=B&&this._bbox[3]>=ie},sr.prototype.intersect=function(C){return this._valid?(B=C instanceof sr?C.bbox():C,!(this._bbox[0]>B[2]||this._bbox[2]<B[0]||this._bbox[3]<B[1]||this._bbox[1]>B[3])):null;var B},sr.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var C="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",C)},sr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Yr=function(C){if(!C)return[];var B=jn(_o(C)),ie=[];return B.features.forEach(function(me){me.geometry&&(ie=ie.concat(So(me.geometry.coordinates)))}),ie},ir=zt,Pi=At,$i={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Li=Object.keys($i);function gn(C){for(var B=Pi(),ie=Yr(C),me=0;me<ie.length;me++)B.include(ie[me]);return B}ii.exports=function(C){return gn(C).bbox()},ii.exports.polygon=function(C){return gn(C).polygon()},ii.exports.bboxify=function(C){return ir(C).map(function(B){B&&Li.some(function(ie){return!!B[ie]&&$i[ie].indexOf(B.type)!==-1})&&(B.bbox=gn(B).bbox(),this.update(B))})};var qn=b(ii.exports),ti=-90;function go(C,B){var ie=ti,me=90,ce=ti,xe=90,Se=270,wt=-270;C.forEach(function(ft){var nr=qn(ft),qt=nr[1],Gr=nr[3],Ti=nr[0],Tr=nr[2];qt>ie&&(ie=qt),Gr<me&&(me=Gr),Gr>ce&&(ce=Gr),qt<xe&&(xe=qt),Ti<Se&&(Se=Ti),Tr>wt&&(wt=Tr)});var Ft=B;return ie+Ft.lat>85&&(Ft.lat=85-ie),ce+Ft.lat>90&&(Ft.lat=90-ce),me+Ft.lat<-85&&(Ft.lat=-85-me),xe+Ft.lat<ti&&(Ft.lat=ti-xe),Se+Ft.lng<=-270&&(Ft.lng+=360*Math.ceil(Math.abs(Ft.lng)/360)),wt+Ft.lng>=270&&(Ft.lng-=360*Math.ceil(Math.abs(Ft.lng)/360)),Ft}function Ro(C,B){var ie=go(C.map(function(me){return me.toGeoJSON()}),B);C.forEach(function(me){var ce,xe=me.getCoordinates(),Se=function(Ft){var ft={lng:Ft[0]+ie.lng,lat:Ft[1]+ie.lat};return[ft.lng,ft.lat]},wt=function(Ft){return Ft.map(function(ft){return Se(ft)})};me.type===Ce.POINT?ce=Se(xe):me.type===Ce.LINE_STRING||me.type===Ce.MULTI_POINT?ce=xe.map(Se):me.type===Ce.POLYGON||me.type===Ce.MULTI_LINE_STRING?ce=xe.map(wt):me.type===Ce.MULTI_POLYGON&&(ce=xe.map(function(Ft){return Ft.map(function(ft){return wt(ft)})})),me.incomingCoords(ce)})}var wi={onSetup:function(C){var B=this,ie={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:C.featureIds||[]};return this.setSelected(ie.initiallySelectedFeatureIds.filter(function(me){return B.getFeature(me)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),ie},fireUpdate:function(){this.map.fire(lt.UPDATE,{action:$t.MOVE,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(){var C=this,B=this.getSelected(),ie=B.filter(function(wt){return C.isInstanceOf("MultiFeature",wt)}),me=!1;if(B.length>1){me=!0;var ce=B[0].type.replace("Multi","");B.forEach(function(wt){wt.type.replace("Multi","")!==ce&&(me=!1)})}var xe=ie.length>0,Se=B.length>0;this.setActionableState({combineFeatures:me,uncombineFeatures:xe,trash:Se})},getUniqueIds:function(C){return C.length?C.map(function(B){return B.properties.id}).filter(function(B){return B!==void 0}).reduce(function(B,ie){return B.add(ie),B},new br).values():[]},stopExtendedInteractions:function(C){C.boxSelectElement&&(C.boxSelectElement.parentNode&&C.boxSelectElement.parentNode.removeChild(C.boxSelectElement),C.boxSelectElement=null),this.map.dragPan.enable(),C.boxSelecting=!1,C.canBoxSelect=!1,C.dragMoving=!1,C.canDragMove=!1},onStop:function(){$r.enable(this)},onMouseMove:function(C,B){return de(B)&&C.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(C),!0},onMouseOut:function(C){return!C.dragMoving||this.fireUpdate()}};wi.onTap=wi.onClick=function(C,B){return se(B)?this.clickAnywhere(C,B):Er(It.VERTEX)(B)?this.clickOnVertex(C,B):de(B)?this.clickOnFeature(C,B):void 0},wi.clickAnywhere=function(C){var B=this,ie=this.getSelectedIds();ie.length&&(this.clearSelectedFeatures(),ie.forEach(function(me){return B.doRender(me)})),$r.enable(this),this.stopExtendedInteractions(C)},wi.clickOnVertex=function(C,B){this.changeMode(Ue.DIRECT_SELECT,{featureId:B.featureTarget.properties.parent,coordPath:B.featureTarget.properties.coord_path,startPos:B.lngLat}),this.updateUIClasses({mouse:Ee.MOVE})},wi.startOnActiveFeature=function(C,B){this.stopExtendedInteractions(C),this.map.dragPan.disable(),this.doRender(B.featureTarget.properties.id),C.canDragMove=!0,C.dragMoveLocation=B.lngLat},wi.clickOnFeature=function(C,B){var ie=this;$r.disable(this),this.stopExtendedInteractions(C);var me=Ze(B),ce=this.getSelectedIds(),xe=B.featureTarget.properties.id,Se=this.isSelected(xe);if(!me&&Se&&this.getFeature(xe).type!==Ce.POINT)return this.changeMode(Ue.DIRECT_SELECT,{featureId:xe});Se&&me?(this.deselect(xe),this.updateUIClasses({mouse:Ee.POINTER}),ce.length===1&&$r.enable(this)):!Se&&me?(this.select(xe),this.updateUIClasses({mouse:Ee.MOVE})):Se||me||(ce.forEach(function(wt){return ie.doRender(wt)}),this.setSelected(xe),this.updateUIClasses({mouse:Ee.MOVE})),this.doRender(xe)},wi.onMouseDown=function(C,B){return Oe(B)?this.startOnActiveFeature(C,B):this.drawConfig.boxSelect&&Sr(B)?this.startBoxSelect(C,B):void 0},wi.startBoxSelect=function(C,B){this.stopExtendedInteractions(C),this.map.dragPan.disable(),C.boxSelectStartLocation=Rr(B.originalEvent,this.map.getContainer()),C.canBoxSelect=!0},wi.onTouchStart=function(C,B){if(Oe(B))return this.startOnActiveFeature(C,B)},wi.onDrag=function(C,B){return C.canDragMove?this.dragMove(C,B):this.drawConfig.boxSelect&&C.canBoxSelect?this.whileBoxSelect(C,B):void 0},wi.whileBoxSelect=function(C,B){C.boxSelecting=!0,this.updateUIClasses({mouse:Ee.ADD}),C.boxSelectElement||(C.boxSelectElement=document.createElement("div"),C.boxSelectElement.classList.add(re.BOX_SELECT),this.map.getContainer().appendChild(C.boxSelectElement));var ie=Rr(B.originalEvent,this.map.getContainer()),me=Math.min(C.boxSelectStartLocation.x,ie.x),ce=Math.max(C.boxSelectStartLocation.x,ie.x),xe=Math.min(C.boxSelectStartLocation.y,ie.y),Se=Math.max(C.boxSelectStartLocation.y,ie.y),wt="translate("+me+"px, "+xe+"px)";C.boxSelectElement.style.transform=wt,C.boxSelectElement.style.WebkitTransform=wt,C.boxSelectElement.style.width=ce-me+"px",C.boxSelectElement.style.height=Se-xe+"px"},wi.dragMove=function(C,B){C.dragMoving=!0,B.originalEvent.stopPropagation();var ie={lng:B.lngLat.lng-C.dragMoveLocation.lng,lat:B.lngLat.lat-C.dragMoveLocation.lat};Ro(this.getSelected(),ie),C.dragMoveLocation=B.lngLat},wi.onTouchEnd=wi.onMouseUp=function(C,B){var ie=this;if(C.dragMoving)this.fireUpdate();else if(C.boxSelecting){var me=[C.boxSelectStartLocation,Rr(B.originalEvent,this.map.getContainer())],ce=this.featuresAt(null,me,"click"),xe=this.getUniqueIds(ce).filter(function(Se){return!ie.isSelected(Se)});xe.length&&(this.select(xe),xe.forEach(function(Se){return ie.doRender(Se)}),this.updateUIClasses({mouse:Ee.MOVE}))}this.stopExtendedInteractions(C)},wi.toDisplayFeatures=function(C,B,ie){B.properties.active=this.isSelected(B.properties.id)?yr.ACTIVE:yr.INACTIVE,ie(B),this.fireActionable(),B.properties.active===yr.ACTIVE&&B.geometry.type!==Ce.POINT&&gi(B).forEach(ie)},wi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},wi.onCombineFeatures=function(){var C=this.getSelected();if(!(C.length===0||C.length<2)){for(var B=[],ie=[],me=C[0].type.replace("Multi",""),ce=0;ce<C.length;ce++){var xe=C[ce];if(xe.type.replace("Multi","")!==me)return;xe.type.includes("Multi")?xe.getCoordinates().forEach(function(wt){B.push(wt)}):B.push(xe.getCoordinates()),ie.push(xe.toGeoJSON())}if(ie.length>1){var Se=this.newFeature({type:Ce.FEATURE,properties:ie[0].properties,geometry:{type:"Multi"+me,coordinates:B}});this.addFeature(Se),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Se.id]),this.map.fire(lt.COMBINE_FEATURES,{createdFeatures:[Se.toGeoJSON()],deletedFeatures:ie})}this.fireActionable()}},wi.onUncombineFeatures=function(){var C=this,B=this.getSelected();if(B.length!==0){for(var ie=[],me=[],ce=function(Se){var wt=B[Se];C.isInstanceOf("MultiFeature",wt)&&(wt.getFeatures().forEach(function(Ft){C.addFeature(Ft),Ft.properties=wt.properties,ie.push(Ft.toGeoJSON()),C.select([Ft.id])}),C.deleteFeature(wt.id,{silent:!0}),me.push(wt.toGeoJSON()))},xe=0;xe<B.length;xe++)ce(xe);ie.length>1&&this.map.fire(lt.UNCOMBINE_FEATURES,{createdFeatures:ie,deletedFeatures:me}),this.fireActionable()}};var Da=Er(It.VERTEX),Es=Er(It.MIDPOINT),Oo={fireUpdate:function(){this.map.fire(lt.UPDATE,{action:$t.CHANGE_COORDINATES,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(C){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:C.selectedCoordPaths.length>0})},startDragging:function(C,B){this.map.dragPan.disable(),C.canDragMove=!0,C.dragMoveLocation=B.lngLat},stopDragging:function(C){this.map.dragPan.enable(),C.dragMoving=!1,C.canDragMove=!1,C.dragMoveLocation=null},onVertex:function(C,B){this.startDragging(C,B);var ie=B.featureTarget.properties,me=C.selectedCoordPaths.indexOf(ie.coord_path);Ze(B)||me!==-1?Ze(B)&&me===-1&&C.selectedCoordPaths.push(ie.coord_path):C.selectedCoordPaths=[ie.coord_path];var ce=this.pathsToCoordinates(C.featureId,C.selectedCoordPaths);this.setSelectedCoordinates(ce)},onMidpoint:function(C,B){this.startDragging(C,B);var ie=B.featureTarget.properties;C.feature.addCoordinate(ie.coord_path,ie.lng,ie.lat),this.fireUpdate(),C.selectedCoordPaths=[ie.coord_path]},pathsToCoordinates:function(C,B){return B.map(function(ie){return{feature_id:C,coord_path:ie}})},onFeature:function(C,B){C.selectedCoordPaths.length===0?this.startDragging(C,B):this.stopDragging(C)},dragFeature:function(C,B,ie){Ro(this.getSelected(),ie),C.dragMoveLocation=B.lngLat},dragVertex:function(C,B,ie){for(var me=C.selectedCoordPaths.map(function(wt){return C.feature.getCoordinate(wt)}),ce=go(me.map(function(wt){return{type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:wt}}}),ie),xe=0;xe<me.length;xe++){var Se=me[xe];C.feature.updateCoordinate(C.selectedCoordPaths[xe],Se[0]+ce.lng,Se[1]+ce.lat)}},clickNoTarget:function(){this.changeMode(Ue.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Ue.SIMPLE_SELECT)},clickActiveFeature:function(C){C.selectedCoordPaths=[],this.clearSelectedCoordinates(),C.feature.changed()},onSetup:function(C){var B=C.featureId,ie=this.getFeature(B);if(!ie)throw new Error("You must provide a featureId to enter direct_select mode");if(ie.type===Ce.POINT)throw new TypeError("direct_select mode doesn't handle point features");var me={featureId:B,feature:ie,dragMoveLocation:C.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:C.coordPath?[C.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(B,me.selectedCoordPaths)),this.setSelected(B),$r.disable(this),this.setActionableState({trash:!0}),me},onStop:function(){$r.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(C,B,ie){C.featureId===B.properties.id?(B.properties.active=yr.ACTIVE,ie(B),gi(B,{map:this.map,midpoints:!0,selectedPaths:C.selectedCoordPaths}).forEach(ie)):(B.properties.active=yr.INACTIVE,ie(B)),this.fireActionable(C)},onTrash:function(C){C.selectedCoordPaths.sort(function(B,ie){return ie.localeCompare(B,"en",{numeric:!0})}).forEach(function(B){return C.feature.removeCoordinate(B)}),this.fireUpdate(),C.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(C),C.feature.isValid()===!1&&(this.deleteFeature([C.featureId]),this.changeMode(Ue.SIMPLE_SELECT,{}))},onMouseMove:function(C,B){var ie=Oe(B),me=Da(B),ce=Es(B),xe=C.selectedCoordPaths.length===0;return ie&&xe||me&&!xe?this.updateUIClasses({mouse:Ee.MOVE}):this.updateUIClasses({mouse:Ee.NONE}),(me||ie||ce)&&C.dragMoving&&this.fireUpdate(),this.stopDragging(C),!0},onMouseOut:function(C){return C.dragMoving&&this.fireUpdate(),!0}};Oo.onTouchStart=Oo.onMouseDown=function(C,B){return Da(B)?this.onVertex(C,B):Oe(B)?this.onFeature(C,B):Es(B)?this.onMidpoint(C,B):void 0},Oo.onDrag=function(C,B){if(C.canDragMove===!0){C.dragMoving=!0,B.originalEvent.stopPropagation();var ie={lng:B.lngLat.lng-C.dragMoveLocation.lng,lat:B.lngLat.lat-C.dragMoveLocation.lat};C.selectedCoordPaths.length>0?this.dragVertex(C,B,ie):this.dragFeature(C,B,ie),C.dragMoveLocation=B.lngLat}},Oo.onClick=function(C,B){return se(B)?this.clickNoTarget(C,B):Oe(B)?this.clickActiveFeature(C,B):W(B)?this.clickInactive(C,B):void this.stopDragging(C)},Oo.onTap=function(C,B){return se(B)?this.clickNoTarget(C,B):Oe(B)?this.clickActiveFeature(C,B):W(B)?this.clickInactive(C,B):void 0},Oo.onTouchEnd=Oo.onMouseUp=function(C){C.dragMoving&&this.fireUpdate(),this.stopDragging(C)};var Bo={};function as(C,B){return!!C.lngLat&&C.lngLat.lng===B[0]&&C.lngLat.lat===B[1]}Bo.onSetup=function(){var C=this.newFeature({type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:[]}});return this.addFeature(C),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Ee.ADD}),this.activateUIButton(Me.POINT),this.setActionableState({trash:!0}),{point:C}},Bo.stopDrawingAndRemove=function(C){this.deleteFeature([C.point.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT)},Bo.onTap=Bo.onClick=function(C,B){this.updateUIClasses({mouse:Ee.MOVE}),C.point.updateCoordinate("",B.lngLat.lng,B.lngLat.lat),this.map.fire(lt.CREATE,{features:[C.point.toGeoJSON()]}),this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.point.id]})},Bo.onStop=function(C){this.activateUIButton(),C.point.getCoordinate().length||this.deleteFeature([C.point.id],{silent:!0})},Bo.toDisplayFeatures=function(C,B,ie){var me=B.properties.id===C.point.id;if(B.properties.active=me?yr.ACTIVE:yr.INACTIVE,!me)return ie(B)},Bo.onTrash=Bo.stopDrawingAndRemove,Bo.onKeyUp=function(C,B){if(nt(B)||Nt(B))return this.stopDrawingAndRemove(C,B)};var Ss={onSetup:function(){var C=this.newFeature({type:Ce.FEATURE,properties:{},geometry:{type:Ce.POLYGON,coordinates:[[]]}});return this.addFeature(C),this.clearSelectedFeatures(),$r.disable(this),this.updateUIClasses({mouse:Ee.ADD}),this.activateUIButton(Me.POLYGON),this.setActionableState({trash:!0}),{polygon:C,currentVertexPosition:0}},clickAnywhere:function(C,B){if(C.currentVertexPosition>0&&as(B,C.polygon.coordinates[0][C.currentVertexPosition-1]))return this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.polygon.id]});this.updateUIClasses({mouse:Ee.ADD}),C.polygon.updateCoordinate("0."+C.currentVertexPosition,B.lngLat.lng,B.lngLat.lat),C.currentVertexPosition++,C.polygon.updateCoordinate("0."+C.currentVertexPosition,B.lngLat.lng,B.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},onMouseMove:function(C,B){C.polygon.updateCoordinate("0."+C.currentVertexPosition,B.lngLat.lng,B.lngLat.lat),Fe(B)&&this.updateUIClasses({mouse:Ee.POINTER})}};Ss.onTap=Ss.onClick=function(C,B){return Fe(B)?this.clickOnVertex(C,B):this.clickAnywhere(C,B)},Ss.onKeyUp=function(C,B){nt(B)?(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT)):Nt(B)&&this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},Ss.onStop=function(C){this.updateUIClasses({mouse:Ee.NONE}),$r.enable(this),this.activateUIButton(),this.getFeature(C.polygon.id)!==void 0&&(C.polygon.removeCoordinate("0."+C.currentVertexPosition),C.polygon.isValid()?this.map.fire(lt.CREATE,{features:[C.polygon.toGeoJSON()]}):(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT,{},{silent:!0})))},Ss.toDisplayFeatures=function(C,B,ie){var me=B.properties.id===C.polygon.id;if(B.properties.active=me?yr.ACTIVE:yr.INACTIVE,!me)return ie(B);if(B.geometry.coordinates.length!==0){var ce=B.geometry.coordinates[0].length;if(!(ce<3)){if(B.properties.meta=It.FEATURE,ie(fi(C.polygon.id,B.geometry.coordinates[0][0],"0.0",!1)),ce>3){var xe=B.geometry.coordinates[0].length-3;ie(fi(C.polygon.id,B.geometry.coordinates[0][xe],"0."+xe,!1))}if(ce<=4){var Se=[[B.geometry.coordinates[0][0][0],B.geometry.coordinates[0][0][1]],[B.geometry.coordinates[0][1][0],B.geometry.coordinates[0][1][1]]];if(ie({type:Ce.FEATURE,properties:B.properties,geometry:{coordinates:Se,type:Ce.LINE_STRING}}),ce===3)return}return ie(B)}}},Ss.onTrash=function(C){this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT)};var No={onSetup:function(C){var B,ie,me=(C=C||{}).featureId,ce="forward";if(me){if(!(B=this.getFeature(me)))throw new Error("Could not find a feature with the provided featureId");var xe=C.from;if(xe&&xe.type==="Feature"&&xe.geometry&&xe.geometry.type==="Point"&&(xe=xe.geometry),xe&&xe.type==="Point"&&xe.coordinates&&xe.coordinates.length===2&&(xe=xe.coordinates),!xe||!Array.isArray(xe))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Se=B.coordinates.length-1;if(B.coordinates[Se][0]===xe[0]&&B.coordinates[Se][1]===xe[1])ie=Se+1,B.addCoordinate.apply(B,[ie].concat(B.coordinates[Se]));else{if(B.coordinates[0][0]!==xe[0]||B.coordinates[0][1]!==xe[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ce="backwards",ie=0,B.addCoordinate.apply(B,[ie].concat(B.coordinates[0]))}}else B=this.newFeature({type:Ce.FEATURE,properties:{},geometry:{type:Ce.LINE_STRING,coordinates:[]}}),ie=0,this.addFeature(B);return this.clearSelectedFeatures(),$r.disable(this),this.updateUIClasses({mouse:Ee.ADD}),this.activateUIButton(Me.LINE),this.setActionableState({trash:!0}),{line:B,currentVertexPosition:ie,direction:ce}},clickAnywhere:function(C,B){if(C.currentVertexPosition>0&&as(B,C.line.coordinates[C.currentVertexPosition-1])||C.direction==="backwards"&&as(B,C.line.coordinates[C.currentVertexPosition+1]))return this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.line.id]});this.updateUIClasses({mouse:Ee.ADD}),C.line.updateCoordinate(C.currentVertexPosition,B.lngLat.lng,B.lngLat.lat),C.direction==="forward"?(C.currentVertexPosition++,C.line.updateCoordinate(C.currentVertexPosition,B.lngLat.lng,B.lngLat.lat)):C.line.addCoordinate(0,B.lngLat.lng,B.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.line.id]})},onMouseMove:function(C,B){C.line.updateCoordinate(C.currentVertexPosition,B.lngLat.lng,B.lngLat.lat),Fe(B)&&this.updateUIClasses({mouse:Ee.POINTER})}};No.onTap=No.onClick=function(C,B){if(Fe(B))return this.clickOnVertex(C,B);this.clickAnywhere(C,B)},No.onKeyUp=function(C,B){Nt(B)?this.changeMode(Ue.SIMPLE_SELECT,{featureIds:[C.line.id]}):nt(B)&&(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT))},No.onStop=function(C){$r.enable(this),this.activateUIButton(),this.getFeature(C.line.id)!==void 0&&(C.line.removeCoordinate(""+C.currentVertexPosition),C.line.isValid()?this.map.fire(lt.CREATE,{features:[C.line.toGeoJSON()]}):(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT,{},{silent:!0})))},No.onTrash=function(C){this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(Ue.SIMPLE_SELECT)},No.toDisplayFeatures=function(C,B,ie){var me=B.properties.id===C.line.id;if(B.properties.active=me?yr.ACTIVE:yr.INACTIVE,!me)return ie(B);B.geometry.coordinates.length<2||(B.properties.meta=It.FEATURE,ie(fi(C.line.id,B.geometry.coordinates[C.direction==="forward"?B.geometry.coordinates.length-2:1],""+(C.direction==="forward"?B.geometry.coordinates.length-2:1),!1)),ie(B))};var Gc={simple_select:wi,direct_select:Oo,draw_point:Bo,draw_polygon:Ss,draw_line_string:No},$l={defaultMode:Ue.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:cr,modes:Gc,controls:{},userProperties:!1},$c={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ql={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Zl(C,B){return C.map(function(ie){return ie.source?ie:bt(ie,{id:ie.id+"."+B,source:B==="hot"?we.HOT:we.COLD})})}var co={exports:{}};(function(C,B){var ie="__lodash_hash_undefined__",me=9007199254740991,ce="[object Arguments]",xe="[object Array]",Se="[object Boolean]",wt="[object Date]",Ft="[object Error]",ft="[object Function]",nr="[object Map]",qt="[object Number]",Gr="[object Object]",Ti="[object Promise]",Tr="[object RegExp]",jt="[object Set]",mt="[object String]",ht="[object Symbol]",Ei="[object WeakMap]",vr="[object ArrayBuffer]",hn="[object DataView]",Bn=/^\[object .+?Constructor\]$/,dr=/^(?:0|[1-9]\d*)$/,on={};on["[object Float32Array]"]=on["[object Float64Array]"]=on["[object Int8Array]"]=on["[object Int16Array]"]=on["[object Int32Array]"]=on["[object Uint8Array]"]=on["[object Uint8ClampedArray]"]=on["[object Uint16Array]"]=on["[object Uint32Array]"]=!0,on[ce]=on[xe]=on[vr]=on[Se]=on[hn]=on[wt]=on[Ft]=on[ft]=on[nr]=on[qt]=on[Gr]=on[Tr]=on[jt]=on[mt]=on[Ei]=!1;var Zs=typeof so=="object"&&so&&so.Object===Object&&so,Ln=typeof self=="object"&&self&&self.Object===Object&&self,Nn=Zs||Ln||Function("return this")(),Ms=B&&!B.nodeType&&B,ls=Ms&&C&&!C.nodeType&&C,Sn=ls&&ls.exports===Ms,hl=Sn&&Zs.process,Xl=function(){try{return hl&&hl.binding&&hl.binding("util")}catch{}}(),cs=Xl&&Xl.isTypedArray;function za(ke,et){for(var er=-1,Cr=ke==null?0:ke.length;++er<Cr;)if(et(ke[er],er,ke))return!0;return!1}function ua(ke){var et=-1,er=Array(ke.size);return ke.forEach(function(Cr,Ji){er[++et]=[Ji,Cr]}),er}function ka(ke){var et=-1,er=Array(ke.size);return ke.forEach(function(Cr){er[++et]=Cr}),er}var Uo,dl,us,fl=Array.prototype,Xu=Function.prototype,hs=Object.prototype,Yl=Nn["__core-js_shared__"],Kr=Xu.toString,Mo=hs.hasOwnProperty,Kl=(Uo=/[^.]+$/.exec(Yl&&Yl.keys&&Yl.keys.IE_PROTO||""))?"Symbol(src)_1."+Uo:"",Yu=hs.toString,id=RegExp("^"+Kr.call(Mo).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),As=Sn?Nn.Buffer:void 0,Qo=Nn.Symbol,pl=Nn.Uint8Array,ha=hs.propertyIsEnumerable,Zc=fl.splice,yo=Qo?Qo.toStringTag:void 0,Is=Object.getOwnPropertySymbols,ml=As?As.isBuffer:void 0,Hc=(dl=Object.keys,us=Object,function(ke){return dl(us(ke))}),_l=Na(Nn,"DataView"),uo=Na(Nn,"Map"),Jl=Na(Nn,"Promise"),gl=Na(Nn,"Set"),yl=Na(Nn,"WeakMap"),da=Na(Object,"create"),Wc=pa(_l),Xc=pa(uo),Fa=pa(Jl),Ql=pa(gl),vl=pa(yl),Cs=Qo?Qo.prototype:void 0,xl=Cs?Cs.valueOf:void 0;function Zn(ke){var et=-1,er=ke==null?0:ke.length;for(this.clear();++et<er;){var Cr=ke[et];this.set(Cr[0],Cr[1])}}function Mt(ke){var et=-1,er=ke==null?0:ke.length;for(this.clear();++et<er;){var Cr=ke[et];this.set(Cr[0],Cr[1])}}function ds(ke){var et=-1,er=ke==null?0:ke.length;for(this.clear();++et<er;){var Cr=ke[et];this.set(Cr[0],Cr[1])}}function Ba(ke){var et=-1,er=ke==null?0:ke.length;for(this.__data__=new ds;++et<er;)this.add(ke[et])}function jo(ke){var et=this.__data__=new Mt(ke);this.size=et.size}function Yc(ke,et){var er=bl(ke),Cr=!er&&nd(ke),Ji=!er&&!Cr&&ma(ke),mi=!er&&!Cr&&!Ji&&nc(ke),Qi=er||Cr||Ji||mi,dn=Qi?function(Si,Qn){for(var An=-1,eo=Array(Si);++An<Si;)eo[An]=Qn(An);return eo}(ke.length,String):[],xo=dn.length;for(var Mn in ke)!Mo.call(ke,Mn)||Qi&&(Mn=="length"||Ji&&(Mn=="offset"||Mn=="parent")||mi&&(Mn=="buffer"||Mn=="byteLength"||Mn=="byteOffset")||Kc(Mn,xo))||dn.push(Mn);return dn}function es(ke,et){for(var er=ke.length;er--;)if(Qu(ke[er][0],et))return er;return-1}function vo(ke){return ke==null?ke===void 0?"[object Undefined]":"[object Null]":yo&&yo in Object(ke)?function(et){var er=Mo.call(et,yo),Cr=et[yo];try{et[yo]=void 0;var Ji=!0}catch{}var mi=Yu.call(et);return Ji&&(er?et[yo]=Cr:delete et[yo]),mi}(ke):function(et){return Yu.call(et)}(ke)}function ec(ke){return Ua(ke)&&vo(ke)==ce}function Hs(ke,et,er,Cr,Ji){return ke===et||(ke==null||et==null||!Ua(ke)&&!Ua(et)?ke!=ke&&et!=et:function(mi,Qi,dn,xo,Mn,Si){var Qn=bl(mi),An=bl(Qi),eo=Qn?xe:Ls(mi),fs=An?xe:Ls(Qi),Ws=(eo=eo==ce?Gr:eo)==Gr,ps=(fs=fs==ce?Gr:fs)==Gr,Rs=eo==fs;if(Rs&&ma(mi)){if(!ma(Qi))return!1;Qn=!0,Ws=!1}if(Rs&&!Ws)return Si||(Si=new jo),Qn||nc(mi)?rc(mi,Qi,dn,xo,Mn,Si):function(Fi,Vi,Tl,Ys,Do,bo,Vo){switch(Tl){case hn:if(Fi.byteLength!=Vi.byteLength||Fi.byteOffset!=Vi.byteOffset)return!1;Fi=Fi.buffer,Vi=Vi.buffer;case vr:return!(Fi.byteLength!=Vi.byteLength||!bo(new pl(Fi),new pl(Vi)));case Se:case wt:case qt:return Qu(+Fi,+Vi);case Ft:return Fi.name==Vi.name&&Fi.message==Vi.message;case Tr:case mt:return Fi==Vi+"";case nr:var ts=ua;case jt:var Ks=1&Ys;if(ts||(ts=ka),Fi.size!=Vi.size&&!Ks)return!1;var ja=Vo.get(Fi);if(ja)return ja==Vi;Ys|=2,Vo.set(Fi,Vi);var Js=rc(ts(Fi),ts(Vi),Ys,Do,bo,Vo);return Vo.delete(Fi),Js;case ht:if(xl)return xl.call(Fi)==xl.call(Vi)}return!1}(mi,Qi,eo,dn,xo,Mn,Si);if(!(1&dn)){var Os=Ws&&Mo.call(mi,"__wrapped__"),Jc=ps&&Mo.call(Qi,"__wrapped__");if(Os||Jc){var Xs=Os?mi.value():mi,th=Jc?Qi.value():Qi;return Si||(Si=new jo),Mn(Xs,th,dn,xo,Si)}}return Rs?(Si||(Si=new jo),function(Fi,Vi,Tl,Ys,Do,bo){var Vo=1&Tl,ts=Ku(Fi),Ks=ts.length,ja=Ku(Vi).length;if(Ks!=ja&&!Vo)return!1;for(var Js=Ks;Js--;){var Qs=ts[Js];if(!(Vo?Qs in Vi:Mo.call(Vi,Qs)))return!1}var _a=bo.get(Fi);if(_a&&bo.get(Vi))return _a==Vi;var Ds=!0;bo.set(Fi,Vi),bo.set(Vi,Fi);for(var El=Vo;++Js<Ks;){var ea=Fi[Qs=ts[Js]],zs=Vi[Qs];if(Ys)var Ao=Vo?Ys(zs,ea,Qs,Vi,Fi,bo):Ys(ea,zs,Qs,Fi,Vi,bo);if(!(Ao===void 0?ea===zs||Do(ea,zs,Tl,Ys,bo):Ao)){Ds=!1;break}El||(El=Qs=="constructor")}if(Ds&&!El){var ks=Fi.constructor,Va=Vi.constructor;ks==Va||!("constructor"in Fi)||!("constructor"in Vi)||typeof ks=="function"&&ks instanceof ks&&typeof Va=="function"&&Va instanceof Va||(Ds=!1)}return bo.delete(Fi),bo.delete(Vi),Ds}(mi,Qi,dn,xo,Mn,Si)):!1}(ke,et,er,Cr,Hs,Ji))}function tc(ke){return!(!ic(ke)||function(et){return!!Kl&&Kl in et}(ke))&&(eh(ke)?id:Bn).test(pa(ke))}function fa(ke){if(er=(et=ke)&&et.constructor,Cr=typeof er=="function"&&er.prototype||hs,et!==Cr)return Hc(ke);var et,er,Cr,Ji=[];for(var mi in Object(ke))Mo.call(ke,mi)&&mi!="constructor"&&Ji.push(mi);return Ji}function rc(ke,et,er,Cr,Ji,mi){var Qi=1&er,dn=ke.length,xo=et.length;if(dn!=xo&&!(Qi&&xo>dn))return!1;var Mn=mi.get(ke);if(Mn&&mi.get(et))return Mn==et;var Si=-1,Qn=!0,An=2&er?new Ba:void 0;for(mi.set(ke,et),mi.set(et,ke);++Si<dn;){var eo=ke[Si],fs=et[Si];if(Cr)var Ws=Qi?Cr(fs,eo,Si,et,ke,mi):Cr(eo,fs,Si,ke,et,mi);if(Ws!==void 0){if(Ws)continue;Qn=!1;break}if(An){if(!za(et,function(ps,Rs){if(Os=Rs,!An.has(Os)&&(eo===ps||Ji(eo,ps,er,Cr,mi)))return An.push(Rs);var Os})){Qn=!1;break}}else if(eo!==fs&&!Ji(eo,fs,er,Cr,mi)){Qn=!1;break}}return mi.delete(ke),mi.delete(et),Qn}function Ku(ke){return function(et,er,Cr){var Ji=er(et);return bl(et)?Ji:function(mi,Qi){for(var dn=-1,xo=Qi.length,Mn=mi.length;++dn<xo;)mi[Mn+dn]=Qi[dn];return mi}(Ji,Cr(et))}(ke,oc,Ju)}function Ps(ke,et){var er,Cr,Ji=ke.__data__;return((Cr=typeof(er=et))=="string"||Cr=="number"||Cr=="symbol"||Cr=="boolean"?er!=="__proto__":er===null)?Ji[typeof et=="string"?"string":"hash"]:Ji.map}function Na(ke,et){var er=function(Cr,Ji){return Cr==null?void 0:Cr[Ji]}(ke,et);return tc(er)?er:void 0}Zn.prototype.clear=function(){this.__data__=da?da(null):{},this.size=0},Zn.prototype.delete=function(ke){var et=this.has(ke)&&delete this.__data__[ke];return this.size-=et?1:0,et},Zn.prototype.get=function(ke){var et=this.__data__;if(da){var er=et[ke];return er===ie?void 0:er}return Mo.call(et,ke)?et[ke]:void 0},Zn.prototype.has=function(ke){var et=this.__data__;return da?et[ke]!==void 0:Mo.call(et,ke)},Zn.prototype.set=function(ke,et){var er=this.__data__;return this.size+=this.has(ke)?0:1,er[ke]=da&&et===void 0?ie:et,this},Mt.prototype.clear=function(){this.__data__=[],this.size=0},Mt.prototype.delete=function(ke){var et=this.__data__,er=es(et,ke);return!(er<0)&&(er==et.length-1?et.pop():Zc.call(et,er,1),--this.size,!0)},Mt.prototype.get=function(ke){var et=this.__data__,er=es(et,ke);return er<0?void 0:et[er][1]},Mt.prototype.has=function(ke){return es(this.__data__,ke)>-1},Mt.prototype.set=function(ke,et){var er=this.__data__,Cr=es(er,ke);return Cr<0?(++this.size,er.push([ke,et])):er[Cr][1]=et,this},ds.prototype.clear=function(){this.size=0,this.__data__={hash:new Zn,map:new(uo||Mt),string:new Zn}},ds.prototype.delete=function(ke){var et=Ps(this,ke).delete(ke);return this.size-=et?1:0,et},ds.prototype.get=function(ke){return Ps(this,ke).get(ke)},ds.prototype.has=function(ke){return Ps(this,ke).has(ke)},ds.prototype.set=function(ke,et){var er=Ps(this,ke),Cr=er.size;return er.set(ke,et),this.size+=er.size==Cr?0:1,this},Ba.prototype.add=Ba.prototype.push=function(ke){return this.__data__.set(ke,ie),this},Ba.prototype.has=function(ke){return this.__data__.has(ke)},jo.prototype.clear=function(){this.__data__=new Mt,this.size=0},jo.prototype.delete=function(ke){var et=this.__data__,er=et.delete(ke);return this.size=et.size,er},jo.prototype.get=function(ke){return this.__data__.get(ke)},jo.prototype.has=function(ke){return this.__data__.has(ke)},jo.prototype.set=function(ke,et){var er=this.__data__;if(er instanceof Mt){var Cr=er.__data__;if(!uo||Cr.length<199)return Cr.push([ke,et]),this.size=++er.size,this;er=this.__data__=new ds(Cr)}return er.set(ke,et),this.size=er.size,this};var Ju=Is?function(ke){return ke==null?[]:(ke=Object(ke),function(et,er){for(var Cr=-1,Ji=et==null?0:et.length,mi=0,Qi=[];++Cr<Ji;){var dn=et[Cr];er(dn,Cr,et)&&(Qi[mi++]=dn)}return Qi}(Is(ke),function(et){return ha.call(ke,et)}))}:function(){return[]},Ls=vo;function Kc(ke,et){return!!(et=et??me)&&(typeof ke=="number"||dr.test(ke))&&ke>-1&&ke%1==0&&ke<et}function pa(ke){if(ke!=null){try{return Kr.call(ke)}catch{}try{return ke+""}catch{}}return""}function Qu(ke,et){return ke===et||ke!=ke&&et!=et}(_l&&Ls(new _l(new ArrayBuffer(1)))!=hn||uo&&Ls(new uo)!=nr||Jl&&Ls(Jl.resolve())!=Ti||gl&&Ls(new gl)!=jt||yl&&Ls(new yl)!=Ei)&&(Ls=function(ke){var et=vo(ke),er=et==Gr?ke.constructor:void 0,Cr=er?pa(er):"";if(Cr)switch(Cr){case Wc:return hn;case Xc:return nr;case Fa:return Ti;case Ql:return jt;case vl:return Ei}return et});var nd=ec(function(){return arguments}())?ec:function(ke){return Ua(ke)&&Mo.call(ke,"callee")&&!ha.call(ke,"callee")},bl=Array.isArray,ma=ml||function(){return!1};function eh(ke){if(!ic(ke))return!1;var et=vo(ke);return et==ft||et=="[object GeneratorFunction]"||et=="[object AsyncFunction]"||et=="[object Proxy]"}function wl(ke){return typeof ke=="number"&&ke>-1&&ke%1==0&&ke<=me}function ic(ke){var et=typeof ke;return ke!=null&&(et=="object"||et=="function")}function Ua(ke){return ke!=null&&typeof ke=="object"}var nc=cs?function(ke){return function(et){return ke(et)}}(cs):function(ke){return Ua(ke)&&wl(ke.length)&&!!on[vo(ke)]};function oc(ke){return(et=ke)!=null&&wl(et.length)&&!eh(et)?Yc(ke):fa(ke);var et}C.exports=function(ke,et){return Hs(ke,et)}})(co,co.exports);var yn=b(co.exports);function Zr(C,B){return C.length===B.length&&JSON.stringify(C.map(function(ie){return ie}).sort())===JSON.stringify(B.map(function(ie){return ie}).sort())}var Wu={Polygon:gr,LineString:Ir,Point:pr,MultiPolygon:kt,MultiLineString:kt,MultiPoint:kt},Hl=Object.freeze({__proto__:null,CommonSelectors:He,constrainFeatureMovement:go,createMidPoint:Ui,createSupplementaryPoints:gi,createVertex:fi,doubleClickZoom:$r,euclideanDistance:Jr,featuresAt:Jn,getFeatureAtAndSetCursors:Ci,isClick:Zt,isEventAtCoordinates:as,isTap:Pn,mapEventToBoundingBox:Kn,ModeHandler:g,moveFeatures:Ro,sortFeatures:Cn,stringSetsAreEqual:Zr,StringSet:br,theme:cr,toDenseArray:ve}),qc=function(C,B){var ie={options:C=function(ce){ce===void 0&&(ce={});var xe=bt(ce);return ce.controls||(xe.controls={}),ce.displayControlsDefault===!1?xe.controls=bt(ql,ce.controls):xe.controls=bt($c,ce.controls),(xe=bt($l,xe)).styles=Zl(xe.styles,"cold").concat(Zl(xe.styles,"hot")),xe}(C)};B=function(ce,xe){return xe.modes=Ue,xe.getFeatureIdsAt=function(Se){return Jn.click({point:Se},null,ce).map(function(wt){return wt.properties.id})},xe.getSelectedIds=function(){return ce.store.getSelectedIds()},xe.getSelected=function(){return{type:Ce.FEATURE_COLLECTION,features:ce.store.getSelectedIds().map(function(Se){return ce.store.get(Se)}).map(function(Se){return Se.toGeoJSON()})}},xe.getSelectedPoints=function(){return{type:Ce.FEATURE_COLLECTION,features:ce.store.getSelectedCoordinates().map(function(Se){return{type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:Se.coordinates}}})}},xe.set=function(Se){if(Se.type===void 0||Se.type!==Ce.FEATURE_COLLECTION||!Array.isArray(Se.features))throw new Error("Invalid FeatureCollection");var wt=ce.store.createRenderBatch(),Ft=ce.store.getAllIds().slice(),ft=xe.add(Se),nr=new br(ft);return(Ft=Ft.filter(function(qt){return!nr.has(qt)})).length&&xe.delete(Ft),wt(),ft},xe.add=function(Se){var wt=JSON.parse(JSON.stringify(Fn(Se))).features.map(function(Ft){if(Ft.id=Ft.id||_r(),Ft.geometry===null)throw new Error("Invalid geometry: null");if(ce.store.get(Ft.id)===void 0||ce.store.get(Ft.id).type!==Ft.geometry.type){var ft=Wu[Ft.geometry.type];if(ft===void 0)throw new Error("Invalid geometry type: "+Ft.geometry.type+".");var nr=new ft(ce,Ft);ce.store.add(nr)}else{var qt=ce.store.get(Ft.id);qt.properties=Ft.properties,yn(qt.properties,Ft.properties)||ce.store.featureChanged(qt.id),yn(qt.getCoordinates(),Ft.geometry.coordinates)||qt.incomingCoords(Ft.geometry.coordinates)}return Ft.id});return ce.store.render(),wt},xe.get=function(Se){var wt=ce.store.get(Se);if(wt)return wt.toGeoJSON()},xe.getAll=function(){return{type:Ce.FEATURE_COLLECTION,features:ce.store.getAll().map(function(Se){return Se.toGeoJSON()})}},xe.delete=function(Se){return ce.store.delete(Se,{silent:!0}),xe.getMode()!==Ue.DIRECT_SELECT||ce.store.getSelectedIds().length?ce.store.render():ce.events.changeMode(Ue.SIMPLE_SELECT,void 0,{silent:!0}),xe},xe.deleteAll=function(){return ce.store.delete(ce.store.getAllIds(),{silent:!0}),xe.getMode()===Ue.DIRECT_SELECT?ce.events.changeMode(Ue.SIMPLE_SELECT,void 0,{silent:!0}):ce.store.render(),xe},xe.changeMode=function(Se,wt){return wt===void 0&&(wt={}),Se===Ue.SIMPLE_SELECT&&xe.getMode()===Ue.SIMPLE_SELECT?(Zr(wt.featureIds||[],ce.store.getSelectedIds())||(ce.store.setSelected(wt.featureIds,{silent:!0}),ce.store.render()),xe):(Se===Ue.DIRECT_SELECT&&xe.getMode()===Ue.DIRECT_SELECT&&wt.featureId===ce.store.getSelectedIds()[0]||ce.events.changeMode(Se,wt,{silent:!0}),xe)},xe.getMode=function(){return ce.events.getMode()},xe.trash=function(){return ce.events.trash({silent:!0}),xe},xe.combineFeatures=function(){return ce.events.combineFeatures({silent:!0}),xe},xe.uncombineFeatures=function(){return ce.events.uncombineFeatures({silent:!0}),xe},xe.setFeatureProperty=function(Se,wt,Ft){return ce.store.setFeatureProperty(Se,wt,Ft),xe},xe}(ie,B),ie.api=B;var me=Dt(ie);return B.onAdd=me.onAdd,B.onRemove=me.onRemove,B.types=Me,B.options=C,B};function Wl(C){qc(C,this)}return Wl.modes=Gc,Wl.constants=Ai,Wl.lib=Hl,Wl})})(RS);var Bk=RS.exports;const Nk=np(Bk);function Ar(l,f,g,b){function E(P){return P instanceof g?P:new g(function(z){z(P)})}return new(g||(g=Promise))(function(P,z){function j(Q){try{K(b.next(Q))}catch(re){z(re)}}function s(Q){try{K(b.throw(Q))}catch(re){z(re)}}function K(Q){Q.done?P(Q.value):E(Q.value).then(j,s)}K((b=b.apply(l,[])).next())})}const OS=l=>l&&l.outerHTML!=="<div></div>",ao=(l,f,g=[void 0])=>{const b={},E=f||Object.keys(l);for(const P of E)g.some(z=>z===l[P])||(b[P]=l[P]);return b},DS=(l,f)=>l.parent?l.parent.type?l.parent.type.name===f:l.parent.vnode.tag?l.parent.vnode.tag.endsWith(f):!1:!1,Uk=(l,f)=>l.parent?l.parent.type?l.parent.type.name.includes(f):l.parent.vnode.tag?l.parent.vnode.tag.includes(f):!1:!1,O0=(l,f,g)=>{for(const b of g)l.on(b,E=>{f.emit(b,E)})};var jk=()=>navigator.userAgent.toLowerCase().includes("safari")&&!navigator.userAgent.toLocaleLowerCase().includes("chrome");const Vk=(l,f,g,b)=>Ar(void 0,void 0,void 0,function*(){const E=l?yield l.promise:null,P=$k(g),z=new Dk(P);DS(b,"MapboxMap")&&E?E.addControl(z):(b.parent&&z.addTo(b.refs.geocoder),OS(b.refs["custom-input"])&&qk(b.refs["custom-input"],z,b)),f.resolve(z)}),Gk=(l,f)=>Ar(void 0,void 0,void 0,function*(){const g=yield l.promise;g.on("result",b=>{f.emit("result",b.result),f.proxy.geocoderState.result=b.result}),g.on("results",b=>{f.emit("results",b),f.proxy.geocoderState.results=b}),g.on("error",b=>{f.emit("error",b),f.proxy.geocoderState.error=b}),g.on("loading",b=>{f.emit("loading",b),f.proxy.geocoderState.loading=b}),g.on("clear",()=>{f.emit("clear")})}),$k=l=>{const f=ao(l);return f.accessToken=l.accessToken||cl.accessToken,f.mapboxgl=cl,f},qk=(l,f,g)=>{if(g&&g.proxy){g.proxy.showOriginalGeocoder&&(g.proxy.showOriginalGeocoder=!1);const b=l.getElementsByTagName("input");if(!b)throw new Error("MapboxGeocoderControl: No inputs found");const E=b[0];E.addEventListener("keyup",P=>{f.query(E.value),jk()&&(setTimeout(()=>{E.focus()},100),setTimeout(()=>{E.focus()},200))})}};var zS=$n({name:"MapboxGeocoderControl",props:{accessToken:{type:String,default:""},origin:{type:String},zoom:{type:Number},flyTo:{type:[Boolean,Object],default:()=>{}},placeholder:{type:String},proximity:{type:Object},trackProximity:{type:Boolean,default:()=>{}},collapsed:{type:Boolean,default:()=>{}},clearAndBlurOnEsc:{type:Boolean,default:()=>{}},clearOnBlur:{type:Boolean,default:()=>{}},bbox:{type:Array},countries:{type:String},types:{type:String},minLength:{type:Number},limit:{type:Number},language:{type:String},filter:{type:Function},localGeocoder:{type:Function},externalGeocoder:{type:Function},reverseGeocode:{type:Boolean,default:()=>{}},enableEventLogging:{type:Boolean,default:()=>{}},marker:{type:Boolean,default:()=>{}},render:{type:Function},getItemValue:{type:Function},mode:{type:String},localGeocoderOnly:{type:Boolean,default:()=>{}}},setup(l){const f=_n("vmb_map",null),g=new Hu,b=Po(!0),E=Po({result:{},results:{},error:null,loading:null});return mo(()=>Ar(this,void 0,void 0,function*(){const P=Zu();P&&(yield Vk(f,g,l,P)),P&&(yield Gk(g,P))})),lo(()=>Ar(this,void 0,void 0,function*(){const P=yield g.promise;if(f){const z=yield f.promise;z._removed||z.removeControl(P)}})),Yn(l,()=>Ar(this,void 0,void 0,function*(){})),{showOriginalGeocoder:b,geocoderState:E}}});const Zk={ref:"geocoder"},Hk={ref:"custom-input"};function Wk(l,f,g,b,E,P){return Di(),Ki("div",null,[GP(Ni("div",Zk,null,512),[[NL,l.showOriginalGeocoder]]),Ni("div",Hk,[ss(l.$slots,"input",{result:l.geocoderState.result,results:l.geocoderState.results,error:l.geocoderState.error,loading:l.geocoderState.loading})],512)])}zS.render=Wk;var oa=(l,f,g)=>l&&l.value!==void 0?Yn(l,f,g):null;function Xk(l,f,g){if(window.ResizeObserver)Kk(l,f);else{const b=Jk(l,g);Yn(b,()=>{f.resize()})}}function Yk(l,f){f.value&&l.touchZoomRotate.enable(),Yn(f,g=>{g?l.touchZoomRotate.enable():l.touchZoomRotate.disable()})}function Kk(l,f){if(!l.value)throw new Error("Could not enable auto-resize because root container could not be found");new window.ResizeObserver(()=>f.resize()).observe(l.value)}function Jk(l,f){const g=Zu(),b=tp(new DOMRect(0,0,0,0).toJSON());if(g){let E=l.value?l.value.getBoundingClientRect():new DOMRect(0,0,0,0);addEventListener("resize",P=>{setTimeout(()=>{if(l.value){const z=l.value.getBoundingClientRect().toJSON(),j=E.width!==z.width||E.height!==z.height;E=z,j&&Object.assign(b,z)}},f||0)})}return b}const kS=l=>({height:l.height,width:l.width,"--zoom-logo":l.zoomLogo>=.8?l.zoomLogo:1}),Qk=l=>l.includes("/")?l:`mapbox://styles/mapbox/${l}`,eF=(l,f)=>{const g=ao(l,["accessToken","antialias","attributionControl","bearing","bearingSnap","bounds","boxZoom","center","clickTolerance","collectResourceTiming","container","cooperativeGestures","crossSourceCollisions","customAttribution","doubleClickZoom","dragPan","dragRotate","fadeDuration","failIfMajorPerformanceCaveat","fitBoundsOptions","hash","interactive","keyboard","localIdeographFontFamily","logoPosition","maxBounds","maxPitch","maxTileCacheSize","maxZoom","minPitch","minZoom","pitch","pitchWithRotate","preserveDrawingBuffer","projection","refreshExpiredTiles","renderWorldCopies","scrollZoom","touchZoomRotate","trackResize","transformRequest","zoom"]);return g.style=Qk(l.mapStyle),g.container=f,g},tF=(l,f,g,b)=>(()=>{const E=g.value,P=eF(l,E),z=new cl.Map(P);z.on("load",()=>{f.resolve(z)}),l.autoResize&&Xk(b,z,l.autoResizeDelay),l.touchZoomRotate&&Yk(z,wP(l,"touchZoomRotate"))})(),rF=(l,f)=>{f.value=kS(l)};function iF(l,f,g){return Ar(this,void 0,void 0,function*(){const{cooperativeGestures:b,width:E,height:P,bearing:z,maxBounds:j,maxPitch:s,minZoom:K,maxZoom:Q,minPitch:re,pitch:we,projection:Ee,renderWorldCopies:Me,zoom:Ce,mapStyle:Ue}=vP(f),{center:lt,flyToOptions:$t}=g;yield oF(l,E,P),yield sF(l,{bearing:z,maxBounds:j,maxPitch:s,minPitch:re,pitch:we,renderWorldCopies:Me}),yield aF(l,{maxZoom:Q,center:lt,flyToOptions:$t,minZoom:K,zoom:Ce}),yield nF(l,Ue),yield lF(l,Ee)})}function nF(l,f){return Ar(this,void 0,void 0,function*(){const g=yield l.promise;Yn(f,b=>g.setStyle(b))})}function oF(l,f,g){return Ar(this,void 0,void 0,function*(){const b=yield l.promise;Yn(f,()=>b.resize()),Yn(g,()=>b.resize())})}function sF(l,f){return Ar(this,void 0,void 0,function*(){const g=yield l.promise;oa(f.bearing,b=>g.setBearing(b)),oa(f.maxBounds,b=>g.setMaxBounds(b)),oa(f.maxPitch,b=>g.setMaxPitch(b)),oa(f.minPitch,b=>g.setMinPitch(b)),oa(f.pitch,b=>g.setPitch(b)),oa(f.renderWorldCopies,b=>g.setRenderWorldCopies(b))})}function aF(l,f){oa(f.center,g=>Of(l,{center:g}),{deep:!0}),oa(f.flyToOptions,g=>Of(l,{flyToOptions:g}),{deep:!0}),oa(f.maxZoom,g=>Of(l,{maxZoom:g})),oa(f.minZoom,g=>Of(l,{minZoom:g})),oa(f.zoom,g=>Of(l,{zoom:g}))}function lF(l,f){return Ar(this,void 0,void 0,function*(){const g=yield l.promise;oa(f,b=>g.setProjection(b))})}function Of(l,f){return Ar(this,void 0,void 0,function*(){const g=yield l.promise,b=f.flyToOptions?ao(f.flyToOptions,["curve","maxDuration","minZoom","screenSpeed","speed"]):{};f.center&&(b.center=f.center),f.zoom&&(b.zoom=f.zoom),g.flyTo(b)})}const FS=["boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemouve","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],cF=[...FS,"update:center","update:flyToOptions","update:zoom","update:pitch","update:bearing","loaded"],uF=(l,f)=>Ar(void 0,void 0,void 0,function*(){const g=yield l.promise;O0(g,f,FS),f.emit("loaded",g),g.on("zoomend",b=>{f.emit("update:zoom",b.target.getZoom()),f.emit("update:center",b.target.getCenter().toArray())}),g.on("dragend",b=>{f.emit("update:center",b.target.getCenter().toArray())}),g.on("pitchend",b=>{f.emit("update:pitch",b.target.getPitch())}),g.on("rotateend",b=>{f.emit("update:bearing",b.target.getBearing())})}),hF=l=>{const f=["string","number","boolean"];let g=!1;return l===null&&(g=!0),f.some(b=>typeof l===b)&&(g=!0),g};function rT(l,f="change",g="value"){const b=Zu(),E=f instanceof Array?f:[f];if(!b)throw new Error("vmodel: Instance not found");const P=Po(b.props[g]||l);for(const z of E)Yn(P,j=>{b.emit(z,P.value)});return Yn(b.props,()=>{(hF(b.props[g])?b.props[g]!==P.value:!LS(b.props[g],P.value))&&(P.value=b.props[g])}),P}var O_=$n({name:"MapboxMap",emits:cF,props:{accessToken:{type:String,required:!0},height:{type:String,default:"100%"},width:{type:String,default:"100%"},container:{type:[Object,String],default:""},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],default:"mapbox://styles/mapbox/streets-v11"},hash:{type:Boolean},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number},attributionControl:{type:Boolean,default:!0},customAttribution:{type:Array},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean},preserveDrawingBuffer:{type:Boolean},antialias:{type:Boolean},refreshExpiredTiles:{type:Boolean},maxBounds:{type:[Array,Object]},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Object,Boolean],default:!0},keyboard:{type:Boolean},doubleClickZoom:{type:Boolean},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{default:()=>[0,0]},zoom:{type:Number},bearing:{type:Number},pitch:{type:Number},bounds:{type:Array},fitBoundsOptions:{type:Object},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0},zoomLogo:{type:Number,default:1},flyToOptions:{default:()=>({})},autoResize:{type:Boolean,default:!1},autoResizeDelay:{type:Number},cooperativeGestures:{type:Boolean,default:!1},projection:{type:String}},setup:l=>{const f=Po(null),g=Po(null),b=new R_;bs("vmb_map",b);const E=rT(l,"update:center","center"),P=rT(l,"update:flyToOptions","flyToOptions"),z=Po(kS(l));return Yn(l,j=>Ar(void 0,void 0,void 0,function*(){rF(j,z)})),iF(b,l,{center:E,flyToOptions:P}),mo(()=>Ar(void 0,void 0,void 0,function*(){const j=Zu();cl.accessToken=l.accessToken,tF(l,b,g,f),j&&(yield uF(b,j))})),lo(()=>Ar(void 0,void 0,void 0,function*(){(yield b.promise).remove()})),{vmb_map:b,root:f,style:z,i_center:E,i_flyToOptions:P,mapContainer:g}}});const dF={key:1};function fF(l,f,g,b,E,P){return Di(),Ki("div",{style:$h(l.style),ref:"root",class:"mapbox-map"},[Ni("div",null,[ss(l.$slots,"default")]),l.vmb_map.isResolved?(Di(),Ki("div",{key:0,ref:"mapContainer",class:"map-container",style:$h({height:l.height,width:l.width})},null,4)):(Di(),Ki("div",dF,[ss(l.$slots,"loader",{},()=>[Ni("div",{style:$h(l.style)},null,4)])]))],4)}function pF(l,f){f===void 0&&(f={});var g=f.insertAt;if(!(typeof document>"u")){var b=document.head||document.getElementsByTagName("head")[0],E=document.createElement("style");E.type="text/css",g==="top"&&b.firstChild?b.insertBefore(E,b.firstChild):b.appendChild(E),E.styleSheet?E.styleSheet.cssText=l:E.appendChild(document.createTextNode(l))}}var mF=`[data-v-55cc3ed8] .mapboxgl-ctrl-logo {
  zoom: var(--zoom-logo);
}`;pF(mF);O_.render=fF;O_.__scopeId="data-v-55cc3ed8";var _F={setup(){return{vmb_map:_n("vmb_map",null)}}};const gF=l=>DS(l,"MapboxMarker"),yF=l=>ao(l,["element","offset","anchor","color","draggable","clickTolerance","rotation","rotationAlignment","pitchAlignment","scale"]),BS=["drag","dragend","dragstart"],vF=[...BS,"update:lngLat","click"],xF=(l,f)=>{O0(l,f,BS),l.on("dragend",g=>f.emit("update:lngLat",g.target._lngLat.toArray())),l.getElement().addEventListener("click",g=>f.emit("click",g))},bF=(l,f)=>Ar(void 0,void 0,void 0,function*(){const g=yield f.promise,b=ao(l);typeof b.draggable=="boolean"&&g.setDraggable(b.draggable),b.lngLat&&g.setLngLat(b.lngLat),b.offset&&g.setOffset(b.offset),b.rotation&&g.setRotation(b.rotation),b.pitchAlignment&&g.setPitchAlignment(b.pitchAlignment),b.rotationAlignment&&g.setRotationAlignment(b.rotationAlignment)}),wF=(l,f,g,b,E,P)=>Ar(void 0,void 0,void 0,function*(){const z=yield f.promise;P&&OS(P.value)&&(l.element=P.value);const j=new A0.Marker(l).setLngLat(E);j.addTo(z),g.resolve(j)});var NS=$n({name:"MapboxMarker",emits:vF,props:{lngLat:{default:()=>[0,0]},offset:{type:[Array],default:()=>[0,0]},anchor:{type:String,default:()=>"bottom"},color:{type:String,default:"#4668F2"},scale:{type:Number,default:1},draggable:{type:Boolean,default:!1},rotation:{type:Number,default:0},pitchAlignment:{type:String,default:"auto"},rotationAlignment:{type:String,default:"auto"}},setup(l){const{vmb_map:f}=_F.setup(),g=new Hu,b=Po(null),E=yF(l);return bs("vmb_marker",g),mo(()=>Ar(this,void 0,void 0,function*(){const P=Zu();if(P&&f){yield wF(E,f,g,P,l.lngLat,b);const z=yield g.promise;xF(z,P)}})),lo(()=>Ar(this,void 0,void 0,function*(){(yield g.promise).remove()})),Yn(l,P=>Ar(this,void 0,void 0,function*(){yield bF(P,g)})),{icon:b}}});const TF={ref:"icon"},EF=["height","width"],SF={"fill-rule":"nonzero"},MF=oE('<g transform="translate(3.0, 29.0)" fill="#000000"><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="10.5" ry="5.25002273"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="10.5" ry="5.25002273"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="9.5" ry="4.77275007"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="8.5" ry="4.29549936"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="7.5" ry="3.81822308"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="6.5" ry="3.34094679"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="5.5" ry="2.86367051"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="4.5" ry="2.38636864"></ellipse></g>',1),AF=["fill"],IF=Ni("path",{d:"M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"},null,-1),CF=[IF],PF=oE('<g opacity="0.25" fill="#000000"><path d="M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"></path></g><g transform="translate(6.0, 7.0)" fill="#FFFFFF"></g><g transform="translate(8.0, 8.0)"><circle fill="#000000" opacity="0.25" cx="5.5" cy="5.5" r="5.4999962"></circle><circle fill="#FFFFFF" cx="5.5" cy="5.5" r="5.4999962"></circle></g>',3);function LF(l,f,g,b,E,P){return Di(),Ki("div",null,[Ni("div",TF,[ss(l.$slots,"icon",{},()=>[(Di(),Ki("svg",{display:"block",height:42*l.scale+"px",width:27*l.scale+"px",viewBox:"0 0 27 41"},[Ni("g",SF,[MF,Ni("g",{fill:l.color},CF,8,AF),PF])],8,EF))])],512),ss(l.$slots,"default")])}NS.render=LF;const RF=l=>{const{showCompass:f,showZoom:g,vizualizePitch:b}=l;return{showCompass:f,showZoom:g,vizualizePitch:b}},OF=(l,f,g)=>Ar(void 0,void 0,void 0,function*(){(yield f.promise).addControl(l,g)});var US=$n({name:"MapboxNavigationControl",props:{showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:{type:Boolean,default:!1},position:{type:String,default:()=>"top-right"}},setup(l){const f=_n("vmb_map",null),g=RF(l),b=new cl.NavigationControl(g),E=l.position;mo(()=>{f&&OF(b,f,E)}),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeControl(b)}))}});function DF(l,f,g,b,E,P){return Di(),Ki("div")}US.render=DF;const zF=(l,f)=>{f.getLayer(l)&&f.removeLayer(l)},kF=(l,f)=>{f.getSource(l)&&f.removeSource(l)},FF=l=>Uk(l,"MapboxGeogeometry"),zf=l=>l/110.574,kf=(l,f)=>l/(Math.cos(f*Math.PI/180)*111.32),D_=(l,f)=>Ar(void 0,void 0,void 0,function*(){const g=yield l.promise,b=f;zF(b.id,g),kF(b.id,g),g.addSource(b.id,b.getGeoJSON())}),z_=(l,f,g)=>Ar(void 0,void 0,void 0,function*(){const b=yield f.promise,E=g,P=ao(l),z=b.getSource(E.id);E.updateOptions(P),z.setData(E.getGeoJSON().data)}),BF=(l,f,g)=>Ar(void 0,void 0,void 0,function*(){f&&(yield f.promise).setPopup(g)}),NF=(l,f,g)=>Ar(void 0,void 0,void 0,function*(){const b=yield f.promise,E=yield l.promise;if(b.id){const P=yield b.geogeometry.promise;E.on("click",b.id,z=>{const j=P.center;g.setLngLat(j).addTo(E)})}}),jS=l=>ao(l,["closeButton","closeOnClick","closeOnMove","focusAfterOpen","anchor","offset","className","maxWidth"]),UF=(l,f,g,b,E,P)=>Ar(void 0,void 0,void 0,function*(){const z=yield f.promise,j=g;P.value&&j.setDOMContent(P.value),gF(l)?yield BF(l,b,j):FF(l)&&E?yield NF(f,E,j):j.addTo(z)}),VS=["close","open"],jF=[...VS],VF=(l,f)=>{O0(l,f,VS)},GF=(l,f)=>Ar(void 0,void 0,void 0,function*(){const g=jS(l);g.maxWidth&&f.setMaxWidth(g.maxWidth),g.offset&&f.setOffset(g.offset),l.lngLat&&f.setLngLat(l.lngLat)});var GS=$n({name:"MapboxPopup",emits:jF,props:{lngLat:{type:[Object,Array],default:()=>[0,0]},closeButton:{type:Boolean,default:!1},closeOnClick:{type:Boolean,default:!0},closeOnMove:{type:Boolean,default:!1},anchor:{type:String,default:void 0},offset:{type:[Number,Array],default:void 0},className:{type:String},focusAfterOpen:{type:Boolean,default:!0},maxWidth:{type:String,default:"500px"},renderless:{type:Boolean,default:!1}},setup(l){const f=Po(null),g=_n("vmb_map",null),b=_n("vmb_marker",null),E=_n("vmb_geogeometry_paint",null),P=jS(l),z=new cl.Popup(P).setLngLat(l.lngLat);return mo(()=>Ar(this,void 0,void 0,function*(){const j=Zu();g&&j&&(yield UF(j,g,z,b,E,f),VF(z,j))})),Yn(l,j=>{GF(j,z)}),lo(()=>Ar(this,void 0,void 0,function*(){z.remove()})),{content:f}}});const $F={ref:"content"};function qF(l,f,g,b,E,P){return Di(),Ki("div",$F,[ss(l.$slots,"default")],512)}GS.render=qF;const ZF=l=>ao(l),HF=(l,f)=>Ar(void 0,void 0,void 0,function*(){(yield l.promise).addControl(f)});var $S=$n({name:"MapboxAttributionControl",props:{compact:{type:Boolean,default:!1},customAttribution:{type:[String,Array],default:void 0}},setup(l){const f=ZF(l),g=new cl.AttributionControl(f),b=_n("vmb_map",null);mo(()=>Ar(this,void 0,void 0,function*(){b&&HF(b,g)})),lo(()=>Ar(this,void 0,void 0,function*(){b&&(yield b.promise).removeControl(g)}))}});function WF(l,f,g,b,E,P){return Di(),Ki("div")}$S.render=WF;const XF=l=>{const{maxWidth:f,unit:g}=l;return{maxWidth:f,unit:g}},YF=(l,f)=>Ar(void 0,void 0,void 0,function*(){(yield l.promise).addControl(f)});var qS=$n({name:"MapboxScaleControl",props:{maxWidth:{type:Number,default:100},unit:{type:String,default:"metric"}},setup(l){const f=XF(l),g=new cl.ScaleControl(f),b=_n("vmb_map",null);mo(()=>Ar(this,void 0,void 0,function*(){b&&(yield YF(b,g))})),lo(()=>Ar(this,void 0,void 0,function*(){b&&(yield b.promise).removeControl(g)}))}});function KF(l,f,g,b,E,P){return Di(),Ki("div")}qS.render=KF;const JF=l=>ao(l),QF=(l,f)=>Ar(void 0,void 0,void 0,function*(){(yield f.promise).addControl(l)});var ZS=$n({name:"MapboxFullscreenControl",props:{container:{type:Object,default:void 0}},setup(l){const f=_n("vmb_map",null),g=JF(l),b=new cl.FullscreenControl(g);mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield QF(b,f))})),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeControl(b)}))}});function eB(l,f,g,b,E,P){return Di(),Ki("div")}ZS.render=eB;const tB=l=>ao(l,["position"]),rB=(l,f)=>{l.on("draw.create",g=>{f.emit("create",g)}),l.on("draw.update",g=>{f.emit("update",g)}),l.on("draw.delete",g=>{f.emit("delete",g)}),l.on("draw.selectionchange",g=>{f.emit("selectionchange",g)})},iB=(l,f,g,b)=>Ar(void 0,void 0,void 0,function*(){b.emit("loaded",f);const E=yield l.promise;rB(E,b),E.addControl(f,g.position)});var HS=$n({name:"MapboxDrawControl",props:{position:{type:String,default:"top-left"}},setup(l){const f=tB(l),g=new Nk,b=_n("vmb_map",null);mo(()=>Ar(this,void 0,void 0,function*(){const E=Zu();b&&E&&iB(b,g,f,E)})),lo(()=>Ar(this,void 0,void 0,function*(){b&&(yield b.promise).removeControl(g)}))}});function nB(l,f,g,b,E,P){return Di(),Ki("div")}HS.render=nB;var WS=$n({name:"MapboxSourceGeoJson",props:{container:{type:Object,default:void 0}},setup(l){const f=_n("vmb_map",null);new A0.GeoJSONSource,mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).addSource}))}});const oB={ref:"features"};function sB(l,f,g,b,E,P){return Di(),Ki("div",oB,[ss(l.$slots,"default")],512)}WS.render=sB;const aB=l=>ao(l);var XS=$n({name:"MapboxGeolocateControl",props:{positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},setup(l){const f=_n("vmb_map",null),g=aB(l),b=new cl.GeolocateControl(g);mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).addControl(b)})),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeControl(b)}))}});function lB(l,f,g,b,E,P){return Di(),Ki("div")}XS.render=lB;class k_{constructor(f){this.id=f.id,this.fillColor=f.fillColor||"#4668F2",this.antialias=typeof f.antialias=="boolean"?f.antialias:!0,this.opacity=typeof f.opacity=="number"?f.opacity:.6,f.outlineColor&&(this.outlineColor=f.outlineColor),this.deferred=new Hu,bs("vmb_geogeometry",this.deferred)}updateOptions(f){f.fillColor&&(this.fillColor=f.fillColor),typeof f.antialias=="boolean"&&(this.antialias=f.antialias),typeof f.opacity=="number"&&(this.opacity=f.opacity),f.outlineColor&&(this.outlineColor=f.outlineColor)}getPaint(){const f={};return this.fillColor&&(f["fill-color"]=this.fillColor),this.antialias&&(f["fill-antialias"]=this.antialias),this.opacity&&(f["fill-opacity"]=this.opacity),this.outlineColor&&(f["fill-outline-color"]=this.outlineColor),f}getLayer(){return{id:this.id,type:"fill",source:this.id,layout:{},paint:this.getPaint()}}}class cB extends k_{constructor(f){super(f),this.edges=f.edges||10,this.radius=f.radius,this.center=f.center}updateOptions(f){super.updateOptions(f),f.edges&&(this.edges=f.edges),f.radius&&(this.radius=f.radius),f.center&&(this.center=f.center)}getGeoJSON(){const f=this.edges,g=kf(this.radius,this.center[1]),b=zf(this.radius),E=[];for(let P=0;P<f;P++){const z=P/f*(2*Math.PI),j=g*Math.cos(z),s=b*Math.sin(z);E.push([this.center[0]+j,this.center[1]+s])}return E.push(E[0]),{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[E]},properties:{}}]}}}}class YS{constructor(f){this.geogeometry=f.geogeometry,this.deferred=new Hu,bs("vmb_geogeometry_paint",this.deferred)}_init(f,g){return Ar(this,void 0,void 0,function*(){const b=yield this.geogeometry.promise;this.geoId=b.id,this.id=`${this.geoId}-${f}-${g}`})}setGeoId(f){this.geoId=f}}let iT=0;class uB extends YS{constructor(f){super(f),this.geoId=f.geoId,this.id=`${f.geoId}-fill-${iT++}`,this.color=f.color||"#4668F2",this.antialias=typeof f.antialias=="boolean"?f.antialias:!0,this.opacity=typeof f.opacity=="number"?f.opacity:.6,f.outlineColor&&(this.outlineColor=f.outlineColor)}init(){const f=Object.create(null,{_init:{get:()=>super._init}});return Ar(this,void 0,void 0,function*(){yield f._init.call(this,"fill",iT++)})}getPaint(){const f={};return this.color&&(f["fill-color"]=this.color),this.antialias&&(f["fill-antialias"]=this.antialias),this.opacity&&(f["fill-opacity"]=this.opacity),this.outlineColor&&(f["fill-outline-color"]=this.outlineColor),f}update(f,g){return Ar(this,void 0,void 0,function*(){const b=yield g.promise,E=ao(f);this.id&&(E.color&&E.color!==this.color&&(b.setPaintProperty(this.id,"fill-color",E.color),this.color=E.color),typeof E.antialias=="boolean"&&E.antialias!==this.antialias&&(b.setPaintProperty(this.id,"fill-antialias",E.antialias),this.antialias=E.antialias),typeof E.opacity=="number"&&E.opacity!==this.opacity&&(b.setPaintProperty(this.id,"fill-opacity",E.opacity),this.opacity=E.opacity),E.outlineColor&&E.outlineColor!==this.outlineColor&&(b.setPaintProperty(this.id,"fill-outline-color",E.outlineColor),this.outlineColor=E.outlineColor))})}getLayer(){if(this.id)return{id:this.id,type:"fill",source:this.geoId,layout:{},paint:this.getPaint()};throw new Error("Geogeometry.Paint.Fill: Cannot get layer. Not initialized")}}var rd=$n({name:"MapboxGeogeometryFill",props:{color:{type:String,default:"#4668F2"},antialias:{type:Boolean,default:!0},opacity:{type:Number,default:.6},outlineColor:{type:String}},setup(l){const f=_n("vmb_geogeometry",null),g=new Hu,b=_n("vmb_map",null);if(!f)throw new Error("MapboxGeogeometryFill: no geogeometry found as parent");const E=new uB(Object.assign(Object.assign({},ao(l)),{geogeometry:f}));return bs("vmb_fill",g),mo(()=>Ar(this,void 0,void 0,function*(){if(b&&f){const P=yield b.promise;(yield f.promise)&&P&&(yield E.init(),P.addLayer(E.getLayer()),g.resolve(E),E.deferred.resolve(E))}})),Yn(l,()=>Ar(this,void 0,void 0,function*(){const P=yield g.promise;P&&b&&P.update(l,b)})),lo(()=>Ar(this,void 0,void 0,function*(){b&&E.id&&(yield b.promise).removeLayer(E.id)})),{}}});function hB(l,f,g,b,E,P){return Di(),Ki("div",null,[ss(l.$slots,"default")])}rd.render=hB;let dB=0;var KS=$n({name:"MapboxGeogeometryCircle",components:{MapboxGeogeometryFill:rd},props:{id:{type:String,default:"circle"},center:{type:Array,required:!0},radius:{type:Number,required:!0},edges:{type:Number,default:10},fillColor:{type:String},outlineColor:{type:String},opacity:{type:Number},antialias:{type:Boolean}},setup(l){const f=_n("vmb_map",null),g=new R_,b=`${l.id}-${dB++}`,E=new cB(ao(Object.assign(Object.assign({},l),{id:b}),["id","radius","center","edges","fillColor","outlineColor","opacity","antialias"]));bs("vmb_circle",g),mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield D_(f,E),g.resolve(E),E.deferred.resolve(E))})),Yn(l,()=>Ar(this,void 0,void 0,function*(){f&&(yield z_(l,f,E))})),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeLayer(E.id)}))}});const fB={ref:"features"};function pB(l,f,g,b,E,P){const z=Vl("mapbox-geogeometry-fill");return Di(),Ki("div",fB,[ss(l.$slots,"default",{},()=>[bn(z,{color:l.fillColor,outlineColor:l.outlineColor,opacity:l.opacity,antialias:l.antialias},{default:jl(()=>[ss(l.$slots,"popup")]),_:3},8,["color","outlineColor","opacity","antialias"])])],512)}KS.render=pB;class mB extends k_{constructor(f){super(f),this.path=f.path}updateOptions(f){super.updateOptions(f),f.path&&(this.path=f.path)}get center(){const f=this.path.reduce((g,b)=>[g[0]+b[0],g[1]+b[1]]);return[f[0]/this.path.length,f[1]/this.path.length]}getGeoJSON(){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[this.path]},properties:{}}]}}}}let _B=0;var JS=$n({name:"MapboxGeogeometryPolygon",components:{MapboxGeogeometryFill:rd},props:{id:{type:String,default:"polygon"},path:{type:Array,required:!0},fillColor:{type:String},outlineColor:{type:String},opacity:{type:Number},antialias:{type:Boolean}},setup(l){const f=_n("vmb_map",null),g=new R_,b=`${l.id}-${_B++}`,E=new mB(ao(Object.assign(Object.assign({},l),{id:b}),["id","path","fillColor","outlineColor","opacity","antialias"]));bs("vmb_polygon",g),mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield D_(f,E),g.resolve(E),E.deferred.resolve(E))})),Yn(l,()=>Ar(this,void 0,void 0,function*(){f&&(E.updateOptions(l),yield z_(l,f,E))})),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeLayer(E.id)}))}});const gB={ref:"features"};function yB(l,f,g,b,E,P){const z=Vl("mapbox-geogeometry-fill");return Di(),Ki("div",gB,[ss(l.$slots,"default",{},()=>[bn(z,{color:l.fillColor,outlineColor:l.outlineColor,opacity:l.opacity,antialias:l.antialias},{default:jl(()=>[ss(l.$slots,"popup")]),_:3},8,["color","outlineColor","opacity","antialias"])])],512)}JS.render=yB;const vB=(l,f)=>{if(l.length!==4)throw"MapboxGeogeometryRectangle.rotateRectagle: Not a rectangle. Please supply exactly four coordinates";const g=f*Math.PI/180,b=[];for(let E=0;E<l.length;E++)b.push([l[E][0]*Math.cos(g)-l[E][1]*Math.sin(g),l[E][0]*Math.sin(g)+l[E][1]*Math.cos(g)]);return b};class xB extends k_{constructor(f){super(f),this.width=f.width,this.height=f.height,this.center=f.center,this.rotationDeg=f.rotationDeg||0}updateOptions(f){super.updateOptions(f),f.width&&(this.width=f.width),f.height&&(this.height=f.height),typeof f.rotationDeg=="number"&&f.rotationDeg!==this.rotationDeg&&(this.rotationDeg=f.rotationDeg)}get coordinates(){const f=vB([[this.width/2,this.height/2],[-this.width/2,this.height/2],[-this.width/2,-this.height/2],[this.width/2,-this.height/2]],this.rotationDeg);return[[this.center[0]+kf(f[0][0],this.center[1]),this.center[1]+zf(f[0][1])],[this.center[0]+kf(f[1][0],this.center[1]),this.center[1]+zf(f[1][1])],[this.center[0]+kf(f[2][0],this.center[1]),this.center[1]+zf(f[2][1])],[this.center[0]+kf(f[3][0],this.center[1]),this.center[1]+zf(f[3][1])]]}getGeoJSON(){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.coordinates,this.coordinates[0]]]},properties:{}}]}}}}let bB=0;var QS=$n({name:"MapboxGeogeometryRectangle",components:{MapboxGeogeometryFill:rd},props:{id:{type:String,default:"rectangle"},center:{type:Array,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},fillColor:{type:String},outlineColor:{type:String},opacity:{type:Number,default:.6},antialias:{type:Boolean,default:!0},rotationDeg:{type:Number}},setup(l){const f=_n("vmb_map",null),g=new R_,b=`${l.id}-${bB++}`,E=new xB(ao(Object.assign(Object.assign({},l),{id:b}),["id","width","height","center","fillColor","outlineColor","opacity","antialias","rotationDeg"]));bs("vmb_rectangle",g),mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield D_(f,E),g.resolve(E),E.deferred.resolve(E))})),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeLayer(E.id)})),Yn(l,()=>Ar(this,void 0,void 0,function*(){f&&(yield z_(l,f,E))}))}});const wB={ref:"features"};function TB(l,f,g,b,E,P){const z=Vl("mapbox-geogeometry-fill");return Di(),Ki("div",wB,[ss(l.$slots,"default",{},()=>[bn(z,{color:l.fillColor,outlineColor:l.outlineColor,opacity:l.opacity,antialias:l.antialias},{default:jl(()=>[ss(l.$slots,"popup")]),_:3},8,["color","outlineColor","opacity","antialias"])])],512)}QS.render=TB;const EB=l=>l.length<=1?!1:l[0][0]===l[l.length-1][0]&&l[0][1]===l[l.length-1][1],SB=l=>l.length===0||l[0].length===2&&typeof l[0][0]=="number"&&typeof l[0][1]=="number",eM=(l,f=0,g=[0,0])=>{let b=f;const E=[g[0],g[1]];if(SB(l)){EB(l)&&l.pop();for(const P of l)E[0]=(P[0]+E[0]*b)/(b+1),E[1]=(P[1]+E[1]*b)/(b+1),b++}else for(const P of l){const{visited:z,center:j}=eM(P);E[0]=(E[0]*b+j[0]*z)/(z+b),E[1]=(E[1]*b+j[1]*z)/(z+b),b+=z}return{visited:b,center:E}},tM=(l,f=0,g=[0,0])=>{let b=f;const E=[g[0],g[1]];switch(l.geometry.type){case"Polygon":case"LineString":{const{center:P,visited:z}=eM(l.geometry.coordinates);E[0]=(E[0]*b+P[0]*z)/(z+b),E[1]=(E[1]*b+P[1]*z)/(z+b),b+=z;break}}return{visited:b,center:E}},MB=(l,f=0,g=[0,0])=>{let b=f;const E=[g[0],g[1]];for(const P of l.features){const{center:z,visited:j}=tM(P);E[0]=(E[0]*b+z[0]*j)/(j+b),E[1]=(E[1]*b+z[1]*j)/(j+b),b+=j;break}return{visited:b,center:E}};class AB extends k_{constructor(f){super(f),this.source=f.source}updateOptions(f){super.updateOptions(f),f.source&&(this.source=f.source)}get center(){const f=this.getGeoJSONData();if(!f||!f.type)return console.warn("Geogeometry Raw: Could not get center. Coordinates could not be obtained"),[0,0];if(f.type==="Feature")return tM(f).center;if(f.type==="FeatureCollection")return MB(f).center;throw new Error("Geogeometry Raw: Unknown Error getting Center")}getGeoJSON(){return this.source.type==="geojson"?this.source:{type:"geojson",data:this.source}}getGeoJSONData(){return this.getGeoJSON().data}}let IB=0;var rM=$n({name:"MapboxGeogeometryRaw",components:{MapboxGeogeometryFill:rd},props:{source:{type:Object,required:!0},id:{type:String,default:"raw"},fillColor:{type:String,default:"red"},outlineColor:{type:String},opacity:{type:Number},antialias:{type:Boolean}},setup(l){const f=_n("vmb_map",null),g=new Hu,b=`${l.id}-${IB++}`,E=new AB(ao(Object.assign(Object.assign({},l),{id:b}),["source","id","fillColor","outlineColor","opacity","antialias"]));bs("vmb_raw",g),mo(()=>Ar(this,void 0,void 0,function*(){f&&(yield D_(f,E),g.resolve(E),E.deferred.resolve(E))})),Yn(l,()=>Ar(this,void 0,void 0,function*(){f&&(E.updateOptions(l),yield z_(l,f,E))})),lo(()=>Ar(this,void 0,void 0,function*(){f&&(yield f.promise).removeLayer(E.id)}))}});const CB={ref:"features"};function PB(l,f,g,b,E,P){return Vl("mapbox-geogeometry-fill"),Di(),Ki("div",CB,[ss(l.$slots,"default",{},()=>[wL("",!0)])],512)}rM.render=PB;let LB=0;class RB extends YS{constructor(f){super(f),this.color=f.color||"#000",this.opacity=typeof f.opacity=="number"?f.opacity:.6,f.geoId&&(this.geoId=f.geoId),typeof f.blur=="number"&&(this.blur=f.blur),f.cap&&(this.cap=f.cap),f.join&&(this.join=f.join),typeof f.width=="number"&&(this.width=f.width),f.translate&&(this.translate=f.translate),typeof f.offset=="number"&&(this.offset=f.offset),f.dasharray&&(this.dasharray=f.dasharray),typeof f.gapWidth=="number"&&(this.gapWidth=f.gapWidth),f.gradient&&(this.gradient=f.gradient),typeof f.miterLimit=="number"&&(this.miterLimit=f.miterLimit),typeof f.roundLimit=="number"&&(this.roundLimit=f.roundLimit),typeof f.sortKey=="number"&&(this.sortKey=f.sortKey),f.translateAnchor&&(this.translateAnchor=f.translateAnchor)}getPaint(){const f={"line-blur":this.blur,"line-opacity":this.opacity,"line-color":this.color,"line-width":this.width,"line-translate":this.translate,"line-offset":this.offset,"line-dasharray":this.dasharray,"line-gap-width":this.gapWidth,"line-translate-anchor":this.translateAnchor},g=ao(f);return console.log(g),g}getLayout(){const f={"line-cap":this.cap,"line-join":this.join,"line-miter-limit":this.miterLimit,"line-round-limit":this.roundLimit,"line-sort-key":this.sortKey},g=ao(f);return console.log(g),g}init(){return super._init("line",LB++),this}update(f,g){return Ar(this,void 0,void 0,function*(){const b=yield g.promise,E=ao(f);this.id&&(E.color&&E.color!==this.color&&(b.setPaintProperty(this.id,"line-color",E.color),this.color=E.color),typeof E.blur=="number"&&E.blur!==this.blur&&(b.setPaintProperty(this.id,"line-blur",E.blur),this.blur=E.blur),E.cap&&E.cap!==this.cap&&(b.setPaintProperty(this.id,"line-cap",E.cap),this.cap=E.cap),E.join&&E.join!==this.join&&(b.setPaintProperty(this.id,"line-join",E.join),this.join=E.join),typeof E.opacity=="number"&&E.opacity!==this.opacity&&(b.setPaintProperty(this.id,"line-opacity",E.opacity),this.opacity=E.opacity),typeof E.width=="number"&&E.width!==this.width&&(b.setPaintProperty(this.id,"line-width",E.width),this.width=E.width),E.translate&&this.translate&&(E.translate[0]!==this.translate[0]||E.translate[1]!==this.translate[1])&&(b.setPaintProperty(this.id,"line-translate",E.translate),this.translate=E.translate),typeof E.offset=="number"&&this.offset!==E.offset&&(b.setPaintProperty(this.id,"line-offset",E.offset),this.offset=E.offset),E.dasharray&&!LS(this.dasharray,E.dasharray)&&(b.setPaintProperty(this.id,"line-dasharray",E.dasharray),this.dasharray=E.dasharray),typeof E.gapWidth=="number"&&this.gapWidth!==E.gapWidth&&(b.setPaintProperty(this.id,"line-gap-width",E.gapWidth),this.gapWidth=E.gapWidth),typeof E.miterLimit=="number"&&this.miterLimit!==E.miterLimit&&(b.setPaintProperty(this.id,"line-miter-limit",E.miterLimit),this.miterLimit=E.miterLimit),typeof E.roundLimit=="number"&&this.roundLimit!==E.roundLimit&&(b.setPaintProperty(this.id,"line-round-limit",E.roundLimit),this.roundLimit=E.roundLimit),typeof E.sortKey=="number"&&(b.setPaintProperty(this.id,"line-sort-key",E.sortKey),this.sortKey=E.sortKey),E.translateAnchor&&this.translateAnchor!==E.translateAnchor&&(b.setPaintProperty(this.id,"line-translate-anchor",E.translateAnchor),this.translateAnchor=E.translateAnchor))})}getLayer(){if(this.id)return{id:this.id,type:"line",source:this.geoId,layout:this.getLayout(),paint:this.getPaint()};throw new Error("Geogeometry.Paint.Line: Cannot get Layer. Not initialized")}}var iM=$n({name:"MapboxGeogeometryLine",props:{blur:{type:Number},cap:{type:String},join:{type:String},opacity:{type:Number,default:1},color:{type:String,default:"#4668F2"},width:{type:Number},translate:{type:Array},offset:{type:Number},dasharray:{type:Array},gapWidth:{type:Number}},setup(l){const f=_n("vmb_geogeometry",null),g=new Hu,b=_n("vmb_map",null);if(bs("vmb_paint",g),!f)throw new Error("MapboxGeogeometryLine: no geogeometry found as parent");const E=new RB(Object.assign(Object.assign({},ao(l)),{geogeometry:f}));return mo(()=>Ar(this,void 0,void 0,function*(){if(b&&f){yield E.init();const P=yield b.promise;(yield f.promise)&&P&&(P.addLayer(E.getLayer()),g.resolve(E))}})),Yn(l,()=>Ar(this,void 0,void 0,function*(){const P=yield g.promise;P&&b&&P.update(l,b)})),lo(()=>Ar(this,void 0,void 0,function*(){b&&E.id&&(yield b.promise).removeLayer(E.id)})),{}}});function OB(l,f,g,b,E,P){return Di(),Ki("div")}iM.render=OB;var nT=Object.freeze({__proto__:null,MapboxGeocoderControl:zS,MapboxMap:O_,MapboxMarker:NS,MapboxNavigationControl:US,MapboxPopup:GS,MapboxAttributionControl:$S,MapboxScaleControl:qS,MapboxFullscreenControl:ZS,MapboxDrawControl:HS,MapboxSourceGeoJson:WS,MapboxGeolocateControl:XS,MapboxGeogeometryCircle:KS,MapboxGeogeometryPolygon:JS,MapboxGeogeometryRectangle:QS,MapboxGeogeometryRaw:rM,MapboxGeogeometryFill:rd,MapboxGeogeometryLine:iM}),DB=l=>{Object.keys(nT).forEach(f=>{l.component(f,nT[f])})};const zB=Ni("div",null,"I am the content of an attached Popup",-1),kB="pk.eyJ1IjoibmF0aGFuaG9sbG93cyIsImEiOiJjbDlrdHNmb2wwZnh1M25waGw5cnpmYnhpIn0.nP2qRwkxz9Wzho0ym2J1mA",FB={__name:"MapView",setup(l){return(f,g)=>{const b=Vl("mapbox-geolocate-control"),E=Vl("mapbox-popup"),P=Vl("mapbox-marker");return Di(),rp(al(O_),{height:"50vh",zoom:"11",center:[170.5006128,-45.8738144],accessToken:kB,class:"w-full h-80"},{default:jl(()=>[bn(b,{position:"top-left"}),bn(P,{lngLat:[170.5006128,-45.8738144]},{default:jl(()=>[bn(E,null,{default:jl(()=>[zB]),_:1})]),_:1})]),_:1})}}},BB=uO({history:UR("/"),routes:[{path:"/",name:"home",component:p3},{path:"/map",name:"map",component:FB},{path:"/routes/:routeName/stops/:stops",name:"Routes",component:m3,props:!0}]}),F_=nR(xO);F_.use(cR());F_.use(BB);F_.use(DB);F_.mount("#app");
